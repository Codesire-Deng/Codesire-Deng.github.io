<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Archlinuxè£…æœºç¬”è®°</title>
    <url>/2022/10/24/Archlinux%E8%A3%85%E6%9C%BA%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><strong>é‡è¦æ•°æ®Â·åŠ¡å¿…å¤‡ä»½</strong>ï¼å›ºæ€ç¡¬ç›˜æŠ¥åºŸï¼Œè¿å¸¦ Linux æ— äº†ï¼Œåªèƒ½é‡è£…ã€‚æå°†æ¥ä¹Ÿä¼šé¢‘ç¹è£…æœºï¼Œæ•…å†™ä¸€ç¯‡ç¬”è®°ï¼Œå¸Œæœ›ä¸€åŠ³æ°¸é€¸ã€‚</p>
<span id="more"></span>

<h2 id="è¿›å…¥æ¡Œé¢å‰"><a href="#è¿›å…¥æ¡Œé¢å‰" class="headerlink" title="è¿›å…¥æ¡Œé¢å‰"></a>è¿›å…¥æ¡Œé¢å‰</h2><h3 id="å‡†å¤‡è£…æœºç›˜"><a href="#å‡†å¤‡è£…æœºç›˜" class="headerlink" title="å‡†å¤‡è£…æœºç›˜"></a>å‡†å¤‡è£…æœºç›˜</h3><ol>
<li>åœ¨ <a href="https://archlinux.org/download/">archlinux</a> æ‰¾åˆ°é•œåƒæºï¼Œä¸‹è½½ ISOã€‚</li>
<li>ç”¨ <a href="https://rufus.ie/zh/">Rufus</a> ä¹‹ç±»çš„åˆ· U ç›˜ã€‚<ul>
<li>MBR åˆ†åŒº</li>
<li>ISO æ¨¡å¼</li>
</ul>
</li>
</ol>
<h3 id="å¼•å¯¼è¿›è£…æœºç›˜"><a href="#å¼•å¯¼è¿›è£…æœºç›˜" class="headerlink" title="å¼•å¯¼è¿›è£…æœºç›˜"></a>å¼•å¯¼è¿›è£…æœºç›˜</h3><p>åç¡•ä¸»æ¿çš„å¿«æ·é”®æ˜¯ <code>F11</code>ã€‚å¦‚æœé»‘å±ï¼Œå°† DP çº¿æ¢æˆ HDMIã€‚</p>
<h3 id="archinstall"><a href="#archinstall" class="headerlink" title="archinstall"></a>archinstall</h3><ol>
<li>è¿›ä¸´æ—¶æ“ä½œç³»ç»Ÿä¹‹åï¼Œè¿ç½‘çº¿ï¼Œè¿è¡Œ <code>archinstall</code>ã€‚</li>
<li>é€‰é•œåƒæºï¼ˆmirror regionï¼‰</li>
<li>é€‰æ‹©æ ¼å¼åŒ–ç¡¬ç›˜</li>
<li>åˆ›å»º superuserã€‚</li>
<li>å…¶ä»–é€‰é¡¹éƒ½æ£€æŸ¥ä¸€ä¸‹ã€‚archinstall å¯èƒ½ä¼šæœ‰å¤§å¹…çš„æ›´æ–°ã€‚</li>
<li>install! </li>
<li>æœ€åæç¤º chrootï¼Œåœ¨é‡Œé¢ <code>systemctl enable sddm</code>ã€‚</li>
</ol>
<h3 id="å¡-wayland"><a href="#å¡-wayland" class="headerlink" title="å¡ wayland"></a>å¡ wayland</h3><p>N å¡ + nvidia ä¸“æœ‰é©±åŠ¨ + wayland &#x3D; é»‘å±</p>
<p>åœ¨ <code>~/.local/share/sddm/wayland-session.log</code> å¯æŸ¥çœ‹ logã€‚</p>
<ol>
<li>å…ˆç”¨ X11 ç™»é™†ï¼ŒæŠŠç¯å¢ƒéƒ½é…ç½®å¥½å†å›æ¥ã€‚</li>
<li>æ·»åŠ å†…æ ¸å‚æ•°ï¼š<code>nvidia-drm.modeset=1</code>ã€‚è¿™æ˜¯ wayland è¦æ±‚çš„ã€‚<ul>
<li>é€‚ç”¨äº systemd-bootï¼š<code>kate /boot/loader/entries/xxxx.conf</code>ã€‚è¿½åŠ å‚æ•°ã€‚</li>
</ul>
</li>
<li>å·²ç»èƒ½ç”¨äº†ï¼Œä½†æ˜¯ BUG å¾ˆå¤šåˆå¡é¡¿ï¼ŒFuck Nvidiaã€‚é‚æ”¾å¼ƒï¼Œæˆ–è€…<a href="https://forum.manjaro.org/t/installing-video-nvidia-causes-kde-sddm-to-fail-to-load/110395/6">å‚è€ƒ</a></li>
</ol>
<h2 id="è¿›å…¥æ¡Œé¢å"><a href="#è¿›å…¥æ¡Œé¢å" class="headerlink" title="è¿›å…¥æ¡Œé¢å"></a>è¿›å…¥æ¡Œé¢å</h2><h3 id="æ·»åŠ -sudo-å…å¯†"><a href="#æ·»åŠ -sudo-å…å¯†" class="headerlink" title="æ·»åŠ  sudo å…å¯†"></a>æ·»åŠ  sudo å…å¯†</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">su</span><br><span class="line">vim /etc/sudoers.d/00_codesire</span><br><span class="line"><span class="comment"># å†…å®¹å¦‚ä¸‹</span></span><br><span class="line">codesire ALL=(ALL:ALL) NOPASSWD: ALL</span><br></pre></td></tr></table></figure>

<h3 id="è°ƒæ•´å¿«æ·é”®"><a href="#è°ƒæ•´å¿«æ·é”®" class="headerlink" title="è°ƒæ•´å¿«æ·é”®"></a>è°ƒæ•´å¿«æ·é”®</h3><ol>
<li>Konsole</li>
<li>System Settings</li>
<li>KRunner</li>
<li>ï¼ˆåé¢å®‰è£…çš„ï¼‰Flameshot: <code>/usr/bin/flameshot gui</code></li>
</ol>
<h3 id="å®‰è£…-yay"><a href="#å®‰è£…-yay" class="headerlink" title="å®‰è£… yay"></a>å®‰è£… yay</h3><p>åˆ©ç”¨ git ä¸‹è½½é¢„ç¼–è¯‘ç‰ˆå®‰è£…ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo pacman -S git</span><br><span class="line"><span class="built_in">cd</span> ~ &amp;&amp; <span class="built_in">mkdir</span> -p .<span class="built_in">local</span>/opt &amp;&amp; <span class="built_in">cd</span> .<span class="built_in">local</span>/opt</span><br><span class="line">git <span class="built_in">clone</span> https://aur.archlinux.org/yay-bin.git</span><br><span class="line"><span class="built_in">cd</span> yay-bin &amp;&amp; makepkg -si</span><br></pre></td></tr></table></figure>

<h3 id="å®‰è£…ä¸­æ–‡å­—ä½“"><a href="#å®‰è£…ä¸­æ–‡å­—ä½“" class="headerlink" title="å®‰è£…ä¸­æ–‡å­—ä½“"></a>å®‰è£…ä¸­æ–‡å­—ä½“</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo pacman -S noto-fonts noto-fonts-cjk noto-fonts-emoji</span><br><span class="line"><span class="built_in">cd</span> ~ &amp;&amp; <span class="built_in">mkdir</span> -p .config/fontconfig</span><br><span class="line">kate .config/fontconfig/fonts.conf</span><br></pre></td></tr></table></figure>

<p>é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;UTF-8&#x27;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">fontconfig</span> <span class="keyword">SYSTEM</span> <span class="string">&#x27;urn:fontconfig:fonts.dtd&#x27;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- $&#123;XDG_CONFIG_HOME&#125;/fontconfig/fonts.conf</span></span><br><span class="line"><span class="comment">        - vim:ft=xml:fenc=utf-8:noet:ts=3:sw=3:</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fontconfig</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">alias</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">family</span>&gt;</span>serif<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">prefer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Serif<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans CJK SC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans CJK TC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans CJK JP<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">prefer</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">alias</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">alias</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">family</span>&gt;</span>sans-serif<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">prefer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans CJK SC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans CJK TC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans CJK JP<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">prefer</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">alias</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">alias</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">family</span>&gt;</span>monospace<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">prefer</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans Mono<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Color Emoji<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans Mono CJK SC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans Mono CJK TC<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">family</span>&gt;</span>Noto Sans Mono CJK JP<span class="tag">&lt;/<span class="name">family</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">prefer</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">alias</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">match</span> <span class="attr">target</span>=<span class="string">&quot;font&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">edit</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">name</span>=<span class="string">&quot;antialias&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bool</span>&gt;</span>true<span class="tag">&lt;/<span class="name">bool</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">edit</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">name</span>=<span class="string">&quot;autohint&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bool</span>&gt;</span>true<span class="tag">&lt;/<span class="name">bool</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">edit</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">name</span>=<span class="string">&quot;dpi&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">double</span>&gt;</span>96<span class="tag">&lt;/<span class="name">double</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">edit</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hinting&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bool</span>&gt;</span>true<span class="tag">&lt;/<span class="name">bool</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">edit</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">name</span>=<span class="string">&quot;hintstyle&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">const</span>&gt;</span>hintslight<span class="tag">&lt;/<span class="name">const</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">edit</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">name</span>=<span class="string">&quot;lcdfilter&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">const</span>&gt;</span>lcdlight<span class="tag">&lt;/<span class="name">const</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">edit</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">name</span>=<span class="string">&quot;rgba&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">const</span>&gt;</span>rgb<span class="tag">&lt;/<span class="name">const</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">edit</span> <span class="attr">mode</span>=<span class="string">&quot;assign&quot;</span> <span class="attr">name</span>=<span class="string">&quot;size&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">int</span>&gt;</span>15<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">edit</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">match</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dir</span>&gt;</span>~/.fonts<span class="tag">&lt;/<span class="name">dir</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fontconfig</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>åˆ·æ–°å­—ä½“ç¼“å­˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">fc-cache -fv</span><br></pre></td></tr></table></figure>

<p>å¯èƒ½éœ€è¦é‡å¯ç”Ÿæ•ˆï¼Œä½†æ˜¯å…ˆä¸é‡å¯ã€‚</p>
<h3 id="å®‰è£…å¸¸ç”¨è½¯ä»¶"><a href="#å®‰è£…å¸¸ç”¨è½¯ä»¶" class="headerlink" title="å®‰è£…å¸¸ç”¨è½¯ä»¶"></a>å®‰è£…å¸¸ç”¨è½¯ä»¶</h3><p>è°œä¹‹ CPU è½¯ä»¶åŒ…ï¼Œä¸è¦å…¨è£…ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo pacman -S amd-ucode</span><br><span class="line">sudo pacman -S intel-ucode</span><br></pre></td></tr></table></figure>

<p>manï¼Œæµè§ˆå™¨ï¼Œè¾“å…¥æ³•ï¼Œvscodeï¼Œopensshï¼Œfiracodeï¼Œflameshotï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yay -S man-db man-pages google-chrome-stable fcitx5-im fcitx5-qt fcitx5-gtk fcitx5-chinese-addons fcitx5-pinyin-zhwiki visual-studio-code-bin openssh ttf-fira-code nerd-fonts-fira-code flameshot</span><br></pre></td></tr></table></figure>

<p>åœ¨ System Settings æ·»åŠ  Pinyin è¾“å…¥ã€‚ä¿®æ”¹åˆ‡æ¢è¾“å…¥æ³•çš„å¿«æ·é”®ã€‚</p>
<p>å¦‚æœéœ€è¦å¼€å¯å¯åŠ¨ sshdï¼š<code>systemctl enable --now sshd</code></p>
<p>ç½‘ç»œè‡ªç”±ï¼ŒFuck Timeoutï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -Ls https://mirrors.v2raya.org/go.sh | sudo bash</span><br><span class="line">sudo systemctl <span class="built_in">disable</span> v2ray --now</span><br><span class="line">yay -S v2raya-bin</span><br><span class="line">sudo systemctl start v2raya.service</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> v2raya.service</span><br></pre></td></tr></table></figure>

<p>è¿›æµè§ˆå™¨ç®¡ç† <code>127.0.0.1:2017</code>ã€‚</p>
<h3 id="è¿˜åŸ-zsh"><a href="#è¿˜åŸ-zsh" class="headerlink" title="è¿˜åŸ zsh"></a>è¿˜åŸ zsh</h3><p>å‚è€ƒ <a href="https://github.com/Codesire-Deng/rc">Codesire-Deng&#x2F;rc</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yay -S zsh</span><br><span class="line">chsh -s $(<span class="built_in">which</span> zsh)</span><br><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>&quot;</span></span><br><span class="line">yay -S zsh-syntax-highlighting-git</span><br></pre></td></tr></table></figure>

<ul>
<li>è¦†ç›–æ‹·è´ <a href="https://github.com/Codesire-Deng/rc">Codesire-Deng&#x2F;rc</a> çš„é…ç½®æ–‡ä»¶ã€‚</li>
<li>å®‰è£…å®Œåï¼Œè°ƒæ•´ konsole å’Œ vscode çš„é»˜è®¤ç»ˆç«¯ã€‚</li>
</ul>
<h3 id="å¼€å‘ç¯å¢ƒ"><a href="#å¼€å‘ç¯å¢ƒ" class="headerlink" title="å¼€å‘ç¯å¢ƒ"></a>å¼€å‘ç¯å¢ƒ</h3><h4 id="C-ç›¸å…³"><a href="#C-ç›¸å…³" class="headerlink" title="C++ ç›¸å…³"></a>C++ ç›¸å…³</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yay -S linux-headers cmake clang mimalloc boost cloc </span><br></pre></td></tr></table></figure>

<h4 id="perf-ç›¸å…³"><a href="#perf-ç›¸å…³" class="headerlink" title="perf ç›¸å…³"></a>perf ç›¸å…³</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yay -S perf</span><br><span class="line"><span class="built_in">cd</span> ~/Downloads &amp;&amp; git <span class="built_in">clone</span> https://github.com/brendangregg/FlameGraph.git</span><br><span class="line">sudo <span class="built_in">ln</span> -s ~/Downloads/FlameGraph/stackcollapse-perf.pl /usr/bin/stackcollapse-perf.pl</span><br><span class="line">sudo <span class="built_in">ln</span> -s ~/Downloads/FlameGraph/flamegraph.pl /usr/bin/flamegraph.pl</span><br></pre></td></tr></table></figure>

<h4 id="Node-ç›¸å…³"><a href="#Node-ç›¸å…³" class="headerlink" title="Node ç›¸å…³"></a>Node ç›¸å…³</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -L https://raw.githubusercontent.com/tj/n/master/bin/n -o n</span><br><span class="line">sudo bash n lts</span><br><span class="line">sudo npm install -g n</span><br><span class="line"><span class="built_in">rm</span> n</span><br><span class="line">sudo npm install -g cnpm --registry=https://registry.npmmirror.com</span><br><span class="line">sudo npm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<h3 id="ç¼–è¯‘-Clang-å¥—ä»¶"><a href="#ç¼–è¯‘-Clang-å¥—ä»¶" class="headerlink" title="ç¼–è¯‘ Clang å¥—ä»¶"></a>ç¼–è¯‘ Clang å¥—ä»¶</h3><p>å‚è€ƒ <a href="https://clang.llvm.org/get_started.html">Clang Docs</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --depth=1 https://github.com/llvm/llvm-project.git</span><br><span class="line"><span class="built_in">cd</span> llvm-project</span><br><span class="line">cmake -B build -DLLVM_ENABLE_PROJECTS=clang -DCMAKE_BUILD_TYPE=Release -G <span class="string">&quot;Unix Makefiles&quot;</span> ./llvm</span><br><span class="line">cmake --build build -j 14 <span class="comment"># ä¸è¦ä½¿ç”¨å…¨éƒ¨çš„æ ¸å¿ƒï¼UIä¼šå´©æºƒ</span></span><br><span class="line">sudo <span class="built_in">cp</span> ./build/bin/clang-format $(<span class="built_in">which</span> clang-format)</span><br><span class="line">clang-format --version</span><br></pre></td></tr></table></figure>

<h3 id="ç”Ÿæˆ-SSH-key"><a href="#ç”Ÿæˆ-SSH-key" class="headerlink" title="ç”Ÿæˆ SSH key"></a>ç”Ÿæˆ SSH key</h3><p>å‚è€ƒ <a href="https://docs.github.com/cn/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">Github Docs</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t ed25519 -C <span class="string">&quot;oi_dzf@qq.com&quot;</span></span><br><span class="line"><span class="built_in">eval</span> <span class="string">&quot;<span class="subst">$(ssh-agent -s)</span>&quot;</span></span><br><span class="line">ssh-add ~/.ssh/id_ed25519</span><br></pre></td></tr></table></figure>

<p>å°†å…¬é’¥æ·»åŠ åˆ° <a href="https://github.com/settings/keys">Github SSH keys</a>ã€‚</p>
<h3 id="systemd-boot-è¿½åŠ -Windows"><a href="#systemd-boot-è¿½åŠ -Windows" class="headerlink" title="systemd-boot è¿½åŠ  Windows"></a>systemd-boot è¿½åŠ  Windows</h3><ol>
<li>æ‰¾åˆ° Windows EFI åˆ†åŒºï¼š<ul>
<li><code>lsblk -o NAME,FSTYPE,SIZE,MOUNTPOINT</code></li>
</ul>
</li>
<li>æŒ‚è½½è¿™ä¸ªåˆ†åŒºï¼š<ul>
<li><code>sudo mkdir /mnt/win-efi</code></li>
<li><code>sudo mount /dev/sdb1xxx /mnt/win-efi</code></li>
</ul>
</li>
<li>æ‹·è´ Windows EFI åˆ°å½“å‰ç¡¬ç›˜çš„ EFIï¼ˆ<code>/boot/EFI</code>åœ¨ä¸åŒç³»ç»Ÿä¸‹å¯èƒ½ä¸åŒï¼Œä¾‹å¦‚å¯èƒ½æ˜¯<code>/boot/efi/EFI</code>ï¼‰<ul>
<li><code>sudo cp -r /mnt/win-efi/EFI/Microsoft /boot/EFI</code></li>
</ul>
</li>
<li>ä¿®æ”¹ bootloader çš„é…ç½®ï¼Œä¾‹å¦‚å€’è®¡æ—¶<ul>
<li>å‚è€ƒ <a href="https://wiki.archlinux.org/title/Systemd-boot">Wiki: Systemd-boot</a></li>
<li><code>kate /boot/loader/loader.conf</code></li>
</ul>
</li>
<li>é‡å¯å³å¯ã€‚åœ¨é€‰æ‹©ç•Œé¢æŒ‰ <code>d</code> å³å¯æŒ‡å®šé»˜è®¤é¡¹ã€‚</li>
</ol>
<h3 id="é™„ï¼šWindows-æ”¹ä¸º-UTC-æ—¶é—´"><a href="#é™„ï¼šWindows-æ”¹ä¸º-UTC-æ—¶é—´" class="headerlink" title="é™„ï¼šWindows æ”¹ä¸º UTC æ—¶é—´"></a>é™„ï¼šWindows æ”¹ä¸º UTC æ—¶é—´</h3><p>æ–°å»º<code>UTC.reg</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\TimeZoneInformation]</span><br><span class="line">&quot;RealTimeIsUniversal&quot;=dword:00000001</span><br></pre></td></tr></table></figure>

<p>ç”¨ç®¡ç†å‘˜è¿è¡Œä¹‹å³å¯ã€‚</p>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ççˆ±ç”Ÿå‘½ï¼Œçæƒœæ—¶é—´ã€‚</p>
]]></content>
      <tags>
        <tag>å‡å°‘è„±å‘æŒ‡å—</tag>
      </tags>
  </entry>
  <entry>
    <title>C++20 Coroutine</title>
    <url>/2021/11/18/C-20-Coroutine/</url>
    <content><![CDATA[<blockquote>
<p><strong>åç¨‹</strong>(coroutine)æ˜¯èƒ½å¤Ÿæš‚åœå’Œæ¢å¤çš„å‡½æ•°ã€‚</p>
</blockquote>
<p>åç¨‹æ˜¯<strong>çº¿ç¨‹é˜»å¡é€ æˆæ€§èƒ½ä¸‹é™</strong>çš„æœ€ä½³è§£å†³æ–¹æ¡ˆï¼Œå°¤å…¶æ˜¯åº”ç”¨åœ¨é™æ€çº¿ç¨‹æ± ä¸­ã€‚</p>
<span id="more"></span>

<small>

<h2 id="åæ§½"><a href="#åæ§½" class="headerlink" title="åæ§½"></a>åæ§½</h2><p>GoLang è®¾è®¡çš„ goroutine ç®€å•å¥½ç”¨ï¼Œå¤§åé¼é¼ï¼›è™šæ‹Ÿæœºè¯­è¨€ï¼ˆä¾‹å¦‚ C#ï¼ŒJavascriptï¼ŒJavaï¼‰çš„åç¨‹æ›´æ˜¯é€†å¤©æ”¹å‘½ï¼Œå¼ºåŠ¿å é¢†é«˜æ€§èƒ½å¹¶å‘çš„é«˜åœ°ï¼›æœºå™¨é˜Ÿè¿™è¾¹ç®€ç›´ç¥é€Ÿï¼Œè€Œæˆ‘ä»¬çš„äººå·¥é˜Ÿ C++ åœ¨å¹²ä»€ä¹ˆå‘¢ï¼Œä¸ä¼šè¿˜æ²¡åšå®Œ STL network å§ï¼Œä¸ä¼šè¿ <code>format</code> çš„ç¼–è¯‘å™¨æ”¯æŒéƒ½æ²¡æœ‰å§ï¼Œä¸ä¼šè¿˜æ²¡æ¨å¹¿ <code>import &lt;module&gt;</code> å§ ğŸ¥µğŸ¥µğŸ¥µâ€¦â€¦</p>
</small>

<h2 id="C-çš„åç¨‹"><a href="#C-çš„åç¨‹" class="headerlink" title="C++çš„åç¨‹"></a>C++çš„åç¨‹</h2><p>C++çš„åç¨‹æ˜¯ï¼š</p>
<ol>
<li>å¯¹ç§°çš„ã€‚ä¸€ä¸ªåç¨‹æš‚åœåï¼Œå¯è¿”å› caller æˆ–æ¢å¤ä»»æ„åç¨‹ã€‚</li>
<li>è¯­è¨€çº§ç‰¹æ€§ã€‚ç¼–è¯‘å™¨çŸ¥é“ä½ åœ¨ä½¿ç”¨åç¨‹ã€‚ç„¶è€Œä¸æ¯”åº“å¼ºåˆ°å“ªé‡Œå»ã€‚</li>
<li>æ— æ ˆ(Stackless) çš„ã€‚æ²¡æœ‰ç‹¬ç«‹è¿è¡Œæ—¶æ ˆï¼Œæ— æƒ§çˆ†æ ˆï¼Œè°ƒåº¦æˆæœ¬ä½ã€‚</li>
</ol>
<p>ä¸€ä¸ªåç¨‹åœ¨è¢«å‘½ä»¤ã€Œæš‚åœã€æ—¶ï¼Œä¼šä¿è¯å°†æ•°æ®å’Œå½“å‰è¿è¡Œä½ç½®ä¿å­˜åœ¨å †å†…å­˜ï¼ˆä»¥ä¾¿æ¢å¤ç°åœºï¼‰ï¼Œç„¶åè½¬ç§»è¿è¡Œæƒã€‚</p>
<p>åç¨‹å…è®¸ç¨‹åºå‘˜æ›´ç¾è§‚åœ°ç¼–å†™å¼‚æ­¥ä»£ç ï¼Œä¹Ÿä½¿æ‡’æƒ°æ±‚å€¼çš„ç®—æ³•æˆä¸ºå¯èƒ½ã€‚</p>
<p>å½“ä¸€ä¸ªå‡½æ•°å‡ºç°ä»¥ä¸‹ä¸‰ç§å…³é”®å­—ä¹‹ä¸€ï¼Œå®ƒå°±æ˜¯åç¨‹ï¼š</p>
<ol>
<li><code>co_await</code> æš‚åœï¼ˆç›´åˆ°è¢«å‘½ä»¤ã€Œæ¢å¤ã€ï¼‰ã€‚</li>
<li><code>co_yield</code> æš‚åœåŒæ—¶è¿”å›ä¸€ä¸ªå€¼ã€‚</li>
<li><code>co_return</code> ç»“æŸæ•´ä¸ªåç¨‹å¹¶è¿”å›ä¸€ä¸ªå€¼ã€‚</li>
</ol>
<h2 id="ä½¿ç”¨åç¨‹çš„ç†ç”±"><a href="#ä½¿ç”¨åç¨‹çš„ç†ç”±" class="headerlink" title="ä½¿ç”¨åç¨‹çš„ç†ç”±"></a>ä½¿ç”¨åç¨‹çš„ç†ç”±</h2><ol>
<li>ç›¸æ¯”äºå›è°ƒå’Œ sender&#x2F;receiverï¼Œåç¨‹çš„ä½¿ç”¨<strong>æˆæœ¬æ›´ä½</strong>ï¼Œ<strong>æ€§èƒ½ä¸‹é™æ›´é«˜</strong>ã€‚</li>
<li>é™ä½ä½¿ç”¨è€…çš„å¿ƒæ™ºè´Ÿæ‹…å’Œé˜…å†è¦æ±‚ï¼Œå‚¬åŒ–é«˜è´¨é‡å·¥ç¨‹ï¼Œæœ‰æœ›æˆä¸º<strong>èµ„æœ¬å® å„¿</strong>ã€‚<ul>
<li>ä¾‹å¦‚å¯ä»¥æ‘†è„± asio é‡Œå¸¸è§çš„ <code>std::shared_ptr</code>ã€‚</li>
</ul>
</li>
</ol>
<h2 id="C-åç¨‹çš„å¼±ç‚¹"><a href="#C-åç¨‹çš„å¼±ç‚¹" class="headerlink" title="C++åç¨‹çš„å¼±ç‚¹"></a>C++åç¨‹çš„å¼±ç‚¹</h2><ol>
<li>é™¤éç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œæ¯ä¸ªåç¨‹éƒ½éœ€è¦é€šè¿‡ <code>operator new</code> æ¥åˆ†é… frameï¼š<ul>
<li>åŠ¨æ€å†…å­˜åˆ†é…å¯èƒ½å¼•å‘æ€§èƒ½é—®é¢˜ï¼›</li>
<li>åœ¨åµŒå…¥å¼æˆ–å¼‚æ„ï¼ˆä¾‹å¦‚ GPUï¼‰ç¯å¢ƒä¸‹ï¼Œç¼ºä¹åŠ¨æ€å†…å­˜åˆ†é…èƒ½åŠ›ï¼Œéš¾ä»¥å·¥ä½œã€‚</li>
</ul>
</li>
<li>é™¤éç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œåç¨‹çš„å¯å®šåˆ¶ç‚¹å¤ªå¤šï¼Œéœ€è¦å¤§é‡é—´æ¥è°ƒç”¨&#x2F;è·³è½¬ï¼ˆè€Œä¸æ˜¯å†…è”ï¼‰ï¼ŒåŒæ ·å¼•èµ·æ€§èƒ½é—®é¢˜ã€‚<ul>
<li>ç›®å‰ï¼Œç¼–è¯‘å™¨é€šå¸¸éš¾ä»¥å†…è”åç¨‹ï¼›</li>
<li>HALO ä¼˜åŒ–ç†è®ºï¼š<a href="http://open-std.org/JTC1/SC22/WG21/docs/papers/2021/p2300r3.html#biblio-p0981r0">P0981R0</a>ã€‚</li>
</ul>
</li>
<li><strong>åŠ¨æ€åˆ†é…</strong>å’Œ<strong>é—´æ¥è°ƒç”¨</strong>çš„å­˜åœ¨ï¼Œå¯¼è‡´åç¨‹æš‚æ—¶æ— æ³•æˆä¸ºå¼‚æ­¥æ¡†æ¶çš„æœ€ä¼˜æ–¹æ³•ã€‚</li>
<li>Debug çš„ä½“éªŒé£è¯„ä¸ä½³ã€‚</li>
</ol>
<h2 id="åç¨‹çš„é™åˆ¶"><a href="#åç¨‹çš„é™åˆ¶" class="headerlink" title="åç¨‹çš„é™åˆ¶"></a>åç¨‹çš„é™åˆ¶</h2><ol>
<li>ä¸èƒ½ä½¿ç”¨å˜å‚æ¨¡æ¿</li>
<li>ä¸èƒ½ä½¿ç”¨ <code>return</code></li>
<li>ä¸èƒ½ä½¿ç”¨å ä½ç¬¦è¿”å›ç±»å‹ ï¼ˆ<code>auto</code> æˆ–è€… Conceptï¼‰</li>
<li>ä¸èƒ½æ˜¯ constexpr å‡½æ•°</li>
<li>ä¸èƒ½æ˜¯æ„é€ å‡½æ•°æˆ–è€…ææ„å‡½æ•°</li>
<li>ä¸èƒ½æ˜¯ <code>main</code> å‡½æ•°</li>
</ol>
<h2 id="åç¨‹çš„è¿è¡Œè¿‡ç¨‹"><a href="#åç¨‹çš„è¿è¡Œè¿‡ç¨‹" class="headerlink" title="åç¨‹çš„è¿è¡Œè¿‡ç¨‹"></a>åç¨‹çš„è¿è¡Œè¿‡ç¨‹</h2><p>æ‰€æœ‰åç¨‹å¿…é¡»å…³è”ç€å‡ ä¸ªå¯¹è±¡ï¼š</p>
<ol>
<li><strong>promise object</strong>ï¼Œåœ¨åç¨‹å†…éƒ¨è¿›è¡Œæ“ä½œï¼Œåç¨‹å‘å…¶å†™å…¥ç»“æœæˆ–è€…å¼‚å¸¸ã€‚</li>
<li><strong>coroutine handle</strong>ï¼Œåœ¨åç¨‹å¤–éƒ¨è¿›è¡Œæ“ä½œï¼Œç”¨äºæ¢å¤åç¨‹æˆ–è€…é”€æ¯åç¨‹å¸§(frame)ã€‚</li>
<li><strong>coroutine state</strong>ï¼Œä¿å­˜åç¨‹çš„ä¿¡æ¯ï¼Œåˆ†é…äºå †å†…å­˜ä¸Šï¼ˆé™¤éè¢«ä¼˜åŒ–ï¼‰ï¼Œå¯¹ç¨‹åºå‘˜ä¸å¯è§ã€‚å…·ä½“ä¿å­˜ç€ï¼š<ol>
<li>promise object</li>
<li>æ‰€æœ‰åç¨‹å‚æ•°ï¼ˆæŒ‰å€¼å¤åˆ¶æˆ–ç§»åŠ¨ï¼‰</li>
<li>è®°å½•æš‚åœç‚¹çš„çŠ¶æ€æœº</li>
<li>å±€éƒ¨å˜é‡å’Œä¸´æ—¶å˜é‡</li>
</ol>
</li>
</ol>
<hr>
<p>å½“åç¨‹ã€Œå¼€å§‹ã€æ—¶ï¼Œå®ƒä¼šï¼š</p>
<ol>
<li>ä½¿ç”¨ <code>operater new</code> æ¥æ„é€  coroutine stateã€‚</li>
<li>å°†æ‰€æœ‰åç¨‹å‚æ•°æ‹·è´æˆ–ç§»åŠ¨åˆ° coroutine stateã€‚<em>å°å¿ƒå‘ç”Ÿã€Œå‚æ‚¬å¼•ç”¨ã€ï¼Œå°¤å…¶åœ¨åç¨‹æ¢å¤åã€‚</em></li>
<li>æ„é€  promise objectã€‚ä¼˜å…ˆè°ƒç”¨æ¥å—æ‰€æœ‰åç¨‹å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œå¦åˆ™è°ƒç”¨é»˜è®¤æ„é€ å‡½æ•°ã€‚</li>
<li>è°ƒç”¨ <code>promise.get_return_object()</code>ï¼Œå…¶ç»“æœä¿å­˜ä¸ºæœ¬åœ°å˜é‡ã€‚æ­¤ç»“æœåœ¨ç¬¬ä¸€æ¬¡æš‚åœæ—¶ä¼šè¿”å›ç»™ callerã€‚åŒ…æ‹¬è¿™ä¸€æ­¥å’Œä»¥å‰çš„æ­¥éª¤ï¼Œæ‰€æœ‰å¼‚å¸¸éƒ½ä¼šæŠ›ç»™ callerï¼Œè€Œä¸æ˜¯æ”¾å…¥ promise objectã€‚</li>
<li>è°ƒç”¨ <code>promise.initial_suspend()</code>ï¼Œç´§æ¥ç€ <code>co_await</code> å®ƒã€‚<em>å¸¸è§çš„è¿”å›å€¼æ˜¯ <code>suspend_always</code> ç”¨äºæ‡’æ±‰åç¨‹ï¼Œæˆ–è€… <code>suspend_never</code> ç”¨äºé¥¿æ±‰åç¨‹</em></li>
<li>å½“ <code>co_await promise.initial_suspend()</code> æ¢å¤åï¼Œåç¨‹å¼€å§‹è¿è¡Œå…¶å‡½æ•°ä½“ã€‚</li>
</ol>
<hr>
<p>å½“åç¨‹åˆ°è¾¾æš‚åœç‚¹ï¼Œå®ƒä¼šï¼š</p>
<ol>
<li>å°† return object è¿”å›ç»™æ‰§è¡Œæƒæ‰€æœ‰è€…ï¼Œç±»å‹åº”ä¸ºåç¨‹çš„è¿”å›ç±»å‹ï¼Œå…è®¸å‘ç”Ÿéšå¼è½¬æ¢ã€‚</li>
</ol>
<hr>
<p>å½“åç¨‹åˆ°è¾¾ <code>co_return [expr]</code> è¯­å¥ï¼Œå®ƒä¼šï¼š</p>
<ol>
<li>è°ƒç”¨ <code>promise.return_void()</code>ï¼Œæ¡ä»¶æ˜¯ï¼š<ol>
<li><code>co_return;</code></li>
<li><code>co_return expr</code> è€Œ expr çš„ç±»å‹æ˜¯ void</li>
<li>å‡½æ•°ä½“ç»“æŸ</li>
</ol>
</li>
<li>æˆ–è€…è°ƒç”¨ <code>promise.return_value(expr)</code>ã€‚</li>
<li>ææ„æ‰€æœ‰è‡ªåŠ¨å˜é‡ã€‚</li>
<li>è°ƒç”¨ <code>promise.final_suspend()</code>ï¼Œç´§æ¥ç€ <code>co_await</code> å®ƒã€‚</li>
</ol>
<hr>
<p>å½“åç¨‹å› æœªæ•è·å¼‚å¸¸è€Œç»“æŸï¼Œå®ƒä¼šï¼š</p>
<ol>
<li>æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œå¹¶åœ¨ <code>catch</code> å—ä¸­è°ƒç”¨ <code>promise.unhandled_exception()</code></li>
<li>è°ƒç”¨ <code>promise.final_suspend()</code>ï¼Œç´§æ¥ç€ <code>co_await</code> å®ƒã€‚æ­¤æ—¶æ¢å¤å¦ä¸€ä¸ªåç¨‹æ˜¯ UBã€‚</li>
</ol>
<hr>
<p>å½“ coroutine state è¢«ææ„ï¼ˆè¦ä¹ˆé‡åˆ° <code>co_return</code>ï¼Œè¦ä¹ˆæœªæ•è·å¼‚å¸¸ï¼Œåœ¨è¦ä¹ˆè¢« handle é”€æ¯ï¼‰æ—¶ï¼Œå®ƒä¼šï¼š</p>
<ol>
<li>ææ„ promise objectã€‚</li>
<li>ææ„æ‰€æœ‰åç¨‹å‚æ•°ã€‚</li>
<li>ä½¿ç”¨ <code>operator delete</code> æ¥é‡Šæ”¾coroutine stateã€‚</li>
<li>è½¬ç§»æ‰§è¡Œæƒã€‚</li>
</ol>
<h2 id="å…³äºå †åˆ†é…"><a href="#å…³äºå †åˆ†é…" class="headerlink" title="å…³äºå †åˆ†é…"></a>å…³äºå †åˆ†é…</h2><p>åŠ¨æ€å†…å­˜åˆ†é…å¯èƒ½æˆä¸º<strong>ä¸¥é‡æ€§èƒ½ç“¶é¢ˆ</strong>ï¼</p>
<p>ç¨‹åºå‘˜å¯é€šè¿‡è‡ªå®šä¹‰ <code>operator new</code> æ¥æ§åˆ¶ coroutine state çš„åˆ†é…ã€‚è¿™éƒ¨åˆ†æš‚æ—¶å¿½ç•¥ä¸è®²ã€‚</p>
<h2 id="Promiseç±»å‹æ¨å¯¼"><a href="#Promiseç±»å‹æ¨å¯¼" class="headerlink" title="Promiseç±»å‹æ¨å¯¼"></a>Promiseç±»å‹æ¨å¯¼</h2><p>è¿™éƒ¨åˆ†æš‚æ—¶å¿½ç•¥ä¸è®²ã€‚</p>
<h2 id="co-await"><a href="#co-await" class="headerlink" title="co_await"></a>co_await</h2><p>ä¸€å…ƒè¿ç®—ç¬¦ <code>co_await</code> ä¼šæš‚åœåç¨‹å¹¶å°†è½¬ç§»æ‰§è¡Œæƒã€‚å…¶æ“ä½œæ•°å¿…é¡»å®šä¹‰ <code>operator co_await</code>ï¼Œæˆ–è€…èƒ½é€šè¿‡å½“å‰åç¨‹çš„ <code>Promise::await_transform</code> è½¬æ¢æˆè¿™ç§ç±»å‹ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">co_await</span> expr</span><br></pre></td></tr></table></figure>

<p><img src="/2021/11/18/C-20-Coroutine/co_await.svg" alt="co_await"></p>
<p>é¦–å…ˆï¼Œ<code>expr</code> è¦è¢«è½¬æ¢ä¸º awaitableï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¦‚æœ <code>expr</code> æ˜¯ç”± initial suspend pointï¼Œfinal suspend point æˆ–è€… yield expression ç”Ÿæˆçš„ï¼Œé‚£ä¹ˆ awaitable å°±æ˜¯ <code>expr</code> æœ¬èº«ã€‚</li>
<li>å¦åˆ™ï¼Œå¦‚æœå½“å‰åç¨‹æœ‰å®šä¹‰ <code>Promise::await_transform</code>ï¼Œé‚£ä¹ˆ awaitable å°±æ˜¯ <code>promise.await_transform(expr)</code>ã€‚</li>
<li>å¦åˆ™ï¼Œawaitable å°±æ˜¯ <code>expr</code> æœ¬èº«ã€‚</li>
</ol>
<p>ç„¶åç”Ÿæˆä¸€ä¸ª awaiter objectï¼Œè§„åˆ™å¦‚ä¸‹ï¼š</p>
<ol>
<li>æ ¹æ®é‡è½½è§£æçš„ç»“æœè°ƒç”¨ <code>opeartor co_await(awaitable)</code> æˆ–è€… <code>awaitable.operator co_await()</code></li>
<li>å¦‚æœé‡è½½è§£ææ‰¾ä¸åˆ°å‡½æ•°ï¼Œé‚£ä¹ˆ awaiter å°±æ˜¯ awaitable æœ¬èº«ã€‚</li>
<li>å¦‚æœé‡è½½è§£ææœ‰æ­§ä¹‰ï¼Œé‚£ä¹ˆç¨‹åºæ˜¯ ill-formedã€‚</li>
</ol>
<p>ç„¶åï¼Œè°ƒç”¨ <code>awaiter.await_ready()</code>å¹¶åˆ¤æ–­ï¼Œå†³å®šæ˜¯å¦æš‚åœåç¨‹ï¼š</p>
<ul>
<li>è‹¥ <code>false</code>ï¼Œåç¨‹æš‚åœï¼Œå¿…è¦çš„ä¿¡æ¯å­˜æ”¾äº coroutine stateã€‚ç„¶åè°ƒç”¨ <code>awaiter.await_suspend(handle)</code>ã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œé€šè¿‡ <code>handle</code> å¯ä»¥è®¿é—® coroutine stateï¼Œä¹Ÿæ˜¯è¿™ä¸ªå‡½æ•°æœ‰è´£ä»»å®‰æ’åç¨‹åœ¨æŸä¸ª executor ä¸Šæ¢å¤ï¼ˆç”šè‡³ç«‹å³å°±åœ°æ¢å¤ï¼‰ï¼Œæˆ–è€…å¹²è„†é”€æ¯åç¨‹ï¼š<ul>
<li>è‹¥ <code>awaiter.await_suspend(handle)</code> è¿”å› voidï¼Œæ‰§è¡Œæƒç«‹å³è½¬ç§»ï¼ˆç»™ caller&#x2F;resumerï¼‰ã€‚</li>
<li>å¦åˆ™è‹¥è¿”å› boolï¼Œ<ul>
<li>è‹¥ <code>true</code> åˆ™è½¬ç§»æ‰§è¡Œæƒï¼ˆç»™ caller&#x2F;resumerï¼‰ã€‚</li>
<li>è‹¥ <code>false</code> åˆ™æ¢å¤å½“å‰åç¨‹ã€‚</li>
</ul>
</li>
<li>å¦åˆ™è¿”å›ä¸€ä¸ª coroutine handleï¼ˆå¯¹åº”å…¶ä»–åç¨‹ï¼‰ï¼Œè°ƒç”¨è¿™ä¸ª <code>other_handle.resume()</code>ã€‚æ³¨æ„é“¾å¼è°ƒç”¨å¯èƒ½æœ€ç»ˆæ¢å¤å½“å‰åç¨‹ã€‚</li>
<li>å½“å‰åç¨‹æ¢å¤åï¼Œè¿”å› <code>awaiter.await_resume()</code> ä½œä¸º <code>co_await expr</code> çš„ç»“æœã€‚</li>
</ul>
</li>
<li>è‹¥ <code>true</code>ï¼Œåç¨‹ç›´æ¥è¿”å› <code>awaiter.await_resume()</code> ä½œä¸º <code>co_await expr</code> çš„ç»“æœã€‚</li>
</ul>
<p>æ³¨æ„åœ¨è¿›å…¥ <code>awaiter.await_suspend(handle)</code> ä¹‹å‰ï¼Œå½“å‰åç¨‹å·²ç»å®Œå…¨æš‚åœï¼Œæ­¤æ—¶å½“å‰ handle å¯ä»¥åœ¨çº¿ç¨‹ä¹‹é—´è‡ªç”±ä¼ é€’ï¼Œå¹¶ç”±å…¶ä»–è°ƒåº¦è€…æ¢å¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåç¨‹å¯èƒ½å·²ç»è¢«æ¢å¤ï¼Œawaiter éšä¹‹å·²ç»è¢«ææ„ï¼Œæ‰€ä»¥ <code>await_suspend()</code> ä¸åº”å†è®¿é—® <code>*this</code>ã€‚</p>
<h2 id="co-yield"><a href="#co-yield" class="headerlink" title="co_yield"></a>co_yield</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">co_yield</span> expr</span><br><span class="line"><span class="keyword">co_yield</span> braced-init-list</span><br></pre></td></tr></table></figure>

<p>ç­‰ä»·äº</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">co_await</span> promise.<span class="built_in">yield_value</span>(expr)</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>C++</tag>
        <tag>Concurrency</tag>
        <tag>è¯­æ³•</tag>
        <tag>C++åç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>C++ Smart Pointer</title>
    <url>/2021/12/15/C-smart-pointer/</url>
    <content><![CDATA[<p>æœ¬æ–‡æ„åœ¨é˜è¿° C++ æ™ºèƒ½æŒ‡é’ˆçš„å®ç°åŸç†ï¼Œåº”ç”¨åœºæ™¯å’Œæ½œåœ¨çš„å‘ã€‚</p>
<span id="more"></span>

<h2 id="shared-ptr"><a href="#shared-ptr" class="headerlink" title="shared_ptr"></a>shared_ptr</h2><p>åŸºäºå¼•ç”¨è®¡æ•°çš„æ™ºèƒ½æŒ‡é’ˆã€‚åœ¨æ„é€ å’Œææ„æ—¶ä¿®æ”¹å¼•ç”¨è®¡æ•°ã€‚å½“å¼•ç”¨è®¡æ•°ä¸º 0 æ—¶ï¼Œææ„èµ„æºã€‚</p>
<p>å•ä¸ªå¼•ç”¨è®¡æ•°å™¨æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯ï¼Œshared_ptr å¹¶éçº¿ç¨‹å®‰å…¨ï¼Œè‡³å°‘å› ä¸ºä¸¤ä¸ªåŸå› ï¼š</p>
<ol>
<li>ã€Œæ”¹å†™èµ„æºæŒ‡é’ˆã€ä¸ã€Œæ”¹å†™å¼•ç”¨è®¡æ•°ã€ï¼Œè¿™ä¸¤æ­¥å¹¶éåŸå­åŒ–ã€‚</li>
<li>ã€Œæ”¹å†™å…±äº«å¼•ç”¨è®¡æ•°ã€ä¸ã€Œæ”¹å†™å¼±å¼•ç”¨è®¡æ•°ã€ï¼Œè¿™ä¸¤æ­¥ä¹ŸéåŸå­åŒ–ã€‚</li>
</ol>
<p>é™ˆç¡•çš„ä¹¦å’Œ<a href="https://www.cnblogs.com/Solstice/archive/2013/01/28/2879366.html">åšå®¢</a>ç»™å‡ºäº†ä¸€ä¸ªç«äº‰æ¡ä»¶çš„ä¾‹å­ã€‚å¦‚æœè¦ä»å¤šä¸ªçº¿ç¨‹è¯»å†™åŒä¸€ä¸ª shared_ptr å¯¹è±¡ï¼Œæ˜¯<strong>éœ€è¦åŠ é”</strong>çš„ã€‚</p>
<h3 id="shared-ptr-çš„å®ç°åŸç†"><a href="#shared-ptr-çš„å®ç°åŸç†" class="headerlink" title="shared_ptr çš„å®ç°åŸç†"></a>shared_ptr çš„å®ç°åŸç†</h3><ol>
<li>ä¸€ä¸ª <code>shared_ptr</code> æŒæœ‰ä¸¤ä¸ªè£¸æŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘èµ„æºå’Œã€Œæ§åˆ¶å—ã€ (control block)</li>
<li>æ§åˆ¶å—ä¸»è¦ç”¨äºå®ç°å¼•ç”¨è®¡æ•°ã€‚å…·ä½“çš„å†…å®¹æœ‰ï¼š<ol>
<li>æŒ‡å‘æ‰€ç®¡ç†èµ„æºçš„æŒ‡é’ˆï¼Œæˆ–è€…æ˜¯èµ„æºæœ¬èº«</li>
<li>deleterï¼ˆå·²æ“¦é™¤ç±»å‹ï¼‰</li>
<li>allocatorï¼ˆå·²æ“¦é™¤ç±»å‹ï¼‰</li>
<li><code>shared_ptr</code> å…±äº«å¼•ç”¨è®¡æ•°å™¨</li>
<li><code>weak_ptr</code> å¼±å¼•ç”¨è®¡æ•°å™¨ ï¼ˆä¸»æµå®ç°ä¸­ <code>shared_ptr</code> äº¦è®¡å…¥å¼±å¼•ç”¨è®¡æ•°ï¼‰</li>
</ol>
</li>
<li>è‹¥ä½¿ç”¨ <code>make_shared</code> æˆ– <code>allocate_shared</code> æ¥æ„é€ æŒ‡é’ˆï¼Œåˆ™èµ„æºå’Œæ§åˆ¶å—ä¸€åŒå‚ä¸å†…å­˜ç”³è¯·ã€‚<em>è¿™æ˜¯æ½œåœ¨å‘ç‚¹ã€‚</em></li>
<li>è‹¥å¼±å¼•ç”¨è®¡æ•°å™¨ä¸æ¸…é›¶ï¼Œåˆ™æ§åˆ¶å—å ç”¨çš„å†…å­˜ä¸ä¼šè¢«å›æ”¶ã€‚å› æ­¤è‹¥æ§åˆ¶å—å¾ˆå¤§ï¼ˆç›´æ¥å­˜æ”¾äº†èµ„æºï¼‰ï¼Œåˆ™ç©ºé—´æ€§èƒ½å¯èƒ½å˜å·®ã€‚</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆ«åæ„é€ å‡½æ•°ï¼ˆaliasing constructorï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt; <span class="keyword">class</span> Y &gt;</span></span><br><span class="line"><span class="function"><span class="title">shared_ptr</span><span class="params">( <span class="type">const</span> shared_ptr&lt;Y&gt;&amp; r, element_type* ptr )</span> <span class="keyword">noexcept</span></span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ–°æ™ºèƒ½æŒ‡é’ˆå…±äº«ä¸ r çš„æ§åˆ¶å—ï¼Œä½†æ˜¯ this-&gt;get() æ€»æ˜¯è¿”å› ptrï¼Œè¿™å¯ä»¥ä¸ r.get() ä¸ç›¸åŒï¼</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">åœºæ™¯ï¼šptr æ˜¯ *r çš„æ•°æ®æˆå‘˜ï¼Œè‹¥ r å­˜æ´»ï¼Œåˆ™ ptr å¿…å®šå­˜æ´»ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="shared-ptr-çš„æ½œåœ¨å‘ç‚¹"><a href="#shared-ptr-çš„æ½œåœ¨å‘ç‚¹" class="headerlink" title="shared_ptr çš„æ½œåœ¨å‘ç‚¹"></a>shared_ptr çš„æ½œåœ¨å‘ç‚¹</h3><ol>
<li>ç¯å½¢å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼ï¼šä½¿ç”¨ä¸€ä¸ª <code>weak_ptr</code> æ¥æ‰“ç ´ç¯å½¢å¼•ç”¨ã€‚</li>
<li>ä¸æ”¯æŒ <code>shared_ptr&lt;T[]&gt;</code>ï¼šä½¿ç”¨ <code>vector</code> æˆ– <code>array</code> ä½œå®¹å™¨ã€‚</li>
<li>å®¹è®¸åŸºç±»ææ„å‡½æ•°ä¸æ˜¯è™šå‡½æ•°ï¼ˆä¼¼ä¹æ˜¯å› ä¸ºæ„é€ æ˜¯æ³›å‹çš„ï¼‰ï¼šå°å¿ƒã€‚</li>
<li>é€€åŒ–æˆé“¾çŠ¶çš„æ•°æ®ç»“æ„åœ¨ææ„æ—¶<strong>æ ˆæº¢å‡º</strong>ï¼šåæ€æ•°æ®ç»“æ„çš„é€€åŒ–ï¼Œä»¥åŠæ˜¯å¦æ»¥ç”¨äº† <code>shared_ptr</code>ã€‚</li>
<li>é‡å¤ä½¿ç”¨ä¸€ä¸ªè£¸æŒ‡é’ˆæ„é€ ä¸¤ä¸ª <code>shared_ptr</code>ï¼Œå¯¼è‡´åŒé‡é‡Šæ”¾ï¼š<ol>
<li>è£¸æŒ‡é’ˆç”¨å®Œå°±æ‰”ã€‚</li>
<li>ä¸è¦ä½¿ç”¨ <code>this</code> æ¥æ„é€ æ™ºèƒ½æŒ‡é’ˆï¼Œè€Œæ˜¯ä½¿ç”¨ <code>shared_from_this</code>ã€‚<em>è¿™æ˜¯æ½œåœ¨å‘ç‚¹ã€‚</em></li>
</ol>
</li>
<li>è‹¥æ²¡æœ‰ä»»ä½• <code>shared_ptr</code> æŒæœ‰å¯¹è±¡ï¼Œæ­¤æ—¶è°ƒç”¨ <code>shared_from_this</code> å°±ä¼šå‡ºé—®é¢˜ï¼š<ol>
<li>C++17 ä¹‹å‰ï¼Œè¿™æ˜¯ UBã€‚</li>
<li>C++17 ä»¥åï¼Œç¨‹åºæŠ›å‡º <code>std::bad_weak_ptr</code> å¼‚å¸¸ã€‚</li>
<li>æœ€ä½³å®è·µæ˜¯ç¦æ­¢è®¿é—®æ„é€ å‡½æ•°ï¼Œè€Œæä¾›å·¥å‚å‡½æ•°è¿”å›æ™ºèƒ½æŒ‡é’ˆã€‚</li>
</ol>
</li>
<li>å°† <code>shared_ptr</code> å¤åˆ¶ç»™æœªçŸ¥çš„å‡½æ•°ï¼Œå¯èƒ½å¯¼è‡´ç¯å½¢å¼•ç”¨ã€‚<ul>
<li>å¥½æ¯”ä¸è¦åœ¨ä¸Šé”åæ‰§è¡Œä¸ºæœªçŸ¥ç”¨æˆ·ä»£ç </li>
<li>GC è¯­è¨€åŒæ ·æœ‰å›è°ƒåœ°ç‹±å¯¼è‡´å†…å­˜æ³„æ¼çš„é—®é¢˜</li>
</ul>
</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// enable_shared_from_this æœ€ä½³å®è·µ</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Best</span> : std::enable_shared_from_this&lt;Best&gt; <span class="comment">// å…¬æœ‰ç»§æ‰¿</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function">std::shared_ptr&lt;Best&gt; <span class="title">getptr</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">shared_from_this</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å·¥å‚å‡½æ•°è¿”å›æ™ºèƒ½æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// nodiscard é˜²æ­¢æš´æ¯™</span></span><br><span class="line">    [[nodiscard]] <span class="function"><span class="type">static</span> std::shared_ptr&lt;Best&gt; <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ä¸èƒ½ä½¿ç”¨ make_shared å› ä¸ºæ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ï¼Œä¸èƒ½è½¬å‘</span></span><br><span class="line">        <span class="keyword">return</span> std::<span class="built_in">shared_ptr</span>&lt;Best&gt;(<span class="keyword">new</span> <span class="built_in">Best</span>());</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Best</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="shared-ptr-çš„åº”ç”¨åœºæ™¯-x2F-æ¡ä»¶"><a href="#shared-ptr-çš„åº”ç”¨åœºæ™¯-x2F-æ¡ä»¶" class="headerlink" title="shared_ptr çš„åº”ç”¨åœºæ™¯&#x2F;æ¡ä»¶"></a>shared_ptr çš„åº”ç”¨åœºæ™¯&#x2F;æ¡ä»¶</h3><ol>
<li>å¤šçº¿ç¨‹&#x2F;å¼‚æ­¥åä½œï¼Œéš¾ä»¥ç¡®å®šèµ„æºç”Ÿå‘½å‘¨æœŸã€‚</li>
<li>ä¸»ä»å…³ç³»æ˜ç¡®ï¼Œä¸å­˜åœ¨ç¯å½¢å¼•ç”¨ï¼šæ ‘ã€é“¾è¡¨ã€DAG</li>
<li>å¯ä»¥åœ¨æ„é€ å‡½æ•°å‚æ•°ä¸­æä¾›è‡ªå®šä¹‰ææ„å™¨ï¼š<code>[](Y* rc) &#123; delect rc; &#125;</code>ã€‚</li>
<li>åŸæœ¬ä½¿ç”¨ <code>unique_ptr</code> çš„æ•°æ®ç»“æ„ï¼Œéœ€è¦å¯¹å¤–æä¾›å¼ºå¼•ç”¨ï¼Œåˆ™å¯ä»¥æ”¹ç”¨ <code>shared_ptr</code>ã€‚</li>
</ol>
<h2 id="unique-ptr"><a href="#unique-ptr" class="headerlink" title="unique_ptr"></a>unique_ptr</h2><p>ç‹¬å æ‰€æœ‰æƒçš„æ™ºèƒ½æŒ‡é’ˆã€‚å½“æŒæœ‰èµ„æºä¸”é€€å‡ºä½œç”¨åŸŸæ—¶ï¼Œä¼šææ„èµ„æºã€‚æ‰€æœ‰æƒåªèƒ½ç§»åŠ¨æˆ–å¼•ç”¨ï¼Œä¸èƒ½æ‹·è´ã€‚</p>
<h3 id="unique-ptr-çš„æ½œåœ¨å‘ç‚¹"><a href="#unique-ptr-çš„æ½œåœ¨å‘ç‚¹" class="headerlink" title="unique_ptr çš„æ½œåœ¨å‘ç‚¹"></a>unique_ptr çš„æ½œåœ¨å‘ç‚¹</h3><ol>
<li>é€€åŒ–æˆé“¾çš„æ•°æ®ç»“æ„åœ¨ææ„æ—¶<strong>æ ˆæº¢å‡º</strong>ï¼šåæ€æ•°æ®ç»“æ„ï¼›é‡å†™æ•°æ®ç»“æ„çš„ææ„å‡½æ•°ã€‚</li>
</ol>
<h3 id="unique-ptr-çš„åº”ç”¨åœºæ™¯"><a href="#unique-ptr-çš„åº”ç”¨åœºæ™¯" class="headerlink" title="unique_ptr çš„åº”ç”¨åœºæ™¯"></a>unique_ptr çš„åº”ç”¨åœºæ™¯</h3><ol>
<li>æä¾›åŠ¨æ€å¯¹è±¡çš„ RAIIï¼Œä¿è¯å‘ç”Ÿå¼‚å¸¸æ—¶å¯¹è±¡ä»è¢«ææ„ã€‚</li>
<li>è¡¨ç¤ºå¯¹å †å¯¹è±¡çš„ç‹¬å å…³ç³»ã€‚é€‚åˆç”¨ä½œç±»çš„æ•°æ®æˆå‘˜ï¼Œä¾‹å¦‚è¡¨ç¤ºæ ‘çš„å„¿å­ã€‚<ul>
<li>çˆ¶äº²æŒ‡é’ˆæ°¸è¿œåªç”¨è£¸æŒ‡é’ˆï¼Œå› ä¸ºå„¿å­å­˜æ´»æ—¶çˆ¶äº²ä¸€å®šå­˜æ´»</li>
<li>å•&#x2F;åŒå‘é“¾è¡¨æ˜¯æ ‘çš„ç‰¹ä¾‹ï¼Œä¹Ÿé€‚ç”¨ <code>unique_ptr</code> + è£¸æŒ‡é’ˆã€‚</li>
</ul>
</li>
<li>åœ¨æ¥å£ä¸­æ˜ç¡®è¡¨è¾¾ã€Œä¼ é€’æ‰€æœ‰æƒã€çš„è¯­ä¹‰ã€‚</li>
<li>ä½œä¸ºå…·æœ‰ç§»åŠ¨è¯­ä¹‰çš„å•ä¸ªå®¹å™¨ä½¿ç”¨ã€‚</li>
<li>ç®¡ç†è¿è¡Œæ—¶ç¡®å®šé•¿åº¦çš„å®šé•¿æ•°ç»„ï¼ˆ<code>unique_ptr&lt;T[]&gt;</code> æ­£ç¡®ä½¿ç”¨ <code>new []</code> <code>delete []</code>ï¼‰</li>
<li>ç”¨äº Pimpl ç¼–è¯‘éš”ç¦»</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Pimpl æŠ½è±¡</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">using</span> Pimpl = <span class="type">const</span> unique_ptr&lt;T&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Impl</span>; <span class="comment">// å®šä¹‰äº *.cpp</span></span><br><span class="line">    Pimpl&lt;Impl&gt; pimpl;</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿è¡Œæ—¶å®šé•¿æ•°ç»„</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="type">const</span> unique_ptr&lt;Data[]&gt; array;</span><br><span class="line">    <span class="type">size_t</span> arr_size;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">MyClass</span>(<span class="type">size_t</span> size): <span class="built_in">arr_size</span>(<span class="built_in">make_unique</span>&lt;Data[]&gt;(size)) &#123;&#125;</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="weak-ptr"><a href="#weak-ptr" class="headerlink" title="weak_ptr"></a>weak_ptr</h2><p>ä» <code>shared_ptr</code> æ„é€ è€Œæ¥ï¼Œä½†ä¸å‚ä¸å¼•ç”¨è®¡æ•°ã€‚</p>
<h3 id="weak-ptr-çš„æ½œåœ¨å‘ç‚¹"><a href="#weak-ptr-çš„æ½œåœ¨å‘ç‚¹" class="headerlink" title="weak_ptr çš„æ½œåœ¨å‘ç‚¹"></a>weak_ptr çš„æ½œåœ¨å‘ç‚¹</h3><p>è‰¯å¥½çš„è®¾è®¡ä½¿å¾— <code>weak_ptr</code> å‘ç‚¹è¾ƒå°‘ï¼Œåªéœ€è®°å¾—å¼±å¼•ç”¨çš„å­˜åœ¨ä¼šä½¿å¾—æ§åˆ¶å—æ— æ³•é‡Šæ”¾å³å¯ã€‚</p>
<h3 id="weak-ptr-çš„åº”ç”¨åœºæ™¯"><a href="#weak-ptr-çš„åº”ç”¨åœºæ™¯" class="headerlink" title="weak_ptr çš„åº”ç”¨åœºæ™¯"></a>weak_ptr çš„åº”ç”¨åœºæ™¯</h3><ol>
<li>æ‰“ç ´ <code>shared_ptr</code> çš„å¾ªç¯å¼•ç”¨ã€‚å¸¸ç”¨äºç¯å½¢é“¾è¡¨ã€å›è°ƒå‡½æ•°ã€‚</li>
<li>ä½œä¸ºã€Œå¯ç©ºèµ„æºçš„è§‚å¯Ÿè€…ã€ã€‚æ ¹æ®èµ„æºæ˜¯å¦ä¸ºç©ºè¡¨ç°ä¸åŒçš„è¡Œä¸ºã€‚</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// weak_ptr åšå›è°ƒ</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bad</span><span class="params">(<span class="type">const</span> shared_ptr&lt;X&gt;&amp; x)</span> </span>&#123;</span><br><span class="line">    obj.<span class="built_in">on_draw</span>([=]&#123; x-&gt;<span class="built_in">extra_work</span>(); &#125;); <span class="comment">// x å·²ç»æ³„éœ²</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">good</span><span class="params">(<span class="type">const</span> shared_ptr&lt;X&gt;&amp; x)</span> </span>&#123;</span><br><span class="line">    obj.<span class="built_in">on_draw</span>([w=<span class="built_in">weak_ptr</span>&lt;X&gt;(x)] &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">auto</span> x = w.<span class="built_in">lock</span>()) x-&gt;<span class="built_in">extra_work</span>(); <span class="comment">// x æœ‰æœºä¼šææ„</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// weak_ptr åš cache</span></span><br><span class="line"><span class="function">shared_ptr&lt;Payload&gt; <span class="title">create</span><span class="params">(<span class="type">int</span> id)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> map&lt;<span class="type">int</span>, weak_ptr&lt;Payload&gt;&gt; cache;</span><br><span class="line">    <span class="type">static</span> mutex mut_cache;</span><br><span class="line">    <span class="function">lock_guard&lt;mutex&gt; <span class="title">hold</span><span class="params">(mut_cache)</span></span>;</span><br><span class="line">    <span class="keyword">auto</span> sp = cache[id].<span class="built_in">lock</span>();</span><br><span class="line">    <span class="keyword">if</span> (!sp) cache[id] = sp = <span class="built_in">make_shared</span>&lt;Payload&gt;();</span><br><span class="line">    <span class="keyword">return</span> sp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ol>
<li><a href="https://en.cppreference.com/w/cpp/memory">cppreference</a></li>
<li><a href="https://www.youtube.com/watch?v=JfmTagWcqoE">CppCon 2016: Herb Sutter â€œLeak-Freedom in C++... By Default.â€</a></li>
<li><a href="http://senlinzhan.github.io/2015/04/24/%E6%B7%B1%E5%85%A5shared-ptr/">Senlinã€Šè°ˆè°ˆ shared_ptr çš„é‚£äº›å‘ã€‹</a></li>
</ol>
]]></content>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title>C++ å¤šæ€</title>
    <url>/2022/01/28/C-%E5%A4%9A%E6%80%81/</url>
    <content><![CDATA[<small>
ç—…é‡èººå®¶ï¼Œè¯ä¸èƒ½åœã€‚<br/>
ä½•ä»¥è§£å¿§ï¼Ÿå”¯æœ‰åšå®¢ã€‚<br/>
æ•°æ®åœ¨æ ¡ï¼Œä¸åœ¨æˆ‘å¿ƒã€‚<br/>
å®¿èˆæ–­ç”µï¼Œå­¦æ ¡è‹±æ˜ï¼<br/>
å›æ»šæ—§ç‰ˆï¼Œæ³ªçœ¼å˜¤å˜¤ã€‚<br/>
&nbsp;H T M L ï¼Œæ‰‹å†™è¿˜è¡Œï¼
</small>

<h1 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h1><p>ã€Œå¤šæ€ã€æ˜¯ä¸€ä¸ªå¾ˆå®½æ³›çš„ç†å¿µï¼Œå¯¹åº”ç¹å¤šå®ç°ã€‚æœ¬æ–‡å°†è®°å½•æˆ‘æ‰€çœ‹åˆ°çš„å¤šæ€çš„å„ç§å½¢æ€ã€‚ä½œè€…è§è¯†çŸ­æµ…ï¼Œè¿˜è¯·è¯»è€…å¤šå¤šæŒ‡æ•™ã€‚</p>
<ul>
<li>æœ¬æ–‡å·²è®¡åˆ’çš„å†…å®¹ï¼š<ul>
<li><input checked="" disabled="" type="checkbox"> åŸºäº <code>std::visit</code><ul>
<li><input checked="" disabled="" type="checkbox"> å®ç°è¿è¡Œæ—¶å¤šæ€çš„ä¼˜åŒ–</li>
<li><input checked="" disabled="" type="checkbox"> å®ç°<em>é‡è½½æ¨¡å¼</em></li>
</ul>
</li>
<li><input checked="" disabled="" type="checkbox"> CRTP å®ç°é™æ€å¤šæ€<ul>
<li><input checked="" disabled="" type="checkbox"> é™æ€å¤šæ€</li>
<li><input checked="" disabled="" type="checkbox"> é™æ€æ¥å£</li>
<li><input checked="" disabled="" type="checkbox"> CRTP çš„ä¸€äº›åˆ†æå’Œ trick</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> C++20 å‰åŸºäº SFINAE çš„æ¨¡æ¿åç‰¹åŒ–</li>
<li><input disabled="" type="checkbox"> C++20 ååŸºäº <code>concepts</code> çš„æ¨¡æ¿ç‰¹åŒ–</li>
<li><input disabled="" type="checkbox"> Hack è™šå‡½æ•°è¡¨ï¼Œç”¨äºä¼˜åŒ–<span id="more"></span></li>
</ul>
</li>
<li>æœ¬æ–‡<strong>ä¸ä¼š</strong>å‡ºç°çš„å†…å®¹ï¼š<ul>
<li><code>virtual</code> è™šå‡½æ•°çš„åŸºç¡€ç”¨æ³•</li>
<li>å‡½æ•°æŒ‡é’ˆæ¨¡æ‹Ÿè™šå‡½æ•°</li>
<li>è¿è¡Œæ—¶åå°„</li>
</ul>
</li>
</ul>
<h1 id="std-visit"><a href="#std-visit" class="headerlink" title="std::visit"></a>std::visit</h1><h2 id="Runtime-Branching"><a href="#Runtime-Branching" class="headerlink" title="Runtime Branching"></a>Runtime Branching</h2><p>å‡å¦‚ä½ è¦å¯¹ä¸€ä¸ªçŸ¢é‡åšçº¿æ€§å˜æ¢ $\vec{x} &#x3D; k \cdot \vec{x} + b$ï¼Œåˆæƒ³é’ˆå¯¹ $k&#x3D;1$ æˆ– $b&#x3D;0$ çš„æƒ…å†µåšä¼˜åŒ–ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿ</p>
<p>è¿™æ˜¯æœ€ç®€å•å´å¾ˆæ…¢çš„ä»£ç ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;n; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (k != <span class="number">1</span>)</span><br><span class="line">        x[i] *= k;</span><br><span class="line">    <span class="keyword">if</span> (b != <span class="number">0</span>)</span><br><span class="line">        x[i] += b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç æ»¡è¶³é€Ÿåº¦è¦æ±‚ï¼Œä½†æ˜¯å¤ªå•°å—¦ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (k == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æƒ³ä¸¤å…¨å…¶ç¾æ€ä¹ˆåŠï¼Ÿå¯ä»¥åˆ©ç”¨ <code>variant</code> æ­é… <code>visit</code> ä½¿ç”¨ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// since C++17</span></span><br><span class="line"><span class="keyword">using</span> bool_variant = std::variant&lt;std::true_type, std::false_type&gt;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> bool_variant <span class="title">to_variant</span><span class="params">(<span class="type">bool</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x)</span><br><span class="line">        <span class="keyword">return</span> std::true_type&#123;&#125;;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> std::false_type&#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">linear</span><span class="params">(std::vector&lt;<span class="type">int</span>&gt; &amp;x, <span class="type">int</span> k, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    bool_variant has_k = <span class="built_in">to_variant</span>(k != <span class="number">1</span>);</span><br><span class="line">    bool_variant has_b = <span class="built_in">to_variant</span>(b != <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> transform = [=, &amp;x](<span class="keyword">auto</span> has_k, <span class="keyword">auto</span> has_b) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;xi : x) &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">constexpr</span> (has_k)</span><br><span class="line">                xi *= k;</span><br><span class="line">            <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(has_b)</span></span></span><br><span class="line"><span class="function">                xi +</span>= b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    std::<span class="built_in">visit</span>(transform, has_k, has_b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶ç¼–è¯‘å™¨ä¸º <code>transform</code> ç”Ÿæˆå››ä¸ªç‰¹åŒ–ç‰ˆæœ¬ï¼Œæ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ã€‚<code>std::visit()</code> ä¼šåœ¨è¿è¡Œæ—¶åˆ¤æ–­ <code>variant</code> å†…å‚¨å­˜çš„æ˜¯å“ªä¸ª typeï¼Œç„¶åæŒ‘é€‰æ­£ç¡®çš„é‡è½½åˆ†æ”¯ã€‚</p>
<p><code>variant</code> + <code>constexpr if</code> å¹¶ä¸æ˜¯å”¯ä¸€çš„ç©æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ <a href="https://en.cppreference.com/w/cpp/utility/variant/visit">cppreference</a> è¿˜æœ‰ä»€ä¹ˆèŠ±æ´»ã€‚</p>
<h2 id="The-Overload-Pattern"><a href="#The-Overload-Pattern" class="headerlink" title="The Overload Pattern"></a>The <em>Overload Pattern</em></h2><p>å‡è®¾ä½ è¦ log ä¸€ä¸ª <code>variant&lt;int, float, string&gt;</code>ï¼Œä½ åˆšåˆšå­¦åˆ°äº† <code>constexpr if</code>ï¼Œäºæ˜¯ä½ æƒ³åˆ°è¿™ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span>&gt; <span class="keyword">inline</span> <span class="keyword">constexpr</span> <span class="type">bool</span> always_false_v = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> ifs_variant = std::variant&lt;<span class="type">int</span>, <span class="type">float</span>, std::string&gt;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">log</span><span class="params">(<span class="type">const</span> ifs_variant &amp;arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> logger = [](<span class="type">const</span> <span class="keyword">auto</span> &amp;arg) &#123;</span><br><span class="line">        <span class="keyword">using</span> T = std::<span class="type">decay_t</span>&lt;<span class="keyword">decltype</span>(arg)&gt;;</span><br><span class="line">        <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(std::is_same_v&lt;T, <span class="type">int</span>&gt;)</span> </span>&#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;int: &quot;</span> &lt;&lt; arg &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_same_v&lt;T, <span class="type">float</span>&gt;) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;float: &quot;</span> &lt;&lt; arg &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_same_v&lt;T, std::string&gt;) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;string: &quot;</span> &lt;&lt; arg &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">static_assert</span>(always_false_v&lt;T&gt;, <span class="string">&quot;non-exhaustive visitor!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    std::<span class="built_in">visit</span>(logger, arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‰ç§’ä¹‹åä½ è§‰å¾—è¿™æ®µä»£ç å¤ªä¸‘ï¼Œå¤ªå¤šçš„ <code>if constexpr</code> å’Œ <code>is_same_v</code> è¯­å¥å½±å“é˜…è¯»ï¼Œä½ ä¹Ÿä¸æƒ³ç”¨ <code>always_false_v&lt;T&gt;</code> è¿™æ ·çš„å­¤å„¿ä»£ç ã€‚äºæ˜¯ä½ æƒ³åˆ°äº†é‡è½½ <code>opeartor()</code>ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">log</span><span class="params">(<span class="type">const</span> ifs_variant &amp;arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> &#123;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;int: &quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">float</span> f)</span> </span>&#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;float: &quot;</span> &lt;&lt; f &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="type">const</span> std::string &amp;s)</span> </span>&#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;string: &quot;</span> &lt;&lt; s &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; logger;</span><br><span class="line">    </span><br><span class="line">    std::<span class="built_in">visit</span>(logger, arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç ä¼šåœ¨ç¼ºå°‘æŸä¸ªé‡è½½æ—¶æŠ¥é”™ï¼ˆæ¨¡æ¿å·¨å‹æŠ¥é”™ï¼‰ï¼Œé•¿åº¦ä¹Ÿåˆç†ï¼Œä½ çš„è¡€å‹ä¸‹é™äº†ä¸€äº›ï¼Œä½†ä»æœªåˆ°å®‰å…¨åŒºï¼Œå› ä¸º <code>void operator()</code> çš„é‡å¤ä¾ç„¶å¾ˆä¸‘ã€‚ä½ æƒ³ç”¨æ¨¡æ¿å…ƒç¼–ç¨‹è‡ªåŠ¨åŒ–è¿™äº›å‡½æ•°é‡è½½ã€‚ä½ çš„ç›®æ ‡æ˜¯ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Lambdas&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Overloaded</span> : Lambdas... &#123;</span><br><span class="line">    <span class="comment">// Import all function whatever the parameter is.</span></span><br><span class="line">    <span class="function"><span class="keyword">using</span> <span class="title">Lambdas::operator</span><span class="params">()</span>...</span>; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å½“ä½ ç”¨ lambda çš„ç±»å‹åšæ¨¡æ¿å‚æ•°ï¼Œå°±èƒ½è‡ªåŠ¨å¯¼å…¥ lambda çš„ <code>opeartor()</code>ã€‚é—®é¢˜æ¥äº†ï¼Œä½ æ€ä¹ˆä¼ å…¥ lambda çš„ç±»å‹ï¼Ÿä½ æ ¹æœ¬æ²¡æœ‰åŠæ³•ç”¨å°–æ‹¬å· <code>&lt;&gt;</code> æ¥æŒ‡å®š lambda ç±»å‹ï¼è€Œè‡ªåŠ¨ç±»å‹æ¨å¯¼è‡³å°‘éœ€è¦ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œä½ æƒ³åˆ°äº†æ„é€ å‡½æ•°ï¼å¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­ä¼ å…¥ lambdaï¼Œè¿™æ ·å°±èƒ½æ¨å¯¼å‡º <code>Lambdas</code> çš„å…·ä½“ç±»å‹ï¼</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Lambdas&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Overloaded</span> : Lambdas... &#123;</span><br><span class="line">    <span class="function"><span class="keyword">using</span> <span class="title">Lambdas::operator</span><span class="params">()</span>...</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Overloaded</span>(Lambdas&amp;&amp;...) &#123;&#125; <span class="comment">// Bang!</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">log</span><span class="params">(<span class="type">const</span> ifs_variant &amp;arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> logger = Overloaded&#123;</span><br><span class="line">        [](<span class="type">int</span> i) &#123; std::cout &lt;&lt; <span class="string">&quot;int: &quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;\n&quot;</span>; &#125;,</span><br><span class="line">        [](<span class="type">float</span> f) &#123; std::cout &lt;&lt; <span class="string">&quot;float: &quot;</span> &lt;&lt; f &lt;&lt; <span class="string">&quot;\n&quot;</span>; &#125;,</span><br><span class="line">        [](<span class="type">const</span> std::string &amp;s) &#123; std::cout &lt;&lt; <span class="string">&quot;string: &quot;</span> &lt;&lt; s &lt;&lt; <span class="string">&quot;\n&quot;</span>; &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    std::<span class="built_in">visit</span>(logger, arg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Bang! ç¬¬äº”è¡Œç¼–è¯‘æŠ¥é”™ï¼Œç¼–è¯‘å™¨è¯´ï¼Œä½ ä¼å›¾ä½¿ç”¨ Lambda çš„é»˜è®¤æ„é€ å‡½æ•°ï¼Œä½†è¿™ä¸ªå‡½æ•°æ˜¯ <code>deleted</code>ï¼</p>
<p>æƒ³äº†åŠå¤©ï¼Œä½ é¡¿æ‚Ÿè¿‡æ¥ï¼ŒOverloaded çš„æ„é€ å‡½æ•°ä¸€å®šè¦æ˜¾å¼è°ƒç”¨ Lambdas çš„æ„é€ å‡½æ•°æ‰è¡Œï¼Œäºæ˜¯ä½ å†™å‡ºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Lambdas&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Overloaded</span> : Lambdas... &#123;</span><br><span class="line">    <span class="function"><span class="keyword">using</span> <span class="title">Lambdas::operator</span><span class="params">()</span>...</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Overloaded</span>(Lambdas &amp;&amp;...t) : Lambdas&#123;std::forward&lt;Lambdas&gt;(t)&#125;... &#123;&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘ç»ˆäºè¿‡äº†ï¼ä½ è¿˜æ“…é•¿ä¸¾ä¸€åä¸‰ï¼Œè”æƒ³åˆ° <code>make_tuple()</code> å¯ä»¥åœ¨æ²¡æœ‰å°–æ‹¬å· <code>&lt;&gt;</code> çš„æƒ…å†µä¸‹å·¥ä½œï¼Œä½ å¯ä»¥æ¨¡ä»¿å®ƒï¼Œäºæ˜¯ä½ å†™å‡ºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Lambdas&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Overloaded</span> : Lambdas... &#123;</span><br><span class="line">    <span class="function"><span class="keyword">using</span> <span class="title">Lambdas::operator</span><span class="params">()</span>...</span>;</span><br><span class="line">    <span class="comment">// no more explicit ctor</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Lambdas&gt;</span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="keyword">auto</span> <span class="title">make_Overloaded</span><span class="params">(Lambdas &amp;&amp;...t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Overloaded&lt;Lambdas...&gt;&#123;std::forward&lt;Lambdas&gt;(t)...&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç å¾ˆç§€ä¹Ÿå¾ˆæ­£ç¡®ã€‚å¯æƒœå¥½æ™¯ä¸é•¿ï¼Œä¸€ä¸ªä¿æ´é˜¿å§¨è·¯è¿‡äº†ä½ ï¼Œè¯´ï¼Œå°ä¼™å­ä½ å†™çš„ä¸è¡Œï¼Œæ¥çœ‹æˆ‘ç§€ä¸€æ‰‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span>... Ts&gt; <span class="keyword">struct</span> <span class="title class_">Overloaded</span> : Ts... &#123; <span class="function"><span class="keyword">using</span> <span class="title">Ts::operator</span><span class="params">()</span>...</span>; &#125;;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span>... Ts&gt; <span class="title">Overloaded</span><span class="params">(Ts...)</span> -&gt; Overloaded&lt;Ts...&gt;</span>;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘é€šè¿‡ï¼é˜¿å§¨çš„ç¬¬äºŒè¡Œæ¨¡æ¿æ°å¥½æ›¿ä»£äº† <code>make_Overloaded</code>ï¼Œæ­£ç¡®æ¨å¯¼å‡ºæ‰€æœ‰æ¨¡æ¿å‚æ•°ï¼è¿™æ˜¯ C++17 çš„æ–°åŠŸèƒ½ *<a href="https://en.cppreference.com/w/cpp/language/class_template_argument_deduction">Custom Template Argument Deduction Rules</a>*ã€‚è¿™ä¸€åŠŸèƒ½åœ¨ C++20 ä¸­æ›´åŠ æ™ºèƒ½ï¼Œæ‰€ä»¥ä½ å¯ä»¥åˆ æ‰é‚£è¡Œæ˜¾å¼æ¨å¯¼è§„åˆ™ã€‚</p>
<p>ç°åœ¨ï¼Œä½ è¿›åŒ–æˆäº† <code>std::visit</code> ä¸ç”¨ <code>Overloaded&#123;&#125;</code> å°±ä¸èˆ’æœæ˜Ÿäººã€‚</p>
<h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;variant&gt;</span> <span class="comment">// C++17</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> ifs_variant = std::variant&lt;<span class="type">int</span>, <span class="type">float</span>, std::string&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span>... Ts&gt; <span class="keyword">struct</span> <span class="title class_">Overloaded</span> : Ts... &#123; <span class="function"><span class="keyword">using</span> <span class="title">Ts::operator</span><span class="params">()</span>...</span>; &#125;;</span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">class</span>... Ts&gt; <span class="title">Overloaded</span><span class="params">(Ts...)</span> -&gt; Overloaded&lt;Ts...&gt;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">log</span><span class="params">(<span class="type">const</span> ifs_variant &amp;arg)</span> </span>&#123;</span><br><span class="line">    std::<span class="built_in">visit</span>(Overloaded&#123;</span><br><span class="line">        [](<span class="type">int</span> i) &#123; std::cout &lt;&lt; <span class="string">&quot;int: &quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;\n&quot;</span>; &#125;,</span><br><span class="line">        [](<span class="type">float</span> f) &#123; std::cout &lt;&lt; <span class="string">&quot;float: &quot;</span> &lt;&lt; f &lt;&lt; <span class="string">&quot;\n&quot;</span>; &#125;,</span><br><span class="line">        [](<span class="type">const</span> std::string &amp;s) &#123; std::cout &lt;&lt; <span class="string">&quot;string: &quot;</span> &lt;&lt; s &lt;&lt; <span class="string">&quot;\n&quot;</span>; &#125;,</span><br><span class="line">    &#125;, arg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ifs_variant i&#123;<span class="number">10</span>&#125;, <span class="built_in">f</span>(<span class="number">0.7f</span>), s&#123;<span class="string">&quot;string&quot;</span>&#125;;</span><br><span class="line">    <span class="built_in">log</span>(i);</span><br><span class="line">    <span class="built_in">log</span>(f);</span><br><span class="line">    <span class="built_in">log</span>(s);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="The-CRTP"><a href="#The-CRTP" class="headerlink" title="The CRTP"></a>The <em>CRTP</em></h1><p>Curiously recurring template pattern (CRTP) æ˜¯æŒ‡ä¸€ä¸ªç±»çš„çˆ¶ç±»çš„æ¨¡æ¿å‚æ•°å«æœ‰è‡ªå·±ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span> : Counter&lt;Foo&gt; &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å¦‚æ­¤ä¸€æ¥ï¼Œçˆ¶ç±»åœ¨ç¼–è¯‘æœŸå°±çŸ¥é“è‡ªå·±çš„æ´¾ç”Ÿç±»å‹ï¼Œå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹åšå¾ˆå¤šäº‹ï¼Œæ¯”å¦‚æ¨¡æ¿åŒ–çš„å¯¹è±¡è®¡æ•°å™¨ã€ç¼–è¯‘æœŸå¤šæ€ã€éé€€åŒ–çš„é“¾å¼è°ƒç”¨ã€æ¨¡æ¿åŒ–æ¥å£å®ç°ç­‰ç­‰ã€‚ç½‘ä¸Šå¾ˆå¤šå£°éŸ³è¯´ CRTP ä¸»è¦æ˜¯ç”¨æ¥æ¶ˆé™¤åŠ¨æ€ç»‘å®šï¼Œä½†æˆ‘è®¤ä¸º CRTP ä¸»è¦æ˜¯ç”¨æ¥çº¦æŸå’Œç®€åŒ–ä»£ç çš„ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ CRTP åˆ°åº•æœ‰ä»€ä¹ˆç”¨ã€‚</p>
<h2 id="Static-Polymorphism"><a href="#Static-Polymorphism" class="headerlink" title="Static Polymorphism"></a>Static Polymorphism</h2><p>ç”±äºçˆ¶ç±»çŸ¥é“æ´¾ç”Ÿç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>static_cast&lt;T*&gt;(this)</code> ä¸€æ­¥åˆ°ä½ï¼Œå°†è‡ªå·±å‘ä¸‹è½¬å‹ã€‚è¿˜å¯ä»¥è°ƒç”¨ <code>T::static_func</code> å®ç°é™æ€åˆ†å‘ã€‚</p>
<h3 id="Demo-1"><a href="#Demo-1" class="headerlink" title="Demo"></a>Demo</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Base</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">member_func</span><span class="params">()</span> </span>&#123; <span class="built_in">static_cast</span>&lt;T *&gt;(<span class="keyword">this</span>)-&gt;<span class="built_in">member_func_impl</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">static_func</span><span class="params">()</span> </span>&#123; T::<span class="built_in">static_func_impl</span>(); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Obj</span> : Base&lt;Obj&gt; &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">member_func_impl</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Obj::member_func_impl\n&quot;</span>; &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">static_func_impl</span><span class="params">()</span> </span>&#123; std::cout &lt;&lt; <span class="string">&quot;Obj::static_func_impl\n&quot;</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Obj a;</span><br><span class="line">    Base&lt;Obj&gt; &amp;ref = a;</span><br><span class="line">    ref.<span class="built_in">member_func</span>();</span><br><span class="line">    Base&lt;Obj&gt;::<span class="built_in">static_func</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¼šä¸ä¼šè§‰å¾—æœ‰ç‚¹è„±è£¤å­æ”¾å±ï¼Ÿè¿™æ ·å†™æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿç”¨äº† CRTP ä¹‹åï¼Œå°±å®£å‘Šä¸§å¤±äº†åŠ¨æ€åˆ†å‘çš„èƒ½åŠ›ï¼Œé‚£ä¸ºä»€ä¹ˆä¸å¹²è„†æŠŠ <code>Base</code> ç±»åˆ æ‰å‘¢ï¼Ÿ</p>
<p>æœ‰äººè¯´ï¼Œ<code>Base</code> ç±»æè¿°äº†å­ç±»åº”è¯¥å®ç°çš„å‡ ä¸ªå‡½æ•°ï¼Œè€Œä¸”æ²¡æœ‰è¿è¡Œæ—¶å¼€é”€ã€‚æˆ‘è®¤ä¸ºæœ€å¥½ä½¿ç”¨ C++20 concept æ¥å®ç°è¿™ç§ç¼–è¯‘æœŸçº¦æŸã€‚ç”¨ CRTP æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯è¯·æ³¨æ„æ ‡è¯†ç¬¦å‘½åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€äº› Bugsã€‚</p>
<h3 id="Bugs"><a href="#Bugs" class="headerlink" title="Bugs"></a>Bugs</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Base</span> &#123;</span><br><span class="line">    <span class="comment">// Notice the &quot;T::member_func()&quot;</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">member_func</span><span class="params">()</span> </span>&#123; <span class="built_in">static_cast</span>&lt;T *&gt;(<span class="keyword">this</span>)-&gt;T::<span class="built_in">member_func</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">static_func</span><span class="params">()</span> </span>&#123; T::<span class="built_in">static_func</span>(); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Obj</span> : Base&lt;Obj&gt; &#123;</span><br><span class="line">    <span class="comment">// empty!</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘æ²¡æœ‰ä»»ä½•æŠ¥é”™ï¼Œè€Œç¨‹åºåœ¨è¿è¡Œæ—¶ä¼šå› ä¸ºæ— ç©·é€’å½’è€Œé™·å…¥æ ˆæº¢å‡ºã€‚æ‰€ä»¥åƒä¸‡<strong>ä¸è¦ä¸ºäº†ç¾è§‚ï¼Œè®©å­ç±»é‡å¤åŸºç±»çš„å‡½æ•°å</strong>ã€‚</p>
<p>æˆ‘ä»¬å†çœ‹ä¸€ä¸ªäººä¸ºåˆ¶é€ çš„é”™è¯¯ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Obj</span> : Base&lt;Obj2&gt; &#123; <span class="comment">// a bug compiles</span></span><br><span class="line">    <span class="comment">// implementation which is unused</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å™¨ä¸ä¼šç»™ä½ ä»»ä½•æé†’ï¼Œè€Œä½ ï¼Œ<code>Obj</code>ï¼Œæ²¦ä¸º <code>Obj2</code> çš„æ›¿èº«ã€‚æ‰€å¹¸çš„æ˜¯ï¼Œè¿™ä¸ª bug æ˜¯å¯ä»¥ä¿®å¤çš„ï¼åªè¦å°† <code>Base</code> çš„æ„é€ å‡½æ•°è®¾ä¸ºç§æœ‰ï¼Œå†åŠ ä¸€ä¸ªå‹å…ƒå³å¯ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Base</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Base</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="keyword">friend</span> T;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Obj2</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Obj</span> : Base&lt;Obj2&gt; &#123; <span class="comment">// Instantiating Obj does not compile</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œ<code>Obj</code> æ— æƒè®¿é—® <code>Base</code> çš„æ„é€ å‡½æ•°ï¼Œå¦‚æœä¼å›¾æ„é€  <code>Obj</code> å¯¹è±¡ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼Œç„¶è€Œä½ è¿˜æ˜¯è¦æ£€æŸ¥åŠå¤©æ‰èƒ½å‘ç°ï¼ŒåŸæ¥æ˜¯ CRTP å†™é”™äº†ï¼æ›´æƒ¨çš„æ˜¯ï¼Œå¦‚æœä½ åªè°ƒç”¨é™æ€æˆå‘˜ï¼Œé‚£ä¹ˆç¼–è¯‘é€šè¿‡ï¼å¤©ç‹è€å­æ¥äº†éƒ½ä¸æŠ¥é”™ï¼æ…¢æ…¢æ‰¾ Bug å§ä½ å°±ã€‚</p>
<h2 id="Template-Interface-Implementation"><a href="#Template-Interface-Implementation" class="headerlink" title="Template Interface Implementation"></a>Template Interface Implementation</h2><p>ç›®å‰ä¸ºæ­¢ CRTP è¢«æˆ‘æ‰¹è¯„å¾—å¤ªå¤šäº†ï¼Œå®é™…ä¸Š CRTP è¿˜æ˜¯æœ‰ç‚¹ç”¨çš„ï¼Œå®ƒå¯ä»¥æ¨¡æ¿åŒ–æ¥å£å®ç°ï¼Œè€Œè¿™ä¸€ç‚¹åœ¨ C++20 concept ä¸­æˆ‘æš‚æ—¶æ²¡å‘ç°å¯¹åº”çš„ä¸œè¥¿ã€‚</p>
<p>å‡è®¾ä½ è¦è®¾è®¡ä¸€ä¸ª <code>Scaleable</code> æ¥å£ï¼Œå¯¹äºæ¯ä¸€ä¸ªå…·ä½“ç±»ï¼Œå®ƒçš„é€»è¾‘éƒ½æ˜¯ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Obj</span> : Scaleable &#123;</span><br><span class="line">    <span class="comment">// getter, setter ...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">override</span> <span class="type">void</span> <span class="title">scale</span><span class="params">(<span class="type">double</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">setValue</span>(<span class="built_in">getValue</span>() * k);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½ ç«‹å³æƒ³åˆ°  </p>
<ol>
<li>ä½ ä¸éœ€è¦ <code>Scaleable</code> çš„åŠ¨æ€ç»‘å®š  </li>
<li>æ¯ä¸ªç±»éƒ½å¤åˆ¶ç²˜è´´ä¸€æ ·çš„ä»£ç ååˆ†æ„šè ¢  </li>
<li>C++20 concept ä¸èƒ½æä¾›é»˜è®¤æˆå‘˜å®ç°ï¼ˆä½œè€…ä»¥ä¸ºçš„ã€‚å¦‚æœå¯ä»¥è¯·å‘Šè¯‰æˆ‘ï¼‰</li>
</ol>
<p>ä½ çŸ¥é“å¯ä»¥ç”¨ CRTPï¼äºæ˜¯ä½ è®¾è®¡å‡ºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Scaleable</span> &#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> K&gt;</span><br><span class="line">    <span class="function">T &amp;<span class="title">scale</span><span class="params">(K &amp;&amp;multiplicator)</span> </span>&#123;</span><br><span class="line">        T &amp;self = <span class="built_in">static_cast</span>&lt;T &amp;&gt;(*<span class="keyword">this</span>);</span><br><span class="line">        self.<span class="built_in">setValue</span>(self.<span class="built_in">getValue</span>() * multiplicator);</span><br><span class="line">        <span class="keyword">return</span> self;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Obj</span> : Scaleable&lt;Obj&gt; &#123;</span><br><span class="line">    <span class="type">double</span> value;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setValue</span><span class="params">(<span class="type">double</span> val)</span> </span>&#123; value = val; &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç å¾ˆæ¼‚äº®ï¼Œè¿˜æ”¯æŒéé€€åŒ–çš„é“¾å¼è°ƒç”¨ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå®ƒåœ¨ <code>Obj</code> å®šä¹‰æ—¶å°±è¡¨æ˜äº† Scaleable çš„è¯­ä¹‰ã€‚å¦‚æœä½¿ç”¨ C++20 concept æˆ–è€…å…¶ä»–éæˆå‘˜å‡½æ•°å»å®ç°ï¼Œ<code>scale</code> çš„å®ç°å°±å¯èƒ½è—åœ¨æŸä¸ª header é‡Œï¼Œä½ ä¸èƒ½ä¸€çœ¼çœ‹å‡º <code>Obj</code> æ˜¯å¦ Scaleableï¼Œè¯­ä¹‰çš„è¡¨è¾¾å°±ä¼šè¢«å‰²è£‚ã€‚</p>
<p>èªæ˜çš„ä½ åˆæƒ³åˆ°äº†æ¥å£æ–¹æ³•è¿˜å¯ä»¥æ˜¯ç±»å¤–çš„æ–¹æ³•ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">T &amp;<span class="title">scale</span><span class="params">(Scaleable&lt;T&gt; &amp;x, <span class="type">double</span> k)</span> </span>&#123;</span><br><span class="line">    T &amp;self = <span class="built_in">static_cast</span>&lt;T &amp;&gt;(x);</span><br><span class="line">    self.<span class="built_in">setValue</span>(self.<span class="built_in">getValue</span>() * k);</span><br><span class="line">    <span class="keyword">return</span> self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ˜¯ä¸æ˜¯å¾ˆåƒ C++20 conceptï¼Ÿæˆ‘è§‰å¾—å¾ˆåƒï¼</p>
<h2 id="A-CRTP-Helper"><a href="#A-CRTP-Helper" class="headerlink" title="A CRTP Helper"></a>A CRTP Helper</h2><p>æ¯æ¬¡å®ç° CRTP æ¥å£çš„æ—¶å€™ï¼Œæœ‰å¾ˆå¤šé‡å¤å·¥ä½œè¦åšï¼Œæ¯”å¦‚åƒç¯‡ä¸€å¾‹çš„ <code>static_cast</code> è¦å†™ï¼Œè¿˜æœ‰ private ctor + friend class å®šå¼ï¼Œå¤ªç¹çã€‚<br>æœ¬æ¥ä½¿ç”¨ CRTP çš„åˆè¡·å°±æ˜¯ç®€åŒ–ä»£ç ï¼Œå¦‚ä»Šå²‚ä¸æ˜¯å—è¾•åŒ—è¾™ï¼Ÿ</p>
<p>ä½ æƒ³åˆ°å¯ä»¥æŠ½è±¡å‡ºæ‰€æœ‰çš„ CRTP æ¥å£çš„å…¬å…±éƒ¨åˆ†ï¼Œåšæˆä¸€ä¸ªåŸºç±»ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CRTP</span> &#123;</span><br><span class="line">    <span class="function">T &amp;<span class="title">self</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;T &amp;&gt;(*<span class="keyword">this</span>); &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> T &amp;<span class="title">self</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;<span class="type">const</span> T &amp;&gt;(*<span class="keyword">this</span>); &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">CRTP</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="keyword">friend</span> T;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Scaleable</span> : CRTP&lt;T&gt; &#123; <span class="comment">/* ... */</span> &#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™çœ‹èµ·æ¥å¾ˆç¾å¥½ï¼Œå¯æ˜¯å¾ˆå¿«ä½ åˆå‘ç°äº†é—®é¢˜ï¼šå¤šä¸ªæ¥å£é€ æˆè±å½¢ç»§æ‰¿ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// diamond inheritance: CRTP&lt;T&gt;</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Obj</span> : Scaleable&lt;Obj&gt;, Lengthable&lt;Obj&gt; &#123; </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä½¿ç”¨è™šç»§æ‰¿æ— åŠ©äºè§£å†³é—®é¢˜ï¼šè¢«è™šç»§æ‰¿çš„åŸºç±»æ˜¯ä¸èƒ½ç”¨ <code>static_cast</code> å‘ä¸‹è½¬å‹çš„ã€‚</p>
<p>è¯•è¿‡å¾ˆå¤šæ–¹æ¡ˆéƒ½ä¸èƒ½è§£å†³è±å½¢ç»§æ‰¿é—®é¢˜ï¼ˆå¦‚æœæœ‰è¯·å‘Šè¯‰æˆ‘ï¼‰ï¼Œåªèƒ½ç¡¬é¿å¼€è±å½¢ç»§æ‰¿äº†ï¼š</p>
<h3 id="Demo-2"><a href="#Demo-2" class="headerlink" title="Demo"></a>Demo</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">template</span>&lt;<span class="keyword">typename</span>&gt; <span class="keyword">class</span> <span class="title class_">Interface</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CRTP</span> &#123;</span><br><span class="line">    <span class="function">T &amp;<span class="title">self</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;T &amp;&gt;(*<span class="keyword">this</span>); &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> T &amp;<span class="title">self</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;<span class="type">const</span> T &amp;&gt;(*<span class="keyword">this</span>); &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">CRTP</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="keyword">friend</span> Interface&lt;T&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Scaleable</span> : CRTP&lt;T, Scaleable&gt; &#123; <span class="comment">/* ... */</span> &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Lengthable</span> : CRTP&lt;T, Lengthable&gt; &#123; <span class="comment">/* ... */</span> &#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·ä¸€æ¥ï¼Œ<code>Scaleable</code> å’Œ <code>Lengthable</code> çš„åŸºç±»æ˜¯ä¸¤ä¸ªä¸åŒçš„ç±»ï¼ŒåŒæ—¶ä¿æŒäº†é›¶å¼€é”€æŠ½è±¡ï¼Œå®Œç¾è§£å†³é—®é¢˜ã€‚</p>
<p>ä»”ç»†è§‚å¯Ÿä½ ä¼šå‘ç°ï¼ŒCRTP é¿å¼€è±å½¢ç»§æ‰¿çš„æ‰‹æ®µæ°å¥½æ˜¯ CRTPï¼</p>
<p>é¡ºä¾¿æé†’ä¸€å¥ï¼Œè°ƒç”¨ <code>self()</code> çš„æ—¶å€™å¿…é¡»å†™ <code>this-&gt;self()</code>ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¸çŸ¥é“æ­£ç¡®çš„åå­—ç©ºé—´ã€‚</p>
<h2 id="Pros-amp-Cons"><a href="#Pros-amp-Cons" class="headerlink" title="Pros &amp; Cons"></a>Pros &amp; Cons</h2><p>ä½ å¾ˆå¯èƒ½å·²ç»æ„Ÿè§‰åˆ°æŠŠ CRTP å½“ä½œæ¥å£ç”¨æœ‰ä»€ä¹ˆå¥½å¤„ï¼š  </p>
<ol>
<li>æ¥å£è¡¨è¾¾äº†æ¸…æ™°ã€æ˜ç¡®çš„è¯­ä¹‰ï¼›  </li>
<li>æ—¢å¯ä»¥é‡å†™å®ç°ï¼Œåˆå¯ä»¥æä¾›é»˜è®¤å®ç°ï¼Œååˆ†çµæ´»ï¼›  </li>
<li>ç¼–è¯‘æœŸå†…è”èƒ½åŠ›ï¼Œé›¶å¼€é”€æŠ½è±¡ï¼›  </li>
<li>é“¾å¼è°ƒç”¨æ—¶ç±»å‹ä¸ä¼šé€€åŒ–ã€‚<br>ä½† CRTP ä¹Ÿæœ‰ä¸è¶³ä¹‹å¤„ï¼š  </li>
<li>æœ¬è´¨ä¸Šæ˜¯è¯­è¨€è¡¨è¾¾èƒ½åŠ›ä¸è¶³çš„å¦¥åï¼ˆè¿˜æ˜¯æ¨è conceptï¼‰ï¼›  </li>
<li>è¦æ±‚ç±»ç»§æ‰¿æ¥å£ï¼Œä¸åˆ©äºåº“è®¾è®¡ï¼›  </li>
<li>éš¾ä»¥è¡¨è¾¾ä¸¤ç§æ¥å£çš„äº¤é›†ï¼›  </li>
<li>å®¹æ˜“å†™ Bugï¼Œç¼–è¯‘æŠ¥é”™ä¿¡æ¯ä¸å‹å¥½ï¼›  </li>
<li>å®£å‘Šæ”¾å¼ƒåŠ¨æ€ç»‘å®šï¼Œéœ€è¦è°¨æ…è®¾è®¡ã€‚</li>
</ol>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><a href="https://www.bilibili.com/video/BV1pq4y1y7oN">åŒç¬™å­ä½¯è°¬ - èŠä¸€èŠC++è®¾è®¡æ¨¡å¼ã€å‡½æ•°å¼ç¼–ç¨‹ç­‰</a></li>
<li><a href="https://en.cppreference.com/w/cpp/utility/variant/visit">std::visit - cppreference.com</a></li>
<li><a href="https://www.cppstories.com/2019/02/2lines3featuresoverload.html/">2 Lines Of Code and 3 C++17 Features - The overload Pattern - C++ Stories</a></li>
<li><a href="https://en.wikipedia.org/wiki/Curiously_recurring_template_pattern">Curiously recurring template pattern - Wikipedia</a></li>
<li><a href="https://www.fluentcpp.com/2017/05/16/what-the-crtp-brings-to-code/">What the Curiously Recurring Template Pattern can bring to your code - Fluent C++</a></li>
<li><a href="https://www.fluentcpp.com/2017/05/19/crtp-helper/">An Implementation Helper For The Curiously Recurring Template Pattern - Fluent C++</a></li>
<li><a href="http://baiy.cn/doc/cpp/inside_rtti.htm">ç™½æ¨ - RTTIã€è™šå‡½æ•°å’Œè™šåŸºç±»çš„å®ç°æ–¹å¼ã€å¼€é”€åˆ†æåŠä½¿ç”¨æŒ‡å¯¼</a></li>
</ul>
]]></content>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title>C++ æ ‡å‡†ç¬”è®°</title>
    <url>/2021/05/03/C/</url>
    <content><![CDATA[<p>æœ¬æ–‡å§‹äº 2018&#x2F;6&#x2F;27ï¼Œç”¨äºæ±‡èšå…³äº C++ çš„å®ç”¨çŸ¥è¯†å’Œç¢°åˆ°çš„å‘ï¼Œæ¸©æ•…è€ŒçŸ¥æ–°ã€‚</p>
<blockquote>
<p>2022&#x2F;1&#x2F;2 ã€æ›´æ”¹ã€‘æ ‡é¢˜æ”¹ä¸ºã€ŠC++ æ ‡å‡†ç¬”è®°ã€‹<br>2022&#x2F;1&#x2F;2 ã€æ–°å¢ã€‘StandardLayout<br>2022&#x2F;1&#x2F;2 ã€æ–°å¢ã€‘bit field</p>
<p>æ›´æ–°é¢„å‘Šï¼š</p>
<ol>
<li>CRTP åŸç†ï¼Œç›®çš„å’Œåº”ç”¨</li>
<li>CRTP åº”ç”¨ä¹‹è¡¨è¾¾å¼æ¨¡æ¿</li>
</ol>
</blockquote>
<span id="more"></span>

<h2 id="union-å…±ç”¨ä½“"><a href="#union-å…±ç”¨ä½“" class="headerlink" title="union å…±ç”¨ä½“"></a>union å…±ç”¨ä½“</h2><ul>
<li>unionå¯åŒ¿åï¼Œå¸¸åœ¨ç»“æ„å®šä¹‰ä¸­ã€‚</li>
<li>ç”¨äºèŠ‚çœå†…å­˜ï¼Œå°¤å…¶åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­ã€‚</li>
<li>unionçš„å®šä¹‰å½¢å¼ä¸structç›¸åŒã€‚</li>
</ul>
<hr>
<h2 id="enum-æšä¸¾"><a href="#enum-æšä¸¾" class="headerlink" title="enum æšä¸¾"></a>enum æšä¸¾</h2><ul>
<li>enum A {a,b,c};   é¦–é¡¹é»˜è®¤ä¸º0ï¼Œé»˜è®¤åé¡¹æ¯”å‰é¡¹å¤§ä¸€ã€‚<br>Aè¢«çœ‹åšä¸€ç§ç±»å‹ï¼Œç”šè‡³å¯ä»¥çœç•¥ï¼›a,c,bè¢«çœ‹åšå¸¸é‡ã€‚<br>a,b,cå¯ä»¥è‡ªåŠ¨æå‡ä¸ºint, ä½†intä¸èƒ½è‡ªåŠ¨è½¬æ¢ä¸ºæšä¸¾ç±»å‹ï¼Œé™¤éå¼ºåˆ¶è½¬æ¢Aï¼ˆ1ï¼‰ã€‚<br>æ¯ä¸ªenumæ ¹æ®å…¶å¸¸é‡çš„æœ€å¤§æœ€å°å€¼ç¡®å®šå…¶ä¸Šä¸‹é™ã€‚</li>
<li>enumåˆ›å»ºçš„å¸¸é‡æ˜¯é™æ€çš„, å¯ä»¥ç”¨ä½œé™æ€ç±»æˆå‘˜å¸¸é‡. è¿è¡Œæ—¶æ‰€æœ‰å¯¹è±¡ä¸ä¼šåŒ…å«æšä¸¾</li>
<li><strong>æ›´å¼ºçš„å®‰å…¨æ€§--ç±»ä½œç”¨åŸŸå†…æšä¸¾(C++11)</strong><ul>
<li>enum class name : type {...};</li>
<li>enum struct name {...};</li>
<li>classæˆ–structäºŒé€‰ä¸€, <code>:type</code>å¯é€‰.</li>
<li>ä½œç”¨åŸŸå†…æšä¸¾ä¸å…è®¸éšå¼åœ°è½¬æ¢ä¸ºæ•´å‹</li>
<li>é»˜è®¤åº•å±‚ä¸ºint</li>
<li>è°ƒç”¨æ ¼å¼ä¸ºname::x</li>
</ul>
</li>
<li>:type æ”¾åœ¨æšä¸¾ååä»¥æŒ‡å®šåº•å±‚, å¦åˆ™å°†éšå®ç°è€Œå¼‚.</li>
</ul>
<hr>
<h2 id="char-å­—ç¬¦å‹"><a href="#char-å­—ç¬¦å‹" class="headerlink" title="char å­—ç¬¦å‹"></a>char å­—ç¬¦å‹</h2><ul>
<li>charç±»å‹è¢«è¾“å…¥è¾“å‡ºæµåŒºåˆ«å¯¹å¾…ã€‚cout &lt;&lt; (int*) st &lt;&lt; endl;</li>
<li>charç±»å‹æ•°ç»„çš„åˆå§‹åŒ–è¢«C++åŒºåˆ«å¯¹å¾…ï¼š<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span> s1[<span class="number">5</span>] = <span class="string">&quot;abcd&quot;</span>; åˆæ³•,<span class="string">&quot;abcd&quot;</span>è¢«è½¬æ¢ä¸º&#123;<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>&#125;, å¯ä¾›ä¿®æ”¹</span><br><span class="line"><span class="type">char</span> s2[<span class="number">5</span>] = s1; é”™è¯¯ï¼Œå³ä½¿s1æ˜¯<span class="type">const</span>ã€‚</span><br><span class="line"><span class="type">char</span>* s3 = <span class="string">&quot;abcd&quot;</span>; è­¦å‘Š, <span class="string">&quot;abcd&quot;</span>æ˜¯å¸¸é‡,ä¸èƒ½ä¿®æ”¹.   å‚æ•°<span class="type">char</span> s3[]=<span class="string">&quot;abcd&quot;</span>äº¦ç­‰ä»·è­¦å‘Š.</span><br></pre></td></tr></table></figure></li>
<li><code>const char []</code>æ‰€å®šä¹‰çš„å­—ç¬¦ä¸²è¢«ä¿æŠ¤ï¼Œæœ‰å†…å­˜ä½ç½®éš”ç¦»ï¼Œä¸å…è®¸è·Ÿè¸ªï¼ˆä½†å…è®¸æŸ¥çœ‹ï¼‰åœ°å€ã€‚</li>
<li>charæ˜¯å¦å¸¦ç¬¦å·å–å†³äºç³»ç»Ÿã€‚</li>
<li>wchar_tå¯ä»¥è¡¨ç¤ºç³»ç»Ÿä½¿ç”¨çš„æœ€å¤§æ‰©å±•å­—ç¬¦é›†ï¼Œè¾“å…¥è¾“å‡ºç”¨wcin,wcout</li>
<li>raw r&quot;(a&#x2F;b\cå›è½¦defg*)&quot;,   æ ‡è¯†ç¬¦  &quot;(   )&quot;  å¯å˜ä¸º &quot;*@(  )*@&quot; ç­‰ç­‰ï¼Œä¿æŒå¹³ç§»å¯¹ç§°</li>
</ul>
<h3 id="lt-cstring-gt-å¸¸ç”¨å‡½æ•°"><a href="#lt-cstring-gt-å¸¸ç”¨å‡½æ•°" class="headerlink" title="&lt;cstring&gt;å¸¸ç”¨å‡½æ•°"></a>&lt;cstring&gt;å¸¸ç”¨å‡½æ•°</h3><ul>
<li><code>char* strcpy(char* dest, const char* src)</code><ul>
<li>ä»¥srcè¦†ç›–dest, ç›´åˆ°é‡åˆ°srcçš„ç»ˆæ­¢ç¬¦.è¿”å›dest.</li>
</ul>
</li>
<li><code>char* strncpy(char* dest, const char* src, size_t count)</code><ul>
<li>ä»¥srcçš„å‰nä½è¦†ç›–dest, è‹¥é‡åˆ°srcçš„ç»ˆæ­¢ç¬¦åˆ™ç”¨0å¡«å……å‰©ä½™ä½.è¿”å›dest.</li>
</ul>
</li>
<li><code>char* strcat(char *dest, char *src)</code><ul>
<li>å°†srcå¤åˆ¶åˆ°destçš„æœ«å°¾.è¿”å›dest.</li>
</ul>
</li>
<li><code>int strcmp(char *str1, char *str2)</code><ul>
<li>æŒ‰å­—å…¸åºæ¯”è¾ƒ, è¿”å›-1,0,1.</li>
</ul>
</li>
<li><code>int stricmp(char *str1, char *str2)</code><ul>
<li>æŒ‰å­—å…¸åºä½†å¯¹å¤§å°å†™ä¸æ•æ„Ÿæ¯”è¾ƒ.</li>
</ul>
</li>
<li><code>int strncmp(char *str1, char *str2, size_t count)</code><ul>
<li>æŒ‰å­—å…¸åºæ¯”è¾ƒå‰nä½</li>
</ul>
</li>
<li><code>int strnicmp(char *str1, char *str2, size_t count)</code><ul>
<li>æŒ‰å­—å…¸åºä½†å¯¹å¤§å°å†™ä¸æ•æ„Ÿæ¯”è¾ƒå‰nä½</li>
</ul>
</li>
</ul>
<hr>
<h2 id="vectorä¸array-æ¨¡æ¿ç±»"><a href="#vectorä¸array-æ¨¡æ¿ç±»" class="headerlink" title="vectorä¸array æ¨¡æ¿ç±»"></a>vectorä¸array æ¨¡æ¿ç±»</h2><ul>
<li><code>vector&lt;typename&gt; arr(n_elem);</code> ä¹Ÿå¯ä»¥ä¸æŒ‡å®šé•¿åº¦</li>
<li><code>array&lt;typename, n_elem&gt; arr;</code> å®šé•¿æ•°ç»„ã€‚ ç­‰é•¿æ•°ç»„å¯ä»¥ç›´æ¥å¤åˆ¶ã€‚</li>
<li>ä¸‹æ ‡å¯è¶Šç•Œï¼Œæ¬²é˜²æ­¢è¶Šç•Œç”¨ <code>arr.at(x)</code></li>
</ul>
<hr>
<h2 id="è¯»å…¥è¡Œ"><a href="#è¯»å…¥è¡Œ" class="headerlink" title="è¯»å…¥è¡Œ"></a>è¯»å…¥è¡Œ</h2><ul>
<li><code>cin.getline(arr, arsize)</code> ç©ºè¡Œä¸è®¾ç½®failbit</li>
<li><code>cin.get(arr, arsize)</code> è¡Œè¯»å–ç»“æŸåä¸ä¸¢å¼ƒæ¢è¡Œç¬¦ï¼ˆæ— æ³•è·¨è¶Šï¼‰</li>
<li><code>cin.get()</code> è¯»å–ä¸€ä¸ªä»»æ„å­—ç¬¦ï¼Œè¿”å›charå€¼</li>
<li><code>cin.get(char)</code>è¿”å›cin</li>
<li><code>string</code>ç±»è¯»è¡Œ <code>getline(cin, str);</code></li>
</ul>
<hr>
<h2 id="fstream-æ–‡ä»¶æµï¼ˆä»¥fin-foutä¸ºä¾‹ï¼‰"><a href="#fstream-æ–‡ä»¶æµï¼ˆä»¥fin-foutä¸ºä¾‹ï¼‰" class="headerlink" title="fstream æ–‡ä»¶æµï¼ˆä»¥fin, foutä¸ºä¾‹ï¼‰"></a>fstream æ–‡ä»¶æµï¼ˆä»¥fin, foutä¸ºä¾‹ï¼‰</h2><ul>
<li>æ‰“å¼€æ–‡ä»¶ï¼š <code>.open(&quot;filename&quot;);</code></li>
<li>å…³é—­æ–‡ä»¶ï¼š <code>.close();</code></li>
<li>æ£€æµ‹æœ€åä¸€æ¬¡è¯»å…¥é‡åˆ°EOFï¼š <code>fin.eof();</code></li>
<li>æ£€æµ‹æœ€åä¸€æ¬¡è¯»å…¥é‡åˆ°ç±»å‹ä¸åŒ¹é…ï¼ˆåŒ…æ‹¬EOFï¼‰ï¼š <code>fin.fail();</code></li>
<li>æ£€æµ‹æœ€åä¸€æ¬¡è¯»å…¥æ–‡ä»¶æŸåã€æ•…éšœï¼š <code>fin.bad();</code></li>
<li>æ£€æµ‹æœ€åä¸€æ¬¡è¯»å…¥å®Œå…¨æ­£å¸¸ï¼š <code>fin.good();</code>  ç­‰ä»·äº <code>(bool) fin &gt;&gt; value;</code></li>
<li>æ¸…ç©ºé”™è¯¯æ ‡è®°ï¼Œå‡†è®¸è¯»å…¥ï¼š <code>.clear();</code></li>
</ul>
<hr>
<h2 id="switch-ç»“æ„æ§åˆ¶"><a href="#switch-ç»“æ„æ§åˆ¶" class="headerlink" title="switch ç»“æ„æ§åˆ¶"></a>switch ç»“æ„æ§åˆ¶</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span>(num)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">case</span> constValue1 : statement1</span><br><span class="line">            <span class="keyword">break</span>;(optional)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> constValue2 : statement2</span><br><span class="line">            <span class="keyword">break</span>;(optional)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> : statement3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<hr>
<h2 id="æ‚é¡¹"><a href="#æ‚é¡¹" class="headerlink" title="æ‚é¡¹"></a>æ‚é¡¹</h2><ul>
<li><code>exit(EXIT_FAILURE);</code>   ï¼š cstdlib, åŒæ“ä½œç³»ç»Ÿé€šä¿¡çš„å‚æ•°å€¼</li>
<li><code>nullptr</code> : C++11 å…³é”®å­—, ç©ºæŒ‡é’ˆå€¼.</li>
</ul>
<hr>
<h2 id="æŒ‡é’ˆ"><a href="#æŒ‡é’ˆ" class="headerlink" title="æŒ‡é’ˆ"></a>æŒ‡é’ˆ</h2><ul>
<li>åº”å½“å°†ç©ºæŒ‡é’ˆå†™ä¸º<code>nullptr</code>. <code>delete</code>å’Œ<code>delete []</code> éƒ½å¯ä»¥ä½œç”¨äºç©ºæŒ‡é’ˆ.</li>
<li>const æŒ‡é’ˆ å°†å—ä¿æŠ¤ï¼Œéconst æŒ‡é’ˆ ä¸èƒ½å¤åˆ¶å…¶å€¼ï¼ˆé™¤éåˆ©ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼‰ï¼Œä¸å…è®¸é€šè¿‡const æŒ‡é’ˆ ä¿®æ”¹æ‰€æŒ‡å‘å€¼ã€‚<br>ä¸ºäº†é˜²æ­¢æ¬ºéª—constæ£€æŸ¥ï¼Œä¸å…è®¸ä»¤const äºŒçº§æŒ‡é’ˆæŒ‡å‘éconst ä¸€çº§æŒ‡é’ˆ</li>
</ul>
<hr>
<h2 id="å‡½æ•°æŒ‡é’ˆ"><a href="#å‡½æ•°æŒ‡é’ˆ" class="headerlink" title="å‡½æ•°æŒ‡é’ˆ"></a>å‡½æ•°æŒ‡é’ˆ</h2><ul>
<li>å£°æ˜ï¼š<code>typename (*pointer name)(parameter list...);</code></li>
<li>è·å¾—æŸå‡½æ•°çš„åœ°å€ï¼š<code>pointer = function name;</code></li>
<li>ä½¿ç”¨å‡½æ•°æŒ‡é’ˆï¼š<code>(*pointer)(parameter list...);</code>  æˆ–  <code>pointer(parameter list...);</code></li>
<li>ä¸¾ä¾‹ï¼š  <figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">åŸå‡½æ•°ï¼š</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">const</span> <span class="type">double</span>* <span class="title">f1</span><span class="params">(<span class="type">const</span> <span class="type">double</span> [], <span class="type">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">æŒ‡å‘f1çš„æŒ‡é’ˆï¼š</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">double</span>* (*p1)(<span class="type">const</span> <span class="type">double</span> [], <span class="type">int</span>) = f1; æˆ– <span class="keyword">auto</span> p1 = f1;</span><br><span class="line"></span><br><span class="line">ç”±f1,f2,f3ç»„æˆæ•°ç»„ï¼š<span class="comment">//[]ä¼˜å…ˆçº§é«˜äº*</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">double</span>* (*ar[<span class="number">3</span>])(<span class="type">const</span> <span class="type">double</span> [], <span class="type">int</span>) = &#123;f1, f2, f3&#125;; ä¸å…è®¸<span class="keyword">auto</span></span><br><span class="line"></span><br><span class="line">æŒ‡å‘ar[<span class="number">3</span>]çš„æŒ‡é’ˆï¼š</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">double</span>* (*(*arp)[<span class="number">3</span>])(<span class="type">const</span> <span class="type">double</span>[], <span class="type">int</span>) = &amp;ar; æˆ– <span class="keyword">auto</span> arp = &amp;arï¼›</span><br><span class="line"></span><br><span class="line">è¿˜å¯ä»¥ç”¨<span class="keyword">typedef</span>ç®€åŒ–å£°æ˜ï¼š</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">const</span> <span class="type">double</span>* (*p_fun)<span class="built_in">const</span>(<span class="type">const</span> <span class="type">double</span> [], <span class="type">int</span>);</span><br><span class="line"></span><br><span class="line">p_fun ar[<span class="number">3</span>] = &#123;f1, f2, f3&#125;;</span><br></pre></td></tr></table></figure></li>
<li>åˆ†ææ–¹æ³•: ä»å˜é‡åå¼€å§‹, å¾€å³å¾€å·¦ç»“åˆ, é€æ­¥è§£é‡Šç»“åˆä½“.<ul>
<li>å½“é‡åˆ°ä¸€ä¸ªæŒ‡é’ˆ, æ€»æ˜¯å…³å¿ƒå®ƒæŒ‡å‘ä»€ä¹ˆç±»å‹</li>
<li>å½“é‡åˆ°ä¸€ä¸ªæ•°ç»„, æ€»æ˜¯å…³å¿ƒå®ƒçš„å…ƒç´ çš„ç±»å‹</li>
<li>å½“é‡åˆ°ä¸€ä¸ªå‡½æ•°, æ€»æ˜¯å…³å¿ƒå®ƒçš„è¿”å›å€¼ç±»å‹</li>
</ul>
</li>
</ul>
<hr>
<h2 id="å‚æ•°ä¼ é€’"><a href="#å‚æ•°ä¼ é€’" class="headerlink" title="å‚æ•°ä¼ é€’"></a>å‚æ•°ä¼ é€’</h2><ul>
<li>å‚é‡ï¼ˆargumentï¼‰æ˜¯å®å‚ï¼Œå‚æ•°ï¼ˆparameterï¼‰æ˜¯å½¢å‚ã€‚</li>
</ul>
<hr>
<h2 id="å‡½æ•°é‡è½½ï¼ˆå‡½æ•°å¤šæ€ï¼‰"><a href="#å‡½æ•°é‡è½½ï¼ˆå‡½æ•°å¤šæ€ï¼‰" class="headerlink" title="å‡½æ•°é‡è½½ï¼ˆå‡½æ•°å¤šæ€ï¼‰"></a>å‡½æ•°é‡è½½ï¼ˆå‡½æ•°å¤šæ€ï¼‰</h2><ul>
<li>åŒåå‡½æ•°å…±å­˜è¦æ±‚ï¼šå‡½æ•°ç‰¹å¾æ ‡ï¼ˆå‡½æ•°å‚æ•°åˆ—è¡¨ï¼‰ä¸åŒã€‚</li>
<li>å½“éœ€è¦è‡ªåŠ¨ç±»å‹è½¬æ¢ä½†é€‰é¡¹ä¸å”¯ä¸€æ—¶ï¼Œç¼–è¯‘ä¸é€šè¿‡ã€‚</li>
<li>ä¸åŒºåˆ†constå’Œéconstå˜é‡ï¼ˆåŒ…æ‹¬æŒ‡é’ˆï¼‰ã€‚</li>
<li>åŒºåˆ†æŒ‡å‘constçš„æŒ‡é’ˆå’ŒæŒ‡å‘éconstçš„æŒ‡é’ˆã€‚</li>
<li>åŒºåˆ†æŒ‡å‘constçš„å¼•ç”¨å’ŒæŒ‡å‘éconstçš„å¼•ç”¨ã€‚ï¼ˆç¼–è¯‘å™¨è°ƒç”¨æœ€åŒ¹é…çš„ç‰ˆæœ¬ï¼‰</li>
<li>å¦‚æœæ²¡æœ‰å³å€¼å¼•ç”¨å‚æ•°ç‰ˆæœ¬ï¼Œå³å€¼å‚é‡å°†èµ‹ç»™constå¼•ç”¨å‚é‡ã€‚</li>
</ul>
<hr>
<h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><ul>
<li>å·¦å€¼å¼•ç”¨<ul>
<li>éconstå¼•ç”¨å¯ä»¥å¼•è‡ªå¯ä¿®æ”¹çš„å·¦å€¼ï¼ˆé˜²æ­¢ä¿®æ”¹constå€¼å’Œä¿®æ”¹ä¸´æ—¶å˜é‡ï¼‰</li>
<li>constå¼•ç”¨å¯ä»¥å¼•è‡ªä»»ä½•å·¦å€¼ã€å³å€¼ï¼ˆæ¯•ç«Ÿæ•°å€¼ä¸ä¼šå˜ï¼‰</li>
<li>åŸºç±»å¼•ç”¨å¯ä»¥æŒ‡å‘æ´¾ç”Ÿç±»å¯¹è±¡</li>
</ul>
</li>
<li>æŒ‡é’ˆä¹Ÿèƒ½è¢«å¼•ç”¨, ä¾‹å¦‚ int*&amp; x &#x3D; ptr;</li>
</ul>
<hr>
<h2 id="çŸ­è·¯è¿ç®—ç¬¦"><a href="#çŸ­è·¯è¿ç®—ç¬¦" class="headerlink" title="çŸ­è·¯è¿ç®—ç¬¦"></a>çŸ­è·¯è¿ç®—ç¬¦</h2><ul>
<li>||, &amp;&amp;å…·æœ‰çŸ­è·¯ä½œç”¨,ç»“æœå¿…ç„¶æ—¶çŸ­è·¯,ä¸è®¡ç®—å³è¾¹çš„è¡¨è¾¾å¼</li>
</ul>
<hr>
<h2 id="inline"><a href="#inline" class="headerlink" title="inline"></a>inline</h2><ul>
<li>åœ¨å£°æ˜æ—¶ç”¨æˆ–åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨å‰çš„å®šä¹‰ç”¨éƒ½è¡Œ</li>
<li>ä¸èƒ½å¤„ç†é€’å½’, ç¼–è¯‘å™¨æœ‰æƒæ‹’ç»é‡‡ç”¨.</li>
<li>å‡½æ•°é»˜è®¤å€¼å¿…é¡»æ”¾åœ¨åŸå‹å£°æ˜ä¸­, ä¸èƒ½æ”¾åœ¨å’Œå£°æ˜åˆ†ç¦»çš„å®šä¹‰ä¸­.åªèƒ½ä»å³åˆ°å·¦åœ°æä¾›é»˜è®¤å€¼</li>
</ul>
<hr>
<h2 id="decltype-expression"><a href="#decltype-expression" class="headerlink" title="decltype(expression)"></a>decltype(expression)</h2><ul>
<li><p><strong>decltype(expression)æ ¸å¯¹è¡¨</strong></p>
<ol>
<li>å¦‚æœexpressionæ˜¯ä¸€ä¸ªä¸å¸¦æ‹¬å·çš„æ ‡è¯†ç¬¦, åˆ™è¿”å›ç›¸åŒç±»å‹, åŒ…æ‹¬const,*ç­‰é™å®šç¬¦</li>
<li>å¦åˆ™,å¦‚æœexpressionæ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨(éœ€è¦æä¾›å‚æ•°),åˆ™è¿”å›ç›¸åŒç±»å‹</li>
<li>å¦åˆ™,å¦‚æœexpressionæ˜¯ä¸€ä¸ªå¸¦æ‹¬å·çš„å·¦å€¼,åˆ™è¿”å›å…¶å¼•ç”¨</li>
<li>å¦åˆ™,è¿”å›expressionçš„ç±»å‹(ä¾‹:å³å€¼)</li>
</ol>
</li>
<li><p>å¯ä»¥åˆ©ç”¨<strong>typedef</strong> decltype(expression) somename;ç®€åŒ–å£°æ˜</p>
</li>
<li><p><strong>decltype ç”¨äºå‡½æ•°è¿”å›ç±»å‹å£°æ˜</strong></p>
<ul>
<li>å£°æ˜è¿”å›ç±»å‹æ—¶æœªçŸ¥å‚æ•°åˆ—è¡¨, æ‰€ä»¥éœ€è¦åç½®å£°æ˜  <figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T1, <span class="keyword">class</span> <span class="title class_">T2</span>&gt;</span><br><span class="line"><span class="function"><span class="keyword">auto</span> <span class="title">gt</span><span class="params">(T1 x, T2 y)</span> -&gt; <span class="title">decltype</span><span class="params">(x + y)</span>     <span class="comment">// &quot;-&gt; å·²çŸ¥ç±»å‹&quot;  ä¹Ÿè¡Œ</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<hr>
<h2 id="æ¨¡æ¿"><a href="#æ¨¡æ¿" class="headerlink" title="æ¨¡æ¿"></a>æ¨¡æ¿</h2><ul>
<li><p><strong>åˆ›å»ºæ¨¡æ¿</strong></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;    <span class="comment">//ä¹Ÿå¯ä»¥ç”¨classä»£æ›¿typename</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(T&amp;, T&amp;)</span></span>;</span><br></pre></td></tr></table></figure>

</li>
<li><p><strong>æ˜¾å¼å…·ä½“åŒ–</strong></p>
  <figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;&gt; <span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(<span class="type">int</span>&amp;, <span class="type">int</span>&amp;)</span></span>;</span><br><span class="line"><span class="keyword">template</span> &lt;&gt; <span class="type">void</span> <span class="built_in">swap</span>&lt;<span class="type">int</span>&gt;(<span class="type">int</span>&amp;, <span class="type">int</span>&amp;);</span><br></pre></td></tr></table></figure>
<p>  <em>ä¸ºä»€ä¹ˆéœ€è¦æ˜¾ç¤ºå…·ä½“åŒ–?å¸¸è§„å‡½æ•°ä¸èƒ½æ›¿ä»£å—?</em></p>
</li>
<li><p><strong>æ˜¾å¼å®ä¾‹åŒ–</strong></p>
<ul>
<li>ä¸ä½¿ç”¨å‡½æ•°å°±èƒ½ä¾ç…§æ¨¡æ¿ç”Ÿæˆå®ä¾‹, å¸¸ç”¨åœ¨åº“ä¸­</li>
<li><code>template void swap&lt;int&gt;(int&amp;, int&amp;);</code></li>
<li>ä½¿ç”¨å‡½æ•°æ—¶<code>add&lt;double&gt;((int)a, (double)b);</code> ä¼šå¼ºåˆ¶ä½¿ç”¨<double>æ¨¡æ¿.æ³¨æ„å¼•ç”¨ç±»å‹ä¸èƒ½éšå¼ç±»å‹è½¬æ¢.åç»­çš„å¼ºåˆ¶ä½¿ç”¨ä»éœ€åŠ &lt;double&gt;</li>
</ul>
</li>
</ul>
<hr>
<h2 id="å˜é‡å"><a href="#å˜é‡å" class="headerlink" title="::å˜é‡å"></a>::å˜é‡å</h2><ul>
<li>è¡¨æ˜é‡‡ç”¨å…¨å±€å˜é‡è€Œéå±€éƒ¨å˜é‡</li>
</ul>
<hr>
<h2 id="å‚¨å­˜ç©ºé—´"><a href="#å‚¨å­˜ç©ºé—´" class="headerlink" title="å‚¨å­˜ç©ºé—´"></a>å‚¨å­˜ç©ºé—´</h2><ol>
<li>é™æ€å‚¨å­˜: ä¿è¯åˆå§‹åŒ–ä¸º0, ç”Ÿå‘½å‘¨æœŸå’Œç¨‹åºç›¸åŒ.</li>
<li>è‡ªåŠ¨å‚¨å­˜(æ ˆå†…å­˜): ä¸ä¿è¯åˆå§‹åŒ–;</li>
<li>åŠ¨æ€å‚¨å­˜(å †å†…å­˜): ä¸ä¿è¯åˆå§‹åŒ–;</li>
</ol>
<hr>
<h2 id="å‚¨å­˜è¯´æ˜ç¬¦"><a href="#å‚¨å­˜è¯´æ˜ç¬¦" class="headerlink" title="å‚¨å­˜è¯´æ˜ç¬¦"></a>å‚¨å­˜è¯´æ˜ç¬¦</h2><ul>
<li>staticç”¨äºå˜é‡   <em>ç¼–è¯‘é˜¶æ®µå°½é‡åˆå§‹åŒ–, è¿è¡Œæ—¶ç›´æ¥åˆ†é…ç©ºé—´,ç¨‹åºç»“æŸæ—¶é”€æ¯, é¦–æ¬¡é‡åˆ°æ—¶å†ä¿è¯åˆå§‹åŒ–</em><ul>
<li>é™æ€å¤–éƒ¨é“¾æ¥æ€§å˜é‡: ç›´æ¥åœ¨éè¢«åŒ…æ‹¬åŒºåŸŸå®šä¹‰, åœ¨å…¶ä»–å•å…ƒä¸­å¯ç”¨externå¼•ç”¨å£°æ˜(ä¸å…è®¸å†æ¬¡åˆå§‹åŒ–)(ODRå•å®šä¹‰è§„åˆ™)</li>
<li>é™æ€å†…éƒ¨é“¾æ¥æ€§å˜é‡: åœ¨éè¢«åŒ…æ‹¬åŒºåŸŸåŠ static, é™å®šåœ¨æœ¬å•å…ƒå†…å¯ä»¥è®¿é—®</li>
<li>é™æ€æ— é“¾æ¥æ€§å˜é‡:åœ¨è¢«åŒ…æ‹¬åŒºåŸŸåŠ static, é™å®šåœ¨æœ¬åŒ…æ‹¬åŒºåŸŸå†…å¯ä»¥è®¿é—®</li>
</ul>
</li>
<li>staticç”¨äºå‡½æ•° è¦†ç›–å‡½æ•°çš„é»˜è®¤å¤–éƒ¨é“¾æ¥æ€§ä¸ºå†…éƒ¨é“¾æ¥æ€§,å¿…é¡»åŒæ—¶ç”¨äºåŸå‹å’Œå®šä¹‰ä¸­.</li>
<li>thread_local å˜é‡æŒç»­æ€§ä¸æ‰€å±çº¿ç¨‹çš„æŒç»­æ€§ç›¸åŒ, å¯ä¸static, externç»“åˆä½¿ç”¨(å…¶ä»–å£°æ˜ä¸­ä¸èƒ½ä½¿ç”¨å¤šä¸ªå‚¨å­˜è¯´æ˜ç¬¦)</li>
<li>mutable ä½¿å¾—constå¯¹è±¡ä¸­çš„å±æ€§èƒ½è¢«ä¿®æ”¹,è€Œä¸å—consté™åˆ¶</li>
<li>register C++11ä¹‹å‰æ˜¯å¯„å­˜å™¨å˜é‡,ä¸èƒ½å–åœ°å€;  ä¹‹åæ˜¯æ˜¾å¼æŒ‡æ˜è‡ªåŠ¨å˜é‡(æ— å®é™…ä½œç”¨,é¿å…æ—§ä»£ç éæ³•)</li>
</ul>
<hr>
<h2 id="æ˜¾å¼æŒ‡å‡ºè¯­è¨€é“¾æ¥æ€§ä»¥å¸®åŠ©é“¾æ¥ç¨‹åºå¯»æ‰¾åŒ¹é…å‡½æ•°"><a href="#æ˜¾å¼æŒ‡å‡ºè¯­è¨€é“¾æ¥æ€§ä»¥å¸®åŠ©é“¾æ¥ç¨‹åºå¯»æ‰¾åŒ¹é…å‡½æ•°" class="headerlink" title="æ˜¾å¼æŒ‡å‡ºè¯­è¨€é“¾æ¥æ€§ä»¥å¸®åŠ©é“¾æ¥ç¨‹åºå¯»æ‰¾åŒ¹é…å‡½æ•°:"></a>æ˜¾å¼æŒ‡å‡ºè¯­è¨€é“¾æ¥æ€§ä»¥å¸®åŠ©é“¾æ¥ç¨‹åºå¯»æ‰¾åŒ¹é…å‡½æ•°:</h2><pre><code>extern &quot;C&quot; void spiff(int);
</code></pre>
<hr>
<h2 id="cv-é™å®šç¬¦"><a href="#cv-é™å®šç¬¦" class="headerlink" title="cv-é™å®šç¬¦"></a>cv-é™å®šç¬¦</h2><pre><code>- constå…¨å±€å˜é‡å¸¦æœ‰éšå¼staticä½¿å¾—å˜é‡é“¾æ¥æ€§ä¸ºå†…éƒ¨, å¯¼è‡´å¤šæ–‡ä»¶åŒæ—¶includeä¸€ä¸ªå¤´æ–‡ä»¶æ—¶ä¸ä¼šå‘ç”Ÿå®šä¹‰å†²çª *å¯ä»¥ä½¿ç”¨externè¦†ç›–éšå¼staticä½¿å˜é‡é“¾æ¥æ€§ä¸ºå¤–éƒ¨. åœ¨å…¶ä»–å•å…ƒä¸­ä»éœ€ç”¨externæ¥å¼•ç”¨å®ƒ.*
- volatile æç¤ºç¼–è¯‘å™¨è¯¥å˜é‡ä¼šåœ¨ç¨‹åºä¹‹å¤–è¢«ä¿®æ”¹, ä¸è¦è¿›è¡Œå¯„å­˜å™¨ç¼“å­˜ä¼˜åŒ–. å¤šè§äºé©±åŠ¨ç¨‹åº.
</code></pre>
<hr>
<h2 id="newè¿ç®—ç¬¦"><a href="#newè¿ç®—ç¬¦" class="headerlink" title="newè¿ç®—ç¬¦"></a>newè¿ç®—ç¬¦</h2><ul>
<li>åŸå‡½æ•°:  <figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> * <span class="keyword">operator</span> <span class="title">new</span><span class="params">(std::<span class="type">size_t</span>)</span></span>;</span><br><span class="line"><span class="type">void</span> * <span class="keyword">operator</span> <span class="keyword">new</span>[] (std::size_T); <span class="comment">// new int[40] --&gt; new(40*sizeof(int))</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="keyword">operator</span> <span class="title">delete</span><span class="params">(<span class="type">void</span> *)</span></span>;</span><br><span class="line"><span class="type">void</span> <span class="keyword">operator</span> <span class="keyword">delete</span>[] (<span class="type">void</span> *);</span><br></pre></td></tr></table></figure></li>
<li>new, deleteå‡½æ•°å¯ä»¥æ›¿æ¢.</li>
<li>newåœ¨å †ä¸­æŸ¥æ‰¾æ»¡è¶³è¦æ±‚çš„å†…å­˜å—</li>
<li>å®šä½newè¿ç®—ç¬¦<ul>
<li><code>typename* p = new (MemAddress) typename</code></li>
<li>è¿”å›(void *)æŒ‡å®šçš„å†…å­˜åœ°å€</li>
<li>å…è®¸é‡è½½</li>
<li><strong>æ³¨æ„éå †å†…å­˜ä¸å¯delete</strong></li>
<li><strong>è‹¥å†…å­˜ä¸­å­˜æ”¾äº†å¯¹è±¡ï¼Œåˆ™éœ€è¦æ‰‹åŠ¨è°ƒç”¨ææ„å‡½æ•°ï¼Œå†ç”±MemAddressé‡Šæ”¾å†…å­˜ï¼Œä¸”éœ€æ³¨æ„new []ä¸delete []å¯¹åº”</strong></li>
</ul>
</li>
<li>å…ƒç´ çš„åˆ›å»ºä¸é”€æ¯åº”éµå¾ªFILOé¡ºåº</li>
</ul>
<hr>
<h2 id="åç§°ç©ºé—´"><a href="#åç§°ç©ºé—´" class="headerlink" title="åç§°ç©ºé—´"></a>åç§°ç©ºé—´</h2><ul>
<li>å£°æ˜åŒºåŸŸ: å¯ä»¥å£°æ˜å˜é‡çš„åŒºåŸŸ, ä¾‹å¦‚æ‰€åœ¨çš„æ–‡ä»¶, ä»£ç å—.</li>
<li>æ½œåœ¨ä½œç”¨åŸŸ: ä»å£°æ˜ç‚¹å¼€å§‹åˆ°å£°æ˜åŒºåŸŸçš„ç»“å°¾. å¯èƒ½è¢«å±€éƒ¨å˜é‡éšè—,æ•…ç§°æ½œåœ¨.</li>
<li>è‡ªå®šä¹‰åç§°ç©ºé—´:<code>namespace Somewhat &#123;...&#125;</code><ul>
<li>åªèƒ½åœ¨å‡½æ•°å¤–éƒ¨å®šä¹‰, å…è®¸åœ¨å¦ä¸€ä¸ªåç§°ç©ºé—´ä¸­åµŒå¥—</li>
<li>å› æ­¤, é»˜è®¤æƒ…å†µä¸‹å£°æ˜çš„åç§°çš„é“¾æ¥æ€§ä¸ºå¤–éƒ¨(é™¤éå®ƒå¼•ç”¨äº†å¸¸é‡)</li>
<li>å¯ä»¥åœ¨å…¶ä»–åˆæ³•ä½ç½®ç»§ç»­æ·»åŠ åç§°, æä¾›å®šä¹‰.</li>
</ul>
</li>
<li><code>using namespace Somewhat;</code>ç¼–è¯‘æŒ‡ä»¤<ul>
<li>æ¯ä¸ªå£°æ˜åŒºåŸŸä¸­éƒ½æœ‰ä¸€æ¡éšå¼çš„<code>using namespace å…¨å±€åç§°ç©ºé—´;</code></li>
<li>è‹¥æŸå¤„ä½¿ç”¨è¿‡<code>using namespace</code>ç¼–è¯‘æŒ‡ä»¤,åˆ™å…¶å­å£°æ˜åŒºåŸŸä¹Ÿéšå¼æ·»åŠ è¿™æ¡è¯­å¥.</li>
<li>å±€éƒ¨å˜é‡æ‹¥æœ‰æœ€é«˜ä¼˜å…ˆæƒ,èƒ½éšè—å„ç§using namespaceåŒåå˜é‡(å› ä¸ºåç§°ç©ºé—´éƒ½åœ¨å‡½æ•°å¤–éƒ¨å®šä¹‰)</li>
</ul>
</li>
<li><code>using</code>å£°æ˜<ul>
<li>ç±»ä¼¼äºå£°æ˜äº†ä¸€ä¸ªå±€éƒ¨å˜é‡, åœ¨ä»£ç å—ä¸­ä¸å…è®¸åŒçº§åŒå.</li>
<li>å› æ­¤ä½¿ç”¨usingå£°æ˜æ¯”ä½¿ç”¨usingç¼–è¯‘æŒ‡ä»¤æ›´å®‰å…¨.</li>
</ul>
</li>
<li>åç§°ç©ºé—´å¯ä»¥æ‹¥æœ‰åˆ«å, ç”¨äºç®€åŒ–ä»£ç : namespace MEF &#x3D; myth::elements::fire;</li>
<li>åç§°ç©ºé—´å¯ä»¥åŒ¿å, å£°æ˜ä¹‹åè‡ªåŠ¨éšå¼using, ç”¨äºé¿å…å…¶ä»–usingå¹¶æ›¿ä»£staticå…¨å±€å˜é‡.</li>
<li>&lt;.h&gt;æ–‡ä»¶æ˜¯ä¸æ”¯æŒåç§°ç©ºé—´çš„ç‰ˆæœ¬.æ–°ç‰ˆä¸€èˆ¬å°†å‡½æ•°æ¬åˆ°stdä¸­.</li>
<li>ä½¿ç”¨å»ºè®®: åœ¨å¤§å‹ç¨‹åº&#x2F;å¤šå•å…ƒç¨‹åºä½¿ç”¨<ul>
<li>å°‘ç”¨<code>using namespace</code></li>
<li>é¿å…åœ¨å¤´æ–‡ä»¶ä¸­ä½¿ç”¨usingç¼–è¯‘æŒ‡ä»¤,è‹¥å¿…é¡»ä½¿ç”¨,åˆ™åœ¨æ‰€æœ‰#includeä¹‹åä½¿ç”¨</li>
<li>é¿å…ç›´æ¥å£°æ˜å¤–éƒ¨å…¨å±€å˜é‡å’Œé™æ€å…¨å±€å˜é‡,æ”¹ç”¨å·²å‘½åçš„åç§°ç©ºé—´</li>
<li>usingå£°æ˜é¦–é€‰ç”¨åœ¨å±€éƒ¨è€Œä¸æ˜¯å…¨å±€</li>
</ul>
</li>
</ul>
<hr>
<h2 id="ç±»"><a href="#ç±»" class="headerlink" title="ç±»"></a>ç±»</h2><ul>
<li>æ„é€ å‡½æ•°<ul>
<li>è°ƒç”¨ç¤ºä¾‹:  <figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">Classname object; <span class="comment">// è°ƒç”¨ç©ºå‚æ•°æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="function">Classname <span class="title">object</span><span class="params">()</span></span>; <span class="comment">// è­¦å‘Š, æ­£åœ¨å£°æ˜å‡½æ•°</span></span><br><span class="line"><span class="function">Classname <span class="title">object</span><span class="params">(one, two, ...)</span></span>; <span class="comment">// è°ƒç”¨å¯¹åº”çš„æ„é€ å‡½æ•°</span></span><br><span class="line">Classname object = <span class="built_in">Classname</span>(one, ...); <span class="comment">// æœ‰å¯èƒ½å…ˆæ„é€ ä¸´æ—¶å¯¹è±¡</span></span><br><span class="line">Classname* p = <span class="keyword">new</span> <span class="built_in">Classname</span>(...);</span><br><span class="line">Classname object&#123;...&#125;; Classname object = Classname&#123;...&#125;; <span class="comment">// C++11</span></span><br><span class="line">Classname* p = <span class="keyword">new</span> Classname&#123;&#125;; <span class="comment">// C++11</span></span><br><span class="line">Classname object = value; <span class="comment">// è°ƒç”¨ä¸€ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°, å¯ç”¨explicit(ä¿®é¥°æ„é€ å‡½æ•°)å…³é—­è¿™ç§ç‰¹æ€§</span></span><br></pre></td></tr></table></figure></li>
<li>é‡è½½æ„é€ å‡½æ•°ä¸­ä½¿ç”¨çš„newæˆ–new []å¿…é¡»å¯¹åº”ï¼Œå› ä¸ºææ„å‡½æ•°åªæœ‰ä¸€ä¸ªã€‚</li>
<li>åˆå§‹åŒ–åˆ—è¡¨<ul>
<li>å‚æ•°åˆ—è¡¨åç”±å†’å·å¼•å‡ºçš„åˆå§‹åŒ–ä¿¡æ¯ã€‚åœ¨æ­¤åˆå§‹åŒ–å¯¹è±¡å°†ä½¿ç”¨å¤åˆ¶æ„é€ å‡½æ•°ï¼Œè€Œä¸æ˜¯ç©ºæ„é€ å‡½æ•°åŠ èµ‹å€¼è¿ç®—ç¬¦ï¼Œå› æ­¤æ•ˆç‡æ›´é«˜ã€‚</li>
<li>åˆå§‹åŒ–çš„é¡ºåºæŒ‰ç…§æˆå‘˜å˜é‡çš„å£°æ˜é¡ºåºï¼Œè€Œä¸åˆå§‹åŒ–åˆ—è¡¨é¡ºåºæ— å…³ã€‚</li>
<li>ä¸€æ—¦è¿›å…¥èŠ±æ‹¬å·ï¼Œæˆå‘˜å˜é‡å°†å®Œæˆé»˜è®¤çš„åˆå§‹åŒ–ï¼Œå¯¹è±¡åˆæ­¥åˆ›å»ºå®Œæˆã€‚å› æ­¤ï¼Œæˆå‘˜å˜é‡ä¸­ï¼Œéé™æ€å¸¸é‡ä¸å¼•ç”¨å¿…é¡»ç”±æ­¤åˆ—è¡¨è¿›è¡Œåˆå§‹åŒ–ã€‚</li>
<li>ç±»å†…åˆå§‹åŒ–å¯ç­‰ä»·äºé»˜è®¤çš„åˆ—è¡¨åˆå§‹åŒ–ã€‚åˆ—è¡¨åˆå§‹åŒ–ä¼šè¦†ç›–ç±»å†…åˆå§‹åŒ–ã€‚</li>
<li>åˆå§‹åŒ–åˆ—è¡¨è´Ÿè´£è°ƒç”¨åŸºç±»æ„é€ å‡½æ•°ï¼ˆåŸºç±»å·²åœ¨æ´¾ç”Ÿç±»ç±»åŸŸä¸­ï¼Œæ— éœ€åŠ ä½œç”¨åŸŸè§£æç¬¦ï¼‰</li>
<li>åˆå§‹åŒ–åˆ—è¡¨è´Ÿè´£è°ƒç”¨æˆå‘˜å¯¹è±¡çš„éé»˜è®¤æ„é€ å‡½æ•°</li>
</ul>
</li>
<li>é»˜è®¤ä¸èƒ½ç»§æ‰¿æ„é€ å‡½æ•°ï¼ˆC++11ï¼‰</li>
</ul>
</li>
<li>ææ„å‡½æ•°<ul>
<li>åªèƒ½æœ‰ä¸€ä¸ªææ„å‡½æ•°, ä¸”å‚æ•°å¿…é¡»ä¸ºç©º</li>
<li>æ³¨æ„ç”¨deleteå¯¹åº”æ„é€ å‡½æ•°æˆ–å…¶ä»–è¿‡ç¨‹çš„new</li>
<li>è‹¥å¯¹è±¡ç”±å®šä½newè¿ç®—ç¬¦åˆ›å»ºï¼Œåˆ™éœ€è¦æ‰‹åŠ¨è°ƒç”¨ææ„å‡½æ•°ï¼Œä¸”éµå¾ªFILOé¡ºåºã€‚</li>
<li>å¿…é¡»ä»¥deleteæˆ–delete []å¯¹åº”æ„é€ å‡½æ•°ä¸­çš„newæˆ–new []ã€‚</li>
<li>æœ€åä¼šè‡ªåŠ¨è°ƒç”¨åŸºç±»çš„ææ„å‡½æ•°</li>
<li>åº”å½“å°†ææ„å‡½æ•°å£°æ˜ä¸ºè™šå‡½æ•°</li>
<li>ä¸èƒ½ç»§æ‰¿ææ„å‡½æ•°</li>
</ul>
</li>
<li>å°è£…æ˜¯ä¸€ä¸ªç¼–è¯‘æœŸçš„æ¦‚å¿µ<ul>
<li>ç¼–è¯‘æœŸä¸å­˜åœ¨å®ä¾‹ï¼Œç¼–è¯‘å™¨ä»…é’ˆå¯¹ç±»å‹åšæ£€æŸ¥</li>
<li>å¯ä»¥åœ¨ç±»æ–¹æ³•ä¸­è®¿é—®åŒç±»å¯¹è±¡çš„ç§æœ‰æˆå‘˜</li>
</ul>
</li>
<li><em>åŒstruct</em> : é¿å…ç¯å½¢æ„é€ <ul>
<li>ç¼–è¯‘å™¨ç¦ç”¨ç®€å•ç¯å½¢å®šä¹‰, å¦‚ <code> struct A &#123; A a; &#125;; // ä½¿ç”¨äº†æœªå®Œæˆçš„å®šä¹‰</code></li>
<li>ç¼–è¯‘å™¨ä¸èƒ½è¾¨åˆ«å¤æ‚ç¯å½¢å®šä¹‰, å¦‚<code>struct A &#123; A()&#123;&#125; A* a = new A(); &#125;</code></li>
</ul>
</li>
<li>éé™æ€å˜é‡åœ¨è¿è¡Œæ—¶æ‰ä¼šåˆ›å»º, æ‰€ä»¥å¦‚int arr[MAXN]çš„MAXNå¿…é¡»æ˜¯é™æ€é‡,å¯ä»¥æ˜¯å…¨å±€const, ç±»ä¸­static const, enum{MAXN&#x3D;x}.</li>
<li>å‹å…ƒå‡½æ•°<ul>
<li>åœ¨å…±æœ‰éƒ¨åˆ†å£°æ˜å‹å…ƒå‡½æ•°åŸå‹, ä¹Ÿå¯ä»¥ç´§æ¥å®šä¹‰ä»¥è®¾ä¸ºå†…è”å‡½æ•°.åç½®çš„å®šä¹‰æ— éœ€friendä¿®é¥°</li>
<li>å‹å…ƒå‡½æ•°è§†ä¸ºç±»å¤–å‡½æ•°, ä½†å¯ä»¥è®¿é—®ç±»ç§æœ‰æˆå‘˜å˜é‡.</li>
<li>ç±»çš„æ˜¾å¼äºŒå…ƒé‡è½½è¿ç®—ç¬¦åº”å½“ç”¨å‹å…ƒ, å°½ç®¡æ²¡æœ‰ç›´æ¥ä¿®æ”¹ç±»ç§æœ‰æˆå‘˜å˜é‡</li>
<li>é‡è½½&lt;&lt; : <code>std::ostream&amp; operator &lt;&lt; (const std::ostream&amp; os, const Classname&amp; obj)</code>ä»¥æ–¹ä¾¿è¾“å‡º.</li>
<li>å‹å…ƒå‡½æ•°å¯æ–¹ä¾¿éšå¼ç±»å‹è½¬æ¢, ä¸å¿…è‹›æ±‚ç”±å¯¹è±¡å‘èµ·å‡½æ•°è°ƒç”¨.ä¾‹å¦‚cmp(&quot;asd&quot;, obj),å¯ä»¥å¯¹åº”åŸå‹cmp(string, string);</li>
<li>å¯ä»¥åœ¨æ´¾ç”Ÿç±»å‹å…ƒå‡½æ•°ä¸­ï¼Œå¼ºåˆ¶å‘ä¸Šè½¬å‹å¹¶ä½¿ç”¨åŸºç±»å‹å…ƒå‡½<br>  æ•°æ®ç±»å‹, å¦åˆ™æ˜“æœ‰äºŒä¹‰æ€§<br>  å‡½æ•°, é¿å…éšå¼è½¬æ¢å‡ºé”™<br>  ass_name&amp;)&#96;<br>  å§‹åŒ–ã€æŒ‰å€¼ä¼ é€’ã€æŒ‰å€¼è¿”å›ã€ä¸Šè½¬å‹å¹¶ä½¿ç”¨åŸºç±»å‹å…ƒå‡½æ•°ã€‚</li>
</ul>
</li>
<li>è½¬æ¢å‡½æ•°<code>operator typeName()</code><ul>
<li>ç”¨é€”:å°†ç±»è½¬æ¢æˆåŸºç¡€æ•°æ®ç±»å‹</li>
<li>å¿…é¡»æ˜¯æˆå‘˜æ–¹æ³•</li>
<li>ä¸èƒ½æŒ‡å®šè¿”å›ç±»å‹</li>
<li>ä¸èƒ½æœ‰å‚æ•°</li>
<li>ç”¨äºcoutæ—¶åº”æ˜¾å¼æ ‡æ˜ç±»å‹</li>
<li>åº”å½“ç”¨explicitä¿®é¥°</li>
</ul>
</li>
<li>å¤åˆ¶æ„é€ å‡½æ•°<code>Class_name(const Class_name&amp;)</code><ul>
<li>åœ¨åˆå§‹åŒ–å¯¹è±¡æ—¶ä½¿ç”¨(æ˜¾ç¤ºçš„åˆå§‹åŒ–ã€æŒ‰å€¼ä¼ é€’ã€æŒ‰å€¼è¿”å›ã€ç¼–è¯‘å™¨ç”Ÿæˆä¸´æ—¶å¯¹è±¡)</li>
<li><strong>æ–°ç‰ˆæœ¬C++å¯ç”¨ç§»åŠ¨æ„é€ å‡½æ•°</strong></li>
<li>ä¾‹:  <figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">Class_name <span class="title">a</span><span class="params">(b)</span></span>;</span><br><span class="line">Class_name* pa = <span class="keyword">new</span> <span class="built_in">Class_name</span>(b);</span><br><span class="line">Class_name a = b; <span class="comment">// å¯èƒ½ç”Ÿæˆä¸´æ—¶å¯¹è±¡åè°ƒç”¨èµ‹å€¼è¿ç®—ç¬¦å‡½æ•°,æ ¹æ®å®ç°è€Œå¼‚.</span></span><br><span class="line">Class_name a = <span class="built_in">Class_name</span>(b); <span class="comment">// åŒä¸Š</span></span><br><span class="line">æŒ‰å€¼ä¼ é€’å‡½æ•°è°ƒç”¨<span class="built_in">func</span>(b); <span class="comment">// æŒ‰å€¼ä¼ é€’ä¹Ÿåˆå§‹åŒ–äº†å‚æ•°</span></span><br></pre></td></tr></table></figure></li>
<li>é»˜è®¤çš„å¤åˆ¶æ„é€ å‡½æ•°ï¼Œæ˜¯åœ¨åˆå§‹åŒ–åˆ—è¡¨ä¸­è°ƒç”¨æ‰€æœ‰æˆå‘˜çš„å¤åˆ¶æ„é€ å‡½æ•°ã€‚é»˜è®¤å¤åˆ¶æ´¾ç”Ÿç±»å¯¹è±¡çš„åŸºç±»éƒ¨åˆ†</li>
<li>åº”æ³¨æ„<strong>æ·±åº¦å¤åˆ¶</strong>, å³å¦¥å–„å¤„ç†æŒ‡é’ˆæ‰€æŒ‡å‘å†…å®¹çš„å¤åˆ¶</li>
</ul>
</li>
<li>èµ‹å€¼è¿ç®—ç¬¦å‡½æ•°<ul>
<li>è€ƒè™‘å¦¥å–„å¤„ç†åŸæ¥å·²æœ‰çš„,å³å°†è¢«æŠ›å¼ƒçš„æ•°æ®.</li>
<li>è€ƒè™‘è‡ªå·±èµ‹å€¼ç»™è‡ªå·±çš„æƒ…å†µ, å°å¿ƒèµ‹å€¼å‰åˆ é™¤äº†è‡ªèº«æ•°æ®.</li>
<li>è®°ä½è¿”å›è‡ªèº«å¼•ç”¨, å³ <code>return *this</code></li>
<li>ä¸èƒ½ç»§æ‰¿èµ‹å€¼è¿ç®—ç¬¦å‡½æ•°</li>
<li>ä¸å»ºè®®è®¾ç½®ä¸ºè™šæ–¹æ³•ï¼Œä¸ºäº†é¿å…åŒåŸºç±»çš„ä¸åŒæ´¾ç”Ÿç±»äº’ç›¸èµ‹å€¼</li>
</ul>
</li>
<li>é»˜è®¤æ–¹æ³•çš„æ½œåœ¨å±é™©<ul>
<li>æŸä¸ªç±»åœ¨å¼€å‘åˆæœŸä¸éœ€è¦å¤åˆ¶æ„é€ å‡½æ•°&#x2F;èµ‹å€¼è¿ç®—ç¬¦é‡è½½ï¼Œä½†åœ¨ä»¥åå¯èƒ½éœ€è¦</li>
<li>å¯èƒ½å†™å‡ºç¬¦åˆå¸¸ç†çš„ä»£ç ï¼Œä½†ç”±äºæœªè¦†ç›–é»˜è®¤æ–¹æ³•è€Œè¿è¡Œæ—¶å¼‚å¸¸</li>
<li>å¯èƒ½åœ¨æœªå¯Ÿè§‰çš„æƒ…å†µä¸‹è°ƒç”¨äº†é»˜è®¤æ–¹æ³•ï¼ˆç”¨é‡è½½åŠ æ³•æ—¶æŒ‰å€¼ä¼ é€’ã€æŒ‰å€¼è¿”å›å°†è°ƒç”¨å¤åˆ¶æ„é€ å‡½æ•°ï¼‰</li>
<li>è§£å†³åŠæ³•ï¼š<ul>
<li>ä¸ç®¡é»˜è®¤æ–¹æ³•æ˜¯å¦éœ€è¦ï¼Œæ€»æ˜¯æä¾›æ­£ç¡®çš„ä»£ç </li>
<li>å°†ç©ºæ–¹æ³•è®¾ä¸ºprivateï¼Œå¹¶ç•™ä¸‹é”™è¯¯ä¿¡æ¯</li>
<li>ä½¿ç”¨deleteï¼ˆC++11ï¼‰</li>
</ul>
</li>
</ul>
</li>
<li><code>[ ]</code>(å–ä½)è¿ç®—ç¬¦: ä¸¤ä¸ªæ“ä½œæ•°åˆ†ç«‹äºå·¦ä¸­æ‹¬å·ä¸¤ä¾§ã€‚åªèƒ½æ˜¯æˆå‘˜å‡½æ•°ã€‚</li>
<li>constå¯¹è±¡<ul>
<li>åªèƒ½ä½¿ç”¨constå‡½æ•°, è‹¥è¿”å›å¼•ç”¨, åˆ™è¿”å›ç±»å‹ä¸ºconst type&amp;</li>
</ul>
</li>
<li>é™æ€ç±»æˆå‘˜å‡½æ•°<ul>
<li>åŸå‹å«static, å®šä¹‰ä¸å«</li>
<li>å’ŒJavaä¸åŒ, ä¸èƒ½é€šè¿‡å¯¹è±¡æ¥è°ƒç”¨é™æ€æˆå‘˜å‡½æ•°</li>
<li>è°ƒç”¨æ ¼å¼ <code>Class_name::s_method();</code></li>
</ul>
</li>
<li>é™æ€ç±»æˆå‘˜å˜é‡<ul>
<li>åœ¨ç±»ä¸­å£°æ˜, ä¸å¯å®šä¹‰</li>
<li>åœ¨ç±»å¤–å®šä¹‰å¹¶åˆ†é…å†…å­˜, å¯ä»¥ä¸åˆå§‹åŒ–</li>
<li>é™æ€å¸¸é‡åœ¨å£°æ˜åŒæ—¶å®šä¹‰.</li>
</ul>
</li>
<li>æ´¾ç”Ÿ&#x2F;ç»§æ‰¿<ul>
<li><code>class newClass : public baseClase</code></li>
<li>é»˜è®¤ç»§æ‰¿ä¸ºprivateç»§æ‰¿ã€‚ç§æœ‰ç»§æ‰¿çš„å‘ä¸Šè½¬å‹å¿…é¡»æ˜¾å¼å†™å‡º</li>
<li>å¤šé‡ç»§æ‰¿çš„å‘ä¸Šè½¬å‹ä¹Ÿåº”æ˜¾ç¤ºå†™å‡ºï¼Œä»¥é˜²ä¸åŒåŸºç±»çš„æ–¹æ³•å†²çª</li>
<li>æ´¾ç”Ÿç±»ä¸­ä¸€æ—¦å®šä¹‰æŸæ–¹æ³•ä¸åŸºç±»æ–¹æ³•åŒåï¼Œåˆ™åŸºç±»æ‰€æœ‰è¯¥åæ–¹æ³•è¢«éšè—ã€‚ä¸å‚æ•°åˆ—è¡¨ï¼ˆç‰¹å¾æ ‡ï¼‰æ— å…³ã€‚<ul>
<li>å¯ç”¨åŸºç±»å::æ–¹æ³•åçš„é€”å¾„è°ƒç”¨éšè—çš„æ–¹æ³•</li>
<li>é‡æ–°å®šä¹‰ç»§æ‰¿çš„æ–¹æ³•ï¼Œåº”ç¡®ä¿ä¸åŸæ¥çš„åŸå‹å®Œå…¨ç›¸åŒ</li>
<li>è‹¥è¿”å›ç±»å‹ä¸ºåŸºç±»å¼•ç”¨æˆ–æŒ‡é’ˆï¼Œåˆ™å¯ä»¥ä¿®æ”¹ä¸ºæ´¾ç”Ÿç±»çš„å¼•ç”¨æˆ–æŒ‡é’ˆï¼ˆè¿”å›ç±»å‹åå˜ï¼‰</li>
<li>è‹¥åŸºç±»è™šæ–¹æ³•è¢«é‡è½½äº†ï¼Œåˆ™åº”åœ¨æ´¾ç”Ÿç±»ä¸­é‡æ–°å®šä¹‰æ‰€æœ‰çš„åŸºç±»ç‰ˆæœ¬</li>
</ul>
</li>
<li>è‹¥æ´¾ç”Ÿç±»æ„é€ å‡½æ•°ä½¿ç”¨äº†newï¼Œåˆ™åº”æä¾›å¤åˆ¶æ„é€ å‡½æ•°&#x2F;èµ‹å€¼è¿ç®—ç¬¦ï¼ˆå«<code>base::operator=(o);</code>ï¼‰&#x2F;è™šææ„å‡½æ•°çš„å®šä¹‰</li>
<li>å…¬æœ‰ç»§æ‰¿è¡¨è¾¾äº†is-aå…³ç³»ï¼Œç§æœ‰ç»§æ‰¿&#x2F;åŒ…å«è¡¨è¾¾äº†has-aå…³ç³»ã€‚é€šå¸¸ä½¿ç”¨ç»„åˆåŒ…å«å±‚æ¬¡åŒ–æ¥å»ºç«‹has-aå…³ç³»ã€‚å¦‚æœéœ€è¦è®¿é—®åŸæœ‰ç±»çš„ä¿æŠ¤æˆå‘˜æˆ–é‡æ–°å®šä¹‰è™šæ–¹æ³•ï¼Œæ‰ä½¿ç”¨ç§æœ‰ç»§æ‰¿ã€‚</li>
<li>æ¬²è°ƒç”¨åŸºç±»å¯¹è±¡ï¼Œå¯¹(*this)å¼ºåˆ¶å‘ä¸Šè½¬å‹(const Base &amp;)å³å¯</li>
<li>ç”¨usingæ”¹å˜ç»§æ‰¿æˆå‘˜æƒé™ï¼šåœ¨æ´¾ç”Ÿç±»çš„publicå¤„<code>using Base::methodName;</code>(çœç•¥usingçš„æŠ€æœ¯æ˜¯å³å°†è¢«æŠ›å¼ƒçš„æ—§æŠ€æœ¯)</li>
</ul>
</li>
<li>è™šæ–¹æ³•<ul>
<li>è‹¥å¸Œæœ›é€šè¿‡åŸºç±»å¼•ç”¨æˆ–æŒ‡é’ˆè°ƒç”¨æ´¾ç”Ÿç±»æ–¹æ³•ï¼Œåˆ™éœ€è¦å°†åŸºç±»æ–¹æ³•å£°æ˜ä¸ºvirtualè™šæ–¹æ³•ï¼ˆä¸€èˆ¬ä¹Ÿå°†æ´¾ç”Ÿç±»æ–¹æ³•å£°æ˜ä¸ºvirtualï¼‰</li>
<li>åº”å½“å°†ææ„å‡½æ•°å®šä¹‰ä¸ºè™šæ–¹æ³•ï¼Œä»¥ç¡®ä¿æ­£ç¡®åœ°é”€æ¯å¯¹è±¡</li>
<li>åœ¨ç±»ä¸­æ¬²è°ƒç”¨åŸºç±»æ–¹æ³•(è€Œä¸æ˜¯æœ¬ç±»æ–¹æ³•)ï¼Œéœ€ä½¿ç”¨ä½œç”¨åŸŸè§£æç¬¦<code>Base::baseMethod();</code></li>
<li>ç¼–è¯‘å™¨å¯¹è™šæ–¹æ³•çš„ä¸€èˆ¬å®ç°ï¼šæŠŠç±»çš„æ‰€æœ‰è™šå‡½æ•°çš„åœ°å€åˆ¶ä½œæˆè¡¨ï¼Œåœ¨å¯¹è±¡ä¸­æ·»åŠ éšè—çš„è™šå‡½æ•°è¡¨æŒ‡é’ˆï¼Œåœ¨è¿è¡Œæ—¶é€šè¿‡æŒ‡é’ˆæ£€ç´¢è™šå‡½æ•°ã€‚</li>
<li>ä¸Javaä¸åŒï¼Œæ´¾ç”Ÿç±»è™šæ–¹æ³•çš„è®¿é—®æƒé™å…è®¸å˜ä¸¥æ ¼ï¼Œä½†ç”±åŸºç±»å¼•ç”¨æˆ–æŒ‡é’ˆçš„å¤šæ€æ•ˆæœä»ç„¶ç”Ÿæ•ˆã€‚</li>
<li>æ´¾ç”Ÿç±»ä¸­ä¸€æ—¦å®šä¹‰è™šæ–¹æ³•ï¼Œå°±å°†éšè—åŸºç±»æ‰€æœ‰åŒåæ–¹æ³•ï¼Œæ•…åº”åœ¨æ´¾ç”Ÿç±»ä¸­é‡æ–°å®šä¹‰æ‰€æœ‰çš„åŸºç±»é‡è½½æ–¹æ³•</li>
<li>å¯ä»¥ä»¤è™šæ–¹æ³•å£°æ˜ç»“å°¾å¤„ä¸º<code>=0</code>ï¼Œä½¿æ–¹æ³•æˆä¸ºçº¯è™šæ–¹æ³•ã€‚çº¯è™šæ–¹æ³•å¯ä»¥ä¸æä¾›å®šä¹‰ã€‚å«æœ‰è‡³å°‘ä¸€ä¸ªçº¯è™šæ–¹æ³•çš„ç±»ä¸ºæŠ½è±¡ç±»ï¼Œä¸èƒ½å£°æ˜å¯¹è±¡ã€‚</li>
</ul>
</li>
<li>è®¿é—®æƒé™<ul>
<li>privateï¼šä»…æœ¬ç±»å’Œå‹å…ƒå‡½æ•°æœ‰æƒè®¿é—®ã€‚å¯¹æ•°æ®æˆå‘˜çš„ç†æƒ³è®¿é—®æ§åˆ¶ã€‚</li>
<li>protectedï¼šæœ¬ç±»å’Œæ´¾ç”Ÿç±»æœ‰æƒè®¿é—®ã€‚åœ¨æ´¾ç”Ÿé“¾ä¸­ï¼Œæ­¤æƒé™ç±»ä¼¼publicï¼›åœ¨ç±»å¤–éƒ¨ï¼Œæ­¤æƒé™ç±»ä¼¼peivateã€‚æ­¤æƒé™é€šå¸¸åªç»™æˆå‘˜å‡½æ•°ã€‚</li>
<li>publicï¼šåœ¨åŒä¸€åŸŸä¸­å°±èƒ½è®¿é—®ã€‚</li>
</ul>
</li>
<li>å¼•ç”¨é™å®šæˆå‘˜å‡½æ•°<ul>
<li>å‡½æ•°ç­¾åçš„æœ€åå¯ä»¥æ ‡æ³¨<code>&amp;</code>æˆ–<code>&amp;&amp;</code>æ¥åšã€Œå¼•ç”¨é™å®š ref-qualifiedã€ã€‚<ol>
<li>éé™å®šæˆå‘˜å‡½æ•°å¯ç”±å·¦å€¼è°ƒç”¨ï¼Œä¹Ÿå¯ç”±å³å€¼è°ƒç”¨ã€‚æ­¤æ—¶ä¸èƒ½å†å®šä¹‰å¼•ç”¨é™å®šæˆå‘˜å‡½æ•°ã€‚</li>
<li>å·¦å€¼é™å®šæˆå‘˜å‡½æ•°ä»…å¯ç”±å·¦å€¼è°ƒç”¨ã€‚</li>
<li>å³å€¼é™å®šæˆå‘˜å‡½æ•°ä»…å¯ç”±å³å€¼è°ƒç”¨ã€‚</li>
</ol>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="Lambda"><a href="#Lambda" class="headerlink" title="Lambda"></a>Lambda</h2><p>Lambdaæ˜¯ä¸€ç§åŒ¿åå‡½æ•°ï¼Œå®ƒåœ¨æ™®é€šå‡½æ•°çš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€äº›åŠŸèƒ½ã€‚Lambdaæ˜¯é€šè¿‡å‡½æ•°å¯¹è±¡å®ç°çš„ï¼Œå…·æœ‰åœ¨ç¼–è¯‘å™¨å†…è”çš„èƒ½åŠ›ï¼Œå› æ­¤æ€§èƒ½å¯ä»¥æ¯”å‡½æ•°æŒ‡é’ˆæ›´å¥½ã€‚</p>
<h3 id="ä½¿ç”¨ä¸¾ä¾‹"><a href="#ä½¿ç”¨ä¸¾ä¾‹" class="headerlink" title="ä½¿ç”¨ä¸¾ä¾‹"></a>ä½¿ç”¨ä¸¾ä¾‹</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">[](<span class="type">int</span> q, <span class="type">int</span> p) &#123; <span class="keyword">return</span> q &gt; p; &#125; <span class="comment">// å¸¸è§çš„æ¯”è¾ƒå‡½æ•°</span></span><br><span class="line">[mask](<span class="type">int</span> x) &#123; <span class="keyword">return</span> mask &amp; x; &#125; <span class="comment">// åˆ¤æ–­æœ‰æ— äº¤é›†</span></span><br><span class="line">[&amp;flag](<span class="type">int</span> x) &#123; flag[x] = <span class="literal">true</span>; &#125; <span class="comment">// ä¿®æ”¹è‡ªåŠ¨å˜é‡flagæ•°ç»„</span></span><br><span class="line">[&amp;](<span class="type">int</span> x)-&gt;<span class="type">int</span> &#123;   <span class="comment">// æŒ‰å¼•ç”¨æ•è·å½“å‰ä½œç”¨åŸŸçš„å…¨éƒ¨è‡ªåŠ¨å˜é‡ã€‚ä¸æ˜¯ç®€å•åœ°returnæ•…è¦å£°æ˜ç±»å‹</span></span><br><span class="line">    <span class="keyword">if</span> (x &gt; mx) mx = x;</span><br><span class="line">    <span class="keyword">return</span> tot += x;</span><br><span class="line">&#125;</span><br><span class="line">[k, &amp;](<span class="type">int</span> del) &#123;  <span class="comment">// æŒ‰å€¼æ•è·kã€æŒ‰å¼•ç”¨æ•è·å…¶ä»–å˜é‡</span></span><br><span class="line">    sth += del;</span><br><span class="line">    cout &lt;&lt; k &lt;&lt; endl; <span class="comment">// kæ˜¯åªè¯»çš„ï¼Ÿï¼Ÿï¼ï¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å³å€¼"><a href="#å³å€¼" class="headerlink" title="å³å€¼"></a>å³å€¼</h2><p>rvalue,ï¼ˆéä¸¥æ ¼å®šä¹‰: ï¼‰åŒ¿åçš„ä¸´æ—¶å€¼ï¼Œå¸¸å‡ºç°åœ¨ç­‰å·çš„å³æ–¹ã€‚æœ€å¤§ç‰¹å¾æ˜¯ä¸å¯å–åœ°å€ï¼Œä¾‹å¦‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> a;</span><br><span class="line">a = <span class="number">2</span> + <span class="number">3</span>; <span class="comment">// (2+3) å°±æ˜¯ä¸€ä¸ªå³å€¼ï¼Œ &amp;(2+3)æ²¡æœ‰æ„ä¹‰</span></span><br></pre></td></tr></table></figure>

<h3 id="å³å€¼å¼•ç”¨"><a href="#å³å€¼å¼•ç”¨" class="headerlink" title="å³å€¼å¼•ç”¨"></a>å³å€¼å¼•ç”¨</h3><p>æœ‰æ—¶å€™è¿ç®—è¿‡ç¨‹ä¸­ä¼šç”Ÿæˆä¸€äº›ä½“ç§¯å¤§çš„ä¸´æ—¶å¯¹è±¡ï¼Œåœ¨å®Œæˆè¡¨è¾¾å¼åè¿™äº›ä¸´æ—¶å¯¹è±¡ä¼šææ„ï¼Œä¾‹å¦‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">MyString</span> &#123;</span><br><span class="line">  <span class="type">char</span>* data = <span class="literal">nullptr</span>;</span><br><span class="line">  <span class="comment">//... ä½¿ç”¨newå’Œdeleteçš„æ¨¡ä»¿stringç±»ï¼Œå…·æœ‰æ‹·è´æ„é€ å‡½æ•°</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">vector&lt;MyString&gt; arr; arr.<span class="built_in">reverse</span>(<span class="number">10</span>); <span class="comment">// ä¿ç•™10ä¸ªstringçš„ç©ºé—´</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; ++i) &#123;</span><br><span class="line">  arr.<span class="built_in">push_back</span>(<span class="built_in">MyString</span>(<span class="string">&quot;Hello_rvalue&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¬¬8è¡Œå‘ç”Ÿå¦‚ä¸‹äº‹ä»¶ï¼š</p>
<ol>
<li>MyString(&quot;Hello_rvalue&quot;) äº§ç”Ÿä¸€ä¸ªå³å€¼ã€‚</li>
<li>push_backæ¥æ”¶ä¸€ä¸ªå³å€¼å‚æ•°ï¼Œå¹¶è°ƒç”¨MyStringçš„<strong>æ‹·è´æ„é€ å‡½æ•°</strong>æ–°å»ºä¸€ä¸ªå¯¹è±¡ã€‚</li>
<li>MyString(&quot;Hello_rvalue&quot;)ç”Ÿå‘½å‘¨æœŸç»“æŸï¼Œææ„ã€‚</li>
</ol>
<p>å‘ç°æ‹·è´æ„é€ å‡½æ•°å­˜åœ¨èµ„æºæµªè´¹ï¼šæ—¢ç„¶å³å€¼çš„èµ„æºå·²ç»æ²¡æœ‰åç»­ä»·å€¼ï¼Œå¤§å¯ä»¥å°†å…¶èµ„æºâ€œå·â€è¿‡æ¥ä½¿ç”¨ã€‚</p>
<p>äºæ˜¯ï¼ŒMyStringç±»æ–°å¢<strong>ç§»åŠ¨æ„é€ å‡½æ•°</strong>ï¼ˆè¿˜æœ‰<strong>ç§»åŠ¨èµ‹å€¼å‡½æ•°</strong>ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">MyString</span> &#123;</span><br><span class="line">  <span class="comment">// ... åŒä¸Š</span></span><br><span class="line">  <span class="built_in">MyString</span>(MyString&amp;&amp; x) &#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;data = x-&gt;data;</span><br><span class="line">    x-&gt;data = <span class="literal">nullptr</span>; <span class="comment">// èµ„æºè¢«å·èµ°</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  MyString&amp; <span class="keyword">operator</span>=(MyString&amp;&amp; x) &#123;</span><br><span class="line">    <span class="comment">// ç±»ä¼¼ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä¸èµ˜è¿°</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å¦‚æ­¤ä¸€æ¥ï¼Œpush_backå°†è‡ªåŠ¨è°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°æ¥åˆ›å»ºå¯¹è±¡ï¼Œé¿å…å¤§é‡newå†…å­˜ã€‚</p>
<p>å³å€¼å¼•ç”¨çš„å­˜åœ¨ï¼Œå°±æ˜¯ä¸ºäº†<strong>å°½é‡æ¦¨å¹²ä¸´æ—¶å¯¹è±¡çš„ä»·å€¼</strong>ã€‚</p>
<p>è¦åˆ©ç”¨å³å€¼å¼•ç”¨ï¼Œæœ€é‡è¦çš„æ˜¯<strong>åˆç†åœ°å®šä¹‰ç§»åŠ¨æ„é€ å’Œç§»åŠ¨èµ‹å€¼</strong>ã€‚</p>
<h3 id="ç§»åŠ¨è¯­ä¹‰"><a href="#ç§»åŠ¨è¯­ä¹‰" class="headerlink" title="ç§»åŠ¨è¯­ä¹‰"></a>ç§»åŠ¨è¯­ä¹‰</h3><p>æœ‰æ—¶å€™ä¸€äº›å·¦å€¼å°±åƒå³å€¼ä¸€æ ·å³å°†æ¶ˆäº¡ï¼Œå¼ƒä¹‹å¯æƒœï¼Œä¾‹å¦‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; ++i) &#123;</span><br><span class="line">  <span class="function">string <span class="title">tmp</span><span class="params">(<span class="string">&quot;hello&quot;</span>)</span></span>;</span><br><span class="line">	tmp += <span class="string">&quot; rvalue?&quot;</span>; <span class="comment">// tmpç»è¿‡ä¸€ç³»åˆ—å¤æ‚çš„å¤„ç†</span></span><br><span class="line">  arr.<span class="built_in">push_back</span>(tmp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœèƒ½åƒå³å€¼å¼•ç”¨ä¸€èˆ¬æŠŠtmpçš„èµ„æºâ€œå·â€èµ°å°±å¥½äº†ï¼Œäºæ˜¯</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; ++i) &#123;</span><br><span class="line">  <span class="function">string <span class="title">tmp</span><span class="params">(<span class="string">&quot;hello&quot;</span>)</span></span>;</span><br><span class="line">	tmp += <span class="string">&quot; rvalue?&quot;</span>; <span class="comment">// tmpç»è¿‡ä¸€ç³»åˆ—å¤æ‚çš„å¤„ç†</span></span><br><span class="line">  arr.<span class="built_in">push_back</span>(std::<span class="built_in">move</span>(tmp)); <span class="comment">// å¼ºåˆ¶è½¬æ¢ä¸ºå³å€¼</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼Œmove(tmp)åç”±äºèµ„æºå·²ç»è¢«å·èµ°ï¼Œtmpå¯èƒ½åƒé‡æŒ‡é’ˆä¸€æ ·å±é™©ã€‚è¢«moveåå¯¹è±¡çš„è¡Œä¸ºç”±ç¨‹åºå‘˜è´Ÿè´£ã€‚</p>
<h3 id="å®Œç¾è½¬å‘"><a href="#å®Œç¾è½¬å‘" class="headerlink" title="å®Œç¾è½¬å‘"></a>å®Œç¾è½¬å‘</h3><p>å®Œç¾è½¬å‘æ˜¯é’ˆå¯¹c++æ¨¡æ¿å‡½æ•°çš„æ¦‚å¿µã€‚</p>
<p>æˆ‘ä»¬ä¸å¾—ä¸å…ˆä»‹ç»c++å¼•ç”¨æŠ˜å æ¦‚å¿µï¼š</p>
<table>
<thead>
<tr>
<th>typename T</th>
<th>T&amp;</th>
<th>T&amp;&amp;</th>
</tr>
</thead>
<tbody><tr>
<td>G</td>
<td>G&amp;</td>
<td>G&amp;&amp;</td>
</tr>
<tr>
<td>G&amp;</td>
<td>G&amp;</td>
<td><strong>G&amp;</strong></td>
</tr>
<tr>
<td>G&amp;&amp;</td>
<td><strong>G&amp;</strong></td>
<td>G&amp;&amp;</td>
</tr>
</tbody></table>
<p>æ¨¡æ¿å‡½æ•°çš„å³å€¼å¼•ç”¨å…·æœ‰æ¬ºéª—æ€§ï¼åœ¨æ¨¡æ¿å®ä¾‹åŒ–æ—¶ï¼Œ<code>T&amp; &amp;&amp;</code> å’Œ<code>T&amp;&amp; &amp;</code>éƒ½ä¼šè¢«è½¬æ¢ä¸º<code>T&amp;</code>ã€‚åªæœ‰<code>T&amp;&amp; &amp;&amp;</code>ä¼šæˆä¸º<code>T&amp;&amp;</code>ã€‚åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯åªå®šä¹‰<code>T&amp;&amp;</code>çš„å‡½æ•°è¡Œä¸ºã€‚</p>
<p><em>ï¼ˆå¯¹äºç®€å•çš„æƒ…å†µï¼Œ<code>T &amp;&amp;</code> ç­‰ä»·äº <code>T&amp;&amp; </code>ï¼‰</em></p>
<p>ä½†æ­¤æ—¶ä¹Ÿå‡ºç°äº†å¦ä¸€ä¸ªé—®é¢˜ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f1</span><span class="params">(T&amp;&amp; x1)</span> </span>&#123;</span><br><span class="line">  <span class="built_in">f2</span>(x1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f2</span><span class="params">(T&amp;&amp; x2)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// do something</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¸Œæœ›ï¼Œè‹¥f1æ¥æ”¶å·¦å€¼ï¼Œé‚£ä¹ˆf2ä¹Ÿåº”è¯¥æ¥æ”¶å·¦å€¼ï¼›å¦‚æœf1æ¥æ”¶å³å€¼ï¼Œé‚£ä¹ˆf2ä¹Ÿåº”è¯¥æ¥æ”¶å³å€¼ã€‚ä½†c++è§„å®šï¼Œâ€œå³å€¼å¼•ç”¨â€æ˜¯ä¸€ä¸ªå·¦å€¼ï¼Œå› ä¸ºå®ƒæœ‰åå­—ï¼Œè¿˜å¯ä»¥å–åœ°å€ã€‚åœ¨è¿™é‡Œï¼Œf2æ— è®ºå¦‚ä½•éƒ½ä¼šæ¥æ”¶å·¦å€¼ã€‚æ€æ ·æ‰èƒ½å†™å‡ºè‡ªåŠ¨æ¥æ”¶å·¦å³å€¼çš„æ¨¡æ¿å‡½æ•°å‘¢ï¼Ÿ</p>
<p>åˆ©ç”¨<strong>ä»»æ„è¡¨è¾¾å¼éƒ½èƒ½ç”ŸæˆåŒ¿åå€¼</strong>ï¼Œæœ€ç®€å•çš„ï¼Œå°±åƒ<code>static_cast&lt;T&amp;&amp;&gt;(x1)</code>ï¼Œæ­¤æ—¶è¡¨è¾¾å¼çš„ç»“æœå¯ä»¥è½¬åŒ–ä¸ºå³å€¼ã€‚å†åŠ ä¸Šå¼•ç”¨æŠ˜å çš„ç‰¹æ€§ï¼Œå°±æ˜¯<code>std::forward</code>çš„åŸºæœ¬åŸç†ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Tå¯ä»¥æ˜¯scalar,object,lrefã€‚ ä½†ä¸å¯èƒ½æ˜¯rrefï¼</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">f1</span><span class="params">(T&amp;&amp; x1)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// å®ç°äº†å·¦å€¼è½¬å‘ä¸ºå·¦å€¼ï¼Œå³å€¼è½¬å‘ä¸ºå³å€¼ã€‚</span></span><br><span class="line">  <span class="built_in">f2</span>(std::forward&lt;T&gt;(x1)); <span class="comment">// ä¸èƒ½ä¾èµ–C++17çš„è‡ªåŠ¨æ¨å¯¼ï¼Œå› ä¸ºx1æ€»æ˜¯lrefï¼</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é™„ï¼šstdçš„å®ç°</span></span><br><span class="line"><span class="comment">// FUNCTION TEMPLATE forward</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Ty</span>&gt;</span><br><span class="line"><span class="function">_NODISCARD <span class="keyword">constexpr</span> _Ty&amp;&amp; <span class="title">forward</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">    <span class="type">remove_reference_t</span>&lt;_Ty&gt;&amp; _Arg)</span> <span class="keyword">noexcept</span> </span>&#123; <span class="comment">// forward an lvalue as either an lvalue or an rvalue</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;_Ty&amp;&amp;&gt;(_Arg); <span class="comment">// æ³¨æ„è¿™é‡Œå¯èƒ½å‘ç”Ÿå¼•ç”¨æŠ˜å </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Ty</span>&gt;</span><br><span class="line"><span class="function">_NODISCARD <span class="keyword">constexpr</span> _Ty&amp;&amp; <span class="title">forward</span><span class="params">(<span class="type">remove_reference_t</span>&lt;_Ty&gt;&amp;&amp; _Arg)</span> <span class="keyword">noexcept</span> </span>&#123; <span class="comment">// forward an rvalue as an rvalue</span></span><br><span class="line">    <span class="built_in">static_assert</span>(!is_lvalue_reference_v&lt;_Ty&gt;, <span class="string">&quot;bad forward call&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;_Ty&amp;&amp;&gt;(_Arg);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// FUNCTION TEMPLATE move</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Ty</span>&gt;</span><br><span class="line"><span class="function">_NODISCARD <span class="keyword">constexpr</span> <span class="type">remove_reference_t</span>&lt;_Ty&gt;&amp;&amp; <span class="title">move</span><span class="params">(_Ty&amp;&amp; _Arg)</span> <span class="keyword">noexcept</span> </span>&#123; <span class="comment">// forward _Arg as movable</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;<span class="type">remove_reference_t</span>&lt;_Ty&gt;&amp;&amp;&gt;(_Arg); <span class="comment">// æ³¨æ„è¿™é‡Œä¸å¯èƒ½å‘ç”Ÿå¼•ç”¨æŠ˜å </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h2><ul>
<li>æ•è·å¼‚å¸¸æ—¶ï¼Œä»å…·ä½“åˆ°æŠ½è±¡ï¼Œæœ€ååˆ°<code>...</code>ã€‚</li>
<li>å¦‚æœå¼‚å¸¸æºå¸¦å­—ç¬¦ä¸²ä¿¡æ¯ï¼Œåˆ™å¯èƒ½å¼•å‘<code>std::bad_alloc</code>ï¼ŒæƒŠä¸æƒŠå–œï¼</li>
<li>stdå®šä¹‰çš„å¼‚å¸¸åˆ†ç±»ï¼š<code>#include &lt;stdexcept&gt;</code>  <ol>
<li><code>logic_error</code> é€»è¾‘å‡ºé”™ã€‚</li>
<li><code>invalid_argument</code> æ— æ•ˆå‚æ•°ã€‚</li>
<li><code>domain_error</code> å€¼åŸŸé”™è¯¯ã€‚ï¼ˆç»§æ‰¿è‡ª<code>logic_error</code>ï¼‰</li>
<li><code>length_error</code> è¯•å›¾è¶…è¶Šæœ€å¤§ä½“ç§¯ã€‚ï¼ˆç»§æ‰¿è‡ª<code>logic_error</code>ï¼‰</li>
<li><code>out_of_range</code> è¯•å›¾è¶Šç•Œã€‚ï¼ˆç»§æ‰¿è‡ª<code>logic_error</code>ï¼‰</li>
<li><code>runtime_error</code> ä»…åœ¨è¿è¡Œæ—¶å¯çŸ¥çš„é”™è¯¯ã€‚</li>
<li><code>range_error</code> è®¡ç®—ç»“æœæ— æ³•ç”¨ç›®æ ‡ç±»å‹è¡¨ç¤ºã€‚ï¼ˆç»§æ‰¿è‡ª<code>runtime_error</code>ï¼‰</li>
<li><code>overflow_error</code> ç®—æœ¯ä¸Šæº¢ã€‚ï¼ˆç»§æ‰¿è‡ª<code>runtime_error</code>ï¼‰</li>
<li><code>underflow_error</code> ç®—æœ¯ä¸‹æº¢ã€‚ï¼ˆç»§æ‰¿è‡ª<code>runtime_error</code>ï¼‰</li>
<li><code>tx_exception</code> å¯ç”¨äºå›æ»šæˆ–å–æ¶ˆtransactionçš„å¼‚å¸¸ã€‚ï¼ˆTransactional Memory Technical Specification, TM TSï¼‰</li>
</ol>
</li>
</ul>
<hr>
<h2 id="constexpr-if"><a href="#constexpr-if" class="headerlink" title="constexpr if"></a>constexpr if</h2><p>ä½¿ç”¨ <code>if constexpr</code>ï¼Œå°†åœ¨ç¼–è¯‘æœŸè®¡ç®—åˆ†æ”¯é€‰æ‹©</p>
<p>å¸¸å¸¸é…åˆ <code>&lt;type_traits&gt;</code> æˆ–å˜å‚æ¨¡æ¿ä½¿ç”¨ã€‚</p>
<ol>
<li>æ¡ä»¶å¿…é¡»èƒ½åœ¨ç¼–è¯‘æœŸè®¡ç®—ï¼Œå¹¶è½¬æ¢ä¸º <code>bool</code>ã€‚</li>
<li>è¢«æŠ›å¼ƒçš„åˆ†æ”¯ï¼š<ol>
<li>ä¸å‚ä¸å‡½æ•°è¿”å›å€¼ç±»å‹æ¨å¯¼</li>
<li>å¯ä»¥ä½¿ç”¨æœ‰å£°æ˜ä½†æ²¡æœ‰å®šä¹‰çš„å˜é‡ï¼ˆä¸å±äº ORD-useï¼‰</li>
</ol>
</li>
<li>åœ¨ä¸€ä¸ª<a href="https://en.cppreference.com/w/cpp/language/templates#Templated_entity">æ¨¡æ¿å®ä½“</a>ä¸­ï¼Œè¢«æŠ›å¼ƒçš„åˆ†æ”¯ä¸å¼•èµ·åç»­çš„å®ä¾‹åŒ–ã€‚å¸¸ç”¨äº <code>if constexpr (sizeof...(rs) &gt; 0) &#123; f(rs...) &#125;</code></li>
<li>åœ¨ä¸€ä¸ªéæ¨¡æ¿å®ä½“ä¸­ï¼Œè¢«æŠ›å¼ƒçš„åˆ†æ”¯ä¾ç„¶å‚ä¸è¯­ä¹‰åˆ†æï¼ˆä¾‹å¦‚ä½ ä¸èƒ½ä½¿ç”¨ä¸€ä¸ªæœªå£°æ˜çš„å˜é‡ï¼‰ã€‚æ‰€ä»¥ <code>if constexpr</code> ä¸èƒ½æ›¿ä»£ <code>#if</code></li>
<li>ä»»ä½•æ—¶å€™ï¼Œè¢«æŠ›å¼ƒçš„åˆ†æ”¯éƒ½ä¸å…è®¸ ill-formedï¼ˆä¾‹å¦‚ <code>static_assert(false,&quot;&quot;)</code>ï¼‰ã€‚ä½ å¯èƒ½éœ€è¦ Conceptã€‚</li>
</ol>
<hr>
<h2 id="StandardLayout"><a href="#StandardLayout" class="headerlink" title="StandardLayout"></a>StandardLayout</h2><p><em><a href="https://en.cppreference.com/w/cpp/language/data_members#Standard_layout">StandardLayout</a></em> çš„å‰èº«æ˜¯ <em>POD</em>ã€‚ä¸ºäº†å†…å­˜å¯¹é½ï¼Œå„è·¯å‚å•†çš„ç¼–è¯‘å™¨ä¼šå¯¹ç»“æ„ä½“çš„æ•°æ®æˆå‘˜è¿›è¡Œåç§»é‡ç¼–æ’ã€‚å¦‚æœéœ€è¦å­—èŠ‚çº§ç²’åº¦çš„æ“ä½œï¼ˆå¸¸è§äºç½‘ç»œï¼‰ï¼Œæˆ‘ä»¬éœ€è¦å¼„æ¸…æ¥šç»“æ„ä½“å†…éƒ¨çš„å…·ä½“å¸ƒå±€ã€‚</p>
<h3 id="ç»“æ„ä½“å¸ƒå±€"><a href="#ç»“æ„ä½“å¸ƒå±€" class="headerlink" title="ç»“æ„ä½“å¸ƒå±€"></a>ç»“æ„ä½“å¸ƒå±€</h3><p>C++æ ‡å‡† å¯¹ç»“æ„ä½“å¸ƒå±€ä»…åšäº†å¾ˆæœ‰é™çš„è§„å®šï¼š</p>
<ol>
<li>åŒä¸€è®¿é—®æƒé™çš„å­—æ®µçš„ç›¸å¯¹é¡ºåºä¸å®šä¹‰ç›¸å¯¹é¡ºåºç›¸åŒï¼šå…ˆå®šä¹‰çš„åœ¨ä½åœ°å€ï¼Œåå®šä¹‰çš„åœ¨é«˜åœ°å€ã€‚</li>
<li>ä¸åŒè®¿é—®æƒé™çš„å­—æ®µçš„ç›¸å¯¹é¡ºåºæ˜¯æœªæŒ‡å®šçš„ã€‚</li>
<li>ä¸ºäº†å†…å­˜å¯¹é½ï¼Œå…è®¸ç¼–è¯‘å™¨åœ¨å­—æ®µä¹‹é—´ã€ç»“æ„ä½“çš„æœ«å°¾æ·»åŠ ç©ºå­—èŠ‚ã€‚</li>
</ol>
<h3 id="æ ‡å‡†å±€éƒ¨ï¼ˆåŸ-PODï¼‰"><a href="#æ ‡å‡†å±€éƒ¨ï¼ˆåŸ-PODï¼‰" class="headerlink" title="æ ‡å‡†å±€éƒ¨ï¼ˆåŸ PODï¼‰"></a>æ ‡å‡†å±€éƒ¨ï¼ˆåŸ PODï¼‰</h3><ul>
<li>C++11 ä»¥å‰ï¼Œ<em>PODType</em> ç­‰ä»·äº <em>StandardLayoutType</em></li>
<li>C++11 å¼€å§‹ï¼Œ<em>StandardLayoutType</em> è¦æ±‚ç±»æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š<ol>
<li>æ‰€æœ‰éé™æ€æ•°æ®æˆå‘˜å…·æœ‰åŒä¸€ä¸ªè®¿é—®æƒé™ã€‚</li>
<li>æ²¡æœ‰è™šå‡½æ•°ï¼Œæ²¡æœ‰è™šåŸºç±»ã€‚</li>
<li>ä»»ä½•éé™æ€æ•°æ®æˆå‘˜éƒ½ä¸æ˜¯å¼•ç”¨ç±»å‹ã€‚</li>
<li>æ‰€æœ‰éé™æ€æ•°æ®æˆå‘˜å’ŒåŸºç±»éƒ½æ˜¯ standard layoutã€‚</li>
<li>ä¸å­˜åœ¨è±å½¢ç»§æ‰¿ã€‚</li>
<li><strong>bit-fieldsï¼ˆä½åŸŸï¼‰å’Œæ‰€æœ‰éé™æ€æ•°æ®æˆå‘˜åœ¨åŒä¸€ä¸ªç±»å†…å®šä¹‰ã€‚</strong></li>
<li>å…¶ä»–å¤æ‚çš„æ¡ä»¶ï¼ˆå‚è€ƒ cpprefï¼‰</li>
</ol>
</li>
</ul>
<p><em>StandardLayoutï¼ˆæ ‡å‡†å¸ƒå±€ï¼‰</em> æ˜¯ C++ æ ‡å‡†æå‡ºçš„æ¦‚å¿µï¼Œä½†æ²¡åšå…·ä½“å¸ƒå±€ã€‚</p>
<p>å¸¸è§çš„å®ç°éµå¾ªä»¥ä¸‹åŸåˆ™ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è‚‰çœ¼åˆ¤æ–­ size å’Œ alignmentï¼š</p>
<ol>
<li>ç»“æ„ä½“è‡ªèº«å¯¹é½åˆ°æœ€å®½çš„<strong>åŸºç¡€ç±»å‹</strong>æ•°æ®æˆå‘˜ã€‚ï¼ˆåµŒå¥— struct çš„æƒ…å†µä¸‹è¦å±•å¼€åˆ¤æ–­ï¼‰</li>
<li>ç»“æ„ä½“å†…<strong>åŸºç¡€ç±»å‹</strong>å­—æ®µå¯¹é½åˆ°è‡ªèº«å¤§å°ï¼Œ<strong>å­ struct</strong> åˆ™æŒ‰ç…§ä¸Šä¸€æ¡å¯¹é½ã€‚ï¼ˆåœ¨å­—æ®µä¹‹é—´ paddingï¼‰</li>
<li>ç»“æ„ä½“çš„ size å¿…é¡»æ˜¯å¯¹é½å­—èŠ‚çš„æ•´æ•°å€ã€‚ï¼ˆåœ¨ç»“æ„ä½“æœ«å°¾ paddingï¼‰</li>
</ol>
<p>ä¾‹å­ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    size = 8</span></span><br><span class="line"><span class="comment">    alignment = 4</span></span><br><span class="line"><span class="comment">    |a___|bbbb</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="type">char</span> a;</span><br><span class="line">    <span class="type">int</span> b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    size = 16</span></span><br><span class="line"><span class="comment">    alignment = 4</span></span><br><span class="line"><span class="comment">    |c___|a___|bbbb|d___</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">B</span> &#123;</span><br><span class="line">    <span class="type">char</span> c;</span><br><span class="line">    A obj; <span class="comment">// obj è¦å¯¹é½åˆ° 4 å­—èŠ‚ï¼Œchar c å’Œ char a ä¸èƒ½ç´§è´´ç›¸é‚»</span></span><br><span class="line">    <span class="type">char</span> d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­æ˜¯å¦æ ‡å‡†å¸ƒå±€</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line">std::is_standard_layout&lt;B&gt;::value;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="bit-field"><a href="#bit-field" class="headerlink" title="bit field"></a>bit field</h2><p>bit fieldï¼ˆä½åŸŸï¼‰æ˜¯ä¸€ç§<strong>è¯­æ³•ç³–</strong>ã€‚å®ƒç”¨äºæè‡´ç´§å‡‘åœ°åœ¨å†…å­˜ä¸­æ’åˆ—ç»“æ„ä½“å†…å®¹ï¼Œä½†æ˜¯éœ€è¦é¢å¤–ä½æ“ä½œæŒ‡ä»¤ã€‚</p>
<p>è¿™é‡Œä»‹ç»ä½åŸŸçš„å®ç°åŸç†ã€‚</p>
<ul>
<li>C++ æ ‡å‡†æ²¡æœ‰è§„å®šä½åŸŸåº”è¯¥å¦‚ä½•å®ç°ï¼Œæ‰€ä»¥ï¼Œä½¿ç”¨ä½åŸŸçš„ C++ ç¨‹åºæœ¬è´¨ä¸Šæ˜¯<strong>ä¸å¯ç§»æ¤</strong>çš„ã€‚</li>
<li>è¦è€ƒè™‘å­—èŠ‚<strong>å†…å¤–éƒ¨</strong>çš„å¤§å°ç«¯é—®é¢˜ã€‚é€šå¸¸å†…å¤–éƒ¨çš„å¤§å°ç«¯ä¿æŒä¸€è‡´ï¼Œå¦‚ x86 å°±æ˜¯ä¸åŒå­—èŠ‚å°ç«¯åœ¨å‰ï¼ˆä½åœ°å€ï¼‰ï¼ŒåŒä¸€å­—èŠ‚å†…å°ç«¯åœ¨å‰ï¼ˆä½ç¼–å·ï¼‰ã€‚</li>
<li>ç¼–è¯‘å™¨ä¼šé¢å¤–æ·»åŠ ä½æ“ä½œæŒ‡ä»¤ï¼ˆå¦‚ <code>shl</code>, <code>shr</code>, <code>sar</code>, <code>or</code> ç­‰ï¼‰æ¥ä¿è¯è¯»å†™ä½åŸŸçš„è¯­ä¹‰æ­£ç¡®æ€§ã€‚</li>
<li>ä½åŸŸçš„ç±»å‹å†³å®šäº†å¯¹é½è¾¹ç•Œã€‚ä¾‹å¦‚ <code>int x : 17</code> ä¼šä¿è¯ <code>x</code> ä¸ä¼šè¶Šè¿‡ 4 å­—èŠ‚çš„å¯¹é½è¾¹ç•Œã€‚</li>
<li>ç›¸é‚»çš„ä½åŸŸï¼Œå¦‚æœå¯¹é½é•¿åº¦ç›¸åŒï¼Œç¼–è¯‘å™¨ä¼šå°½é‡å°†ä»–ä»¬è£…åœ¨ä¸€èµ·ï¼Œå¦‚æœè£…å¾—ä¸‹çš„è¯ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨åŒ¿åä½åŸŸåšäººå·¥ paddingã€‚é•¿åº¦ä¸º 0 çš„åŒ¿åä½åŸŸä¼šå¼ºåˆ¶ä¸‹ä¸€ä¸ªä½åŸŸé‡æ–°å¼€å§‹å¯¹é½ã€‚</li>
</ul>
<hr>
]]></content>
      <tags>
        <tag>C++</tag>
        <tag>è¯­æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>CG with OpenGL</title>
    <url>/2020/09/19/CG-with-OpenGL/</url>
    <content><![CDATA[<p>æ›´æ–°ï¼šç°åœ¨éƒ½ç”¨æ ¸å¿ƒæ¨¡å¼äº†ï¼Œæ¨è<a href="https://learnopengl-cn.github.io/">LearnOpenGL</a>ï¼Œä¸æ¨èå¾€ä¸‹çœ‹å•¦ã€‚</p>
<hr>
<h1 id="OpenGL"><a href="#OpenGL" class="headerlink" title="OpenGL"></a>OpenGL</h1><p>OpenGLç³»ç»Ÿç”±ç‹¬ç«‹äºè®¾å¤‡çš„å‡½æ•°é›†ï¼ˆæ ¸å¿ƒåº“ï¼‰ã€å®ç”¨åº“ï¼ˆGLUï¼‰å’Œå®ç”¨å·¥å…·åŒ…ï¼ˆGLUTï¼‰ä¸‰éƒ¨åˆ†ç»„æˆã€‚</p>
<span id="more"></span>

<h2 id="äºŒç»´å‡ ä½•å˜æ¢"><a href="#äºŒç»´å‡ ä½•å˜æ¢" class="headerlink" title="äºŒç»´å‡ ä½•å˜æ¢"></a>äºŒç»´å‡ ä½•å˜æ¢</h2><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="æ¬ç –"><a href="#æ¬ç –" class="headerlink" title="æ¬ç –"></a>æ¬ç –</h2><blockquote class="blockquote-center">
<p>ç å†œä¹‹è·¯ä¸å¯é•¿è¿œ</p>

</blockquote>


<h3 id="glutæ¨¡æ¿"><a href="#glutæ¨¡æ¿" class="headerlink" title="glutæ¨¡æ¿"></a>glutæ¨¡æ¿</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;GL/glut.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">someDrawing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">glClear</span>(GL_COLOR_BUFFER_BIT); <span class="comment">// æ˜¾ç¤ºèƒŒæ™¯è‰²</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">glColor3f</span>(<span class="number">0.0</span>, <span class="number">0.4</span>, <span class="number">0.2</span>); <span class="comment">// è®¾ç½®é¢œè‰²ä¸ºç»¿è‰²</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç”»çº¿</span></span><br><span class="line">    <span class="built_in">glBegin</span>(GL_LINES);</span><br><span class="line">        <span class="built_in">glVertex2i</span>(<span class="number">180</span>, <span class="number">15</span>); <span class="comment">// (180, 15) --- (10, 145)</span></span><br><span class="line">        <span class="built_in">glVertex2i</span>(<span class="number">10</span>, <span class="number">145</span>);</span><br><span class="line">    <span class="built_in">glEnd</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">glFlush</span>(); <span class="comment">// ç«‹å³å¤„ç†OpenGLå¸¸è§„äº‹åŠ¡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">glutInit</span>(&amp;argc, argv);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨å•ç¼“å­˜ï¼Œä¸”ä½¿ç”¨RGBæ¨¡å¼</span></span><br><span class="line">    <span class="built_in">glutInitDisplayMode</span>(GLUT_SINGLE | GLUT_RGB);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·ç¦»å·¦è¾¹ç•Œ50åƒç´ ï¼Œè·ç¦»ä¸Šè¾¹ç•Œ100åƒç´ </span></span><br><span class="line">    <span class="built_in">glutInitWindowPosition</span>(<span class="number">50</span>, <span class="number">100</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å®½åº¦400åƒç´ ï¼Œé«˜åº¦300åƒç´ </span></span><br><span class="line">    <span class="built_in">glutInitWindowSize</span>(<span class="number">400</span>,<span class="number">300</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">glutCreateWindow</span>(<span class="string">&quot;Window Title&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// èƒŒæ™¯ç¼“å­˜è‰²ä¸ºç™½è‰²ï¼ŒAlphaå€¼ï¼ˆè°ƒå’Œå‚æ•°ï¼‰ä¸º0</span></span><br><span class="line">    <span class="built_in">glClearColor</span>(<span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>, <span class="number">0.0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®æ­£æŠ•å½±æ¨¡å¼,å°†ä¸–ç•Œåæ ‡ç³»äºŒç»´çŸ©å½¢åŒºåŸŸå†…çš„å†…å®¹æ˜ å°„åˆ°å±å¹•ä¸Š</span></span><br><span class="line">    <span class="comment">// xåæ ‡ä¸º[0, 200]ï¼Œyåæ ‡ä¸º[0, 150]ã€‚æ­¤èŒƒå›´å¤–çš„å†…å®¹ä¸äºˆæ˜¾ç¤º</span></span><br><span class="line">    <span class="comment">// çºµæ¨ªæ¯”ä¸çª—å£ä¿æŒä¸€è‡´ï¼Œä½¿å›¾å½¢ä¸å˜å½¢</span></span><br><span class="line">    <span class="built_in">glMatrixMode</span>(GL_PROJECTION);</span><br><span class="line">    <span class="built_in">glLoadIdentity</span>(); <span class="comment">// æ’é™¤ä¹‹å‰æŠ•å½±çŸ©é˜µçš„å½±å“</span></span><br><span class="line">    <span class="built_in">gluOrtho2D</span>(<span class="number">0.0</span>, <span class="number">200.0</span>, <span class="number">0.0</span>, <span class="number">150.0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">glutDisplayFunc</span>(someDrawing); <span class="comment">// æ³¨å†Œç»˜å›¾å‡½æ•°</span></span><br><span class="line">    <span class="built_in">glutMainLoop</span>(); <span class="comment">// è¿›å…¥ä¸»å¾ªç¯ï¼šæ˜¾ç¤ºæ‰€æœ‰ä¸œè¥¿ç„¶åç­‰å¾…</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¸»åŠ¨é”™è¯¯æ£€æŸ¥"><a href="#ä¸»åŠ¨é”™è¯¯æ£€æŸ¥" class="headerlink" title="ä¸»åŠ¨é”™è¯¯æ£€æŸ¥"></a>ä¸»åŠ¨é”™è¯¯æ£€æŸ¥</h3><p>OpenGLè®°å½•ä¸€ä¸ªå…¨å±€é”™è¯¯æ ‡å¿—ï¼Œè¡¨ç¤ºæœ€è¿‘ä¸€ä¸ªæœªè¢«ç¨‹åºå‘˜æŠ“å–çš„é”™è¯¯ä¿¡æ¯ã€‚æ¨èåœ¨æ¯ä¸€ä¸ªæ˜¾ç¤ºå›è°ƒå­ç¨‹åºä¸­è‡³å°‘æ£€æŸ¥ä¸€æ¬¡å‡ºé”™æƒ…å†µï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">GLenum <span class="title">errorCheck</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">const</span> GLenum code = <span class="built_in">glGetError</span>();</span><br><span class="line">    <span class="keyword">if</span> (code != GL_NO_ERROR) &#123;</span><br><span class="line">        <span class="type">const</span> GLubyte* what = <span class="built_in">gluErrorString</span>(code); <span class="comment">// é™æ€å¸¸é‡å†…å­˜</span></span><br><span class="line">        <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;OpenGL error: %s\n&quot;</span>, what);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> code;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç”»ç‚¹ä¸ç”»çº¿"><a href="#ç”»ç‚¹ä¸ç”»çº¿" class="headerlink" title="ç”»ç‚¹ä¸ç”»çº¿"></a>ç”»ç‚¹ä¸ç”»çº¿</h3><p>å‡½æ•°åç¼€ï¼šint-&gt;<code>i</code>ï¼Œshort-&gt;<code>s</code>ï¼Œfloat-&gt;<code>f</code>ï¼Œdouble-&gt;<code>d</code>ï¼Œvector-&gt;<code>v</code>ï¼Œ2D-&gt;<code>2</code>ï¼Œ3D-&gt;<code>3</code>ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> p1[] = &#123;<span class="number">75</span>, <span class="number">150</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">glBegin</span>(GL_POINTS); <span class="comment">// ç‚¹</span></span><br><span class="line">    <span class="built_in">glVertex2iv</span>(p1);</span><br><span class="line">    <span class="built_in">glVertex2i</span>(<span class="number">50</span>, <span class="number">100</span>);</span><br><span class="line"><span class="built_in">glEnd</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">glBegin</span>(GL_LINES); <span class="comment">// ä¸¤ä¸ªç‚¹æ„æˆçº¿</span></span><br><span class="line">    <span class="built_in">glVertex2iv</span>(p);</span><br><span class="line">    <span class="built_in">glVertex2i</span>(<span class="number">50</span>, <span class="number">100</span>);<span class="comment">// æˆçº¿</span></span><br><span class="line">    <span class="built_in">glVertex2iv</span>(p3);</span><br><span class="line">    <span class="built_in">glVertex2iv</span>(p4);    <span class="comment">// æˆçº¿</span></span><br><span class="line">    <span class="built_in">glVertex2iv</span>(p5);    <span class="comment">// è¢«å¿½ç•¥</span></span><br><span class="line"><span class="built_in">glEnd</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">glBegin</span>(GL_LINE_STRIP); <span class="comment">// æ™®é€šæŠ˜çº¿</span></span><br><span class="line">    <span class="built_in">glVertex2iv</span>(p1);</span><br><span class="line">    <span class="built_in">glVertex2i</span>(<span class="number">50</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="built_in">glVertex2iv</span>(p3);    </span><br><span class="line">    <span class="built_in">glVertex2iv</span>(p4);</span><br><span class="line">    <span class="built_in">glVertex2iv</span>(p5);</span><br><span class="line"><span class="built_in">glEnd</span>();</span><br><span class="line"></span><br><span class="line"><span class="built_in">glBegin</span>(GL_LINE_LOOP); <span class="comment">// å°é—­æŠ˜çº¿</span></span><br><span class="line">    <span class="built_in">glVertex2iv</span>(p1);   <span class="comment">// p1ä¸p5æˆçº¿</span></span><br><span class="line">    <span class="built_in">glVertex2i</span>(<span class="number">50</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="built_in">glVertex2iv</span>(p3);    </span><br><span class="line">    <span class="built_in">glVertex2iv</span>(p4);</span><br><span class="line">    <span class="built_in">glVertex2iv</span>(p5);</span><br><span class="line"><span class="built_in">glEnd</span>();</span><br></pre></td></tr></table></figure>
<p>æœ‰å…³OpenGLçš„å‡ºé”™ç¼–ç è¯·è‡ªè¡ŒæŸ¥æ‰¾èµ„æ–™ã€‚</p>
]]></content>
      <tags>
        <tag>æ¸¸æˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>Concurrency With C++</title>
    <url>/2021/04/01/Concurrency-with-C/</url>
    <content><![CDATA[<p>ä¸åŒè¯­è¨€&#x2F;æ“ä½œç³»ç»Ÿ&#x2F;ç¡¬ä»¶çš„çº¿ç¨‹å®ç°è¿˜ä¸ä¸€æ ·ï¼Œå› æ­¤å­¦ä¸€ä¸ªæ¯”è¾ƒä¸»æµçš„å¤šçº¿ç¨‹åº“è¿˜æ˜¯æŒºé‡è¦çš„ã€‚<br>C++ STLçš„çº¿ç¨‹æ”¯æŒåº“å°±æ˜¯ä¸€ä¸ªå¥½ä¾‹å­ã€‚åœ¨è¿™ä¹‹å‰ï¼Œæœ€å¥½å…ˆå¤ä¹ ä¸€ä¸‹åŸºç¡€çŸ¥è¯†ã€‚</p>
<h2 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h2><ul>
<li><strong>ä¸å˜é‡(invariants)</strong> æ˜¯æŒ‡å¯¹æ•°æ®ç»“æ„çš„æ–­è¨€<ul>
<li>ä¾‹ï¼šæŸç§å¸æœ¬ï¼Œä»»æ„å‰ç¼€å’Œä¸ä¸ºè´Ÿæ•°ã€‚</li>
<li>ä¾‹ï¼šé“¾è¡¨æŸä¸ªèŠ‚ç‚¹çš„åç»§çš„å‰é©±æ˜¯è‡ªå·±ã€‚</li>
<li>ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸è‰¯çš„å¹¶å‘ç¼–ç¨‹ä¼šç ´åä¸å˜é‡ï¼</li>
<li>ç ´åä¸å˜é‡çš„æ ¹æºæ˜¯å†™æ“ä½œã€‚<span id="more"></span></li>
</ul>
</li>
<li>åœ¨å¹¶å‘ä¸­çš„<strong>ç«äº‰æ¡ä»¶(race condition)</strong> æ˜¯æŒ‡ï¼Œä»»ä½•ç»“æœä¾èµ–äºåœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä¸Šæ“ä½œæ‰§è¡Œçš„ç›¸å¯¹é¡ºåºã€‚<ul>
<li>æœ‰é—®é¢˜çš„ç«äº‰æ¡ä»¶ä¼šç ´åä¸å˜é‡ï¼Œå¼•å‘Bugã€‚</li>
<li>Debugæ¨¡å¼ä¸‹å¯èƒ½æ— æ³•å‘ç°æœ‰é—®é¢˜çš„ç«äº‰æ¡ä»¶ã€‚</li>
<li>ä¸‹æ–‡çš„ç«äº‰æ¡ä»¶é»˜è®¤æ˜¯æœ‰é—®é¢˜çš„ã€‚</li>
<li>åœ¨ç±»å†…éƒ¨ä½¿ç”¨äº’æ–¥é”<em>ä¸èƒ½</em>å®Œå…¨æ¶ˆé™¤ç«äº‰æ¡ä»¶ã€‚<ul>
<li>ä¾‹ï¼š<code>return &amp;locked_data;</code> æ³„éœ²æŒ‡é’ˆæˆ–å¼•ç”¨ï¼Œä½¿å¾—æ•°æ®ç¦»å¼€å†…éƒ¨é”çš„ä¿æŠ¤ï¼</li>
<li>ä¾‹ï¼š<code>template&lt;typename F&gt; ... F(&amp;locked_data);</code> å¯èƒ½å·²ç»æ³„éœ²äº†æŒ‡é’ˆæˆ–å¼•ç”¨ï¼</li>
<li>ä¾‹ï¼š<code>if (!s.empty()) s.pop();</code> å¾ˆå¯èƒ½å¼•å‘ä¸€æ¬¡ä¸å®‰å…¨çš„popï¼</li>
<li>ä¾‹ï¼š<code>tmp = s.top(); s.pop(); return tmp;</code> åœ¨returnæ—¶å‘ç”Ÿæ„é€ å‡½æ•°å¼‚å¸¸ï¼Œæ•°æ®ä¸¢å¤±ï¼</li>
<li>è§£å†³åŠæ³•ï¼š<ol>
<li>ä¼ å…¥å¼•ç”¨æˆ–æŒ‡é’ˆæ¥æ¥æ”¶è¿”å›å€¼ã€‚ç¼ºç‚¹ï¼šä¸€äº›ç±»ä¸æ”¯æŒèµ‹å€¼ã€‚</li>
<li>è¦æ±‚æ‹·è´&#x2F;ç§»åŠ¨æ„é€ å‡½æ•°ä¸æŠ›å‡ºå¼‚å¸¸ã€‚ç¼ºç‚¹ï¼šç”¨æˆ·è¯´æˆ‘åä¸ã€‚</li>
<li>è¿”å›æŒ‡å‘åŸè¿”å›å€¼çš„æŒ‡é’ˆï¼Œæœ€å¥½é…åˆshared_ptrã€‚ç¼ºç‚¹ï¼šæ€§èƒ½æŸè€—ã€‚</li>
<li>1+2 æˆ–è€… 1+3ã€‚</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>æ­»é”</strong><ul>
<li>å››è¦ç´ ï¼šäº’æ–¥ï¼ŒæŒæœ‰å¹¶ç­‰å¾…ï¼ŒéæŠ¢å ï¼Œå¾ªç¯ç­‰å¾…ã€‚</li>
<li>è§£å†³åŠæ³•ï¼šç ´åå››è¦ç´ ä¸­ä»»æ„ä¸€ä¸ª<ol>
<li>ä¿è¯ä¸Šé”çš„é¡ºåºæ˜¯å”¯ä¸€çš„ã€‚</li>
<li>ä½¿ç”¨<code>std::lock()</code>ã€‚</li>
</ol>
</li>
</ul>
</li>
<li><strong>é”çš„ç²’åº¦</strong>æ˜¯æŒ‡å•ä¸ªé”ä¿æŠ¤çš„æ•°æ®é‡å’Œä¿æŠ¤æ—¶é—´ã€‚<ul>
<li>æŒ‘é€‰åˆé€‚çš„æ•°æ®é‡å¤§å°ã€‚</li>
<li>åœ¨è€—æ—¶çš„æ“ä½œä¸­å°½å¯èƒ½åœ°é‡Šæ”¾é”ï¼Œä¾‹å¦‚I&#x2F;Oæ“ä½œã€‚</li>
</ul>
</li>
<li><strong>æ‡’æ±‰æ¨¡å¼</strong>ç‰¹æŒ‡å•ä¾‹æ¨¡å¼ä¸­çš„å»¶è¿Ÿåˆå§‹åŒ–ã€‚<ul>
<li>è£¸æ‡’æ±‰æ¨¡å¼æ˜¾ç„¶æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚</li>
<li>åŒé‡æ£€æŸ¥åŠ é”ä¹Ÿå……æ»¡äº†é™·é˜±ï¼Œå› ä¸ºæœ€å¤–å±‚çš„æ£€æŸ¥å¯èƒ½æ˜¯é”™è¯¯çš„ï¼ˆèµ‹å¥½äº†æŒ‡é’ˆï¼Œä½†æœªå½»åº•å®Œæˆåˆå§‹åŒ–ï¼‰ï¼</li>
<li>ç†æƒ³çš„è§£å†³æ–¹æ³•æ˜¯ä¿è¯æ ‡å¿—ä½æ˜¯æœ€ååˆå§‹åŒ–çš„ï¼ˆè¦é˜²æ­¢ç¼–è¯‘å™¨ä¹±åºä¼˜åŒ–ï¼‰ï¼Œè€Œä¸è¦å°†æŒ‡é’ˆçœ‹ä½œæ ‡å¿—ä½ã€‚</li>
<li>ä½¿ç”¨<code>std::call_once</code>ï¼</li>
<li>è¿˜å¯ä»¥åˆ©ç”¨C++çš„staticå±€éƒ¨å˜é‡å®ç°æ‡’æ±‰æ¨¡å¼ã€‚C++11æ ‡å‡†ä¿è¯è¿™æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼</li>
</ul>
</li>
<li><strong>è¯»å†™é”</strong>æ˜¯æŒ‡å…±äº«é”ã€‚<ul>
<li>ç”¨äºå¾ˆå°‘æ›´æ–°çš„æ•°æ®ç»“æ„ã€‚</li>
<li>C++11å•¥ä¹Ÿæ²¡æœ‰ã€‚</li>
<li>C++14æ–°å¢<code>shared_timed_mutex</code>ã€‚</li>
<li>C++17æ–°å¢<code>shared_mutex</code>ï¼Œæ€§èƒ½æ›´å¥½ï¼Œå¥½è€¶ï¼</li>
<li>æ¨èå°†<code>shared_mutex</code>å£°æ˜ä¸º<code>mutable</code>ã€‚</li>
<li>å½“å¿ƒè¯»è€…å¤ªå¤šï¼Œå†™è€…é¥¿æ­»ï¼</li>
</ul>
</li>
<li><strong>é€’å½’é”</strong>å…è®¸ä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡ä¸Šé”ï¼Œä½†å¿…é¡»è¿›è¡Œç›¸åŒæ¬¡æ•°çš„é‡Šæ”¾é”ã€‚<ul>
<li>ä¾‹ï¼š<code>A.a()</code>éœ€è¦é”ï¼Œ<code>A.b()</code>ä¹Ÿéœ€è¦é”ï¼Œè€Œä¸”<code>A.a()</code>éœ€è¦è°ƒç”¨<code>A.b()</code>ã€‚</li>
<li>ä¸å»ºè®®è¿™æ ·ç”¨ï¼Œå› ä¸º<code>A.b()</code>å¯èƒ½è¦é¢å¯¹é”™è¯¯çš„æ•°æ®ã€‚</li>
<li>å»ºè®®æŠ½å‡º<code>A.a()</code>å’Œ<code>A.b()</code>çš„å…¬å…±éƒ¨åˆ†ï¼Œæˆä¸ºä¸€ä¸ªæ–°çš„ç§æœ‰å‡½æ•°ï¼Œä¸”ä¸ä¸Šé”ï¼ˆå› ä¸ºå·²ç»ä¸Šäº†é”ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h2 id="C-Library"><a href="#C-Library" class="headerlink" title="C++ Library"></a>C++ Library</h2><h3 id="Thread-çº¿ç¨‹"><a href="#Thread-çº¿ç¨‹" class="headerlink" title="Thread çº¿ç¨‹"></a>Thread çº¿ç¨‹</h3><p><a href="https://en.cppreference.com/w/cpp/thread">cppreference thread</a></p>
<p><code>#include &lt;thread&gt;</code></p>
<p>èµ·ä¸€ä¸ªçº¿ç¨‹ï¼</p>
<ul>
<li><code>thread</code> ç±»<ul>
<li>é»˜è®¤æ„é€ ä¸ä»£è¡¨ä»»ä½•çº¿ç¨‹</li>
<li>å¯ç§»åŠ¨ï¼Œä¸å¯å¤åˆ¶</li>
<li>æ„é€ å‡½æ•°å®Œæˆåç«‹å³å°±ç»ª</li>
<li>è‹¥å­çº¿ç¨‹æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™è°ƒç”¨<code>std::terminate</code>ä¸­æ­¢è¿›ç¨‹</li>
<li>ä½¿ç”¨<code>thread_local</code>å…³é”®å­—ï¼Œä»¤å˜é‡çš„ç”Ÿå‘½å‘¨æœŸå’Œæ‰€å±çº¿ç¨‹ç›¸åŒ</li>
<li><code>join()</code> è°ƒç”¨è€…ç­‰å¾…ï¼Œç›´åˆ°çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</li>
<li><code>detach()</code> åˆ†ç¦»çº¿ç¨‹å’Œçº¿ç¨‹å¯¹è±¡ï¼Œæ­¤æ—¶å¯ä»¥å®‰å…¨åœ°é”€æ¯çº¿ç¨‹å¯¹è±¡ã€‚</li>
<li><code>joinable()</code> æ˜¯å¦å¯ä»¥ä½¿ç”¨<code>join()</code>ã€‚æ­£åœ¨è¿è¡Œä¸­ã€æœªåˆ†ç¦»çš„çº¿ç¨‹éƒ½æ˜¯ joinable.</li>
<li><code>thread::hardware_concurrency()</code> è·å–çº¿ç¨‹æ•°å‚è€ƒå€¼ã€‚</li>
</ul>
</li>
<li><code>this_thread</code> å‘½åç©ºé—´<ul>
<li><code>yield()</code> å»ºè®®å½“å‰çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€</li>
<li><code>get_id()</code> è·å–çº¿ç¨‹idã€‚ç»“æœå¯ç”¨<code>&lt;&lt;</code>åºåˆ—åŒ–ï¼Œè™½ç„¶æ„ä¹‰ä¸å¤§ã€‚</li>
<li><code>sleep_for(duration)</code>&#x2F;<code>sleep_until(time_point)</code> å½“å‰çº¿ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´</li>
</ul>
</li>
</ul>
<hr>
<p>æåˆ°å¤šçº¿ç¨‹ï¼Œå‡ ä¹é¿ä¸å¼€äº’æ–¥ã€åŒæ­¥ç­‰æ¦‚å¿µã€‚</p>
<h3 id="Mutex-äº’æ–¥é”"><a href="#Mutex-äº’æ–¥é”" class="headerlink" title="Mutex äº’æ–¥é”"></a>Mutex äº’æ–¥é”</h3><p><a href="https://en.cppreference.com/w/cpp/header/mutex">cppreference mutex</a></p>
<p><code>#include &lt;mutex&gt;</code></p>
<p>ä¸»è¦ç”¨äºä¿æŠ¤<strong>æ•°æ®</strong>çš„æ“ä½œåŸå­æ€§ã€‚</p>
<p>è‹¥å¤šä¸ªçº¿ç¨‹è¯·æ±‚åŒä¸€ä¸ªé”ï¼Œè€Œæ­¤é”å°šæœªè¢«é‡Šæ”¾ï¼Œåˆ™å½“é”é‡Šæ”¾æ—¶ï¼Œå…¶ä¸­ä¸€ä¸ªçº¿ç¨‹è·å¾—é”ï¼ˆé€€å‡ºé˜»å¡ï¼‰ï¼Œå…¶ä½™çº¿ç¨‹ç»´æŒé˜»å¡ã€‚</p>
<ul>
<li><code>mutex</code> ç±»<ul>
<li><code>lock()</code> é˜»å¡ï¼Œç›´åˆ°è·å¾—é”</li>
<li><code>unlock()</code></li>
<li><code>try_lock()</code> è‹¥æ— æ³•è·å¾—é”ï¼Œåˆ™è¿”å› false ä½†ä¸é˜»å¡</li>
<li>å°å¿ƒ<code>mutex</code>çš„ç”Ÿå‘½å‘¨æœŸã€‚é”€æ¯ä¸€ä¸ªè¢«å…¶ä»–çº¿ç¨‹æŒæœ‰çš„é”æ˜¯åæœæ— å®šä¹‰çš„ã€‚</li>
<li>é”€æ¯çº¿ç¨‹å‰åº”å½“é‡Šæ”¾é”ï¼Œå¦åˆ™åæœæ— å®šä¹‰ã€‚</li>
<li>ä¸å¯æ‹·è´ï¼Œä¸å¯ç§»åŠ¨</li>
<li>åŒä¸€çº¿ç¨‹ä¸å¯å¯¹åŒä¸€<code>mutex</code>å¤šæ¬¡ä¸Šé”ï¼Œè¿™æ ·åšçš„åæœæ˜¯æ— å®šä¹‰çš„ã€‚</li>
</ul>
</li>
<li><code>recursive_mutex</code> ç±»<ul>
<li>åŒä¸€çº¿ç¨‹å¯ä»¥å¤šæ¬¡ä¸Šé”ã€‚ä¸Šé”å’Œè§£é”åº”ä¸€ä¸€å¯¹åº”ã€‚</li>
<li>ä¾‹å¦‚<code>std::lock_guard&lt;std::recursive_mutex&gt; lk(m);</code></li>
</ul>
</li>
<li><code>timed_mutex</code> ç±»<ul>
<li><code>try_lock_for(timeout_duration)</code> æœ€å¤šç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œæ— æ³•è·å¾—é”åˆ™è¿”å› false</li>
<li><code>try_lock_until(timeout_time)</code> æœ€å¤šç­‰å¾…è‡³ä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œæ— æ³•è·å¾—é”åˆ™è¿”å› false</li>
</ul>
</li>
<li><code>recursive_timed_mutex</code> ç±»<ul>
<li>æ··åˆäº†ä¸¤è€…çš„åŠŸèƒ½</li>
</ul>
</li>
<li><code>void lock(Lockable1&amp; lock1, Lockable2&amp; lock2, LockableN&amp;... lockn)</code> å…¨å±€å‡½æ•°<ul>
<li>å®‰å…¨åœ°â€œåŒæ—¶â€è¯·æ±‚å¤šä¸ªäº’æ–¥é”</li>
<li>ä¿è¯ä¸ä¼šå¼•å‘æ­»é”</li>
</ul>
</li>
<li><code>lock_guard</code> ç±»<ul>
<li>RAII è¯·æ±‚å’Œé‡Šæ”¾ä¸€ä¸ªé”</li>
<li>å¿…é¡»æ‹¥æœ‰ä¸€ä¸ªé”</li>
<li><code>lock_guard( mutex_type&amp; m, std::adopt_lock_t t );</code>å‡å®šå·²ç»è·å¾—äº†é”</li>
</ul>
</li>
<li><code>scoped_lock</code> ç±»<ul>
<li>RAII åŒæ—¶è¯·æ±‚å’Œé‡Šæ”¾å¤šä¸ªé”</li>
<li>ä¿è¯ä¸ä¼šå¼•å‘æ­»é”</li>
</ul>
</li>
<li><code>unique_lock</code> ç±»<ul>
<li>RAII ç‹¬å é”</li>
<li>å¯ä»¥ä¸»åŠ¨è§£é”ã€‚å¸¸è§äºæ¡ä»¶å˜é‡ã€‚æš‚æ—¶æˆ–æå‰é‡Šæ”¾é”é€šå¸¸å¯æé«˜æ—¶é—´æ€§èƒ½ã€‚</li>
<li>å¯ä»¥ä¸æ‹¥æœ‰é”ï¼Œå› æ­¤æœ‰ç©ºé—´å’Œæ€§èƒ½æŸè€—ã€‚å¸¸è§äºéœ€è¦å»¶è¿Ÿä¸Šé”æˆ–è½¬ç§»æ‰€æœ‰æƒã€‚</li>
<li>adopt_lockå‡å®šå·²ç»è·å¾—äº†é”ï¼Œdefer_lockå‡å®šå»¶è¿Ÿè·å¾—é”ã€‚</li>
<li>è‹¥å»¶è¿Ÿä¸Šé”ï¼Œéšåå¯ç”¨<code>std::lock(unique_lock, ...)</code>ä¸Šé”ã€‚</li>
</ul>
</li>
<li><code>shared_lock</code> ç±»<ul>
<li>RAII å…±äº«é”</li>
</ul>
</li>
<li><code>void call_once( std::once_flag&amp; flag, Callable&amp;&amp; f, Args&amp;&amp;... args );</code> å‡½æ•°<ul>
<li>å…¨å±€ä»…æ‰§è¡Œå‡½æ•°<code>f(args)</code>ä¸€æ¬¡</li>
<li>è‹¥<code>flag</code>æ˜¯å¤ä½ï¼Œåˆ™å…è®¸æ‰§è¡Œ<code>f(args)</code></li>
<li>æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘</li>
<li>è‹¥<code>f(args)</code>æ­£å¸¸ç»“æŸï¼Œåˆ™<code>flag</code>ç½®ä½ï¼Œé˜²æ­¢ç¬¬äºŒæ¬¡è°ƒç”¨</li>
<li>è‹¥<code>f(args)</code>æŠ›å‡ºæœªå¤„ç†çš„å¼‚å¸¸ï¼Œåˆ™<code>flag</code>ä¿æŒå¤ä½ï¼Œå…è®¸ç¬¬äºŒæ¬¡è°ƒç”¨</li>
<li>ä¸€ä¸ª<code>flag</code>å¯ä»¥å¯¹åº”å¤šä¸ª<code>f</code>ï¼Œä¸ä¿è¯å“ªä¸ªå‡½æ•°å…ˆæ‰§è¡Œã€‚</li>
</ul>
</li>
</ul>
<h3 id="Condition-Variable-æ¡ä»¶å˜é‡"><a href="#Condition-Variable-æ¡ä»¶å˜é‡" class="headerlink" title="Condition Variable æ¡ä»¶å˜é‡"></a>Condition Variable æ¡ä»¶å˜é‡</h3><p><a href="https://en.cppreference.com/w/cpp/thread/condition_variable">cppreference condition_variable</a></p>
<p>æ¡ä»¶å˜é‡å¯ä»¥ç”¨æ¥é˜»å¡ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ï¼Œç›´åˆ°æŸä¸ªæ´»åŠ¨çº¿ç¨‹ä¿®æ”¹ä¸€ä¸ªå…±äº«å˜é‡ï¼ˆå³æ¡ä»¶ï¼‰ï¼Œå¹¶é€šçŸ¥æ¡ä»¶å˜é‡ã€‚</p>
<ol>
<li>ä¸ºäº†ä¿æŠ¤ä¸Šè¿°å…±äº«å˜é‡ï¼Œéœ€è¦ä¸Šäº’æ–¥é”ã€‚</li>
<li>å¯¹æ¯”äº’æ–¥é”çš„ä¼˜åŠ¿æ˜¯ï¼šé¿å…å®šæ—¶ï¼Œå®šå‘å”¤é†’ï¼Œå ç”¨èµ„æºä½ï¼Œäº‹ä»¶é©±åŠ¨ã€‚</li>
<li>è¢«å”¤é†’çš„çº¿ç¨‹éœ€è¦æ‰‹åŠ¨æˆ–è‡ªåŠ¨åœ°æ£€æŸ¥æ¡ä»¶ï¼Œè‹¥æ¡ä»¶å¤±è´¥ï¼Œåˆ™å†æ¬¡è¢«é˜»å¡ï¼Œç­‰å¾…è¢«å”¤é†’ã€‚</li>
</ol>
<p><code>#include &lt;condition_variable&gt;</code></p>
<ul>
<li><code>condition_variable</code>ç±»<ul>
<li>åªæœ‰é»˜è®¤æ„é€ å‡½æ•°</li>
<li><code>void wait( std::unique_lock&lt;std::mutex&gt;&amp; lock );</code> <ul>
<li>é‡Šæ”¾é”ï¼Œç„¶åè¿›å…¥é˜»å¡ï¼Œç›´åˆ°è¢«å”¤é†’ã€‚</li>
<li>è¢«å”¤é†’åï¼Œå…ˆè·å¾—é”ã€‚</li>
</ul>
</li>
<li><code>void wait( std::unique_lock&lt;std::mutex&gt;&amp; lock, Predicate pred );</code> <ul>
<li>é‡Šæ”¾é”ï¼Œç„¶åè¿›å…¥é˜»å¡ï¼Œç›´åˆ°è¢«å”¤é†’ã€‚</li>
<li>è¢«å”¤é†’åï¼Œå…ˆè·å¾—é”</li>
<li>åªè¦<code>pred</code>ä¸æ»¡è¶³ï¼Œå°±ä¼šå†æ¬¡é‡Šæ”¾é”ç„¶åé˜»å¡ã€‚</li>
<li>é¿å…åœ¨<code>pred</code>é‡ŒåŠ å‰¯ä½œç”¨ï¼Œå› ä¸ºæ— æ³•ç¡®å®šå®ƒä¼šæ‰§è¡Œå¤šå°‘æ¬¡ã€‚</li>
</ul>
</li>
<li><code>notify_one()</code>&#x2F;<code>notify_all()</code> <ul>
<li>å”¤é†’å…³è”çš„é˜»å¡çº¿ç¨‹ã€‚</li>
<li>å½“å‰çº¿ç¨‹åº”å½“äº‹å…ˆé‡Šæ”¾é”ï¼ˆlock_guardåº”å·²ææ„ï¼‰ã€‚</li>
</ul>
</li>
<li><code>void notify_all_at_thread_exit( std::condition_variable&amp; cond, std::unique_lock&lt;std::mutex&gt; lk );</code> <ul>
<li>å…¨å±€å‡½æ•°ã€‚ </li>
<li>çº¿ç¨‹é€€å‡ºæ—¶ï¼ˆæ‰€æœ‰thread_localè¢«é”€æ¯åï¼‰ï¼Œé‡Šæ”¾é”ï¼Œç„¶åå”¤é†’å…¨éƒ¨ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="Future-amp-Async-æœªæ¥ä¸å¼‚æ­¥"><a href="#Future-amp-Async-æœªæ¥ä¸å¼‚æ­¥" class="headerlink" title="Future &amp; Async æœªæ¥ä¸å¼‚æ­¥"></a>Future &amp; Async æœªæ¥ä¸å¼‚æ­¥</h3><p><a href="https://en.cppreference.com/w/cpp/header/future">cppreference future</a></p>
<p>æœ‰æ—¶å€™ï¼Œèµ·ä¸€ä¸ªçº¿ç¨‹ä»…ä»…æ˜¯ä¸ºäº†ä¸€æ¬¡è¿”å›å€¼ã€‚threadä¸èƒ½æä¾›è¿”å›å€¼ï¼Œæ¡ä»¶å˜é‡åˆå¤ªé‡é‡çº§äº†ï¼Œä½ éœ€è¦ä½¿ç”¨<code>async</code>ã€‚</p>
<p><code>async</code>å¯ä»¥è½»é‡çº§åœ°å¼€å¯ä¸€ä¸ªå¸¦è¿”å›å€¼çš„çº¿ç¨‹ï¼Œé€šå¸¸çŸ­æœŸå†…ä½ ç”¨ä¸åˆ°è¿”å›å€¼ã€‚ä¸€æ®µæ—¶é—´åï¼Œä½ éœ€è¦è¿”å›å€¼äº†ï¼Œæ‰é˜»å¡è‡ªå·±ï¼Œç›´åˆ°è¿”å›å€¼å°±ç»ªã€‚éœ€è¦èŠ±è´¹ä¸€æ®µæ—¶é—´æ‰èƒ½å°±ç»ªçš„è¿”å›å€¼å°±æ˜¯<code>future</code>ã€‚</p>
<p><code>async</code>ä¹Ÿå…è®¸ä½ æ¨è¿Ÿæ‰§è¡Œï¼Œè¿™æ„å‘³ç€æ²¡æœ‰æ–°çº¿ç¨‹ï¼Œè€Œæ˜¯åŒæ­¥åœ°æ‰§è¡Œã€‚</p>
<ul>
<li><code>async</code>å‡½æ•°<ul>
<li>å¯æ¥å—<code>std::launch policy</code>ä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå…è®¸çš„å€¼æœ‰ï¼š<ul>
<li><code>std::launch::async</code> å¼€å¯æ–°çº¿ç¨‹ï¼Œå¼‚æ­¥æ‰§è¡Œã€‚</li>
<li><code>std::launch::deferred</code> æ²¡æœ‰æ–°çº¿ç¨‹ï¼Œæ‡’æƒ°åŒæ­¥æ‰§è¡Œã€‚</li>
<li><code>launch::async|launch::deferred</code> é»˜è®¤å€¼ï¼Œç”±å®ç°é€‰æ‹©ç­–ç•¥ã€‚</li>
<li>C++æ ‡å‡†å…è®¸å®ç°é‡‡ç”¨ä¸åŒçš„é»˜è®¤ç­–ç•¥ï¼Œç”šè‡³å…è®¸æ–°å¢ç­–ç•¥ã€‚</li>
</ul>
</li>
<li><code>async</code>è¿”å›ä¸€ä¸ª<code>future</code></li>
</ul>
</li>
<li><code>future&lt;&gt;</code>ç±»<ul>
<li>è¡¨ç¤ºä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼å¯èƒ½æ­£åœ¨è®¡ç®—ä¸­ï¼Œå¯èƒ½å°±ç»ªï¼Œä¹Ÿå¯èƒ½æ˜¯æŠ›å‡ºçš„å¼‚å¸¸ã€‚</li>
<li><code>get()</code>æˆå‘˜å‡½æ•°ã€‚ ä¿è¯è¿”å›å°±ç»ªçš„å€¼æˆ–è€…æŠ›å‡ºå¼‚å¸¸ã€‚ï¼ˆè‹¥æœªå°±ç»ªï¼Œåˆ™å½“å‰çº¿ç¨‹é˜»å¡ï¼‰ã€‚æ­¤å‡½æ•°åªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œç„¶åå°†<code>valid()</code>è®¾ç½®ä¸ºfalseã€‚</li>
<li><code>valid()</code>æˆå‘˜å‡½æ•°ã€‚ æ£€æŸ¥ä¸‹ä¸€æ¬¡<code>get()</code>çš„åˆæ³•æ€§ï¼Œå³æœ‰æ²¡æœ‰å…±äº«çŠ¶æ€ã€‚</li>
<li><code>wait()</code>æˆå‘˜å‡½æ•°ã€‚ ä¿è¯å€¼å°±ç»ªæˆ–è€…æŠ›å‡ºå¼‚å¸¸ã€‚ï¼ˆè‹¥æœªå°±ç»ªï¼Œåˆ™é˜»å¡ï¼‰</li>
<li><code>wait_for</code>, <code>wait_until</code>æˆå‘˜å‡½æ•°ã€‚æœ‰é™ç­‰å¾…ã€‚</li>
<li><code>share()</code>æˆå‘˜å‡½æ•°ã€‚ç§»åŠ¨è‡ªå·±ï¼Œæ„é€ ä¸€ä¸ª<code>shared_future&lt;&gt;</code>ã€‚</li>
<li>å¯ç§»åŠ¨ï¼Œä¸å¯å¤åˆ¶ã€‚</li>
</ul>
</li>
<li><code>shared_future&lt;&gt;</code>ç±»<ul>
<li>ä¸<code>future&lt;&gt;</code>ç±»ä¼¼ï¼Œä½†å¯ä»¥<code>get()</code>å¤šæ¬¡ã€‚</li>
<li>å¯ç§»åŠ¨ä¹Ÿå¯ä»¥å¤åˆ¶ã€‚</li>
<li>æ­£ç¡®çš„ç”¨æ³•å°±æ˜¯æ¯ä¸ªçº¿ç¨‹æŒæœ‰ä¸€ä»½å¤åˆ¶ã€‚</li>
</ul>
</li>
<li><code>packaged_task&lt;Callable&gt;</code>ç±»<ul>
<li>å°†futureç»‘å®šåˆ°å‡½æ•°ï¼ˆæˆ–å¯è°ƒç”¨å¯¹è±¡ï¼‰ï¼Œæ–¹ä¾¿è‡ªå®šä¹‰è°ƒåº¦ã€‚</li>
<li>æ„é€ å™¨ä»…æ¥å—å‡½æ•°ï¼ˆå¯ä»¥æ˜¯lambdaï¼ï¼‰ï¼Œä¸ç»‘å®šå‚æ•°ã€‚åªæœ‰åœ¨<code>operator ()</code>æ—¶æ‰ä¼ å…¥å‚æ•°ã€‚</li>
<li>packaged_taskæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼å¯ä»¥ç”¨å®ƒèµ·ä¸€ä¸ªæ–°çº¿ç¨‹ã€‚<code>thread(move(task), args...)</code></li>
<li>å¯ç§»åŠ¨ï¼Œä¸å¯å¤åˆ¶ã€‚</li>
<li><code>get_future()</code> è·å–ç»‘å®šçš„futureã€‚</li>
<li><code>operator(args...)</code> ç«‹å³åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œï¼Œç„¶åfutureå°±ç»ªï¼Œæ„å‘³ç€å”¤é†’ç­‰å¾…æ­¤futureçš„çº¿ç¨‹ã€‚</li>
<li><code>make_ready_at_thread_exit(args...)</code> ç«‹å³åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œï¼Œä½†æ˜¯futureä¸å°±ç»ªã€‚å½“çº¿ç¨‹é€€å‡ºä¸”æ‰€æœ‰thread_localå¯¹è±¡é”€æ¯åï¼Œfutureæ‰å°±ç»ªã€‚</li>
<li><code>reset()</code> é‡æ–°æ„é€ è‡ªå·±ã€‚æ—§ç‰ˆçš„futureä½œåºŸã€‚</li>
</ul>
</li>
<li><code>promise&lt;&gt;</code>ç±»<ul>
<li>æ¯”asyncæä¾›æ›´å¼ºçš„è‡ªç”±åº¦ï¼Œå¯ä»¥æ‰‹åŠ¨è®¾ç½®futureï¼å¦‚æ­¤å¯ä»¥åœ¨è®¾ç½®futureåç»§ç»­æ¸…ç†å·¥ä½œã€‚</li>
<li>å¯ç§»åŠ¨ï¼Œä¸å¯å¤åˆ¶ã€‚</li>
<li>ä¸€èˆ¬å…ˆ<code>get_future()</code>ç•™ä¸‹æ¥å£ï¼Œç„¶åmove<code>promise</code>åˆ°åˆ«çš„çº¿ç¨‹ï¼Œåœ¨åˆ«çš„çº¿ç¨‹<code>set_value</code>ã€‚</li>
<li><code>set_value(value)</code> è®¾ç½®å…³è”çš„futureçš„å€¼ï¼Œå”¤é†’åœ¨ç­‰å¾…çš„çº¿ç¨‹ã€‚</li>
<li><code>set_value_at_thread_exit(value)</code> ç±»ä¼¼<code>set_value</code>ï¼Œä½†å½“å‰çº¿ç¨‹é€€å‡ºåï¼Œæ‰å”¤é†’åœ¨ç­‰å¾…çš„çº¿ç¨‹ã€‚</li>
<li><code>void set_exception( std::exception_ptr p )</code> ä»¤futureçš„<code>get()</code>æŠ›å‡ºå¼‚å¸¸ã€‚<ul>
<li>åœ¨try-catchå—ä¸­ï¼Œé…åˆ<code>std::current_exception()</code>ä½¿ç”¨</li>
<li>ä¸ç”¨try-catchï¼Œæ€§èƒ½æ›´é«˜ï¼Œé…åˆ<code>make_exception_ptr(E e)</code>ç”¨ã€‚</li>
</ul>
</li>
<li><code>set_exception_at_thread_exit</code> åŒç†ã€‚</li>
</ul>
</li>
</ul>
<h2 id="å†…å­˜æ¨¡å‹å’ŒåŸå­æ“ä½œ"><a href="#å†…å­˜æ¨¡å‹å’ŒåŸå­æ“ä½œ" class="headerlink" title="å†…å­˜æ¨¡å‹å’ŒåŸå­æ“ä½œ"></a>å†…å­˜æ¨¡å‹å’ŒåŸå­æ“ä½œ</h2><h2 id="è®¾è®¡æ— é”æ•°æ®ç»“æ„"><a href="#è®¾è®¡æ— é”æ•°æ®ç»“æ„" class="headerlink" title="è®¾è®¡æ— é”æ•°æ®ç»“æ„"></a>è®¾è®¡æ— é”æ•°æ®ç»“æ„</h2><ul>
<li>æ— é”æ•°æ®ç»“æ„åº”å¦‚ä½•è®¾è®¡ï¼Ÿ</li>
<li>æ— é”æ•°æ®ç»“æ„çš„å†…å­˜ç®¡ç†æœ‰ä½•éš¾é¢˜ï¼Ÿ</li>
<li>æ›´å¤šçš„å»ºè®®ï¼Ÿ</li>
</ul>
]]></content>
      <tags>
        <tag>C++</tag>
        <tag>Concurrency</tag>
      </tags>
  </entry>
  <entry>
    <title>Expression Templates</title>
    <url>/2022/01/31/Expression-Templates/</url>
    <content><![CDATA[<h1 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h1><p>åœ¨ç ”ç©¶ CRTP æ—¶å‘ç°äº†ä¸€ç§ç»å…¸åº”ç”¨â€”â€”è¡¨è¾¾å¼æ¨¡æ¿ã€‚ä»Šå¤©å­¦ä¸€å­¦ï¼Œé¡ºä¾¿æ°´ä¸€ç¯‡åšå®¢ã€‚ğŸ¶</p>
<h1 id="Motivation-and-example"><a href="#Motivation-and-example" class="headerlink" title="Motivation and example"></a>Motivation and example</h1><p>è¡¨è¾¾å¼æ¨¡æ¿æ˜¯ä¸€ç§æ¨¡æ¿å…ƒç¼–ç¨‹ï¼Œå®ƒåœ¨ç¼–è¯‘æœŸå±•å¼€å‘é‡çš„ä¸€ç³»åˆ—å¤åˆè¿ç®—ï¼Œä»è€Œå°†è¾…åŠ©ç©ºé—´ä» $O(n)$ é™åˆ° $O(1)$ã€‚ç›¸æ¯”äºæœ´ç´ ç®—æ³•ï¼Œè¡¨è¾¾å¼æ¨¡æ¿å±äºæƒ°æ€§æ±‚å€¼ï¼Œæ±‚å€¼æ—¶é—´ç‚¹æ˜¯èµ‹å€¼è¿ç®—ã€‚</p>
<span id="more"></span>

<p>ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰è¿™æ ·ä¸€ä¸ª vector è¿ç®—ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">tot = (a + b) * c;</span><br></pre></td></tr></table></figure>
<p>æœ´ç´ ç®—æ³•çš„è¯­ä¹‰æ˜¯ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="keyword">auto</span> tmp0 = a + b; <span class="comment">// allocating O(n) space</span></span><br><span class="line">    <span class="keyword">auto</span> tmp1 = tmp0 * c;</span><br><span class="line">    tot = tmp1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å³ä½¿ä½ çŸ¥é“ã€Œå¼•ç”¨é™å®šæˆå‘˜å‡½æ•°ã€ï¼Œä½¿ä½ å¯ä»¥æŠ¹æ‰ <code>tmp1</code> çš„ç©ºé—´åˆ†é…ï¼Œä½†æ˜¯ <code>tmp0</code> çš„è¾…åŠ©ç©ºé—´æ€»æ˜¯é€ƒä¸æ‰ã€‚</p>
<p>èƒ½å¸®åŠ©ä½ çš„åªæœ‰è¡¨è¾¾å¼æ¨¡æ¿ï¼Œå®ƒå¯ä»¥è¡¨è¾¾å‡ºè¿™æ ·çš„è¯­ä¹‰ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">size_t</span> i=<span class="number">0</span>, n=a.<span class="built_in">size</span>(); i&lt;n; ++i) &#123;</span><br><span class="line">    tot[i] = (a[i] + b[i]) * c[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æ­¤ä¸€æ¥éœ€è¦çš„è¾…åŠ©ç©ºé—´å°±æ˜¯å¯„å­˜å™¨çº§åˆ«çš„ï¼å»æ‰äº†å‡½æ•°è°ƒç”¨ä¹Ÿæ›´æ–¹ä¾¿ç¼–è¯‘å™¨åšè¿›ä¸€æ­¥çš„ä¼˜åŒ–ã€‚</p>
<h1 id="My-first-attempt"><a href="#My-first-attempt" class="headerlink" title="My first attempt"></a>My first attempt</h1><details class="note primary"><summary><p>æˆ‘çš„é¦–æ¬¡å°è¯•</p>
</summary>
<p>å¿ä½ä¸çœ‹æ•™ç¨‹ï¼Œæˆ‘å…ˆè¯•ç€å®ç°å‡ºæ¥ï¼Œçœ‹çœ‹å·®è·æœ‰å¤šå¤§ã€‚ğŸ¤”</p>
<p>æˆ‘çš„æƒ³æ³•ï¼š</p>
<ol>
<li>åˆ©ç”¨ç±»å‹ç³»ç»Ÿï¼Œå°†æ‡’æƒ°ä¿¡æ¯è®°å½•åœ¨æ¨¡æ¿å‚æ•°ä¸­</li>
<li>å®šä¹‰æƒ°æ€§äºŒå…ƒè¿ç®—ç¬¦ï¼Œå®ƒçš„æ“ä½œæ•°å¯ä»¥æ˜¯ vector æˆ–è€…æƒ°æ€§äºŒå…ƒè¿ç®—ç¬¦ã€‚</li>
<li>é­”æ”¹ <code>vector</code>ï¼Œåœ¨èµ‹å€¼è¿ç®—ç¬¦ä¸­è§¦å‘æ±‚å€¼ï¼›é‡è½½åŠ å‡ä¹˜é™¤è¿ç®—ã€‚</li>
</ol>
<h2 id="Draft-1"><a href="#Draft-1" class="headerlink" title="Draft 1"></a>Draft 1</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> BinaryOperator, <span class="keyword">typename</span> LHS, <span class="keyword">typename</span> RHS&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">DeferredOperator</span> &#123;</span><br><span class="line">    <span class="type">const</span> LHS &amp;lhs;</span><br><span class="line">    <span class="type">const</span> RHS &amp;rhs;</span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="title">DeferredOperator</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        BinaryOperator, <span class="type">const</span> LHS &amp;lhs, <span class="type">const</span> RHS &amp;rhs)</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">        : lhs(lhs), rhs(rhs) &#123;</span>&#125;</span><br><span class="line">    <span class="keyword">constexpr</span> <span class="keyword">auto</span> <span class="keyword">operator</span>[](<span class="type">size_t</span> pos) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BinaryOperator&#123;&#125;(lhs[pos], rhs[pos]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> lhs.<span class="built_in">size</span>(); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">class</span> <span class="title class_">Container</span> = std::vector&lt;T&gt;&gt;</span><br><span class="line"><span class="keyword">struct</span> Vec : Container &#123;</span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Op&gt;</span><br><span class="line">    Vec &amp;<span class="keyword">operator</span>=(Op &amp;&amp;op) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">size_t</span> n = op.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">resize</span>(n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; n; ++i) <span class="keyword">this</span>-&gt;<span class="keyword">operator</span>[](i) = op[i];</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Vec&lt;<span class="type">int</span>&gt; vec;</span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">a</span><span class="params">(<span class="number">5</span>, <span class="number">1</span>)</span>, <span class="title">b</span><span class="params">(<span class="number">5</span>, <span class="number">3</span>)</span>, <span class="title">c</span><span class="params">(<span class="number">5</span>, <span class="number">6</span>)</span></span>;</span><br><span class="line">    vec = <span class="built_in">DeferredOperator</span>(</span><br><span class="line">        std::multiplies&lt;<span class="type">int</span>&gt;&#123;&#125;, <span class="built_in">DeferredOperator</span>(std::plus&lt;<span class="type">int</span>&gt;&#123;&#125;, a, b), c);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> x : vec) &#123;</span><br><span class="line">        std::cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        <span class="built_in">assert</span>(x == (<span class="number">1</span> + <span class="number">3</span>) * <span class="number">6</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="What-39-s-wrong"><a href="#What-39-s-wrong" class="headerlink" title="What&#39;s wrong"></a>What&#39;s wrong</h2><p>è¿™æ®µç¨‹åºæ˜¯æ­£ç¡®çš„ï¼ğŸ˜ä½†ä¹Ÿæœ‰ä¸€äº›çŠ¯è ¢çš„åœ°æ–¹ï¼š</p>
<ol>
<li>æ²¡æœ‰é‡è½½è¿ç®—ç¬¦ï¼Œç”¨èµ·æ¥å¤ªä¸‘ï¼›</li>
<li>æ˜¾å¼æ¨¡æ¿å‚æ•°å¤ªå¤šï¼Œæ¯”å¦‚ <code>int</code> å‡ºç°å¤ªå¤šæ¬¡ã€‚ç†æƒ³ä¸­åº”è¯¥åªåœ¨ <code>Vec</code> å®šä¹‰æ—¶è¡¨æ˜<code>T = int</code>ï¼Œåé¢çš„é€šé€šè‡ªåŠ¨æ¨å¯¼ï¼›</li>
<li>é­”æ”¹çš„ <code>Vec</code> ç±»æ²¡æœ‰æ²¿ç”¨ <code>std::vector</code> çš„éé»˜è®¤æ„é€ å‡½æ•°ï¼›</li>
<li>å½“è°ƒç”¨ <code>vec = vec</code> æ—¶ä¼šé”™è¯¯åœ°è°ƒç”¨æƒ°æ€§æ±‚å€¼ç‰ˆæœ¬ï¼›</li>
<li>æ²¡æœ‰æ˜¾å¼ CRTPï¼Œè¯æ˜ä¸å¤Ÿç†Ÿç»ƒï¼›</li>
<li>åœ¨è®¡ç®—å‰è°ƒç”¨ <code>vector::resize()</code> çœŸçš„å¥½å—ï¼Ÿæœ‰ç‚¹è¿åé›¶å¼€é”€æŠ½è±¡çš„æ„Ÿè§‰ã€‚</li>
</ol>

</details>

<h1 id="The-second-attempt"><a href="#The-second-attempt" class="headerlink" title="The second attempt"></a>The second attempt</h1><details class="note primary"><summary><p>æŸ¥æ–‡æ¡£å†æ”¹è¿›</p>
</summary>
<p>é’ˆå¯¹ä¸Šä¸€ç« èŠ‚åˆ—å‡ºçš„ç¼ºç‚¹ï¼Œæˆ‘æŸ¥é˜…æ–‡æ¡£åšäº†ä¸€äº›æ”¹è¿›ï¼š</p>
<h2 id="Inheriting-constructors"><a href="#Inheriting-constructors" class="headerlink" title="Inheriting constructors"></a>Inheriting constructors</h2><p><a href="https://en.cppreference.com/w/cpp/language/using_declaration">cppreference</a></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">class</span> <span class="title class_">Container</span> = std::vector&lt;T&gt;&gt;</span><br><span class="line"><span class="keyword">struct</span> Vec : Container &#123;</span><br><span class="line">    <span class="keyword">using</span> Container::Container;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±èƒ½ä½¿ç”¨ <code>std::vector</code> çš„æ„é€ æ¥å£äº†ï¼Œæˆ‘ä»¬çš„ C++ çœŸçš„å¤ªå¥½ç”¨å•¦ï¼</p>
<h2 id="Template-Inner-Class"><a href="#Template-Inner-Class" class="headerlink" title="Template Inner Class"></a>Template Inner Class</h2><p>æˆ‘ä»¬å¯ä»¥å°† <code>DeferredOperator</code> ç±»å®šä¹‰åœ¨ <code>Vec</code> å†…éƒ¨ï¼Œè¿™æ ·å°±ä¸ç”¨åˆ°å¤„ä¼ é€’åŸºç¡€æ•°æ®ç±»å‹å•¦ï¼</p>
<h2 id="Who-needs-operator"><a href="#Who-needs-operator" class="headerlink" title="Who needs operator+()?"></a>Who needs operator+()?</h2><ol>
<li><code>Vec</code> ç±»éœ€è¦å®ç° <code>operator+()</code>ï¼Œå¹¶ç”±è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ª <code>DeferredOperator</code></li>
<li><code>DeferredOperator</code> ç±»éœ€è¦å®ç° <code>operator+()</code>ï¼Œè¿™ä¸ªå‡½æ•°åŒæ ·è¿”å›ä¸€ä¸ª <code>DeferredOperator</code></li>
</ol>
<h2 id="Ambiguity-of-operator-x3D"><a href="#Ambiguity-of-operator-x3D" class="headerlink" title="Ambiguity of operator&#x3D;()"></a>Ambiguity of operator&#x3D;()</h2><p>ä¸ºäº†åŒºåˆ† <code>Vec = Vec</code> å’Œ <code>Vec = DeferredOperator</code>ï¼Œæˆ‘ä»¬éœ€è¦æ›´ç²¾ç»†åœ°å®šä¹‰å‚æ•°ã€‚</p>
<h2 id="Draft-2"><a href="#Draft-2" class="headerlink" title="Draft 2"></a>Draft 2</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">class</span> <span class="title class_">Container</span> = std::vector&lt;T&gt;&gt;</span><br><span class="line"><span class="keyword">struct</span> Vec : Container &#123;</span><br><span class="line">    <span class="keyword">using</span> Container::Container;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> BinaryOperator, <span class="keyword">typename</span> LHS, <span class="keyword">typename</span> RHS&gt;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">DeferredOperator</span> &#123;</span><br><span class="line">        <span class="type">const</span> LHS &amp;lhs;</span><br><span class="line">        <span class="type">const</span> RHS &amp;rhs;</span><br><span class="line">        <span class="function"><span class="keyword">constexpr</span> <span class="title">DeferredOperator</span><span class="params">(<span class="type">const</span> LHS &amp;lhs, <span class="type">const</span> RHS &amp;rhs)</span> <span class="keyword">noexcept</span></span></span><br><span class="line"><span class="function">            : lhs(lhs), rhs(rhs) &#123;</span>&#125;</span><br><span class="line">        <span class="keyword">constexpr</span> <span class="keyword">auto</span> <span class="keyword">operator</span>[](<span class="type">size_t</span> pos) <span class="type">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> BinaryOperator&#123;&#125;(lhs[pos], rhs[pos]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">template</span>&lt;<span class="keyword">typename</span> OuterRHS&gt;</span><br><span class="line">        <span class="keyword">constexpr</span> <span class="keyword">auto</span> <span class="keyword">operator</span>+(<span class="type">const</span> OuterRHS &amp;outerRHS) <span class="type">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> DeferredOperator&lt;std::plus&lt;&gt;, DeferredOperator, OuterRHS&gt;(</span><br><span class="line">                *<span class="keyword">this</span>, outerRHS);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">constexpr</span> <span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> lhs.<span class="built_in">size</span>(); &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> RHS&gt;</span><br><span class="line">    <span class="keyword">constexpr</span> <span class="keyword">auto</span> <span class="keyword">operator</span>+(<span class="type">const</span> RHS &amp;rhs) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> DeferredOperator&lt;std::plus&lt;&gt;, Vec, RHS&gt;(*<span class="keyword">this</span>, rhs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> BinaryOperator, <span class="keyword">typename</span> LHS, <span class="keyword">typename</span> RHS&gt;</span><br><span class="line">    Vec &amp;<span class="keyword">operator</span>=(<span class="type">const</span> DeferredOperator&lt;BinaryOperator,LHS,RHS&gt; &amp;op) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;tag\n&quot;</span>;</span><br><span class="line">        <span class="type">const</span> <span class="type">size_t</span> n = op.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">resize</span>(n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; n; ++i) <span class="keyword">this</span>-&gt;<span class="keyword">operator</span>[](i) = op[i];</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Vec&lt;<span class="type">int</span>&gt; vec, <span class="built_in">a</span>(<span class="number">5</span>, <span class="number">1</span>), <span class="built_in">b</span>(<span class="number">5</span>, <span class="number">3</span>), <span class="built_in">c</span>(<span class="number">5</span>, <span class="number">6</span>);</span><br><span class="line">    vec = a; <span class="comment">// check bug</span></span><br><span class="line">    vec = a + b + c;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> x : vec) &#123;</span><br><span class="line">        std::cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        <span class="built_in">assert</span>(x == (<span class="number">1</span> + <span class="number">3</span>) + <span class="number">6</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Direction-of-improvement"><a href="#Direction-of-improvement" class="headerlink" title="Direction of improvement"></a>Direction of improvement</h2><p>WoW! è¿™æ®µä»£ç ä¹Ÿæ˜¯æ­£ç¡®çš„ï¼ä½†è¿˜æ˜¯å†™å¾—æœ‰ç‚¹è‡­ï¼š</p>
<ol>
<li>è¿™é‡Œåªå†™äº†é‡è½½åŠ æ³•ã€‚å¦‚æœæ¯ç§è¿ç®—ç¬¦éƒ½è¦å†™ä¸¤ä¸ªæˆå‘˜å‡½æ•°ï¼Œé‚£ä¹Ÿå¤ªéš¾çœ‹äº†ã€‚</li>
<li>åªå¯¹ <code>Vec</code> ç±»å®ç°äº†æƒ°æ€§åŠ æ³•ã€‚ä¸‡ä¸€å†æ¥ä¸€ä¸ª <code>Matrix</code> ç±»å‘¢ï¼Ÿæƒ°æ€§è¿ç®—èƒ½ä¸èƒ½æ¥å£åŒ–ï¼Ÿ</li>
<li>CRTP åœ¨å“ªï¼Ÿ</li>
</ol>

</details>

<h1 id="Peak-of-Evolution"><a href="#Peak-of-Evolution" class="headerlink" title="Peak of Evolution"></a>Peak of Evolution</h1><p>è¿™æ¬¡ä¾ç„¶æ˜¯åŸåˆ›ä»£ç ï¼Œæ”¹è¿›äº†ä¸€äº›åœ°æ–¹ï¼š</p>
<h2 id="Class-Diagram"><a href="#Class-Diagram" class="headerlink" title="Class Diagram"></a>Class Diagram</h2><p>å¤šå±‚æ¬¡çš„ CRTP ç”¨èµ·æ¥å®¹æ˜“å¤´æ™•ï¼Œåº”è¯¥äº‹å…ˆè®¾è®¡å¥½ç±»çš„å…³ç³»ï¼š</p>
<p><img src="/2022/01/31/Expression-Templates/crtpEt.svg" alt="CRTP relationship"></p>
<p>æ©™è‰²å’Œçº¢è‰²çš„ç±»æ‰æ˜¯ CRTP çš„æ¨¡æ¿å®å‚ã€‚ç™½è‰²çš„ç±»ä¸»è¦ç”¨ä½œæ¥å£ï¼Œç±»ä¼¼äºæŠ½è±¡ç±»ã€‚</p>
<h2 id="ET-interface"><a href="#ET-interface" class="headerlink" title="ET interface"></a>ET interface</h2><ul>
<li>ç”¨æˆ·ç±»åªè¦ç»§æ‰¿ <code>VectorExpresstion</code> æ¥å£ï¼ŒåŒæ—¶å®šä¹‰åˆé€‚çš„ <code>operator[]</code> å’Œ <code>operator=</code> å³å¯å®ç°æ¨¡æ¿è¡¨è¾¾å¼ã€‚</li>
<li>ç”¨æˆ·å¯ä»¥åœ¨ <code>operator=</code> ä¸­åšæ€§èƒ½ä¼˜åŒ–ï¼Œä¾‹å¦‚æ‰‹å·¥å¾ªç¯å±•å¼€ã€SIMD ç­‰ç­‰ï¼Œéå¸¸çµæ´»ã€‚</li>
<li>ç”¨æˆ·è¿˜å¯ä»¥è‡ªå®šä¹‰è¿ç®—ç¬¦ï¼Œä½†æˆ‘æš‚æ—¶æƒ³ä¸åˆ°æœ‰ä»€ä¹ˆä¸å•°å—¦çš„å®ç°æ–¹æ³•ï¼ˆé™¤äº†å®ï¼‰ã€‚</li>
</ul>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// necessary header for Expression Template library</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;functional&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// header for user-define things</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// helper class for CRTP. For more info, please see my previous blog</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">template</span>&lt;<span class="keyword">typename</span>&gt; <span class="keyword">class</span> <span class="title class_">Interface</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">CRTP</span> &#123;</span><br><span class="line">    <span class="function">T &amp;<span class="title">self</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;T &amp;&gt;(*<span class="keyword">this</span>); &#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> T &amp;<span class="title">self</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;<span class="type">const</span> T &amp;&gt;(*<span class="keyword">this</span>); &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">CRTP</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="keyword">friend</span> Interface&lt;T&gt;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// my Expression Template library implementation</span></span><br><span class="line"><span class="keyword">namespace</span> ET &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// base class for lazy evaluation</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Expression</span> : CRTP&lt;T, Expression&gt; &#123;</span><br><span class="line">    <span class="comment">// use a looong function name to avoid ambiguity</span></span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="keyword">auto</span> <span class="title">evaluate</span><span class="params">(<span class="type">size_t</span> i)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">self</span>()[i]; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="keyword">auto</span> <span class="title">selfSize</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>-&gt;<span class="built_in">self</span>().<span class="built_in">size</span>(); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// class to indicate a single value (instead of an vector)</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">ArithmeticExpression</span> : Expression&lt;ArithmeticExpression&lt;T&gt;&gt; &#123;</span><br><span class="line">    <span class="built_in">ArithmeticExpression</span>() = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span>&lt;std::<span class="type">enable_if_t</span>&lt;std::is_arithmetic_v&lt;T&gt;, <span class="type">bool</span>&gt; = <span class="literal">true</span>&gt;</span><br><span class="line">    <span class="keyword">constexpr</span> <span class="built_in">ArithmeticExpression</span>(<span class="type">const</span> T value) <span class="keyword">noexcept</span> : <span class="built_in">val</span>(value) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constexpr</span> T <span class="keyword">operator</span>[](<span class="type">size_t</span>) <span class="type">const</span> &#123; <span class="keyword">return</span> val; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="type">void</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123;&#125; <span class="comment">// return void for easier metaprogramming</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="type">const</span> T val;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// class to indicate an vector (instead of a single arithmetic value)</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">VectorExpression</span> : Expression&lt;T&gt; &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> BinaryOperator, <span class="keyword">typename</span> LHS, <span class="keyword">typename</span> RHS&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">BinaryExpression</span></span><br><span class="line">    : VectorExpression&lt;BinaryExpression&lt;BinaryOperator, LHS, RHS&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">constexpr</span> <span class="keyword">auto</span> <span class="keyword">operator</span>[](<span class="type">size_t</span> i) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="comment">// evaluation happens when operator[] is called</span></span><br><span class="line">        <span class="keyword">return</span> BinaryOperator&#123;&#125;(lhs.<span class="built_in">evaluate</span>(i), rhs.<span class="built_in">evaluate</span>(i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">constexpr</span> <span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="comment">// return the size of an *vector*</span></span><br><span class="line">        <span class="function"><span class="keyword">if</span> <span class="title">constexpr</span> <span class="params">(!std::is_same_v&lt;<span class="keyword">decltype</span>(lhs.selfSize()), <span class="type">void</span>&gt;)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">return</span> lhs.<span class="title">selfSize</span><span class="params">()</span></span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> rhs.<span class="built_in">selfSize</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">BinaryExpression</span>(<span class="type">const</span> LHS &amp;lhs, <span class="type">const</span> RHS &amp;rhs) : <span class="built_in">lhs</span>(lhs), <span class="built_in">rhs</span>(rhs) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="type">const</span> LHS &amp;lhs;</span><br><span class="line">    <span class="type">const</span> RHS &amp;rhs;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> LHS, <span class="keyword">typename</span> RHS&gt;</span><br><span class="line"><span class="keyword">using</span> AddExpression = BinaryExpression&lt;std::plus&lt;&gt;, LHS, RHS&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> LHS, <span class="keyword">typename</span> RHS&gt;</span><br><span class="line"><span class="keyword">using</span> SubExpression = BinaryExpression&lt;std::minus&lt;&gt;, LHS, RHS&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> LHS, <span class="keyword">typename</span> RHS&gt;</span><br><span class="line"><span class="keyword">using</span> MulExpression = BinaryExpression&lt;std::multiplies&lt;&gt;, LHS, RHS&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> LHS, <span class="keyword">typename</span> RHS&gt;</span><br><span class="line"><span class="keyword">using</span> DivExpression = BinaryExpression&lt;std::divides&lt;&gt;, LHS, RHS&gt;;</span><br><span class="line"></span><br><span class="line">&#125; <span class="comment">// namespace ET</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ==============================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// overloaded operator to export:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">using</span> ETNum = ET::ArithmeticExpression&lt;T&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> E1, <span class="keyword">typename</span> E2&gt;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="keyword">auto</span></span><br><span class="line"><span class="keyword">operator</span>+(<span class="type">const</span> ET::Expression&lt;E1&gt; &amp;lhs, <span class="type">const</span> ET::Expression&lt;E2&gt; &amp;rhs) &#123;</span><br><span class="line">    <span class="comment">// notice Expression&lt;E1&gt; -&gt; E1</span></span><br><span class="line">    <span class="comment">// so &quot;Expression&quot; is removed</span></span><br><span class="line">    <span class="keyword">return</span> ET::<span class="built_in">AddExpression</span>&lt;E1, E2&gt;(lhs.<span class="built_in">self</span>(), rhs.<span class="built_in">self</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> E1, <span class="keyword">typename</span> E2&gt;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="keyword">auto</span></span><br><span class="line"><span class="keyword">operator</span>-(<span class="type">const</span> ET::Expression&lt;E1&gt; &amp;lhs, <span class="type">const</span> ET::Expression&lt;E2&gt; &amp;rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> ET::<span class="built_in">SubExpression</span>&lt;E1, E2&gt;(lhs.<span class="built_in">self</span>(), rhs.<span class="built_in">self</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> E1, <span class="keyword">typename</span> E2&gt;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="keyword">auto</span></span><br><span class="line"><span class="keyword">operator</span>*(<span class="type">const</span> ET::Expression&lt;E1&gt; &amp;lhs, <span class="type">const</span> ET::Expression&lt;E2&gt; &amp;rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> ET::<span class="built_in">MulExpression</span>&lt;E1, E2&gt;(lhs.<span class="built_in">self</span>(), rhs.<span class="built_in">self</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> E1, <span class="keyword">typename</span> E2&gt;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="keyword">auto</span></span><br><span class="line"><span class="keyword">operator</span>/(<span class="type">const</span> ET::Expression&lt;E1&gt; &amp;lhs, <span class="type">const</span> ET::Expression&lt;E2&gt; &amp;rhs) &#123;</span><br><span class="line">    <span class="keyword">return</span> ET::<span class="built_in">DivExpression</span>&lt;E1, E2&gt;(lhs.<span class="built_in">self</span>(), rhs.<span class="built_in">self</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ==============================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// user-define operator</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// I find it hard to convert a function into an operator() overloading.</span></span><br><span class="line"><span class="comment">// If you have a good idea, please tell me!</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">POW</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Tp, <span class="keyword">typename</span> _Up&gt;</span></span><br><span class="line"><span class="function">    <span class="keyword">auto</span> <span class="title">operator</span><span class="params">()</span><span class="params">(_Tp &amp;&amp;<span class="type">__t</span>, _Up &amp;&amp;__u)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">pow</span>(std::forward&lt;_Tp&gt;(<span class="type">__t</span>), std::forward&lt;_Up&gt;(__u));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> E1, <span class="keyword">typename</span> E2&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="keyword">auto</span></span></span><br><span class="line"><span class="function"><span class="title">Pow</span><span class="params">(<span class="type">const</span> ET::Expression&lt;E1&gt; &amp;lhs, <span class="type">const</span> ET::Expression&lt;E2&gt; &amp;rhs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ET::<span class="built_in">BinaryExpression</span>&lt;POW, E1, E2&gt;(lhs.<span class="built_in">self</span>(), rhs.<span class="built_in">self</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ==============================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// user-define vector</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">class</span> <span class="title class_">Container</span> = std::vector&lt;T&gt;&gt;</span><br><span class="line"><span class="keyword">struct</span> Vec</span><br><span class="line">    : Container</span><br><span class="line">    , ET::VectorExpression&lt;Vec&lt;T, Container&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">using</span> Container::Container;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> Exp&gt;</span><br><span class="line">    Vec &amp;<span class="keyword">operator</span>=(<span class="type">const</span> ET::Expression&lt;Exp&gt; &amp;exp) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">size_t</span> n = exp.<span class="built_in">selfSize</span>();</span><br><span class="line">        <span class="keyword">this</span>-&gt;<span class="built_in">resize</span>(n);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; n; ++i) <span class="keyword">this</span>-&gt;<span class="keyword">operator</span>[](i) = exp.<span class="built_in">evaluate</span>(i);</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ==============================</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Vec&lt;<span class="type">double</span>&gt; ans, <span class="built_in">a</span>(<span class="number">5</span>, <span class="number">1</span>), <span class="built_in">b</span>(<span class="number">5</span>, <span class="number">2</span>), <span class="built_in">c</span>(<span class="number">5</span>, <span class="number">8</span>), <span class="built_in">d</span>(<span class="number">5</span>, <span class="number">7</span>), <span class="built_in">e</span>(<span class="number">5</span>, <span class="number">0.4</span>);</span><br><span class="line"></span><br><span class="line">    ans = <span class="built_in">Pow</span>((a + b) * c / d + <span class="built_in">ETNum</span>&lt;<span class="type">double</span>&gt;(<span class="number">1</span>), e);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;&amp;x : ans) &#123;</span><br><span class="line">        std::cout &lt;&lt; x &lt;&lt; <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">        <span class="built_in">assert</span>(x == <span class="built_in">pow</span>(((<span class="number">1</span> + <span class="number">2</span>) * <span class="number">8</span> / <span class="number">7.0</span> + <span class="number">1</span>), <span class="number">0.4</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Conclusion-and-Prospect"><a href="#Conclusion-and-Prospect" class="headerlink" title="Conclusion and Prospect"></a>Conclusion and Prospect</h1><p>ä¸€ä¸ªåŸºæœ¬å¯ç”¨çš„è¡¨è¾¾å¼æ¨¡æ¿åº“è¯ç”Ÿäº†ã€‚ä½†æ˜¯è¦è®°ä½ï¼š</p>
<ol>
<li>è¡¨è¾¾å¼æ¨¡æ¿ç¦»å¼€äº†å†…è”ä¼˜åŒ–å°±æ˜¯è´Ÿä¼˜åŒ–ã€‚ç»è¿‡ç®€å•æµ‹è¯•ï¼Œgcc è‡³å°‘è¦åœ¨ <code>-O1</code> æ¡ä»¶ä¸‹æ‰æœ‰å†…è”æˆå‘˜å‡½æ•°çš„èƒ½åŠ›ã€‚</li>
<li>ä½¿ç”¨è¡¨è¾¾å¼æ¨¡æ¿å’Œå…¶ä»–ä¼˜åŒ–æ‰‹æ®µå¹¶ä¸å†²çªï¼Œå¯ä»¥åœ¨è‡ªå®šä¹‰ <code>operator=</code> å¤„åš SIMDï¼Œå¾ªç¯å±•å¼€ç­‰ç­‰ã€‚</li>
</ol>
<p>æˆ‘ä¸å¾—ä¸æ‰¿è®¤è¿™ä»½ä»£ç å¯¹æ¯”åŸºç¡€åº“çš„æ°´å‡†è¿˜æ˜¯å·®äº†å¾ˆå¤šï¼Œè‡³å°‘æœ‰ä»¥ä¸‹æ–¹é¢å¯ä»¥æ”¹è¿›ï¼š</p>
<ul>
<li>more type traitï¼Œæè¿°è¡¨è¾¾å¼çš„å¯åŠ æ€§ã€å¯ä¹˜æ€§ã€å¯è¢«é™¤å’Œå¯é™¤æ€§ç­‰ç­‰ã€‚</li>
<li>è¿›ä¸€æ­¥ç®€åŒ–ç”¨æˆ·è‡ªå®šä¹‰è¿ç®—ç¬¦çš„ä»£ç ã€‚</li>
<li>å®ç°ä¸€å…ƒè¿ç®—ç¬¦ã€‚</li>
<li>åœ¨çŸ¢é‡å’Œæ ‡é‡çš„æ··åˆè¿ç®—ä¸­æŠ¹å»æ˜¾å¼æ„é€ æ ‡é‡ã€‚</li>
</ul>
<p>ä½†æ¨¡æ¿å…ƒç¼–ç¨‹æš‚æ—¶ä¸æ˜¯æˆ‘çš„ä¸»è¦å­¦ä¹ æ–¹å‘ï¼Œæ‰€ä»¥è¿˜æ˜¯å†ç­‰ç­‰å§~</p>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><a href="https://en.wikipedia.org/wiki/Expression_templates">Expression templates - Wikipedia</a></li>
<li><a href="https://en.wikibooks.org/wiki/More_C%2B%2B_Idioms/Expression-template">More C++ Idioms&#x2F;Expression-template - Wikibooks</a></li>
<li><a href="https://en.cppreference.com/w/cpp/language/using_declaration">Using-declaration - cppreference.com</a></li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>Coroutine Tutorial: Generators</title>
    <url>/2022/02/22/Generators-with-Coroutine/</url>
    <content><![CDATA[<h1 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h1><p>è¦æŒæ¡ C++20 åç¨‹ï¼Œä»…ä»…çœ‹å®Œæ–‡æ¡£æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚C++ å’Œå…¶ä»–è¯­è¨€çš„åç¨‹çš„æœ€å¤§ä¸åŒç‚¹åœ¨äºï¼ŒC++ æä¾›äº†æœ€å°‘é‡çš„ç¼–è¯‘å™¨å®ç°å’Œæå¤§é‡çš„ã€Œå¯å®šåˆ¶ç‚¹ã€ï¼Œè€Œå…¶ä»–è¯­è¨€å¯èƒ½è¿ã€Œè°ƒåº¦å™¨ã€éƒ½ç»™ç”¨æˆ·å‡†å¤‡å¥½äº†ã€‚</p>
<p>åœ¨èŒ«èŒ«å¤šçš„å¯å®šåˆ¶ç‚¹é¢å‰ï¼Œå¦‚æœä½ èƒ½ä¸€çœ¼çœ‹å‡ºã€Œä¸ºä»€ä¹ˆ C++ è¦è¿™æ ·è®¾è®¡ã€ï¼Œé‚£ä¹ˆæˆ‘æ„¿ç§°ä½ ä¸ºå¤©æ‰ã€‚å¦åˆ™ï¼Œè¿˜æ˜¯ä»å¸¸è§çš„èŒƒå¼ä¸‹æ‰‹ï¼Œé€æ¸ä½“ä¼šè®¾è®¡è€…çš„æ€æƒ³å§ã€‚</p>
<p>æˆ‘ä»¬å°†ä»æœ€ç®€å•çš„èŒƒå¼â€”â€”Generator ä¸‹æ‰‹ã€‚</p>
<span id="more"></span>

<p><small>æœ¬æ–‡åŠ›æ±‚æ¦‚å¿µå®šä¹‰çš„æƒå¨æ€§ï¼Œä½†æ— æ³•åšä»»ä½•ä¿è¯ã€‚</small></p>
<h1 id="What-is-Generator"><a href="#What-is-Generator" class="headerlink" title="What is Generator"></a>What is Generator</h1><p>Generator æ³›æŒ‡ä¸€æ®µåºåˆ—ï¼ˆæœ‰é™æˆ–æ— é™é•¿ï¼‰çš„ç”Ÿæˆå™¨ã€‚åœ¨åç¨‹çš„è¯­å¢ƒä¸‹ï¼ŒGenerator ç‰¹æŒ‡ä¸€ä¸ª<strong>æ‡’æƒ°</strong>çš„åç¨‹ï¼Œå®ƒæ¯æ¬¡è¿è¡Œæ—¶ä¼šåœ¨è°ƒç”¨è€…çº¿ç¨‹<strong>åŒæ­¥</strong>åœ°è®¡ç®—ä¸€ä¸ªå€¼ï¼Œç„¶åæš‚åœè‡ªå·±ï¼ŒåŒæ—¶æŠŠå€¼è¿”å›ç»™è°ƒç”¨è€…ã€‚</p>
<div class="note info"><p>å› ä¸º Generator åœ¨æ˜¯åœ¨è°ƒç”¨è€…çº¿ç¨‹ä¸‹ç«‹å³åŒæ­¥æ‰§è¡Œçš„ï¼Œæ‰€ä»¥å®ƒä¸éœ€è¦ä»»ä½•è°ƒåº¦å™¨ã€‚</p>
</div>

<p>Fibonacci æ•°åˆ—å°±æ˜¯ Generator çš„ hello-worldã€‚æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹æ•ˆæœï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">Generator&lt;<span class="type">int</span>&gt; <span class="title">fibonacci</span><span class="params">(<span class="type">int</span> a0, <span class="type">int</span> a1)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">co_yield</span> a0;</span><br><span class="line">    <span class="keyword">co_yield</span> a1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> a2; <span class="literal">true</span>;) &#123;</span><br><span class="line">        a2 = a0 + a1;</span><br><span class="line">        a0 = a1;</span><br><span class="line">        a1 = a2;</span><br><span class="line">        <span class="keyword">co_yield</span> a2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> len=<span class="number">10</span>; <span class="type">int</span> i : <span class="built_in">fibonacci</span>(<span class="number">1</span>, <span class="number">1</span>)) &#123;</span><br><span class="line">        std::cout &lt;&lt; i &lt;&lt; std::endl;</span><br><span class="line">        <span class="keyword">if</span> (--len == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¦å®ç°è¿™ä¸ªæ•ˆæœï¼Œåªè¦å®ç° <code>Generator&lt;T&gt;</code><del>ï¼Œè™½ç„¶å¾ˆéº»çƒ¦</del>ã€‚</p>
<h1 id="Why-Generator"><a href="#Why-Generator" class="headerlink" title="Why Generator"></a>Why Generator</h1><p>ä¸Šä¸€æ®µä¾‹å­å¾ˆæ„šè ¢ï¼Œæˆ‘éšæ‰‹å†™ä¸€ä¸ª <code>struct Fibo</code> é‡è½½ <code>operator()</code>ï¼Œå†…ç½®ä¸€ä¸ªè¿­ä»£å™¨ä¸é¦™ï¼Ÿä¸ºä»€ä¹ˆè¦å¤§è´¹å‘¨ç« å®ç° Generatorï¼Œè¿˜è¦ä»˜å‡ºåç¨‹çš„è¿è¡Œæ—¶ä»£ä»·ï¼Ÿ</p>
<p><del>æˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œçº¯çº¯ä¸ºäº†å­¦è€Œå­¦</del> Generator å¯ä»¥å…å»ä½ æ¯æ¬¡é‡æ–°è®¾è®¡ç»“æ„ä½“çš„éº»çƒ¦ï¼Œæ— éœ€ä½ é‡å†™å„ç§è¿­ä»£å™¨ï¼Œå¯ä»¥çœ‹ä½œä¸€ä¸ªåˆé¦™åˆè‡­çš„è¯­æ³•ç³–ã€‚æ›´è¿›ä¸€æ­¥ï¼ŒGenerator å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç›¸äº’åµŒå¥—ï¼Œç›¸æ¯”å…¶ä»–åšæ³•å¤§å¤§é™ä½äº†ç¼–ç¨‹å¤æ‚åº¦ã€‚</p>
<h1 id="Analyze-How-to"><a href="#Analyze-How-to" class="headerlink" title="Analyze How-to"></a>Analyze How-to</h1><p>å¸Œæœ›ä½ å·²ç»å¤§è‡´äº†è§£ C++ Coroutine çš„è¿ä½œæ–¹å¼ï¼Œè‡³å°‘äº†è§£ <code>co_await</code> å…³é”®å­—çš„ä½œç”¨ã€‚é¡ºä¾¿æ¨é”€ä¸€ä¸‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç«  <a href="/2021/11/18/C-20-Coroutine/">C++20 Coroutine</a>ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ è®°ä½ <code>co_await</code>ã€‚</p>
<p>ç°åœ¨æŒ‰ç…§åç¨‹çš„ç”Ÿå‘½å‘¨æœŸæ¥åˆ†æ <code>Generator&lt;T&gt;</code>ï¼Œçœ‹çœ‹å®ƒåº”è¯¥å…·æœ‰å“ªäº›æ¥å£å’Œè¡Œä¸ºã€‚</p>
<h2 id="get-return-object"><a href="#get-return-object" class="headerlink" title="get_return_object"></a>get_return_object</h2><p>åç¨‹åœ¨åˆæ¬¡è¿›å…¥çš„æ—¶å€™ä¼šè°ƒç”¨ <code>promise.get_return_object()</code>ï¼Œå…¶è¿”å›å€¼ä¼šåœ¨ç¬¬ä¸€æ¬¡æš‚åœçš„æ—¶å€™è¿”å›ç»™ callerã€‚caller è¦å‘åç¨‹ç´¢å–è¿”å›å€¼ï¼Œé€šå¸¸åªèƒ½é€šè¿‡è¿™ä¸ª<code>return_object</code> å»è¦ï¼Œæ‰€ä»¥å®ƒç›¸å½“äºä¸€ä¸ª handlerã€‚</p>
<p>æŒ‰ç…§ C++ æ ‡å‡†è§„å®š <code>promise.get_return_object()</code> çš„è¿”å›å€¼å¿…é¡»æ˜¯åç¨‹ç±»å‹ï¼Œä¹Ÿå°±æ˜¯ <code>Generator&lt;T&gt;</code>ï¼Œä¹Ÿå¥½ï¼Œçœå¾—æˆ‘ä»¬æ€è€ƒäº†ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Generator</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">promise_type</span> &#123;</span><br><span class="line">      <span class="keyword">public</span>:</span><br><span class="line">        <span class="function">Generator <span class="title">get_return_object</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Generator&#123;&lt;unspecified&gt;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="inital-suspend"><a href="#inital-suspend" class="headerlink" title="inital_suspend"></a>inital_suspend</h2><p>åç¨‹åœ¨åˆæ¬¡è¿›å…¥çš„æ—¶å€™ï¼ˆä¸”åœ¨ä¸Šä¸€æ­¥ä¹‹åï¼‰ä¼šè°ƒç”¨ <code>co_await promise.inital_suspend()</code>ã€‚æˆ‘ä»¬å¸Œæœ›çš„æ˜¯åç¨‹ä¸è¦åšä»»ä½•è®¡ç®—ï¼ˆæ‡’æƒ°ï¼‰ï¼Œå¹¶ä¸”ç›´æ¥è®©å‡ºæ‰§è¡Œæƒç»™ callerã€‚æ‰€ä»¥æœ‰å¦‚ä¸‹è®¾è®¡ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Generator</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">promise_type</span> &#123;</span><br><span class="line">      <span class="keyword">public</span>:</span><br><span class="line">        <span class="function">Generator <span class="title">get_return_object</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Generator&#123;&lt;unspecified&gt;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">std::suspend_always <span class="title">initial_suspend</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>åˆ«å»æ‰¾ <code>std::suspend_always</code> çš„å®ç°äº†ï¼Œæˆ‘å·²ç»ç»™ä½ å‡†å¤‡å¥½äº†ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">suspend_always</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">constexpr</span> <span class="type">bool</span> <span class="title">await_ready</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">constexpr</span> <span class="type">void</span> <span class="title">await_suspend</span><span class="params">(coroutine_handle&lt;&gt;)</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">constexpr</span> <span class="type">void</span> <span class="title">await_resume</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">suspend_never</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">constexpr</span> <span class="type">bool</span> <span class="title">await_ready</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> <span class="literal">true</span>; &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">constexpr</span> <span class="type">void</span> <span class="title">await_suspend</span><span class="params">(coroutine_handle&lt;&gt;)</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">constexpr</span> <span class="type">void</span> <span class="title">await_resume</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡ºï¼Œ<code>std::suspend_always</code> åœ¨è¢« <code>co_await</code> çš„æ—¶å€™æ€»æ˜¯ä¼šè®©å‡ºæ‰§è¡Œæƒç»™ caller&#x2F;resumerï¼Œè€Œä¸”<strong>ä¸åšä»»ä½•è°ƒåº¦</strong>ã€‚å¦‚æœ caller&#x2F;resumer æœªæ¥ä¸å°†è¿™ä¸ªåç¨‹åŠ å…¥è°ƒåº¦ï¼Œé‚£å®ƒå°±<strong>è¢«æ°¸è¿œé—å¿˜</strong>åœ¨å †å†…å­˜ä¸­äº†ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œå¯ä»¥å‘ç° <code>co_await std::suspend_always&#123;&#125;</code> çš„è¿”å›å€¼æ€»æ˜¯ <code>void</code>ã€‚</p>
<h2 id="caller-resume"><a href="#caller-resume" class="headerlink" title="caller resume"></a>caller resume</h2><p>ç›®å‰ä¸ºæ­¢ï¼Œä¸€ä¸ªåç¨‹å·²ç»æ„é€ å¥½äº†ï¼Œè€Œä¸”å·²ç»æš‚åœäº†ã€‚ç”¨æˆ·ç¨‹åºå¤§æ¦‚é•¿è¿™ä¸ªæ ·å­ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">Generator&lt;<span class="type">int</span>&gt; <span class="title">fibonacci</span><span class="params">(<span class="type">int</span> a0, <span class="type">int</span> a1)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Generator&lt;<span class="type">int</span>&gt; fibo = <span class="built_in">fibonacci</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// è¿è¡Œæ—¶ï¼Œå› ä¸º co_await initial_suspend() è€Œè·³å‡ºåç¨‹ï¼Œæ‰§è¡Œåˆ°è¿™é‡Œ</span></span><br><span class="line">    <span class="comment">// fibo å°±æ˜¯æˆ‘ä»¬è¦ç”¨çš„ handler</span></span><br><span class="line">    <span class="comment">// è¦å†å…¥åç¨‹ã€è·å–è¿”å›å€¼ã€é”€æ¯åç¨‹ç­‰ç­‰éƒ½è¦é  fibo</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶ï¼Œæˆ‘ä»¬æƒ³åšä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>resume ä¸€ä¸‹ <code>fibo</code>ï¼Œä»è€Œè®¡ç®—å‡ºç¬¬ä¸€ä¸ªå€¼</li>
<li>é€šè¿‡ <code>fibo</code> æ‹¿åˆ°ç¬¬ä¸€ä¸ªå€¼</li>
</ol>
<p>æ ¹æ® C++ æ ‡å‡†ï¼Œè¦æ¢å¤ä¸€ä¸ªåç¨‹ï¼Œå¿…é¡»æŒæœ‰å¯¹åº”çš„ <code>std::coroutine_handle</code>ï¼Œæ¢å¥è¯è¯´ <code>fibo</code> å¿…é¡»æŒæœ‰ <code>std::coroutine_handle</code>ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Generator</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">promise_type</span> &#123; <span class="comment">/*...*/</span> &#125;;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    std::coroutine_handle&lt;promise_type&gt; m_handle;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>é‚£ Generator æ˜¯ç”±è°åˆå§‹åŒ–çš„å‘¢ï¼Ÿåˆ«å¿˜äº†ï¼Œåˆå§‹åŒ–çš„äº‹æ˜¯ç”± <code>promise.get_return_object()</code> å¹²çš„ã€‚</p>
<p>é—®é¢˜åˆæ¥äº†ï¼Œå¦‚ä½•åœ¨ <code>promise.get_return_object()</code> åˆå§‹åŒ– <code>std::coroutine_handle</code>ï¼Ÿ</p>
<p>æˆ‘ä»¬è¦è®¤è¯†åˆ°ä»¥ä¸‹äº‹å®ï¼š</p>
<div class="note info"><p>&amp;promise å’Œ coroutine_handle ä¸€ä¸€å¯¹åº”ï¼Œå®ƒä»¬çš„åç§»é‡æ˜¯ç¼–è¯‘æœŸå·²çŸ¥çš„ï¼Œå¯ä»¥äº’ç›¸æ¢ç®—ã€‚</p>
</div>

<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥æ ¹æ® <code>promise</code> çš„åœ°å€ç®—å‡ºåç¨‹çš„ <code>std::coroutine_handle</code>ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥ç”¨ <code>std::coroutine_handle</code> æ¢ç®—å‡º <code>promise</code> çš„åœ°å€ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Generator</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">promise_type</span> &#123;</span><br><span class="line">      <span class="keyword">public</span>:</span><br><span class="line">        <span class="function">Generator <span class="title">get_return_object</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Generator&#123;</span><br><span class="line">                std::coroutine_handle&lt;promise_type&gt;::<span class="built_in">from_promise</span>(*<span class="keyword">this</span>)</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">Generator</span>(std::coroutine_handle&lt;promise_type&gt; handle) <span class="keyword">noexcept</span></span><br><span class="line">        : <span class="built_in">m_handle</span>(handle) &#123;&#125;</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    std::coroutine_handle&lt;promise_type&gt; m_handle;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<div class="note info"><p><code>std::coroutine_handle</code> çš„æœ¬è´¨æ˜¯æŒ‡å‘åç¨‹å¸§çš„æŒ‡é’ˆï¼Œé€šå¸¸æŒ‰å€¼ä¼ é€’ã€‚</p>
</div>

<p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä»»æ„ç»™ Generator åŠ æˆå‘˜æ–¹æ³•ï¼Œè®©å®ƒåˆ©ç”¨ <code>m_handle</code> åšä»»ä½•äº‹æƒ…ï¼Œæ¯”å¦‚åˆ©ç”¨ <code>fibo.m_handle.resume()</code> æ¢å¤åç¨‹ï¼Œè¿›è¡Œä¸€æ¬¡è®¡ç®—ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Generator</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">promise_type</span> &#123; <span class="comment">/*...*/</span> &#125;;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">next</span><span class="params">()</span> </span>&#123; m_handle.<span class="built_in">resume</span>(); &#125; <span class="comment">// è®¡ç®—ä¸‹ä¸€ä¸ªå€¼</span></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    std::coroutine_handle&lt;promise_type&gt; m_handle;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="co-yield"><a href="#co-yield" class="headerlink" title="co_yield"></a>co_yield</h2><p>ç°åœ¨ï¼Œç”¨æˆ·è°ƒç”¨äº† <code>fibo.next()</code>ï¼Œåç¨‹è¢«æ¢å¤æ‰§è¡Œã€‚ç°åœ¨æˆ‘ä»¬æƒ³è¿”å›ç¬¬ä¸€ä¸ªå€¼ç»™ç”¨æˆ·ï¼Œæ„å‘³ç€å¿…é¡»æš‚åœåç¨‹ï¼Œå½’è¿˜æ‰§è¡Œæƒã€‚C++ ç»™æˆ‘ä»¬æä¾›äº†å…³é”®å­— <code>co_yield</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œ<code>co_yield expr</code> ç­‰ä»·äº <code>co_await promise.yield_value(expr)</code>ã€‚</p>
<p>æ‰€ä»¥åœ¨ <code>promise.yield_value(expr)</code> é‡Œé¢ï¼Œæˆ‘ä»¬è¦åšä¸¤ä»¶äº‹ï¼š</p>
<ol>
<li>å°† <code>expr</code> ä¿å­˜åœ¨ <code>promise</code> é‡Œé¢ï¼Œä¾¿äºå¤–éƒ¨è®¿é—®ã€‚</li>
<li>è¿”å›ä¸€ä¸ª <code>std::suspend_always&#123;&#125;</code>ï¼Œä»¤ caller é‡è·æ‰§è¡Œæƒã€‚</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Generator</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">promise_type</span> &#123;</span><br><span class="line">      <span class="keyword">public</span>:</span><br><span class="line">        <span class="function"><span class="type">const</span> T &amp;<span class="title">result</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> m_value; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">std::suspend_always <span class="title">yield_value</span><span class="params">(T value)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">            m_value = value;</span><br><span class="line">            <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span>:</span><br><span class="line">        T m_value;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">const</span> T &amp;<span class="title">result</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> m_handle.<span class="built_in">promise</span>().<span class="built_in">result</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">next</span><span class="params">()</span> </span>&#123; m_handle.<span class="built_in">resume</span>(); &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    std::coroutine_handle&lt;promise_type&gt; m_handle;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<div class="note info"><p><code>std::coroutine_handle&lt;Promise&gt;::promise()</code> å¯ä»¥æ‹¿åˆ°å¯¹åº”çš„ promise å¯¹è±¡ï¼Œä»è€Œæ‹¿åˆ°è®¡ç®—ç»“æœã€‚ä½†è¯·ç‰¹åˆ«å°å¿ƒåç¨‹å¯èƒ½å·²ç»è¢«é”€æ¯ï¼</p>
</div>

<div class="note warning"><p>ä»å®¹å™¨çš„è§’åº¦çœ‹ï¼Œ<code>T m_value</code> æ˜¯ä¸€ä¸ªå¾ˆçƒ‚çš„è®¾è®¡ï¼Œä»…ä¾›ç¤ºæ„ï¼Œè¯·å‹¿æ¨¡ä»¿ï¼</p>
</div>

<h2 id="Finish-the-leftover"><a href="#Finish-the-leftover" class="headerlink" title="Finish the leftover"></a>Finish the leftover</h2><p>ç°åœ¨ï¼ŒGenerator å·²ç»å…·å¤‡æˆ‘ä»¬æ‰€éœ€çš„å…¨éƒ¨åŠŸèƒ½ï¼Œä½†è¿˜æœ‰ä¸€äº›æ‰‹ç»­è¦åŠï¼š</p>
<ol>
<li>å¼‚å¸¸å¤„ç†</li>
<li>å®šä¹‰ <code>co_return</code> çš„è¡Œä¸º</li>
</ol>
<h3 id="uncaught-exception-handler"><a href="#uncaught-exception-handler" class="headerlink" title="uncaught exception handler"></a>uncaught exception handler</h3><p>åç¨‹è¿è¡Œæ—¶æ²¡æœ‰è¢«æ˜¾å¼ catch çš„å¼‚å¸¸ä¼šå¯¼è‡´ç«‹å³è°ƒç”¨ <code>promise.unhandled_exception()</code>ï¼Œç´§æ¥ç€è°ƒç”¨ <code>co_await promise.final_suspend()</code>ã€‚</p>
<p>ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å…ˆä¸å¤„ç†å¼‚å¸¸ï¼Œç•™ä¸‹ä¸€ä¸ªç©ºå‡½æ•°å°±è¡Œã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">promise_type</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">unhandled_exception</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>

<h3 id="define-co-return"><a href="#define-co-return" class="headerlink" title="define co_return"></a>define <code>co_return</code></h3><p>åç¨‹å¯ä»¥æ˜¾å¼ <code>co_return [expr]</code>ï¼Œæˆ–è€…å› ä¸ºæ‰§è¡Œå®Œå‡½æ•°ä½“è€Œéšå¼ <code>co_return</code>ã€‚</p>
<p>æˆ‘ä»¬çš„ fibonacci ä¸éœ€è¦ <code>co_return</code> ä»»ä½•ä¸œè¥¿ï¼Œä½†æ˜¯ä½œä¸ºä¸€ç¯‡è´Ÿè´£ä»»çš„æ•™ç¨‹ï¼Œæˆ‘è¿˜æ˜¯ä¼šå‘Šè¯‰ä½ ï¼š</p>
<div class="note info"><p><code>co_return expr;</code> ä¼šè°ƒç”¨ <code>promise.return_value(expr)</code>ï¼Œéšåææ„åç¨‹å†…çš„è‡ªåŠ¨å˜é‡ï¼Œä½† promise å’Œåç¨‹å‚æ•°ä»ç„¶å­˜æ´»ã€‚</p>
<p>ç±»ä¼¼åœ° <code>co_return;</code> æˆ–è€… <code>co_return (void)expr;</code> ä¼šè°ƒç”¨ <code>promise.return_void()</code>ã€‚</p>
</div>

<div class="note warning"><p><code>return_value(expr)</code> å’Œ <code>return_void()</code> æ˜¯æˆ‘ä»¬è®¿é—®åç¨‹å†…è‡ªåŠ¨å˜é‡çš„æœ€åæœºä¼šã€‚ä½†æ˜¯ promise å’Œåç¨‹å‚æ•°ä»ä¼šå­˜æ´»ã€‚</p>
</div>

<p><code>return_xxx()</code> å’Œ è‡ªåŠ¨å˜é‡ææ„åï¼Œåç¨‹æ‰§è¡Œ <code>co_await promise.final_suspend()</code>ï¼Œè‹¥åç¨‹<strong>ä¸æš‚åœ</strong>ï¼Œåˆ™åç¨‹å¸§ææ„ï¼š</p>
<ol>
<li>ææ„ <code>promise</code></li>
<li>ææ„åç¨‹å‚æ•°</li>
<li>é‡Šæ”¾å †ç©ºé—´</li>
<li>è½¬ç§»æ‰§è¡Œæƒ</li>
</ol>
<p>è‹¥åç¨‹æš‚åœï¼Œå°±<strong>åªèƒ½</strong>é€šè¿‡ <code>std::coroutine_handle::destroy()</code> æ¥æ˜¾å¼ææ„ï¼Œæ— è®ºæ˜¯å¦å·²ç»ææ„éƒ½<strong>ä¸èƒ½å† resume</strong>ã€‚</p>
<p>å…³äºåç¨‹çš„å„ç±»å…ƒç´ çš„ç”Ÿå‘½å‘¨æœŸï¼Œæ˜¯ä¸€å¤§å‘ç‚¹ï¼Œæœªæ¥æˆ‘ä¼šæ’°å†™ä¸€ç¯‡æ–‡ç« æ¥è¡¨è¿°ã€‚</p>
<p>è¨€å½’æ­£ä¼ ï¼Œæˆ‘ä»¬åªè¦éšä¾¿å†™ä¸€ä¸ª final_suspend() å°±å¥½ï¼Œåæ­£è¿™ä¸ª Generator æ°¸è¿œä¸ä¼š <code>co_return</code>ã€‚</p>
<h2 id="Demo-fibonacci"><a href="#Demo-fibonacci" class="headerlink" title="Demo: fibonacci"></a>Demo: fibonacci</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;coroutine&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Generator</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">promise_type</span> &#123;</span><br><span class="line">      <span class="keyword">public</span>:</span><br><span class="line">        <span class="function">Generator <span class="title">get_return_object</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Generator&#123;</span><br><span class="line">                std::coroutine_handle&lt;promise_type&gt;::<span class="built_in">from_promise</span>(*<span class="keyword">this</span>)&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">return_void</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">std::suspend_always <span class="title">initial_suspend</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">std::suspend_always <span class="title">final_suspend</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">const</span> T &amp;<span class="title">result</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> m_value; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">std::suspend_always <span class="title">yield_value</span><span class="params">(T value)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">            m_value = value;</span><br><span class="line">            <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">unhandled_exception</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">        ~<span class="built_in">promise_type</span>() &#123; std::cout &lt;&lt; <span class="string">&quot;~promise_type\n&quot;</span>; &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span>:</span><br><span class="line">        T m_value;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">const</span> T &amp;<span class="title">result</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> m_handle.<span class="built_in">promise</span>().<span class="built_in">result</span>(); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Generator</span>() <span class="keyword">noexcept</span> : <span class="built_in">m_handle</span>(<span class="literal">nullptr</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Generator</span>(std::coroutine_handle&lt;promise_type&gt; handle) <span class="keyword">noexcept</span></span><br><span class="line">        : <span class="built_in">m_handle</span>(handle) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">Generator</span>() &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;~Generator\n&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (m_handle) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;m_handle.destroy()\n&quot;</span>;</span><br><span class="line">            m_handle.<span class="built_in">destroy</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">next</span><span class="params">()</span> </span>&#123; m_handle.<span class="built_in">resume</span>(); &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    std::coroutine_handle&lt;promise_type&gt; m_handle;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO begin() end() operator*</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">Generator&lt;<span class="type">int</span>&gt; <span class="title">fibo</span><span class="params">(<span class="type">int</span> a0, <span class="type">int</span> a1)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">co_yield</span> a0;</span><br><span class="line">    <span class="keyword">co_yield</span> a1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> a2; <span class="literal">true</span>;) &#123;</span><br><span class="line">        a2 = a0 + a1;</span><br><span class="line">        a0 = a1;</span><br><span class="line">        a1 = a2;</span><br><span class="line">        <span class="keyword">co_yield</span> a2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">    <span class="keyword">auto</span> fi = <span class="built_in">fibo</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        fi.<span class="built_in">next</span>();</span><br><span class="line">        cout &lt;&lt; fi.<span class="built_in">result</span>() &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Output:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">5</span><br><span class="line">8</span><br><span class="line">13</span><br><span class="line">21</span><br><span class="line">34</span><br><span class="line">55</span><br><span class="line">~Generator</span><br><span class="line">m_handle.destroy()</span><br><span class="line">~promise_type</span><br></pre></td></tr></table></figure>

<h1 id="Conclusion-and-Prospect"><a href="#Conclusion-and-Prospect" class="headerlink" title="Conclusion and Prospect"></a>Conclusion and Prospect</h1><p>æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªåŸºæœ¬èƒ½ç”¨çš„ Generatorï¼Œå› ä¸ºæ˜¯å…¥é—¨æ•™ç¨‹ï¼Œä»£ç æ•…æ„å†™å¾—å¾ˆç³™ï¼Œèªæ˜çš„ä½ ä¸€å®šçŸ¥é“å¦‚ä½•æ”¹è¿›ã€‚</p>
<p>å¦‚æœä½ æƒ³è‡ªå·±é€ ä¸€ä¸ª Generatorï¼Œé‚£ä¹ˆè¿˜éœ€è¦æ”¹è¿›çš„åœ°æ–¹è‡³å°‘æœ‰ï¼š</p>
<ol>
<li><code>promise_type</code> å†…ç½®ä¸€ä¸ªæ›´é«˜æ•ˆã€å®‰å…¨çš„å®¹å™¨</li>
<li><code>Generator&lt;T&gt;</code> å†…ç½®ä¸€ä¸ªè¿­ä»£å™¨ç±»ï¼Œä»¥æ”¯æŒ range for å¾ªç¯ã€‚</li>
<li>å¦‚æœä½ å¾ˆç†Ÿæ‚‰ç”Ÿå‘½å‘¨æœŸçš„å‘ç‚¹ï¼Œ<code>promise_type</code> å†…ç½®çš„å®¹å™¨å¯ä»¥ä»…å­˜æ”¾æŒ‡å‘åç¨‹è‡ªåŠ¨å˜é‡çš„æŒ‡é’ˆï¼Œè¿›ä¸€æ­¥å‹ç¼©ç©ºé—´ï¼Œæå‡ <code>yield</code> æ•ˆç‡ã€‚</li>
<li>åˆ©ç”¨ execution æ¥å®ç°å¼‚æ­¥ç‰ˆæœ¬çš„ Generatorã€‚</li>
<li>æ€è€ƒé€’å½’ <code>yield</code> çš„æ•ˆç‡é—®é¢˜ï¼Œä»¥åŠå¦‚ä½•æ”¹è¿›ï¼ˆéš¾ä½†ç§€ï¼‰ã€‚</li>
</ol>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><a href="/2021/11/18/C-20-Coroutine/">C++20 Coroutine - ç­‰ç–¾é£</a></li>
<li><a href="https://en.cppreference.com/w/cpp/language/coroutines">Coroutine (C++20) - cppreference</a></li>
<li><a href="https://github.com/lewissbaker/cppcoro">cppcoro - lewissbaker</a></li>
<li><a href="https://www.bilibili.com/video/BV1z5411Z7K5">åç¨‹ä¸Šæ‰‹ç»å…¸æ¡ˆä¾‹ï¼šå®ç°ä¸€ä¸ªåºåˆ—ç”Ÿæˆå™¨ - Benny Huo</a></li>
</ul>
<h1 id="Some-Slight-Improvements"><a href="#Some-Slight-Improvements" class="headerlink" title="Some Slight Improvements"></a>Some Slight Improvements</h1><ol>
<li>ä½¿ç”¨ <code>std::optional</code> æ¥åšå®¹å™¨ï¼Œè‡ªåŠ¨è°ƒç”¨æ­£ç¡®çš„æ„é€ &#x2F;ææ„å‡½æ•°ï¼Œæ”¯æŒç§»åŠ¨è¯­ä¹‰ã€‚(å¯ä»¥è¿›ä¸€æ­¥æ”¹ç”¨ <code>std::variant</code>)ã€‚</li>
<li>å®šä¹‰äº† Generator çš„å‡ ä¸ªæ„é€ å’Œèµ‹å€¼å‡½æ•°ï¼Œå¢å¼ºäº†å®‰å…¨æ€§(safety)ã€‚</li>
<li>åœ¨ <code>unhandled_exception()</code> å†…å­˜æ”¾äº† <code>std::exception_ptr</code>ã€‚</li>
<li>ç”¨ä¾‹æ”¹ä¸ºç¨å¾®å¤æ‚ä¸€äº›çš„å­—ç¬¦ä¸²ç”Ÿæˆï¼Œé‡Œé¢æœ‰ä¸€äº›æ€§èƒ½é—®é¢˜ï¼Œè¯»è€…æœ‰å…´è¶£çš„å¯ä»¥æ‰¾æ‰¾èŒ¬ã€‚</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;optional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;coroutine&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;exception&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;random&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ Generator::promise_type  æˆä¸ºä¸€ä¸ªæ›´å®‰å…¨é«˜æ•ˆçš„å•å…ƒç´ å®¹å™¨</span></span><br><span class="line"><span class="comment">// é™åˆ¶äº† Generator çš„æ‰€æœ‰æƒï¼Œåˆ é™¤äº†é»˜è®¤æ„é€ ï¼Œæ‹·è´æ„é€ å’Œæ‹·è´èµ‹å€¼</span></span><br><span class="line"><span class="comment">// Generator ä¿è¯åœ¨æ„é€ åæŒæœ‰</span></span><br><span class="line"><span class="comment">// coroutine_handleï¼Œä½†å¯èƒ½è¢«ç§»åŠ¨èµ°ï¼Œæ‰€ä»¥ææ„æ—¶è¦æ£€æŸ¥éç©º</span></span><br><span class="line"><span class="comment">// TODO è¿­ä»£å™¨ï¼Œå¼‚å¸¸ä¼ æ’­</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Generator</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">promise_type</span> &#123;</span><br><span class="line">      <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">promise_type</span>() <span class="keyword">noexcept</span> = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function">Generator <span class="title">get_return_object</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Generator&#123;</span><br><span class="line">                std::coroutine_handle&lt;promise_type&gt;::<span class="built_in">from_promise</span>(*<span class="keyword">this</span>)&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">return_void</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">std::suspend_always <span class="title">initial_suspend</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line">        <span class="function">std::suspend_always <span class="title">final_suspend</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> &#123;&#125;; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">const</span> T &amp;<span class="title">result</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> *m_value; &#125;</span><br><span class="line">        <span class="function">T &amp;<span class="title">result</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> *m_value; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">std::suspend_always <span class="title">yield_value</span><span class="params">(<span class="type">const</span> T &amp;value)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">            m_value = value;</span><br><span class="line">            <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">std::suspend_always <span class="title">yield_value</span><span class="params">(T &amp;&amp;value)</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">            m_value.<span class="built_in">emplace</span>(std::<span class="built_in">move</span>(value));</span><br><span class="line">            <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="type">void</span> <span class="title">unhandled_exception</span><span class="params">()</span> </span>&#123; m_exception = std::<span class="built_in">current_exception</span>(); &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">private</span>:</span><br><span class="line">        std::optional&lt;T&gt; m_value;</span><br><span class="line">        std::exception_ptr m_exception;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">const</span> T &amp;<span class="title">result</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> m_handle.<span class="built_in">promise</span>().<span class="built_in">result</span>(); &#125;</span><br><span class="line">    <span class="function">T &amp;<span class="title">result</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123; <span class="keyword">return</span> m_handle.<span class="built_in">promise</span>().<span class="built_in">result</span>(); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Generator</span>() = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Generator</span>(std::coroutine_handle&lt;promise_type&gt; handle) <span class="keyword">noexcept</span></span><br><span class="line">        : <span class="built_in">m_handle</span>(handle) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Generator</span>(<span class="type">const</span> Generator &amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    Generator &amp;<span class="keyword">operator</span>=(<span class="type">const</span> Generator &amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    Generator &amp;<span class="keyword">operator</span>=(Generator &amp;&amp;other) <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> != other) &#123;</span><br><span class="line">            m_handle = other.m_handle;</span><br><span class="line">            other.m_handle = <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">Generator</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (m_handle) m_handle.<span class="built_in">destroy</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">next</span><span class="params">()</span> </span>&#123; m_handle.<span class="built_in">resume</span>(); &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    std::coroutine_handle&lt;promise_type&gt; m_handle;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO begin() end() operator* operator-&gt;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function">Generator&lt;std::string&gt; <span class="title">lottery</span><span class="params">(<span class="type">size_t</span> size, <span class="type">unsigned</span> <span class="type">int</span> mod)</span> </span>&#123;</span><br><span class="line">    <span class="function">std::mt19937 <span class="title">rng</span><span class="params">(time(<span class="literal">nullptr</span>))</span></span>;</span><br><span class="line">    std::string winningNumbers;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">size_t</span> numLen = std::<span class="built_in">to_string</span>(mod - <span class="number">1</span>).<span class="built_in">size</span>();</span><br><span class="line">        winningNumbers.<span class="built_in">reserve</span>(size * (numLen + <span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">co_yield</span> winningNumbers += std::<span class="built_in">to_string</span>(<span class="built_in">rng</span>() % mod);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">1</span>; i &lt; size; ++i) &#123;</span><br><span class="line">        winningNumbers += <span class="string">&quot; &quot;</span>;</span><br><span class="line">        <span class="keyword">co_yield</span> winningNumbers += std::<span class="built_in">to_string</span>(<span class="built_in">rng</span>() % mod);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">    <span class="keyword">auto</span> fi = <span class="built_in">lottery</span>(<span class="number">10</span>, <span class="number">256</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        fi.<span class="built_in">next</span>();</span><br><span class="line">        cout &lt;&lt; fi.<span class="built_in">result</span>() &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Output:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">253</span><br><span class="line">253 148</span><br><span class="line">253 148 56</span><br><span class="line">253 148 56 2</span><br><span class="line">253 148 56 2 179</span><br><span class="line">253 148 56 2 179 41</span><br><span class="line">253 148 56 2 179 41 96</span><br><span class="line">253 148 56 2 179 41 96 10</span><br><span class="line">253 148 56 2 179 41 96 10 125</span><br><span class="line">253 148 56 2 179 41 96 10 125 123</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>C++</tag>
        <tag>Concurrency</tag>
        <tag>C++åç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo &amp; NexT æ›´æ–°æ–¹å¼</title>
    <url>/2021/04/01/Hexo-NexT-%E6%9B%B4%E6%96%B0%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<h3 id="æ›´æ–°Hexo"><a href="#æ›´æ–°Hexo" class="headerlink" title="æ›´æ–°Hexo"></a>æ›´æ–°Hexo</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cnpm install -g cnpm                 <span class="comment"># å‡çº§ npm</span></span><br><span class="line">cnpm cache clean -f                 <span class="comment"># æ¸…é™¤ npm ç¼“å­˜</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ–° package.json ä¸­çš„ hexo åŠä¸ªæ’ä»¶ç‰ˆæœ¬</span></span><br><span class="line">cnpm install -g npm-check           <span class="comment"># æ£€æŸ¥ä¹‹å‰å®‰è£…çš„æ’ä»¶ï¼Œéƒ½æœ‰å“ªäº›æ˜¯å¯ä»¥å‡çº§çš„ </span></span><br><span class="line">cnpm install -g npm-upgrade         <span class="comment"># å‡çº§ç³»ç»Ÿä¸­çš„æ’ä»¶</span></span><br><span class="line">npm-check</span><br><span class="line">npm-upgrade</span><br><span class="line"></span><br><span class="line">cnpm update</span><br><span class="line"></span><br><span class="line">hexo -v</span><br></pre></td></tr></table></figure>

<h3 id="æ›´æ–°NexT"><a href="#æ›´æ–°NexT" class="headerlink" title="æ›´æ–°NexT"></a>æ›´æ–°NexT</h3><ol>
<li>é‡å‘½ååŸæœ‰çš„ä¸»é¢˜æ–‡ä»¶ï¼ˆå¤¹ï¼‰</li>
<li><code>npm install hexo-theme-next@latest</code></li>
<li>diffé…åˆè‚‰çœ¼æ›´æ–°é…ç½®</li>
<li>å‚è€ƒ<a href="https://theme-next.js.org/docs/getting-started/upgrade.html">å®˜æ–¹æ–‡æ¡£</a></li>
</ol>
]]></content>
      <tags>
        <tag>å‡å°‘è„±å‘æŒ‡å—</tag>
      </tags>
  </entry>
  <entry>
    <title>Intellisense and Copy elision</title>
    <url>/2022/04/04/Intellisense-and-Copy-elision/</url>
    <content><![CDATA[<p>æœ€è¿‘å¼€å‘ <code>co_context</code>ï¼Œé‡åˆ°äº†å¾ˆå¤š C++ å‘¨è¾¹çš„å‘ã€‚å…¶ä¸­ä¸€ä¸ªå‘æ˜¯ intellisense ç¿»è„¸ä¸è®¤ C++17 æ ‡å‡†çš„å¼ºåˆ¶æ‹·è´æ¶ˆé™¤ï¼ˆMandatory elision of copy&#x2F;move operationsï¼‰ã€‚</p>
<p>è¿™ä¸ª intellisense æ¥è‡ª Vscode Extention: C&#x2F;C++ (Microsoft)ã€‚</p>
<h2 id="Brief-Solution"><a href="#Brief-Solution" class="headerlink" title="Brief Solution"></a>Brief Solution</h2><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __INTELLISENSE__</span></span><br><span class="line"><span class="comment">// The fake code to cheat intellisense...</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="comment">// The real code for compiler...</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<span id="more"></span>

<h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a>Background</h2><p><code>co_context</code> è¦å¼€å‘ä¸€ä¸ª <code>lock_guard</code>ï¼Œä½†ç”¨æˆ·å¿…é¡»è¦å†™ <code>co_await</code>ï¼Œå¯¼è‡´åªèƒ½å†™æˆä»¥ä¸‹å½¢å¼ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> lk = <span class="keyword">co_await</span> mtx.<span class="built_in">lock_guard</span>();</span><br></pre></td></tr></table></figure>

<p><code>lk</code> åœ¨ææ„çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨ <code>mtx.unlock()</code>ã€‚è¿™çœ‹èµ·æ¥å¾ˆç¾å¥½ï¼Œä½†è¿™é‡Œå‘ç”Ÿäº† Copy elisionï¼Œæ ¹æ® C++17 æ ‡å‡†ï¼Œè¿™æ˜¯å¼ºåˆ¶ç¼–è¯‘å™¨æ‰§è¡Œçš„ä¼˜åŒ–ï¼Œæ— è®ºæ‹·è´&#x2F;ç§»åŠ¨æ„é€ å‡½æ•°æœ‰æ²¡æœ‰å‰¯ä½œç”¨ã€‚ä¸ºäº†é˜²æ­¢ç”¨æˆ·è¯¯ç”¨ï¼Œæˆ‘å¹²è„†åˆ é™¤äº†æ‹·è´&#x2F;ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œæ³¨æ„è¿™ä¹Ÿæ˜¯ç¬¦åˆæ ‡å‡†çš„åšæ³•ã€‚</p>
<p>ä½†é—®é¢˜æ˜¯ï¼Œintellisense ä¸çŸ¥é“ Copy elisionï¼å› ä¸ºæˆ‘åˆ é™¤äº†é‚£äº›æ„é€ å‡½æ•°ï¼Œå¯¼è‡´ intellisense ä¼šæŠ¥é”™ï¼šã€Œæ— æ³•å¼•ç”¨ xx æ„é€ å‡½æ•°ï¼Œå®ƒå·²ç»è¢«åˆ é™¤ã€ã€‚</p>
<p>æœ€ç³Ÿç³•çš„æ˜¯ï¼Œåº“çš„ç”¨æˆ·åœ¨æ­£ç¡®ä½¿ç”¨ <code>lock_guard</code> æ—¶ï¼Œéƒ½å¯èƒ½æ”¶åˆ°è¿™ä¸€æ¡é”™è¯¯çš„æŠ¥é”™ï¼ˆå“ªæ€•ç¼–è¯‘é€šè¿‡ï¼‰ï¼Œè¿™å¾ˆæœ‰è¿·æƒ‘æ€§ï¼Œæ˜¾ç„¶ä¼šå¤§å¤§é™ä½ç”¨æˆ·ä½“éªŒã€‚</p>
<h2 id="One-way-compromise"><a href="#One-way-compromise" class="headerlink" title="One way: compromise"></a>One way: compromise</h2><p>æœ€åˆæˆ‘é€‰æ‹©å‘ intellisense å¦¥åï¼šä½ æƒ³è®©æˆ‘å†™ç§»åŠ¨æ„é€ ï¼Œæˆ‘å†™å°±æ˜¯äº†ã€‚ä¸ºäº†è¯­ä¹‰æ­£ç¡®æ€§ï¼Œæˆ‘ä¸å¾—ä¸å°† <code>lock_guard</code> ç±»å†…éƒ¨çš„ <code>mutex&amp;</code> æ”¹æˆ <code>mutex*</code>ï¼Œä»¥æ”¯æŒã€Œç§»åŠ¨ã€ã€‚</p>
<p>æœ€ååœ¨ <code>~lock_guard()</code> å†…ï¼Œæˆ‘ä¸å¾—ä¸åˆ¤æ–­ <code>if (mtx != nullptr) mtx-&gt;unlock()</code>ï¼Œè¿™å¾ˆä¸‘ï¼Œä¹Ÿå½±å“äº†æ€§èƒ½ã€‚æˆ‘ä¸èƒ½å¿å—ã€‚</p>
<h2 id="The-second-way-cheat"><a href="#The-second-way-cheat" class="headerlink" title="The second way: cheat"></a>The second way: cheat</h2><p>é”™è¯¯çš„æ ¹æºæ˜¯ intellisense ä¸çŸ¥é“ Copy elisionã€‚é”™è¯¯çš„ä»£ä»·ä¸åº”ç”±æˆ‘æ¥æ‰¿æ‹…ã€‚</p>
<p>æˆ‘ä¸º <code>lock_guard</code> å¢åŠ äº†ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä½†æ ‡æ³¨äº† <code>[[deprecated]]</code>ï¼Œè€Œä¸”å†…éƒ¨æ˜¯ <code>assert(false)</code>ï¼Œè¿™æ˜¯ä¸ºäº†é˜²æ­¢ç”¨æˆ·è¯¯ç”¨ã€‚è¿™æˆåŠŸåœ°éª—è¿‡äº† intellisenseã€‚</p>
<p>å› ä¸ºä¿è¯ä¸ä¼šæ‹·è´&#x2F;ç§»åŠ¨ï¼Œæ‰€ä»¥å¯ä»¥åˆ é™¤ <code>if (mtx != nullptr)</code> è¿™æ ·çš„æ„šè ¢ä»£ç å•¦ï¼</p>
<h2 id="The-final-solution-ifdef"><a href="#The-final-solution-ifdef" class="headerlink" title="The final solution: #ifdef"></a>The final solution: #ifdef</h2><p>ç»è¿‡é«˜äººæŒ‡ç‚¹ï¼Œæ¬ºéª— intellisense æœ‰ä¸“é—¨çš„å®æ¥å®Œæˆã€‚æ‰€ä»¥æœ€åçš„è§£å†³åŠæ³•æ˜¯ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __INTELLISENSE__</span></span><br><span class="line">    [[<span class="built_in">deprecated</span>(</span><br><span class="line">        <span class="string">&quot;This function is for cheating intellisense, &quot;</span></span><br><span class="line">        <span class="string">&quot;who doesn&#x27;t sense RVO. &quot;</span></span><br><span class="line">        <span class="string">&quot;You should NEVER use this explicitly or implicitly.&quot;</span>)]]</span><br><span class="line">    <span class="built_in">lock_guard</span>(lock_guard &amp;&amp; other) <span class="keyword">noexcept</span></span><br><span class="line">        : <span class="built_in">mtx</span>(other.mtx) &#123;</span><br><span class="line">        <span class="built_in">assert</span>(<span class="literal">false</span> &amp;&amp; <span class="string">&quot;Mandatory copy elision failed!&quot;</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="built_in">lock_guard</span>(lock_guard &amp;&amp; other) = <span class="keyword">delete</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ï¼Œ<code>[[deprecated]]</code> å’Œ <code>assert</code> å¯ä»¥åˆ å»ï¼Œå› ä¸ºç¼–è¯‘å™¨æ°¸è¿œä¸ä¼šå¤„ç†å®ƒä»¬ã€‚</p>
]]></content>
  </entry>
  <entry>
    <title>è·Ÿæˆ‘ä¸€èµ·å†™Makefile</title>
    <url>/2020/02/01/Makefile/</url>
    <content><![CDATA[<p>è·¯è¿‡ä¸€ç¯‡å†™å¾—å¾ˆåˆ°ä½çš„Makefileä»‹ç»æ–‡ç« ï¼Œè½¬è½½ä¸€ä¸‹ï¼š</p>
<p><a href="https://seisman.github.io/how-to-write-makefile/overview.html">seisman.github.io&#x2F;how-to-write-makefile</a></p>
]]></content>
      <tags>
        <tag>æ‚é¡¹</tag>
      </tags>
  </entry>
  <entry>
    <title>One Minute to C++ &quot;defer&quot;</title>
    <url>/2022/02/06/One-Minute-to-C-defer/</url>
    <content><![CDATA[<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Lambda&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Defer</span> : Lambda &#123;</span><br><span class="line">    ~<span class="built_in">Defer</span>() &#123; Lambda::<span class="built_in">operator</span>()(); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Lambda&gt;</span></span><br><span class="line"><span class="function"><span class="title">Defer</span><span class="params">(Lambda)</span> -&gt; Defer&lt;Lambda&gt;</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// usage</span></span><br><span class="line">Defer guard&#123;[sockfd]&#123;</span><br><span class="line">    <span class="built_in">shutdown</span>(sockfd, SHUT_WR);</span><br><span class="line">&#125;&#125;;</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<p>This is a short tutorial on implementing golang-style &quot;defer&quot; in C++.</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line">The favored technique will be:</span><br><span class="line"><span class="addition">+ C++ template and lambda</span></span><br><span class="line"><span class="deletion">- C macro</span></span><br></pre></td></tr></table></figure>

<h1 id="The-Explaination"><a href="#The-Explaination" class="headerlink" title="The Explaination"></a>The Explaination</h1><ol>
<li>Inheriting from a lambda type, we define a template class <code>Defer</code> whose dtor calls the <code>Lambda::operator()</code>.</li>
<li>Explicitly deduce a ctor <code>Defer(Lambda)</code> to the exact type <code>Defer&lt;Lambda&gt;</code>. This step can be omitted in C++20 or later.</li>
<li>Define a <code>Defer</code> object, initialized with the lambda, at any scope, similar to golang.</li>
</ol>
<h1 id="Tips-and-More"><a href="#Tips-and-More" class="headerlink" title="Tips and More"></a>Tips and More</h1><ol>
<li>You may need to capture some local variables into the lambda.</li>
<li><code>-O1</code> is recommended for the lambda inlining, which makes this idiom zero-overhead.</li>
<li>Using C macro, this idiom can be developed more concise. Personally I don&#39;t like C macro, however, because of safety concerns.</li>
<li>A library: <a href="https://github.com/lizho/FakeGolang/blob/master/include/fake_golang.h">lizho&#x2F;FakeGolang</a></li>
</ol>
]]></content>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title>SAMå®æˆ˜å‰–æ</title>
    <url>/2020/10/11/SAM%E5%AE%9E%E6%88%98/</url>
    <content><![CDATA[<ul>
<li><em>å®æˆ˜ä¸ä¼šSAMï¼Ÿå¯¼è‡´æ¯”èµ›æ‰“é“ï¼Ÿå¿« ç‚¹ å­¦ ï¼</em></li>
</ul>
<h1 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h1><a href="/2020/10/01/Suffix-Automaton/" title="åç¼€è‡ªåŠ¨æœº Suffix Automaton">åç¼€è‡ªåŠ¨æœº(Suffix-Automaton)</a>

<span id="more"></span>

<h1 id="åœ¨è‡ªåŠ¨æœºä¸Šæ¸¸èµ°"><a href="#åœ¨è‡ªåŠ¨æœºä¸Šæ¸¸èµ°" class="headerlink" title="åœ¨è‡ªåŠ¨æœºä¸Šæ¸¸èµ°"></a>åœ¨è‡ªåŠ¨æœºä¸Šæ¸¸èµ°</h1><p>ä»$root$å¼€å§‹ï¼Œæ²¿ç›®æ ‡å­—ç¬¦ä¸²é€ä¸ªå­—ç¬¦èµ°ã€‚è‹¥è·¯å¾„å­˜åœ¨ï¼Œå³å½“å‰å­ä¸²å­˜åœ¨ï¼›åä¹‹ï¼Œè‹¥å‡ºè¾¹ä¸å­˜åœ¨ï¼Œå³ç›®æ ‡å­ä¸²ä¸å­˜åœ¨ã€‚</p>
<h2 id="æ±‚æœ€å°è¡¨ç¤º"><a href="#æ±‚æœ€å°è¡¨ç¤º" class="headerlink" title="æ±‚æœ€å°è¡¨ç¤º"></a>æ±‚æœ€å°è¡¨ç¤º</h2><p>æ±‚å­—ç¬¦ä¸²$S$çš„æœ€å°è¡¨ç¤ºã€‚</p>
<p><em>åº¦å¨˜æœ‰$O(n)$çš„ç‰¹æ®Šåšæ³•ï¼Œæ­¤å¤„ä¸èµ˜è¿°ã€‚</em></p>
<p>æ„é€ å­—ç¬¦ä¸²$SS$çš„åç¼€è‡ªåŠ¨æœºï¼Œä»$root$å¼€å§‹ï¼Œæ¯æ¬¡æ²¿æœ€å°çš„å‡ºè¾¹èµ°ï¼Œèµ°næ­¥å°±å¾—åˆ°äº†$SS$ä¸­é•¿åº¦ä¸ºnçš„æœ€å°å­ä¸²ï¼Œå³$S$çš„æœ€å°è¡¨ç¤ºã€‚</p>
<h2 id="æ±‚æœ¬è´¨ä¸åŒçš„ç¬¬kå°å­ä¸²"><a href="#æ±‚æœ¬è´¨ä¸åŒçš„ç¬¬kå°å­ä¸²" class="headerlink" title="æ±‚æœ¬è´¨ä¸åŒçš„ç¬¬kå°å­ä¸²"></a>æ±‚æœ¬è´¨ä¸åŒçš„ç¬¬kå°å­ä¸²</h2><p><a href="https://www.spoj.com/problems/SUBLEX/">SPOJ SUBLEX</a> é¢˜æ„ï¼šæ±‚å­—ç¬¦ä¸²$S$çš„æ‰€æœ‰æœ¬è´¨ä¸åŒå­ä¸²ä¸­çš„ç¬¬$k$å°ã€‚$length(S)\le 9e4, è¯¢é—®æ•°é‡\le 500$ã€‚</p>
<p>SAMæ„é€ å®Œæˆåå¾—åˆ°ä¸€ä¸ªDAGï¼Œåˆ©ç”¨æ‹“æ‰‘åºæ±‚ä»æ¯ä¸ªç‚¹å‡ºå‘å¯èƒ½çš„è·¯å¾„æ•°ç›®ã€‚è§<a href="#SAM%E4%B8%8A%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F">æ‹“æ‰‘æ’åºçš„æ–¹æ³•</a>ã€‚æœ€åç”¨ç±»ä¼¼äºŒåˆ†æ³•æ±‚ç¬¬kå°å³å¯ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å†…å­˜æ± +è®¡æ•°æ’åºçš„SAMï¼Œç›¸å¯¹ä¼˜ç§€</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXW = <span class="number">26</span>, MAXN = <span class="number">9e4</span>+<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    State *pa;</span><br><span class="line">    State *go[MAXW];</span><br><span class="line">    <span class="type">int</span> Max;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> siz = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> cnt;    </span><br><span class="line">&#125;sam[MAXN&lt;&lt;<span class="number">1</span>], *last, *root;</span><br><span class="line"></span><br><span class="line"><span class="function">State* <span class="title">alloc</span><span class="params">(<span class="type">int</span> Max)</span> </span>&#123;</span><br><span class="line">    State&amp; ref = sam[State::cnt++];</span><br><span class="line">    ref.Max = Max;</span><br><span class="line">    <span class="keyword">return</span> &amp;ref;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">State* <span class="title">alloc</span><span class="params">(State* src)</span> </span>&#123;</span><br><span class="line">    State&amp; ref = sam[State::cnt++];</span><br><span class="line">    ref = *src;</span><br><span class="line">    <span class="keyword">return</span> &amp;ref;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">extend</span><span class="params">(<span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">    State *p = last, *np = <span class="built_in">alloc</span>(p-&gt;Max+<span class="number">1</span>);</span><br><span class="line">    last = np;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (p &amp;&amp; !p-&gt;go[c])</span><br><span class="line">        p-&gt;go[c] = np, p = p-&gt;pa;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!p) <span class="keyword">return</span> np-&gt;pa = root, <span class="built_in">void</span>();</span><br><span class="line">    </span><br><span class="line">    State* q = p-&gt;go[c];</span><br><span class="line">    <span class="keyword">if</span> (q-&gt;Max == p-&gt;Max+<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> np-&gt;pa = q, <span class="built_in">void</span>();</span><br><span class="line">    </span><br><span class="line">    State* nq = <span class="built_in">alloc</span>(q);</span><br><span class="line">    nq-&gt;Max = p-&gt;Max + <span class="number">1</span>;</span><br><span class="line">    q-&gt;pa = np-&gt;pa = nq;</span><br><span class="line">    <span class="keyword">while</span> (p &amp;&amp; p-&gt;go[c] == q)</span><br><span class="line">        p-&gt;go[c] = nq, p = p-&gt;pa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> State::cnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> st[MAXN];</span><br><span class="line"><span class="type">int</span> Q, len;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> num[MAXN];</span><br><span class="line">State* b[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»ä¼¼äºŒåˆ†æ³•æ±‚å½“å‰ç¬¬lefå°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">const</span> State* now, <span class="type">int</span> dep, <span class="type">int</span> lef)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> ans[MAXN];</span><br><span class="line">    <span class="keyword">if</span> (lef == <span class="number">0</span>) &#123;</span><br><span class="line">        ans[dep] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="built_in">puts</span>(ans);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;MAXW; ++i) <span class="keyword">if</span> (now-&gt;go[i]) &#123;</span><br><span class="line">        <span class="type">const</span> State* g = now-&gt;go[i];</span><br><span class="line">        <span class="keyword">if</span> (lef &lt;= g-&gt;siz) &#123;</span><br><span class="line">            ans[dep] = i+<span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">dfs</span>(g, dep+<span class="number">1</span>, lef<span class="number">-1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            lef -= g-&gt;siz;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> DEBUG</span></span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    </span><br><span class="line">    last = root = <span class="built_in">alloc</span>(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, st);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> &amp;i=len; st[i]!=<span class="string">&#x27;\0&#x27;</span>; ++i) &#123;</span><br><span class="line">        st[i] -= <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="built_in">extend</span>(st[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‹“æ‰‘æ’åº</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;State::cnt; ++i) ++num[sam[i].Max];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=len<span class="number">-1</span>; i&gt;=<span class="number">0</span>; --i) num[i] += num[i+<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;State::cnt; ++i) b[--num[sam[i].Max]] = &amp;sam[i];</span><br><span class="line">    <span class="comment">// æ²¿æ‹“æ‰‘åºDP</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;State::cnt; ++i)</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>; j&lt;MAXW; ++j)</span><br><span class="line">            <span class="keyword">if</span> (b[i]-&gt;go[j])</span><br><span class="line">                 b[i]-&gt;siz += b[i]-&gt;go[j]-&gt;siz;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;Q);</span><br><span class="line">    <span class="keyword">while</span> (Q--) &#123;</span><br><span class="line">        <span class="type">int</span> aim;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;aim);</span><br><span class="line">        <span class="built_in">dfs</span>(root, <span class="number">0</span>, aim);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ç¦»çº¿è®¡ç®—-Right"><a href="#ç¦»çº¿è®¡ç®—-Right" class="headerlink" title="ç¦»çº¿è®¡ç®—|Right|"></a>ç¦»çº¿è®¡ç®—|Right|</h1><p>æ„é€ å¥½çš„åç¼€è‡ªåŠ¨æœºéšå«äº†ä¸€é¢—åˆ†è£‚æ ‘ï¼Œåªéœ€è®¿é—®æ‰€æœ‰èŠ‚ç‚¹å’Œ$Pa$æŒ‡é’ˆï¼Œå°±èƒ½è¿˜åŸè¿™é¢—åˆ†è£‚æ ‘ã€‚æ˜¾ç„¶ï¼Œå¶å­èŠ‚ç‚¹çš„$|Right| &#x3D; 1$ï¼Œä½†ä»…æœ‰è¿™äº›ä¿¡æ¯è¿˜ä¸è¶³æ¨å‡ºå…¶ä»–èŠ‚ç‚¹çš„$|Right|$ï¼Œè¿™æ˜¯å› ä¸ºèŠ‚ç‚¹åœ¨å¾€ä¸‹åˆ†è£‚æ—¶å¯èƒ½ä¸¢å¤±å…ƒç´ <br><br/><img src="/2020/10/11/SAM%E5%AE%9E%E6%88%98/abaTree.png" alt="&quot;aba&quot;çš„åˆ†è£‚æ ‘ã€‚â€œ1â€æ²¡æœ‰å‡ºç°åœ¨å¶èŠ‚ç‚¹ä¸­"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œâ€œ1â€åœ¨åˆ†è£‚çš„è¿‡ç¨‹ä¸­æ¶ˆå¤±äº†ï¼Œä¸å­˜åœ¨å¶å­èŠ‚ç‚¹ä¸­ã€‚</p>
<p>ä¸ºä»€ä¹ˆ$Right$é›†åˆçš„å…ƒç´ æ— æ³•å¾€ä¸‹åˆ†è£‚ï¼Ÿè¿™æ˜¯å› ä¸ºå®ƒè¡¨ç¤ºçš„å­ä¸²æ— æ³•å‘å·¦ç«¯æ‰©å±•ï¼Œæ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯å‰ç¼€ã€‚æ³¨æ„åˆ°å¶å­èŠ‚ç‚¹ä¹Ÿæ˜¯å‰ç¼€ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œåªè¦å¯¹å‰ç¼€æ‰€åœ¨èŠ‚ç‚¹çš„$|Right|$é¢„ç½®ä¸º$1$ï¼ˆå…¶ä»–èŠ‚ç‚¹é¢„ç½®ä¸º$0$ï¼‰ï¼Œç„¶åè‡ªåº•å‘ä¸Šæ›´æ–°åˆ†è£‚æ ‘å³å¯å¾—åˆ°æ‰€æœ‰$|Right|$</p>
<h2 id="åˆ†è£‚æ ‘ä¸Šæ‹“æ‰‘æ’åº"><a href="#åˆ†è£‚æ ‘ä¸Šæ‹“æ‰‘æ’åº" class="headerlink" title="åˆ†è£‚æ ‘ä¸Šæ‹“æ‰‘æ’åº"></a>åˆ†è£‚æ ‘ä¸Šæ‹“æ‰‘æ’åº</h2><p>ä¸Šæ–‡å¼•å‡ºäº†ä¸€ä¸ªæ–°é—®é¢˜ï¼Œå¦‚ä½•è‡ªåº•å‘ä¸Šåœ°è®¿é—®åˆ†è£‚æ ‘ï¼Ÿä¸€ç§ç›´è§‚çš„åŠæ³•æ˜¯bfsæ”¶é›†SAMæ‰€æœ‰èŠ‚ç‚¹å†åšæ‹“æ‰‘æ’åºï¼Œè¿™é€»è¾‘å¤æ‚è€Œä»£ç ç¹çã€‚ä¸€ç§æ›´å¥½çš„åŠæ³•æ˜¯ï¼Œåœ¨æ„é€ SAMæ—¶é‡‡ç”¨å†…å­˜æ± æŠ€æœ¯ï¼Œä¹‹åå¯¹å†…å­˜æ± æŒ‰ç…§$Max$é™åºæ’åºå³å¯ã€‚åŸå› æ˜¯<br>$$ Max(fa)+1&#x3D;Min(s) \Rightarrow Max(s) &gt; Max(fa)$$<br>æœ‰è¶£çš„æ˜¯ï¼Œåˆ†è£‚æ ‘çš„æ‹“æ‰‘åºä¹Ÿæ˜¯è‡ªåŠ¨æœºçš„æ‹“æ‰‘åºï¼åŸå› æ˜¯<br>$$ trans(s, *)&#x3D;t \Rightarrow Max(t) &gt; Max(s) $$<br>å¦‚æœä½ å¿˜è®°äº†ï¼Œè¯·å¤ä¹ <a href="/2020/10/01/Suffix-Automaton/" title="åç¼€è‡ªåŠ¨æœº Suffix Automaton">åç¼€è‡ªåŠ¨æœºçš„æ›´å¤šæ€§è´¨</a>ã€‚</p>
<div class="note primary"><h4 id="æ‹“æ‰‘æ’åºè¦ç‚¹"><a href="#æ‹“æ‰‘æ’åºè¦ç‚¹" class="headerlink" title="æ‹“æ‰‘æ’åºè¦ç‚¹"></a>æ‹“æ‰‘æ’åºè¦ç‚¹</h4><ol>
<li>æŒ‡é’ˆæ¿æ„é€ é‡‡ç”¨å†…å­˜æ± æŠ€æœ¯</li>
<li>$Max$å¯èƒ½çš„å–å€¼ä»…æœ‰$[1,n]$ï¼Œæ‰€ä»¥è¦é‡‡ç”¨è®¡æ•°æ’åº</li>
<li>ä¸è¦çœŸçš„ä¿®æ”¹å†…å­˜æ± ï¼Œè€Œæ˜¯æ–°å¼€æŒ‡é’ˆåšæ’åº</li>
<li>å¦‚æœä¸å¾—ä¸å†™å¸¸è§„æ‹“æ‰‘æ’åºï¼Œbfsæ—¶è¯·æ³¨æ„DAGçš„é‡å¤è®¿é—®</li>
</ol>
</div>

<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;cnt; ++i) ++num[sam[i].Max];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=len<span class="number">-1</span>; i&gt;=<span class="number">0</span>; --i) num[i] += num[i+<span class="number">1</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;cnt; ++i) b[--num[sam[i].Max]] = &amp;sam[i];</span><br><span class="line"><span class="comment">// sam[] has been top sorted by b[].</span></span><br></pre></td></tr></table></figure>

<p>å‰©ä½™ç»†èŠ‚åœ¨<a href="#%E6%B1%82%E6%9C%AC%E8%B4%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E7%AC%ACk%E5%B0%8F%E5%AD%90%E4%B8%B2">ä¾‹é¢˜1</a>ã€<a href="#%E6%B1%82%E9%95%BF%E5%BA%A6%E4%B8%BA-i-%E7%9A%84%E5%AD%90%E4%B8%B2%E7%9A%84%E6%9C%80%E5%A4%A7%E5%87%BA%E7%8E%B0%E6%AC%A1%E6%95%B0">ä¾‹é¢˜2</a>ä¸­ä½“ç°</p>
<h2 id="æ±‚é•¿åº¦ä¸ºiçš„å­ä¸²çš„æœ€å¤§å‡ºç°æ¬¡æ•°"><a href="#æ±‚é•¿åº¦ä¸ºiçš„å­ä¸²çš„æœ€å¤§å‡ºç°æ¬¡æ•°" class="headerlink" title="æ±‚é•¿åº¦ä¸ºiçš„å­ä¸²çš„æœ€å¤§å‡ºç°æ¬¡æ•°"></a>æ±‚é•¿åº¦ä¸ºiçš„å­ä¸²çš„æœ€å¤§å‡ºç°æ¬¡æ•°</h2><p><a href="https://www.spoj.com/problems/NSUBSTR/">SPOJ NSUBSTR</a> é¢˜æ„ï¼šç»™å‡ºå­—ç¬¦ä¸²Sï¼ˆé•¿åº¦&lt;&#x3D;2.5e5ï¼‰ï¼Œè®¾f(x)ä¸ºSä¸­é•¿åº¦ä¸ºxçš„å­ä¸²çš„æœ€å¤§å‡ºç°æ¬¡æ•°ï¼Œæ±‚f(1...length(s))ã€‚</p>
<p>åˆ†æï¼šåç¼€è‡ªåŠ¨æœºä¸­æ¯ä¸ªçŠ¶æ€$s$è•´å«çš„å­—ç¬¦ä¸²é•¿åº¦ä¸º$[Min(s), Max(s)]$ï¼Œæ¯ä¸ªå‡ºç°äº†$Right(s)$æ¬¡ï¼Œåªéœ€ç”¨$|Right(s)|$æ›´æ–°$ans[Max(s)]$å°±è¡Œäº†ï¼Œåœ¨æœ€åè¾“å‡ºå‰ä¾æ¬¡ç”¨$ans[i+1]$æ›´æ–°$ans[i]$å³å¯ã€‚åŸå› æ˜¯é•¿åº¦æ›´é•¿çš„å­ä¸²å‡ºç°çš„æ¬¡æ•°ä¸€å®šä¸è¶…è¿‡é•¿åº¦çŸ­çš„ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æœ´ç´ çš„æ‹“æ‰‘æ’åºç‰ˆæœ¬ï¼Œæ¨èæ”¹ç”¨è®¡æ•°æ’åº</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DEBUG</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXW = <span class="number">26</span>, MAXN = <span class="number">50</span>+<span class="number">3</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXW = <span class="number">26</span>, MAXN = <span class="number">250000</span>+<span class="number">3</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">State</span> &#123;</span><br><span class="line">    State* pa;</span><br><span class="line">    State* go[MAXW];</span><br><span class="line">    <span class="type">int</span> Max;</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> RSiz = <span class="number">0</span>, inD = <span class="number">0</span>;</span><br><span class="line">    <span class="type">bool</span> vis = <span class="literal">false</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">State</span>(<span class="type">int</span> Max) &#123;</span><br><span class="line">        <span class="built_in">memset</span>(go, <span class="number">0</span>, <span class="built_in">sizeof</span>(go));</span><br><span class="line">        pa = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">this</span>-&gt;Max = Max;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">State</span>(<span class="type">const</span> State* o) &#123;</span><br><span class="line">        <span class="built_in">memcpy</span>(go, o-&gt;go, <span class="built_in">sizeof</span>(go));</span><br><span class="line">        pa = o-&gt;pa;</span><br><span class="line">        Max = o-&gt;Max;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;*root, *last;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">extend</span><span class="params">(<span class="type">int</span> c)</span> </span>&#123;</span><br><span class="line">    State *p = last, *np = <span class="keyword">new</span> <span class="built_in">State</span>(p-&gt;Max+<span class="number">1</span>);</span><br><span class="line">    last = np;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (p &amp;&amp; !p-&gt;go[c])</span><br><span class="line">        p-&gt;go[c] = np, p = p-&gt;pa;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!p) <span class="keyword">return</span> np-&gt;pa = root, <span class="built_in">void</span>();</span><br><span class="line">    </span><br><span class="line">    State *q = p-&gt;go[c];</span><br><span class="line">    <span class="keyword">if</span> (p-&gt;Max+<span class="number">1</span> == q-&gt;Max)</span><br><span class="line">        <span class="keyword">return</span> np-&gt;pa = q, <span class="built_in">void</span>();</span><br><span class="line">        </span><br><span class="line">    State *nq = <span class="keyword">new</span> <span class="built_in">State</span>(q);</span><br><span class="line">    q-&gt;pa = np-&gt;pa = nq;</span><br><span class="line">    nq-&gt;Max = p-&gt;Max + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (p &amp;&amp; p-&gt;go[c] == q)</span><br><span class="line">        p-&gt;go[c]=nq, p = p-&gt;pa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> st[MAXN];</span><br><span class="line"><span class="type">int</span> len;</span><br><span class="line"></span><br><span class="line">State* q[MAXN&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    q[<span class="number">0</span>] = root;</span><br><span class="line">    cnt = <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;cnt; ++i) &#123;</span><br><span class="line">        State* <span class="type">const</span> now = q[i];</span><br><span class="line">        <span class="keyword">if</span> (now-&gt;pa) ++now-&gt;pa-&gt;inD;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>; j&lt;MAXW; ++j)</span><br><span class="line">            <span class="keyword">if</span> (now-&gt;go[j] &amp;&amp; !now-&gt;go[j]-&gt;vis) &#123;</span><br><span class="line">                q[cnt++] = now-&gt;go[j];</span><br><span class="line">                now-&gt;go[j]-&gt;vis = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">topsort</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> head = <span class="number">0</span>, tail = <span class="built_in">partition</span>(q, q+cnt, [](<span class="type">const</span> State* o) &#123;</span><br><span class="line">        <span class="keyword">return</span> o-&gt;inD == <span class="number">0</span>;</span><br><span class="line">    &#125;) - q;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (head &lt; tail) &#123;</span><br><span class="line">        State* now = q[head++];</span><br><span class="line">        <span class="keyword">if</span> (!now-&gt;pa) <span class="keyword">continue</span>;</span><br><span class="line">        now-&gt;pa-&gt;RSiz += now-&gt;RSiz;</span><br><span class="line">        <span class="keyword">if</span> (--now-&gt;pa-&gt;inD == <span class="number">0</span>)</span><br><span class="line">            q[tail++] = now-&gt;pa;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> ans[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">ifdef</span> DEBUG</span></span><br><span class="line">    <span class="built_in">freopen</span>(<span class="string">&quot;in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">    <span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    </span><br><span class="line">    root = last = <span class="keyword">new</span> <span class="built_in">State</span>(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, st);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> &amp;i=(len=<span class="number">0</span>); st[i]!=<span class="string">&#x27;\0&#x27;</span>; ++i) &#123;</span><br><span class="line">        st[i] -= <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">        <span class="built_in">extend</span>(st[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// bfså–å‡ºSAMä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ³¨æ„åˆ¤é‡</span></span><br><span class="line">    <span class="built_in">bfs</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯¹SAMä¸­æ‰€æœ‰è•´å«å‰ç¼€çš„çŠ¶æ€ |Right| = 1ï¼ˆå…¶å®ƒç½®ä¸º0ï¼‰</span></span><br><span class="line">    State* p = root;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;len; ++i) &#123;</span><br><span class="line">        p = p-&gt;go[st[i]];</span><br><span class="line">        ++p-&gt;RSiz;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‹“æ‰‘æ’åºï¼Œé¡ºä¾¿è‡ªåº•å‘ä¸Šæ›´æ–°|Right|</span></span><br><span class="line">    <span class="built_in">topsort</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;cnt; ++i) &#123;</span><br><span class="line">        ans[q[i]-&gt;Max] = <span class="built_in">max</span>(ans[q[i]-&gt;Max], q[i]-&gt;RSiz);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=len; i&gt;<span class="number">1</span>; --i)</span><br><span class="line">        ans[i<span class="number">-1</span>] = <span class="built_in">max</span>(ans[i<span class="number">-1</span>], ans[i]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>; i&lt;=len; ++i)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans[i]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h1 id="è·³å‘çˆ¶äº²ï¼Œèˆå¼ƒå·¦ç«¯ï¼Œå¯»æ±‚åŒ¹é…"><a href="#è·³å‘çˆ¶äº²ï¼Œèˆå¼ƒå·¦ç«¯ï¼Œå¯»æ±‚åŒ¹é…" class="headerlink" title="è·³å‘çˆ¶äº²ï¼Œèˆå¼ƒå·¦ç«¯ï¼Œå¯»æ±‚åŒ¹é…"></a>è·³å‘çˆ¶äº²ï¼Œèˆå¼ƒå·¦ç«¯ï¼Œå¯»æ±‚åŒ¹é…</h1><p><code>now = now-&gt;pa</code>çš„æœ¬è´¨æ˜¯æŠ›å¼ƒå·¦ç«¯ä¸€éƒ¨åˆ†å­—ç¬¦ï¼Œå¸¦æ¥çš„æ•ˆæœæ˜¯$Right$é›†åˆçš„æ‰©å¼ ã€‚è¿™ä¸ªç‰¹æ€§åœ¨æ±‚æœ€é•¿å…¬å…±å­ä¸²çš„æ—¶å€™å°¤ä¸ºå¥½ç”¨ï¼Œä¸KMPèˆå¼ƒå³ç«¯éƒ¨åˆ†å­—ç¬¦ä»¥å¯»æ±‚åŒ¹é…çš„åŸç†æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚</p>
<h2 id="æ±‚ä¸¤å­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­ä¸²"><a href="#æ±‚ä¸¤å­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­ä¸²" class="headerlink" title="æ±‚ä¸¤å­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­ä¸²"></a>æ±‚ä¸¤å­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­ä¸²</h2><p><a href="https://www.spoj.com/problems/LCS/">SPOJ LCS</a> é¢˜æ„ï¼šæ±‚å­—ç¬¦ä¸²$S1,S2$çš„æœ€é•¿å…¬å…±å­ä¸²(è¦æ±‚è¿ç»­)</p>
<p>åˆ†æï¼šåç¼€è‡ªåŠ¨æœºå¾ˆæ“…é•¿å¤„ç†è¿ç»­ä¸²çš„åŒ¹é…ã€‚è¯•æƒ³æˆ‘ä»¬åšå‡º$S1$çš„SAMï¼Œç„¶åç›´æ¥è·‘$S2$ï¼ŒåŠ¿å¿…å‡ºç°å‡ºè¾¹ä¸å­˜åœ¨çš„é—®é¢˜â€”â€”æ— æ³•ç»§ç»­åŒ¹é…äº†ã€‚ä¸å¦¨è®¾æ— æ³•ç»§ç»­åŒ¹é…æ—¶ï¼Œå¯¼è‡´æ— æ³•åŒ¹é…çš„å­—ç¬¦æ˜¯$S2[i]$ï¼Œå½“å‰çŠ¶æ€ä¸º$s$ï¼Œå³$trans(s, S2[i])$ä¸å­˜åœ¨ï¼Œå³ä¸å­˜åœ¨$S1[r_j]&#x3D;S2[i], r_j\in Right(s)$ã€‚æƒ³è¦å¯»æ±‚åŒ¹é…ï¼Œåªèƒ½æŠ›å¼ƒå·²åŒ¹é…çš„å­ä¸²å·¦ç«¯ï¼Œè€Œ<code>s=s-&gt;pa</code>æ°å¥½å¸¦æ¥äº†æœ€å°‘çš„æŠ›å¼ƒé‡ï¼Œä½¿å¾—$Right(s)$èƒ½æ‰©å¼ ï¼Œä»è€Œå¸¦æ¥åŒ¹é…çš„å¯èƒ½æ€§ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œå½“<code>s-&gt;go[S2[i]] == nullptr</code>æ—¶ï¼Œé‡å¤<code>s = s-&gt;pa</code>ï¼Œç›´åˆ°è·å¾—åŒ¹é…<code>s-&gt;go[S2[i]] != nullptr</code>æˆ–ä¸å¯èƒ½åŒ¹é…<code>s == nullptr</code>ã€‚</p>
<p>å‡å¦‚ç›´æ¥èƒ½åŒ¹é…å‘¢ï¼Ÿé‚£å¤ªç®€å•äº†ï¼ŒåŒ¹é…é•¿åº¦åŠ ä¸€ï¼Œä¸‹ä¸€ä½ã€‚</p>
<p>äºæ˜¯æœ€ç»ˆè§£ä¸ºï¼šè®°å½“å‰å·²åŒ¹é…é•¿åº¦$match$ï¼Œå½“å‰ç­”æ¡ˆ$ans$ï¼Œå½“å‰è‡ªåŠ¨æœºçŠ¶æ€$s$ï¼Œæ¥ä¸‹æ¥å°è¯•åŒ¹é…$S2[i]$ï¼Œè‹¥$trans(s,S2[i])$å­˜åœ¨ï¼Œå°±è½¬ç§»ï¼Œå¹¶ä¸”$match$åŠ ä¸€ï¼›å¦åˆ™å°è¯•ä¸æ–­è·³åˆ†è£‚æ ‘çš„$fa$ï¼Œç›´åˆ°è½¬ç§»å­˜åœ¨ï¼Œç”±äº$Max(fa) &lt; Min(s) \le match$ï¼Œ$match$å¿…èƒ½å–åˆ°$Max(fa)$ï¼Œæ‰€ä»¥$s$è·³åˆ°$trans(fa, S2[i])$ï¼Œ $match$å–ä¸º$Max(fa)+1$å³å¯ã€‚æ¯èµ°ä¸€æ­¥éƒ½ç”¨$match$æ›´æ–°$ans$ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// çœç•¥SAMçš„æ„é€ å’Œå…¶ä»–ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿</span></span><br><span class="line">    State* now = root;</span><br><span class="line">    <span class="type">int</span> match = <span class="number">0</span>, ans = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; sb[i]!=<span class="string">&#x27;\0&#x27;</span>; ++i) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="type">int</span> c = (sb[i]-=<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (now-&gt;go[c]) &#123;</span><br><span class="line">            now = now-&gt;go[c];</span><br><span class="line">            ++match;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (now &amp;&amp; !now-&gt;go[c])</span><br><span class="line">                now = now-&gt;pa;</span><br><span class="line">            <span class="keyword">if</span> (now) &#123;</span><br><span class="line">                match = now-&gt;Max+<span class="number">1</span>;</span><br><span class="line">                now = now-&gt;go[c];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                now = root;</span><br><span class="line">                match = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        ans = <span class="built_in">max</span>(ans, match);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>å­—ç¬¦ä¸²</tag>
      </tags>
  </entry>
  <entry>
    <title>åç¼€è‡ªåŠ¨æœº Suffix Automaton</title>
    <url>/2020/10/01/Suffix-Automaton/</url>
    <content><![CDATA[<h1 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h1><h2 id="è‡ªåŠ¨æœºçš„äº”ä¸ªéƒ¨åˆ†"><a href="#è‡ªåŠ¨æœºçš„äº”ä¸ªéƒ¨åˆ†" class="headerlink" title="è‡ªåŠ¨æœºçš„äº”ä¸ªéƒ¨åˆ†"></a>è‡ªåŠ¨æœºçš„äº”ä¸ªéƒ¨åˆ†</h2><ol>
<li><strong>alpha</strong> å­—ç¬¦é›†</li>
<li><strong>state</strong> çŠ¶æ€é›†åˆã€‚å¦è®©$null$è¡¨ç¤ºä¸å­˜åœ¨çš„çŠ¶æ€æˆ–è½¬ç§»</li>
<li><strong>init</strong> åˆå§‹çŠ¶æ€</li>
<li><strong>end</strong> ç»“æŸçŠ¶æ€é›†åˆ</li>
<li><strong>trans</strong> çŠ¶æ€è½¬ç§»å‡½æ•°ï¼šä»¤$trans(s, str)$è¡¨ç¤ºåœ¨çŠ¶æ€$s$æ—¶è¯»å…¥å­—ç¬¦ä¸²$str$åï¼Œæ‰€è¾¾åˆ°çš„çŠ¶æ€ã€‚$trans$åº”å…·æœ‰ä¼ é€’æ€§ã€‚</li>
</ol>
<span id="more"></span>

<h2 id="è®¾"><a href="#è®¾" class="headerlink" title="è®¾"></a>è®¾</h2><ol>
<li>è‡ªåŠ¨æœºèƒ½è¯†åˆ«çš„æ‰€æœ‰å­—ç¬¦ä¸²é›†åˆ<strong>Reg(A)</strong> ï¼Œå…¶ä¸­çš„å­—ç¬¦ä¸²$x$æ»¡è¶³$trans(init, x)\in end$</li>
<li>ä»çŠ¶æ€$s$å¼€å§‹èƒ½è¯†åˆ«çš„å­—ç¬¦ä¸² <strong>Reg(s)</strong></li>
<li>åç¼€è‡ªåŠ¨æœº<strong>SAM</strong>ï¼Œä¸€ä¸ªèƒ½è¯†åˆ«æ¯ä¸²$S$çš„æ‰€æœ‰åç¼€çš„è‡ªåŠ¨æœºã€‚$SAM(x)&#x3D;true$å½“ä¸”ä»…å½“$x$æ˜¯$S$çš„åç¼€ã€‚</li>
<li>$trans(init, str)$å³ä»åˆå§‹çŠ¶æ€è¯»å…¥$str$ååˆ°è¾¾çš„çŠ¶æ€<strong>ST(str)</strong> <em>ï¼ˆSTæ˜¯stateçš„ç¼©å†™)</em></li>
<li>æ¯ä¸²$S$çš„æ‰€æœ‰åç¼€çš„é›†åˆ<strong>Suf</strong>ï¼Œä»$a$ä½ç½®å¼€å§‹çš„åç¼€<strong>Suffix(a)</strong></li>
<li>æ¯ä¸²$S$çš„æ‰€æœ‰è¿ç»­å­ä¸²çš„é›†åˆ<strong>Fac</strong>ï¼Œä½ç½®ä¸º$[l,r)$çš„å­ä¸²<strong>S[l,r)</strong></li>
</ol>
<h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><h2 id="SAMçš„å¯è¡Œæ€§åˆ†æ"><a href="#SAMçš„å¯è¡Œæ€§åˆ†æ" class="headerlink" title="SAMçš„å¯è¡Œæ€§åˆ†æ"></a>SAMçš„å¯è¡Œæ€§åˆ†æ</h2><ol>
<li><p>å¯¹äºå­—ç¬¦ä¸²$s$ï¼Œè‹¥$s\in Fac$ï¼Œåˆ™$ST(s)$åº”å­˜åœ¨ï¼Œè¿™æ˜¯å› ä¸ºå¯ä»¥åœ¨$s$åé¢åŠ ä¸Šä¸€äº›å­—ç¬¦ä½¿å…¶å˜æˆ$S$çš„åç¼€ã€‚<em>åä¹‹$s\notin Fac$ï¼Œåˆ™åº”æœ‰$ST(s)&#x3D;null$ä»¥èŠ‚çœç©ºé—´</em></p>
</li>
<li><p>è€ƒè™‘$ST(a)$èƒ½è¯†åˆ«å“ªäº›å­—ç¬¦ä¸²ï¼Œå³$Reg(ST(a))$ã€‚è‹¥$x\in Reg(ST(a))$ï¼Œåˆ™$ax\in Suf$ï¼Œæ•…$ax$æ˜¯åç¼€ï¼Œ$x$ä¹Ÿæ˜¯åç¼€ã€‚$Reg(ST(a))$æ˜¯æ¯æ¬¡$a$å‡ºç°åæ¥ä¸‹æ¥çš„åç¼€ã€‚è®¾<strong>Right(a)</strong> ä¸ºaæ¯æ¬¡å‡ºç°çš„å¼€åŒºé—´æœ«ä½ç½®ï¼Œåˆ™$Reg(ST(a))$å®Œå…¨ç”±$Right(a)$å†³å®šã€‚</p>
</li>
<li><p>å¯¹äºçŠ¶æ€$s$ï¼ˆä¸æ˜¯å•ä¸ªå­—ç¬¦ä¸²ï¼‰ï¼Œæˆ‘ä»¬å…³å¿ƒ$Reg(s)$ã€‚å¦‚æœå¯¹äº$a,b\in Fac$æœ‰$Right(a)&#x3D;Right(b)$ï¼Œé‚£ä¹ˆå¯ä»¤$ST(a)&#x3D; ST(b)$ã€‚æ‰€ä»¥ä¸€ä¸ªçŠ¶æ€$s$ç”±æ‰€æœ‰$Right$é›†åˆæ˜¯<strong>Right(s)</strong> çš„å­—ç¬¦ä¸²ç»„æˆã€‚</p>
</li>
<li><p>è€ƒè™‘çŠ¶æ€$s$åŒ…æ‹¬çš„å­—ç¬¦ä¸²é•¿åº¦ï¼Œæ˜“è¯è‹¥$s$åŒ…å«é•¿åº¦ä¸º$l$,$r$çš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆä¸€å®šåŒ…å«é•¿åº¦ä¸º$m(l \leq m \leq r)$çš„å­—ç¬¦ä¸²ã€‚æ‰€ä»¥è¿™äº›å­—ç¬¦ä¸²é•¿åº¦ä¸€å®šå¯ä»¥ç»„æˆä¸€ä¸ªåŒºé—´ï¼Œè®¾ä¸º <strong>[Min(s), Max(s)]</strong></p>
</li>
<li><p>çŠ¶æ€æ•°æ˜¯çº¿æ€§çš„ã€‚<br/>ã€€ã€€çŠ¶æ€ç”±$Right$é›†åˆå†³å®šï¼Œè€ƒè™‘ä¸¤ä¸ªçŠ¶æ€$a,b$çš„$Right$é›†åˆ$R_a,R_b$ã€‚å‡è®¾$R_a,R_b$æœ‰äº¤é›†ï¼Œè®¾$r \in R_a \cap R_b$ã€‚ç”±äºä¸€ä¸ªå­ä¸²åªèƒ½å±äºä¸€ä¸ªçŠ¶æ€ï¼Œæ‰€ä»¥$a$ï¼Œ$b$æ‰€è¡¨ç¤ºçš„å­ä¸²ä¸ä¼šæœ‰äº¤é›†ï¼Œå³ç”±$r$å¾€å‰ä¸èƒ½æœ‰é•¿åº¦ç›¸åŒçš„å­ä¸²ï¼Œæ•…$[Min(a), Max(a)]$å’Œ$[Min(b), Max(b)]$æ²¡æœ‰äº¤é›†ï¼Œä¸å¦¨è®¾$Max(a) &lt; Min(b)$ï¼Œç”±äº$a$ï¼Œ$b$åŒ…å«çš„æ‰€æœ‰ä¸²éƒ½å¯ä»¥è§†ä¸º$r$å¾€å‰çš„å­ä¸²ï¼Œæ•…$a$çš„æ‰€æœ‰ä¸²éƒ½æ˜¯$b$çš„ä»»æ„ä¸²çš„åç¼€ã€‚å› $b$çš„ä»»æ„ä¸²éƒ½èƒ½æ‰¾åˆ°åç¼€å±äº$a$ï¼Œä¸¤è€…$Right$é›†åˆåˆä¸ç›¸ç­‰ï¼Œæ•…$R_b \subset R_a$ã€‚é‚£ä¹ˆä»»æ„ä¸¤ä¸ªçŠ¶æ€çš„$Right$é›†åˆè¦ä¹ˆä¸ç›¸äº¤ï¼Œè¦ä¹ˆä¸€ä¸ªæ˜¯å¦ä¸€ä¸ªçš„çœŸå­é›†ã€‚<br/>ã€€ã€€ç–¾é£å°†ä»¥çŠ¶æ€ä¸ºèŠ‚ç‚¹ï¼Œä»¥$Right$åŒ…å«å…³ç³»ä¸ºçˆ¶å­å…³ç³»æ„æˆçš„æ ‘å« <strong>â€œåˆ†è£‚æ ‘â€</strong> <br/>ã€€ã€€ä¸è€ƒè™‘å­—ç¬¦ä¸²è¿™ä¸ªä¸»é¢˜ï¼Œâ€œåˆ†è£‚æ ‘â€æ˜“è¯æ˜¯çº¿æ€§çš„ï¼›å®é™…ä¸Šï¼Œ$SAM$çš„ç»“ç‚¹ä¸ªæ•°æœ€å¤šä¸º$2n$ã€‚<br><br/><img src="/2020/10/01/Suffix-Automaton/%E5%88%86%E8%A3%82%E6%A0%91%E4%B8%BE%E4%BE%8B.png" alt="åˆ†è£‚æ ‘ä¸¾ä¾‹"></p>
</li>
<li><p>æ›´ä¸¥è°¨çš„åˆ†è£‚æ ‘å®šä¹‰ï¼šä»¤æ»¡è¶³$Right(s) \subset Right(fa)$çš„æœ€å°$|Right(fa)|$çš„$fa$ä¸ºçŠ¶æ€$s$çš„çˆ¶äº²ã€‚<br/>ã€€ã€€ç›´è§‚åœ°çœ‹ï¼Œä¸€å®šæ˜¯$fa$ä¸­æœ€é•¿çš„å­—ç¬¦ä¸²å‘å‰æ‰©å±•ä¸€ä½å¯¼è‡´äº†$Right$é›†åˆåˆ†è£‚ï¼Œæ‰€ä»¥$Max(fa)+1&#x3D;Min(s)$ã€‚</p>
</li>
<li><p>è‡ªåŠ¨æœºçš„è¾¹æ•°æ˜¯çº¿æ€§çš„ã€‚<br/>ã€€ã€€ç›´è§‚åœ°çœ‹ï¼Œè‡ªåŠ¨æœºæ˜¯ä¸€ä¸ªDAGï¼ˆå¦åˆ™å¯ä»¥æ— é™åœ°åœ¨è‡ªåŠ¨æœºä¸Šèµ°ï¼Œå³è¯†åˆ«æ— é™é•¿çš„å­—ç¬¦ä¸²ï¼Œæ˜¾ç„¶è¿™æ˜¯ä¸å¯èƒ½çš„ï¼‰ï¼Œè€Œèƒ½ä»$init$èµ°åˆ°æŸä¸ª$end$ç‚¹çš„è‚¯å®šæ˜¯å­—ç¬¦ä¸²çš„æŸä¸€ä¸ªåç¼€ã€‚å­—ç¬¦ä¸²åªæœ‰$n$ä¸ªåç¼€ï¼Œæ„å‘³ç€ä»$init$åˆ°$end$åªèƒ½æœ‰$n$ç§è·¯å¾„ï¼›å¦ä¸€æ–¹é¢ï¼ŒèŠ‚ç‚¹æ•°åªæœ‰$O(n)$ï¼Œæ‰€ä»¥çŒœæµ‹è¾¹æ•°ä¹Ÿæ˜¯$O(n)$çš„ã€‚<br/>ã€€ã€€æ ‡å‡ºè‡ªåŠ¨æœºä»»æ„ä¸€ä¸ªç”Ÿæˆæ ‘ï¼Œåˆ™å¯¹äºä¸€æ¡éæ ‘è¾¹$(a\rightarrow b)$ï¼Œå­˜åœ¨è‹¥å¹²è·¯å¾„${init \rightarrowtail a \rightarrow b \rightarrowtail e(e\in end)}$å¯¹åº”ç€ä¸€ä¸ªåç¼€ã€‚å¯¹æ¯ä¸€ä¸ªåç¼€ï¼Œå¯¹åº”åœ¨è‡ªåŠ¨æœºä¸Šèµ°åˆ°çš„ç¬¬ä¸€æ¡éæ ‘è¾¹ã€‚å¦‚æ­¤æ¯ä¸ªåç¼€æœ€å¤šå¯¹åº”ä¸€ä¸ªéæ ‘è¾¹ï¼Œè€Œéæ ‘è¾¹è‡³å°‘è¢«ä¸€ä¸ªåç¼€å¯¹åº”ï¼Œæ‰€ä»¥åç¼€æ•°é‡$\geq$éæ ‘è¾¹æ•°é‡ã€‚æ‰€ä»¥è¾¹æ•°æ˜¯$O(n)$çš„ã€‚</p>
</li>
</ol>
<h2 id="å½’çº³æ³•æ„é€ SAM"><a href="#å½’çº³æ³•æ„é€ SAM" class="headerlink" title="å½’çº³æ³•æ„é€ SAM"></a>å½’çº³æ³•æ„é€ SAM</h2><h3 id="SAMçš„æ›´å¤šæ€§è´¨"><a href="#SAMçš„æ›´å¤šæ€§è´¨" class="headerlink" title="SAMçš„æ›´å¤šæ€§è´¨"></a>SAMçš„æ›´å¤šæ€§è´¨</h3><p><em>è¿™ä¸€éƒ¨åˆ†æ˜¯SAMæ„é€ ç®—æ³•çš„é‡è¦ä¾æ®ã€‚<br/>è¯·ç¡®è®¤ä¸Šæ–‡æ‰€æœ‰åŠ ç²—å†…å®¹éƒ½å·²ç†è§£ã€‚</em></p>
<ol>
<li><p>åç¼€è‡ªåŠ¨æœºæ˜¯ä¸€ä¸ªæœ‰å‘æ— ç¯å›¾<br>$$<br>SAM &#x3D; {åˆ†è£‚æ ‘çš„ç‚¹ï¼Œè‡ªåŠ¨æœºçš„æœ‰å‘è¾¹}<br>$$ </p>
</li>
<li><p>SAMçš„æ„é€ ç®—æ³•æ˜¯åœ¨çº¿çš„ï¼Œå³ä»å·¦åˆ°å³é€ä¸ªæ·»åŠ å­—ç¬¦ã€‚æ ¹æ®æ•°å­¦å½’çº³æ³•ï¼Œ<strong>ä¸‹æ–‡å‡è®¾å·²æœ‰å­—ç¬¦ä¸²$T$çš„åç¼€è‡ªåŠ¨æœº</strong>ã€‚</p>
</li>
<li><p>è€ƒè™‘ä¸€ä¸ªçŠ¶æ€$s$ï¼Œå®ƒçš„$Right(s)&#x3D;{r_1, r_2, \cdots, r_n}$ï¼Œå‡å¦‚æœ‰çŠ¶æ€è½¬ç§»$trans(s,c) &#x3D; t$ï¼ˆå³çŠ¶æ€$s$åæ·»åŠ ä¸€ä¸ªå­—ç¬¦$c$å¾—åˆ°çŠ¶æ€$t$ï¼‰ï¼Œç”±äºå‘å³æ‰©å±•äº†ä¸€ä½å­—ç¬¦ï¼Œ$Right(s)$ä¸­åªæœ‰$T[r_i]&#x3D;c$çš„æ»¡è¶³è¦æ±‚ã€‚æ‰€ä»¥$Right(t)&#x3D;{r_i+1 | T[r_i]&#x3D;c}$ã€‚<br/>ã€€ã€€å¦‚æœ$trans(s,c)$å­˜åœ¨ï¼Œé‚£ä¹ˆ$trans(Pa(s), c)$å¿…å®šå­˜åœ¨ï¼Œå…¶ä¸­$Pa(s)$è¡¨ç¤ºåˆ†è£‚æ ‘ä¸ŠçŠ¶æ€$s$çš„çˆ¶äº²ã€‚å¹¶ä¸”$Right(trans(s,c)) \subseteq Right(trans(Pa(s),c))$ã€‚<br/>ã€€ã€€å¦ä¸€ä¸ªæ˜¾ç„¶çš„ç»“è®ºæ˜¯$Max(s)&lt;Max(t)$ã€‚</p>
</li>
<li><p>åç¼€è‡ªåŠ¨æœºæ²¡æœ‰æ˜¾å¼åœ°å‚¨å­˜$Right$é›†åˆã€‚å› æ­¤å¯ä»¥è®¤ä¸ºä¿®æ”¹$Right$çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(0)$ã€‚</p>
</li>
<li><p>åˆå§‹çŠ¶æ€æ—¶æ¯ä¸²$T$ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œè‡ªåŠ¨æœºåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹$root$ã€‚</p>
</li>
</ol>
<h3 id="æ·»åŠ ä¸€ä½å­—ç¬¦æ›´æ–°è‡ªåŠ¨æœº"><a href="#æ·»åŠ ä¸€ä½å­—ç¬¦æ›´æ–°è‡ªåŠ¨æœº" class="headerlink" title="æ·»åŠ ä¸€ä½å­—ç¬¦æ›´æ–°è‡ªåŠ¨æœº"></a>æ·»åŠ ä¸€ä½å­—ç¬¦æ›´æ–°è‡ªåŠ¨æœº</h3><p>ã€€ã€€ä»¤å½“å‰å­—ç¬¦ä¸²ä¸º$T$ï¼Œé•¿åº¦ä¸º$L$ï¼›æœ«å°¾æ·»åŠ ä¸€ä¸ªå­—ç¬¦$x$ï¼Œè¦å°†$SAM(T)$æ›´æ–°ä¸º$SAM(Tx)$ã€‚<br><br/>ã€€ã€€é‚£ä¹ˆæ–°å¢çš„å­ä¸²æ˜¯$Tx$çš„æ‰€æœ‰åç¼€ï¼Œå¯çœ‹ä½œ$T$çš„æ‰€æœ‰åç¼€åæ·»åŠ äº†$x$ã€‚ä»¤$SAM(T)$ä¸­è¡¨ç¤º$T$çš„åç¼€çš„èŠ‚ç‚¹ä¸º${v_1, v_2, \cdots, v_k&#x3D;root}$ã€‚å› ä¸ºåç¼€åœ¨å­—ç¬¦ä¸²çš„æœ«å°¾å‡ºç°ï¼Œæ‰€ä»¥$L\in Right(v_i)$ï¼Œå¯çŸ¥$v_i$åœ¨åˆ†è£‚æ ‘ä¸Šæ°å¥½æ„æˆä¸€æ¡ä»å¶å­åˆ°$root$çš„é“¾ï¼Œä¸å¦¨è®¾${v_1, v_2, \cdots, v_k&#x3D;root}$å·²ç»æŒ‰ä»å¶å­åˆ°ç¥–å…ˆæ’åºã€‚<br><br/>ã€€ã€€æ·»åŠ å­—ç¬¦$x$åï¼Œé¦–å…ˆæ–°å»ºçŠ¶æ€$np$è¡¨ç¤º$ST(Tx)$ï¼Œè¿™æ˜¯ä¸€ä¸ªå·²ç¡®å®šçš„çŠ¶æ€ï¼ˆå› ä¸ºæ²¡æœ‰å‡ºè¾¹ï¼‰ï¼Œå¯çŸ¥$Right(np)&#x3D;{L+1}$ã€‚<br><br/>ã€€ã€€å›å¤´è€ƒè™‘æ—§è‡ªåŠ¨æœºçš„$v_i$ï¼Œè®¾$Right(v_i)&#x3D;{r_1, r_2, \cdots, r_n&#x3D;L}$ã€‚å¦‚æœèƒ½åœ¨åé¢æ·»åŠ å­—ç¬¦$x$ï¼ˆæ³¨æ„ç°åœ¨ä»æ˜¯å­—ç¬¦ä¸²$T$çš„è‡ªåŠ¨æœºï¼‰ï¼Œå³$nv&#x3D;trans(v_i, x)$å­˜åœ¨ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“$Right(nv)&#x3D;{r_i+1|T[r_i]&#x3D;x}$ï¼›åä¹‹å¦‚æœ$v_i$æ²¡æœ‰$x$çš„å‡ºè¾¹ï¼Œæ„å‘³ç€æ²¡æœ‰$r_i$æ»¡è¶³$T[r_i]&#x3D;x$ã€‚ç”±äºåˆ†è£‚æ ‘ä¸Šçˆ¶äº²çš„$Right$æ‰©å¤§ï¼Œå¦‚æœ$trans(v_i,x)$å­˜åœ¨ï¼Œé‚£ä¹ˆ$trans(v_{i+1}, x)$ä¹Ÿå­˜åœ¨ã€‚<br><br/>ã€€ã€€å¯¹äºæ‰€æœ‰$trans(v,x)&#x3D;null$çš„$v$ï¼Œè€Œåªæœ‰$Tx[r_n&#x3D;L]&#x3D;x$æ»¡è¶³è½¬ç§»æ¡ä»¶ï¼Œäºæ˜¯æ·»åŠ ä¸€æ¡è¾¹$trans(v,x)&#x3D;np$ã€‚<br><br/>ã€€ã€€ä»¤$v_p$æ˜¯$v_1, v_2, \cdots, v_k$ä¸­ç¬¬ä¸€ä¸ªæœ‰$x$å‡ºè¾¹ï¼ˆå³$trans(v_p, x)$å­˜åœ¨ï¼‰çš„çŠ¶æ€ã€‚ä»¤$q&#x3D;trans(v_p, x)$ï¼Œæ³¨æ„ï¼Œç°åœ¨ä»æ˜¯æ—§çš„è‡ªåŠ¨æœºã€‚æˆ‘ä»¬èƒ½ä¸èƒ½ç›´æ¥åœ¨$Right(q)$ä¸­ç›´æ¥æ’å…¥$L+1$å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸èƒ½ã€‚è¿™æ˜¯å› ä¸ºæœ‰å¯èƒ½$Max(q) &gt; Max(v_p)+1$ï¼Œéšå«æ„æ€æ˜¯$q$åœ¨â€$v_p$æœ«å°¾æ·»åŠ $x$â€çš„åŸºç¡€ä¸Šï¼Œç”±äº$Right$é›†åˆçš„ç¼©å‡ï¼Œçº³å…¥äº†å·¦ç«¯æ›´å¤šå­—ç¬¦ï¼›å¦‚æœå¼ºè¡Œåœ¨$Right(q)$ä¸­æ’å…¥$L+1$ï¼Œä¼šå¯¼è‡´$Max(q)$å‡å°è€Œä¸¢å¤±äº†åŸæ¥çš„çŠ¶æ€ï¼Œç ´åäº†è‡ªåŠ¨æœºçš„æ­£ç¡®æ€§ã€‚</p>
<p><img src="/2020/10/01/Suffix-Automaton/%E5%BC%BA%E8%A1%8C%E6%8F%92%E5%85%A5%E7%9A%84%E5%8F%8D%E4%BE%8B.png" alt="å¼ºè¡Œæ’å…¥çš„åä¾‹"><br><br/>ã€€ã€€å¦‚å›¾æ‰€ç¤ºï¼Œ$v_p$å«æœ‰çš„æœ€é•¿å­—ç¬¦ä¸²æ˜¯çº¢è‰²5ä¸ªâ€œAâ€ï¼Œä½†$trans(v_p,x)&#x3D;q$å«æœ‰çš„æœ€é•¿å­—ç¬¦ä¸²æ˜¯è“è‰²7ä½å­—ç¬¦ä¸²ï¼Œå¦‚æœåœ¨$Right(q)$ä¸­å¼ºè¡Œæ’å…¥$L+1$å³å˜ä¸ºç»¿è‰²éƒ¨åˆ†ï¼Œä¼šä½¿$Max(q)$ä»7å‡å°‘åˆ°6ä»è€Œä¸¢å¤±ä¿¡æ¯ã€‚<br><br/>ã€€ã€€å¦‚æœè¶³å¤Ÿå¹¸è¿ï¼Œ$Max(q) &#x3D; Max(v_p)+1$ï¼Œå°±æ²¡æœ‰ä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨$Right(q)$ä¸­æ’å…¥$L+1$ï¼Œç„¶ååªè¦ä»¤$Pa(np)&#x3D;q$å³å¯å®Œæˆè‡ªåŠ¨æœºæ›´æ–°ã€‚<em>æ³¨ï¼šç†è®ºä¸Š$Right(trans(v_p\dots v_k,x))$éƒ½è¦æ’å…¥$L+1$ï¼Œä½†è¿™äº›çŠ¶æ€çš„å‡ºè¾¹éƒ½æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œè€Œåç¼€è‡ªåŠ¨æœºå®é™…ä¸Šä¸è®°å½•$Right$ï¼Œæ‰€ä»¥æ›´æ–°å®Œæˆã€‚</em><br><br/>ã€€ã€€å¦‚æœæ²¡é‚£ä¹ˆå¹¸è¿ï¼Œä»å›¾ä¸Šå¯çŸ¥ï¼ŒåŸçŠ¶æ€$q$åœ¨æ’å…¥æœ«å°¾å­—ç¬¦$x$ååº”è½¬æ¢ä¸¤ä¸ªçŠ¶æ€ï¼Œè®¾è“è‰²å¯¹åº”çš„çŠ¶æ€ä¸º$q&#39;$ï¼ˆæ²¿ç”¨$q$)ï¼Œç»¿è‰²çŠ¶æ€ä¸º$nq$ï¼ˆæ–°å»ºèŠ‚ç‚¹ï¼‰ã€‚æ˜¾ç„¶<br>$$<br>trans(q&#39;, *) &#x3D; trans(q, *), \<br>Pa(q&#39;)&#x3D;nqï¼Œ\<br>Right(nq)&#x3D;Right(q&#39;)\cup {L+1}ï¼Œ\<br>Max(nq) &#x3D; Max(v_p)+1<br>$$<br>æ˜¾ç„¶$Right(nq)$æ˜¯çœŸåŒ…å«${L+1}$çš„æœ€å°é›†åˆï¼Œæ‰€ä»¥<br>$$ Pa(np)&#x3D;nq $$<br><br/>ã€€ã€€æˆªè‡³ç›®å‰æˆ‘ä»¬æ–°æ·»äº†$np$ï¼Œå°†$q$è½¬åŒ–ä¸º$q&#39;,nq$ï¼Œå…¶ä¸­$np,q&#39;$éƒ½æ­£ç¡®å¤„ç†äº†å‡ºè¾¹å’Œåˆ†è£‚æ ‘çˆ¶äº²ã€‚<br>é‚£ä¹ˆ$nq$çš„åˆ†è£‚æ ‘çˆ¶äº²åˆæ˜¯è°å‘¢ï¼Ÿç»“åˆä¸Šå›¾æ˜“è¯<br>$$ Pa(nq)&#x3D;Pa(q) $$</p>
<p>$nq$çš„å‡ºè¾¹æ˜¯å“ªä¸€äº›ï¼Ÿç”±äºæ–°æ·»çš„æœ€åä¸€ä¸ªå­—ç¬¦ä¸èƒ½å¸¦æ¥æ›´å¤šçš„çŠ¶æ€è½¬ç§»ï¼ˆæœ€åä¸€ä¸ªå­—ç¬¦åé¢å†æ²¡æœ‰å­—ç¬¦äº†ï¼‰ï¼Œæ‰€ä»¥<br>$$ trans(nq, *) &#x3D; trans(q, *) $$<br><br/>ã€€ã€€æœ€åï¼Œæˆ‘ä»¬è¿˜è¦è€ƒè™‘åŸè‡ªåŠ¨æœºä¸­æŒ‡å‘$q$çš„çŠ¶æ€ï¼Œå’Œæ–°è‡ªåŠ¨æœºä¸­åº”å½“æŒ‡å‘$q&#39;$å’Œ$nq$çš„çŠ¶æ€ã€‚åœ¨$v_p,\cdots,v_k$ä¸­ï¼Œç”±äº$Right$çš„æ‰©å¤§ï¼Œ$Right(trans(v_i,x))$ä¹Ÿé€æ¸æ‰©å¤§ï¼ˆä¸ç¼©å°ï¼‰ï¼Œæ‰€ä»¥åªæœ‰ä¸€æ®µè¿ç»­çš„$v_p,\cdots,v_e(e\le k)$æ˜¯æŒ‡å‘$q$çš„ï¼Œç”±äºè¦é…åˆåœ¨$Right$é›†åˆä¸­æ’å…¥$L+1$ï¼Œè¿™äº›å‡ºè¾¹è¦ä¿®æ”¹ä¸º<br>$$ trans(v_i,x) &#x3D; nq $$<br>å…¶ä½™æŒ‡å‘$q$çš„çŠ¶æ€å¿…ç„¶ç”±äºå·¦ç«¯æœ‰è¿‡å¤šå­—ç¬¦è€Œæ— æ³•æŒ‡å‘$nq$ï¼Œäºæ˜¯æ”¹ä¸ºæŒ‡å‘$q&#39;$ï¼Œç­‰æ•ˆäºä¸åšä»»ä½•ä¿®æ”¹ã€‚<br><br/>ã€€ã€€æœ€åçš„æœ€åï¼Œå¯¹äº$v_{e+1},\cdots,v_k$ï¼Œå¯¹äº$nv&#x3D;trans(v_i, x)$ï¼Œå¿…ç„¶å¯ä»¥ç²—æš´åœ°ä»¤$Right(nv)$æ’å…¥$L+1$ï¼Œæ‰€ä»¥è½¬ç§»å…³ç³»å¯ä»¥ä¿æŒä¸å˜ï¼Œç­‰æ•ˆäºä¸åšä»»ä½•ä¿®æ”¹ã€‚</p>
<h1 id="æ ‡å‡†ä»£ç "><a href="#æ ‡å‡†ä»£ç " class="headerlink" title="æ ‡å‡†ä»£ç "></a>æ ‡å‡†ä»£ç </h1><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXW = <span class="number">26</span>, MAXN = <span class="number">1e5</span>+<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">State</span> &#123;</span><br><span class="line">	State* go[MAXW];</span><br><span class="line">	State* pa;</span><br><span class="line">	<span class="type">int</span> mx;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">State</span>(<span class="type">int</span> MX):<span class="built_in">pa</span>(<span class="number">0</span>), <span class="built_in">mx</span>(MX) &#123;</span><br><span class="line">		<span class="built_in">memset</span>(go, <span class="number">0</span>, <span class="built_in">sizeof</span>(<span class="number">0</span>));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">State</span>(<span class="type">const</span> State* o) &#123;</span><br><span class="line">		pa = o-&gt;pa;</span><br><span class="line">		<span class="built_in">memcpy</span>(go, o-&gt;go, <span class="built_in">sizeof</span>(o-&gt;go));</span><br><span class="line">		mx = o-&gt;mx;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;*last, *root;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">extend</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">	State* p = last;</span><br><span class="line">	State* np = <span class="keyword">new</span> <span class="built_in">State</span>(p-&gt;mx+<span class="number">1</span>);</span><br><span class="line">	last = np;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (p &amp;&amp; p-&gt;go[x]==<span class="number">0</span>)</span><br><span class="line">		p-&gt;go[x] = np, p = p-&gt;pa;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (p == <span class="number">0</span>) <span class="keyword">return</span> np-&gt;pa = root, <span class="built_in">void</span>();</span><br><span class="line"></span><br><span class="line">	State* q = p-&gt;go[x];</span><br><span class="line">	<span class="keyword">if</span> (p-&gt;mx+<span class="number">1</span> == q-&gt;mx)</span><br><span class="line">		<span class="keyword">return</span> np-&gt;pa = q, <span class="built_in">void</span>();</span><br><span class="line"></span><br><span class="line">	State* nq = <span class="keyword">new</span> <span class="built_in">State</span>(q);</span><br><span class="line">	nq-&gt;mx = p-&gt;mx+<span class="number">1</span>;</span><br><span class="line">	q-&gt;pa = np-&gt;pa = nq;</span><br><span class="line">	<span class="keyword">while</span> (p &amp;&amp; p-&gt;go[x]==q)</span><br><span class="line">		p-&gt;go[x] = nq, p = p-&gt;pa;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> st[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, st);</span><br><span class="line"></span><br><span class="line">	last = root = <span class="keyword">new</span> <span class="built_in">State</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; st[i]!=<span class="string">&#x27;\0&#x27;</span>; ++i)</span><br><span class="line">		<span class="built_in">extend</span>(st[i]);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="ç»“æŸè¯­"><a href="#ç»“æŸè¯­" class="headerlink" title="ç»“æŸè¯­"></a>ç»“æŸè¯­</h1><p>ã€€ã€€SAMæ€è·¯çœŸçš„å¼‚å¸¸ç²¾å¦™ï¼Œç¯ç¯ç›¸æ‰£ï¼Œå·§å¤ºå¤©å·¥ã€‚ä¸å¹¸çš„æ˜¯ä¼˜ç¾çš„ç»“è®ºæ˜¯ä»¥å¤æ‚è€Œåºå¤§çš„è®ºè¯ä¸ºä»£ä»·çš„ã€‚<br><br/>ã€€ã€€è¢«å¥‰ä¸ºåœ£ç»çš„<code>2012å¹´noiå†¬ä»¤è¥é™ˆç«‹æ°è®²ç¨¿(SAMåç¼€è‡ªåŠ¨æœº)</code>åœ¨æè¿°æ„é€ è¿‡ç¨‹çš„æ—¶å€™æ²¡æœ‰è§£é‡Šå¯ä»¥çœç•¥çš„æ“ä½œä¸ºä»€ä¹ˆè¢«çœç•¥ï¼Œå¯¼è‡´æ€è·¯æœ‰å¾ˆå¤§æ®‹ç¼ºå’Œè·³è·ƒã€‚å³ä½¿æ˜¯æœ¬æ–‡ä¹Ÿç”¨äº†ä¸å°‘â€œæ˜¾ç„¶â€å­—çœ¼ï¼Œä½†æ¯”è¾ƒåŸæ–‡å·²æœ‰è¾ƒå¤§æ”¹è¿›ã€‚å¦å¤–ï¼ŒåŸè®²ç¨¿æ²¡æœ‰äº¤ä»£æ„é€ ç®—æ³•ä¸ºä»€ä¹ˆæ˜¯$O(n)$çš„ã€‚<del>ç–¾é£ç†è§£è¿™pptèŠ±äº†æ•´æ•´ä¸‰å¤©</del>å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¸å¦¨èµç–¾é£ä¸€æ”¯å†°é˜”ä¹å–ï¼ˆé¦‹.jpgï¼‰<br><br/>ã€€ã€€æœ‰äººè¯´SAMå®Œå…¨å¯ä»¥å½“åšé»‘ç›’æ¥ç”¨ï¼Œæˆ‘è®¤ä¸ºä¸ç„¶ã€‚é»‘ç›’SAMçš„å”¯ä¸€åŠŸèƒ½æ˜¯åˆ¤å®šå­ä¸²æ˜¯å¦å­˜åœ¨ï¼Œå±€é™æ€§å¾ˆå¤§ã€‚è€ŒSAMçš„å®æˆ˜åº”ç”¨ä»£ç ç›¸å¯¹è£¸æ„é€ æœ‰å¾ˆå¤§å¢æ”¹ï¼Œä¾‹å¦‚è¦ç»“åˆdfsåºï¼Œå¹³è¡¡æ ‘ï¼ŒåŠ¨æ€æ ‘ç­‰ç­‰æŠ€å·§ï¼Œä¸”éƒ½æ˜¯å»ºç«‹åœ¨å®Œå…¨ç†è§£åç¼€è‡ªåŠ¨æœºçš„åŸºç¡€ä¸Šï¼Œéš¾åº¦ä¾ç„¶å¾ˆå¤§ã€‚è¿™éƒ¨åˆ†æ—¥åå†å¡«è¡¥ã€‚</p>
<p><em>è½¬è½½è¯·æ³¨æ˜åŸä½œè€…å’Œç½‘å€</em></p>
]]></content>
      <tags>
        <tag>å­—ç¬¦ä¸²</tag>
        <tag>æ•°æ®ç»“æ„</tag>
      </tags>
  </entry>
  <entry>
    <title>UbuntuåŒç³»ç»ŸåŒæ˜¾å¡è£…æœº</title>
    <url>/2020/01/25/Ubuntu%E8%A3%85%E6%9C%BA%E7%AC%94%E8%AE%B0/</url>
    <content><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å¾ˆä¹…ä¹‹å‰å°±åœ¨Windowsç¬”è®°æœ¬ä¸Šè£…äº†ubuntu 18.04 LTSï¼Œå› ä¸ºæ˜¯åŒç³»ç»Ÿï¼Œéœ€è¦æ‰‹åŠ¨ç»™ç¡¬ç›˜åˆ†åŒºï¼Œè€Œå½“æ—¶ubuntuçš„ç³»ç»Ÿåˆ†åŒºè´¼å¤šï¼ŒåŸ‹ä¸‹äº†æŸä¸€ä¸ªåˆ†åŒºè¿‡å°çš„ä¼ç¬”ã€‚æœ€è¿‘æŸFilesystemå¡æ»¡äº†ï¼ˆ500MBï¼‰ï¼Œæ‰å‘ç°å¾ˆå¤šåŒç³»ç»Ÿå®‰è£…æ•™ç¨‹æ²¡æœ‰å¸è½½æ•™ç¨‹ï¼</p>
<p>äºæ˜¯æ¢ç´¢çš„æ—…ç¨‹åˆå¼€å§‹äº†ã€‚<strong>æˆ‘ä»¬å°†å¸è½½ç°æœ‰çš„Ubuntuç³»ç»Ÿï¼Œè°ƒæ•´ç¡¬ç›˜åˆ†åŒºï¼Œç„¶åé‡è£…ubuntuï¼Œå¹¶å®‰è£…æœ€æ£’çš„è½¯ä»¶å’Œé©±åŠ¨</strong>ã€‚</p>
<span id="more"></span>

<h1 id="å¸è½½åŸæœ‰ubuntu"><a href="#å¸è½½åŸæœ‰ubuntu" class="headerlink" title="å¸è½½åŸæœ‰ubuntu"></a>å¸è½½åŸæœ‰ubuntu</h1><p>åŸæœ‰çš„ç³»ç»Ÿæ˜¯æ‰‹åŠ¨åˆ†åŒºçš„ï¼Œå¯¼è‡´ä¸€ä¸ªç¡¬ç›˜ä¸Šåˆ†åŒºæ•°è¾ƒå¤šã€‚</p>
<ol>
<li>å¯åŠ¨Windowsç³»ç»Ÿï¼Œä½¿ç”¨åˆ†åŒºåŠ©æ‰‹å°†ubuntuå ç”¨çš„åˆ†åŒºåˆå¹¶ï¼Œå¹¶æ ¼å¼åŒ–æˆext4ç³»ç»Ÿã€‚ï¼ˆæ ¼å¼åŒ–ä¼¼ä¹ä¸æ˜¯å¿…è¦æ­¥éª¤ï¼‰</li>
<li>å‡†å¤‡å¥½ubuntuè£…æœºuç›˜ã€‚åº”è¯¥éƒ½ä¼šå§ï¼ç”¨UltraISOã€‚</li>
<li>è°ƒæ•´BIOSè®¾ç½®ã€‚è®¾ç½®ä¸ºuç›˜å¯åŠ¨ï¼Œå…³é—­secure bootï¼Œåç¡•çš„ä¸»æ¿è¿˜è¦å…³é—­fast bootã€‚</li>
</ol>
<h1 id="å®‰è£…ubuntu-18-04-3-LTS"><a href="#å®‰è£…ubuntu-18-04-3-LTS" class="headerlink" title="å®‰è£…ubuntu 18.04.3 LTS"></a>å®‰è£…ubuntu 18.04.3 LTS</h1><ol>
<li>uç›˜å¯åŠ¨ï¼Œé€‰æ‹©è¯•ç”¨ubuntuã€‚</li>
<li>å¼€å§‹å®‰è£…ï¼Œæ¥å¥½wifiã€‚åœ¨è¯¢é—®æ˜¯å¦ä¸windowså…±å­˜çš„æ—¶å€™ç‚¹è‡ªå®šä¹‰ã€‚åœ¨åˆ†åŒºè¡¨ä¸­å°†åˆšåˆšåœ¨åˆ†åŒºåŠ©æ‰‹ä¸­åˆå¹¶çš„åˆ†åŒºåˆ é™¤ï¼Œå½’è¿˜çš„ç©ºé—´åˆ†é…åˆ°windowsçš„Cç›˜ä¸Šã€‚ç„¶ååé€€ï¼Œé€‰æ‹©ä¸windowså…±å­˜ã€‚</li>
<li>è¿™æ—¶ç•Œé¢è®©ä½ åˆ†å‰²windowsçš„Cç›˜ï¼Œä¾›ubuntuä½¿ç”¨ã€‚æˆ‘åˆ†å‰²äº†32GBï¼Œå»ºè®®è´ªå¤šï¼ŒåŸå› ç„å­¦ã€‚</li>
<li>ä¸€è·¯å®‰è£…ï¼Œæ²¡ä»€ä¹ˆå¤§é—®é¢˜ã€‚</li>
</ol>
<h1 id="ç™»å½•ubuntu"><a href="#ç™»å½•ubuntu" class="headerlink" title="ç™»å½•ubuntu"></a>ç™»å½•ubuntu</h1><p>å› ä¸ºæ˜¯åŒæ˜¾å¡ï¼ˆIntelé›†æ˜¾ + Geforce MX150ï¼‰ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å¼€æœºç™»å½•å›°éš¾ï¼ŒåŸå› æ˜¯é»˜è®¤çš„ç‹¬æ˜¾é©±åŠ¨æœ‰é—®é¢˜ï¼Œå¯¼è‡´æœºå™¨å¡æ­»ã€‚</p>
<ol>
<li><p>åœ¨grubå¼•å¯¼æ—¶ï¼Œå¯¹ubuntuæŒ‰&quot;e&quot;ï¼Œå€’æ•°ç¬¬äºŒè¡Œæ‰¾åˆ°<code>quiet splash *</code>ï¼Œä¿®æ”¹ä¸º<code>quiet splash acpi_osi=linux nomodeset *</code>ï¼ŒæŒ‰&quot;F10&quot;å¼•å¯¼ã€‚è¿™ä¹ˆåšæ˜¯ä¸ºäº†ç¦ç”¨æ‰€æœ‰æ˜¾å¡é©±åŠ¨ã€‚</p>
</li>
<li><p>å¼€æœºååˆ†è¾¨ç‡æ˜¯800*600çš„ï¼Œæ“ä½œä¸ä¾¿æ—¶æŒ‰&quot;Alt+F7&quot;ç§»åŠ¨çª—å£ã€‚</p>
</li>
<li><p>å®‰è£…vimã€‚(å–œæ¬¢geditçš„ä¸å®‰è£…ä¹Ÿå®Œå…¨å¯ä»¥)</p>
</li>
<li><p>æŒ‰ç…§ä»¥ä¸‹ä»£ç ç¦ç”¨Nvidiaå¼€æºæ˜¾å¡é©±åŠ¨</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/modprobe.d/blacklist.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–‡ä»¶å†…åŠ å…¥ä»¥ä¸‹é»‘åå•</span></span><br><span class="line">blacklist vga16fb</span><br><span class="line">blacklist nouveau</span><br><span class="line">blacklist rivafb</span><br><span class="line">blacklist rivatv</span><br><span class="line">blacklist nvidiafb</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿å­˜é€€å‡ºï¼Œç„¶åæ›´æ–°booté…ç½®</span></span><br><span class="line">sudo update-initramfs -u</span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure></li>
<li><p>ç°åœ¨å¯ä»¥æ­£å¸¸å¼€æœºäº†ã€‚æ¥ä¸‹æ¥å®‰è£…Nvidiaå®˜æ–¹é—­æºé©±åŠ¨ï¼ˆå¯è·³è¿‡ï¼‰ã€‚æ‰“å¼€ubuntuè‡ªå¸¦è½¯ä»¶Software &amp; Updatesï¼Œåœ¨Additional Driversé‡Œå‹¾é€‰é—­æºé©±åŠ¨ï¼Œç‰ˆæœ¬å·é€‰å¤§ä¸€ç‚¹ï¼ŒApply Changesï¼Œç­‰ä¸€æ®µæ—¶é—´ä¸‹è½½å®‰è£…å³å¯ã€‚</p>
</li>
<li><p>é‡å¯ç”µè„‘ï¼ŒEnjoyï¼å¯ä»¥æ ¹æ®å–œå¥½è°ƒæ•´NVIDIA X Server Settingsçš„å†…å®¹ã€‚<br>PSï¼šä¸è¦è‡ªè¡Œä¸‹è½½è‹±ä¼Ÿè¾¾å®˜ç½‘çš„é©±åŠ¨ï¼äº²æµ‹æ— æ•ˆï¼ç›¸ä¿¡æˆ‘ï¼</p>
</li>
<li><p>è°ƒæ•´grubå¼•å¯¼ï¼Œè‡ªå·±çœ‹ç€åŠå§ï¼Œå½“ç„¶ä¸æ˜¯å¿…é¡»çš„ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/default/grub</span><br><span class="line">sudo update-grub</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="è§¦æ‘¸æ¿å³é”®å¤±çµ"><a href="#è§¦æ‘¸æ¿å³é”®å¤±çµ" class="headerlink" title="è§¦æ‘¸æ¿å³é”®å¤±çµ"></a>è§¦æ‘¸æ¿å³é”®å¤±çµ</h1><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gsettings <span class="built_in">set</span> org.gnome.desktop.peripherals.touchpad click-method areas</span><br></pre></td></tr></table></figure>

<h1 id="VIM"><a href="#VIM" class="headerlink" title="VIM"></a>VIM</h1><p>ubuntué»˜è®¤æºå·²ç»å¾ˆä¹…æ²¡æ›´æ–°Vimï¼Œæ‰€ä»¥åŠ ä¸Šæº</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:jonathonf/vim </span><br></pre></td></tr></table></figure>

<p>å†ç»™å‡ºç«èµ›ç”¨~&#x2F;.vimrcå²‚ä¸ç¾å“‰ï¼èµ¶ç´§èƒŒä¸‹æ¥ï¼</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">number</span></span><br><span class="line"><span class="keyword">set</span> <span class="built_in">cindent</span></span><br><span class="line"><span class="keyword">set</span> autoread</span><br><span class="line"><span class="keyword">set</span> tabstop=<span class="number">4</span></span><br><span class="line"><span class="keyword">set</span> softtabstop=<span class="number">4</span></span><br><span class="line"><span class="keyword">set</span> <span class="built_in">shiftwidth</span>=<span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;F9&gt;</span> :<span class="keyword">call</span> CompileCPP()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line">func! CompileCPP()</span><br><span class="line">    exec <span class="string">&quot;w&quot;</span></span><br><span class="line">    <span class="keyword">if</span> &amp;<span class="keyword">filetype</span> == <span class="string">&#x27;cpp&#x27;</span></span><br><span class="line">        exec <span class="string">&quot;g++ -Wall -DDEBUG % -o %&lt;&quot;</span></span><br><span class="line">    <span class="keyword">endif</span></span><br><span class="line">endfunc</span><br><span class="line"></span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;F10&gt;</span> :<span class="keyword">call</span> Run()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line">func! Run()</span><br><span class="line">    exec <span class="string">&quot;!./%&lt;&quot;</span></span><br><span class="line">endfunc</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæ§åˆ¶å°&quot;F10&quot;è¢«å ç”¨ï¼Œå°±åœ¨preferencesé‡Œå–æ¶ˆæ‰ã€‚</p>
<h1 id="Chrome"><a href="#Chrome" class="headerlink" title="Chrome"></a>Chrome</h1><p>æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œåªæƒ³è¯´ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dpkg --get-selections | grep firefox</span><br><span class="line">sudo apt purge firefox firefox-locale-en firefox-locale-zh-hans</span><br><span class="line">sudo apt autoremove</span><br><span class="line"><span class="comment"># å¸é©¬ç¬‘</span></span><br></pre></td></tr></table></figure>

<h1 id="VSCode"><a href="#VSCode" class="headerlink" title="VSCode"></a>VSCode</h1><p>å€ŸåŠ©Settings Syncæ’ä»¶å¯ä»¥å¾ˆå¿«é…ç½®Codeï¼Œä½†æ˜¯å„ç§taskè¿˜éœ€è¦è‡ªè¡Œå¤‡ä»½ã€‚</p>
<h1 id="é£æœº"><a href="#é£æœº" class="headerlink" title="é£æœº"></a>é£æœº</h1><p>ç¬¬ä¸€æ¬¡åœ¨~&#x2F;.localä¸‹å®‰è£…è½¯ä»¶ï¼Œéœ€è¦æ³¨é”€é‡ç™»å½•æ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚<br>æŸäº›ç®—æ³•éœ€è¦é¢å¤–çš„åº“ï¼Œæ¯”å¦‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt install libsodium-dev</span><br></pre></td></tr></table></figure>
<p>æå®šä¹‹ååœ¨Settings-&gt;...-&gt;Socks Hostä½œè°ƒæ•´å³å¯ã€‚</p>
<h1 id="ç¾åŒ–"><a href="#ç¾åŒ–" class="headerlink" title="ç¾åŒ–"></a>ç¾åŒ–</h1><p>è°ƒæ•´æ§åˆ¶å°çš„é…è‰²å’Œé€æ˜åº¦ï¼Œæ¢å£çº¸ç­‰ç­‰ï¼Œä¸å¤šè¯´äº†ã€‚</p>
<p>ubuntuå¾ˆé¸¡è´¼ï¼Œç”¨æ—¥æœ¬å­—æ¥ç³Šå¼„æˆ‘ï¼Œå­—ä½“å¾ˆä¸å¥½çœ‹ï¼Œç»Ÿç»Ÿå¹²æ‰ã€‚</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å°†SCæŒªåˆ°æœ€å‰é¢ï¼Œè§£å†³â€œé—¨â€ç­‰å­—æ˜¾ç¤ºä¸æ­£å¸¸çš„é—®é¢˜ã€‚</span></span><br><span class="line">sudo vim /etc/fonts/conf.d/64-language-selector-prefer.conf</span><br></pre></td></tr></table></figure>

<h1 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h1><p>å…¶ä»–æ‚ä¸ƒæ‚å…«çš„ä¸œè¥¿å°±è‡ªè¡Œè§£å†³å§ï¼Œç¥çœ‹å®˜ubuntuæ—…ç¨‹æ„‰å¿«ï¼</p>
]]></content>
      <tags>
        <tag>å‡å°‘è„±å‘æŒ‡å—</tag>
      </tags>
  </entry>
  <entry>
    <title>co_context[0]: C++é«˜æ€§èƒ½åç¨‹æ¡†æ¶</title>
    <url>/2022/05/26/co-context-0/</url>
    <content><![CDATA[<p><a href="https://github.com/Codesire-Deng/co_context">co_context</a> æ˜¯æœ€è¿‘å¼€å‘çš„ C++ å¼‚æ­¥åç¨‹æ¡†æ¶ï¼Œä»¥<strong>æ˜“ç”¨æ€§</strong>ä¸ºæœ€é«˜ç›®æ ‡ï¼Œå°½é‡å…¼é¡¾<strong>æ€§èƒ½</strong>ã€‚å¸Œæœ›ä»æ­¤ C++ çš„å¼‚æ­¥èƒ½æ¯” Node.js æ›´ç®€å•ï¼Œæ›´ä¼˜é›…ã€‚</p>
<p>co_context æ˜¯åŸºäº Linux io_uringï¼ŒI&#x2F;O èµ°å†…æ ¸æ€åè®®æ ˆï¼Œè¿™æ˜¯ co_context åŠªåŠ›é€¼è¿‘çš„æ€§èƒ½ä¸Šé™ã€‚</p>
<span id="more"></span>

<p>åšäº†å‡ ä¸ªå°æµ‹è¯•ï¼Œæ€§èƒ½è¿˜æ˜¯æ¯”è¾ƒçŒ›çš„ã€‚å¦‚æœåˆ«çš„ç½‘ç»œæ¡†æ¶ï¼Œä½†å‡¡æ²¾ä¸Š <code>shared_ptr</code>ï¼Œ<code>mutex</code>ï¼Œ<code>memory_order_seq_cst</code> ç­‰ç­‰é‡å‹å·¥å…·ï¼Œå¤šåŠè¦æ¯” co_context æ…¢ä¸€äº›ã€‚</p>
<hr>
<p>2022&#x2F;5&#x2F;26 æ›´æ–°ï¼š</p>
<ul>
<li>æ–°å¢ ã€ŒI&#x2F;O å–æ¶ˆã€å’Œã€Œè¶…æ—¶ I&#x2F;O å–æ¶ˆã€ï¼ŒAPI æ›´å¥½ç”¨äº†ï¼›</li>
<li>æ›´æ–°è°ƒåº¦ç­–ç•¥ï¼Œredis-PING QPS çªç ´ 50 ä¸‡äº†ï¼›</li>
<li>é‡åš redis-benchmark çš„å®éªŒï¼š<ul>
<li>å‘ç°åå°è¿è¡Œ Chrome ä¼šæ˜¾è‘—å½±å“ CPU è°ƒåº¦ï¼Œè¿›è€Œå½±å“æ€§èƒ½è¡¨ç°â€”â€”å…³é—­ Chromeï¼›</li>
<li>å‘ç°ç½‘ç»œä»£ç†ä¼šé™ä½ localhost é€šä¿¡çš„æ€§èƒ½â€”â€”å…³é—­ç½‘ç»œä»£ç†ï¼›</li>
</ul>
</li>
<li>é“¾å¼ I&#x2F;O ä¸­operator+ çš„æ±‚å€¼é¡ºåºæ˜¯ç”±ç¼–è¯‘å™¨å®šä¹‰çš„ï¼Œå› æ­¤å¼ƒç”¨ï¼Œæ”¹ç”¨operator&amp;&amp; ï¼›</li>
<li>æ¯•è®¾ co_context é€šè¿‡å®¡æ ¸äº† ï¼Œè¿‡å‡ å¤©å„¿ç«¥èŠ‚ç­”è¾© ~</li>
</ul>
<hr>
<h2 id="ç”¨ä¾‹é€Ÿè§ˆ"><a href="#ç”¨ä¾‹é€Ÿè§ˆ" class="headerlink" title="ç”¨ä¾‹é€Ÿè§ˆ"></a>ç”¨ä¾‹é€Ÿè§ˆ</h2><h3 id="redis-PING-INLINE"><a href="#redis-PING-INLINE" class="headerlink" title="redis-PING_INLINE"></a>redis-PING_INLINE</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;co_context/io_context.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;co_context/lazy_io.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;co_context/net/acceptor.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> co_context;</span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">uint16_t</span> port = <span class="number">6379</span>;</span><br><span class="line"></span><br><span class="line">task&lt;&gt; <span class="built_in">reply</span>(co_context::socket sock) &#123;</span><br><span class="line">    <span class="type">char</span> recv_buf[<span class="number">100</span>];</span><br><span class="line">    <span class="type">int</span> n = <span class="keyword">co_await</span> sock.<span class="built_in">recv</span>(recv_buf);</span><br><span class="line">    <span class="keyword">while</span> (n &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        n = <span class="built_in">co_await</span> (sock.<span class="built_in">send</span>(&#123;<span class="string">&quot;+OK\r\n&quot;</span>, <span class="number">5</span>&#125;) &amp;&amp; sock.<span class="built_in">recv</span>(recv_buf));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task&lt;&gt; <span class="built_in">server</span>() &#123;</span><br><span class="line">    acceptor ac&#123;inet_address&#123;port&#125;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> sockfd; (sockfd = <span class="keyword">co_await</span> ac.<span class="built_in">accept</span>()) &gt;= <span class="number">0</span>;) &#123;</span><br><span class="line">        <span class="built_in">co_spawn</span>(<span class="built_in">reply</span>(co_context::socket&#123;sockfd&#125;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    io_context ctx&#123;<span class="number">32768</span>&#125;;</span><br><span class="line">    ctx.<span class="built_in">co_spawn</span>(<span class="built_in">server</span>());</span><br><span class="line">    ctx.<span class="built_in">run</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ª redis-serverï¼Œä½†æ— è®ºæ¥æ”¶ä»€ä¹ˆå‘½ä»¤ï¼Œéƒ½åªä¼šè¿”å›ä¸€ä¸ª&quot;+OK&quot;ã€‚çŒœçŒœå®ƒçš„ QPS æ˜¯å¤šå°‘ï¼Ÿå•çº¿ç¨‹ä¸‹ï¼Œé¢å‘ 1000 ä¸ªå®¢æˆ·ç«¯ï¼Œco_context QPS æ˜¯ 55 ä¸‡ï¼Œè€Œ redis æœ¬å°Šæ˜¯ 36 ä¸‡ï¼Œå¹³å‡å»¶è¿Ÿã€p99å»¶è¿Ÿç­‰å‡ç¢¾å‹ã€‚è™½ç„¶â€¦â€¦è¿™æ ·çš„æ€§èƒ½åœ¨ç½‘ç»œæ¡†æ¶é‡Œå‹‰å¼ºåŠæ ¼ ï¼ˆæ¯•ç«Ÿéš”å£ bRPC åŠ¨ä¸åŠ¨äº”ç™¾ä¸‡å¹¶å‘ã€‚ã€‚ï¼‰ã€‚</p>
<p>æµ‹è¯•å·¥å…·æ˜¯ redis-benchmarkï¼Œå…¶çº¿ç¨‹å¼€1~3ä¸ªï¼ˆä½¿QPSæœ€ä¼˜ï¼‰ï¼Œæµ‹è¯•ç¯å¢ƒæ˜¯å•æœº 5800X, 32GB 3200MHZ-ddr4ã€‚</p>
<p><img src="/2022/05/26/co-context-0/redis-single-thread.png" alt="å•çº¿ç¨‹"></p>
<h3 id="é“¾å¼-I-x2F-O"><a href="#é“¾å¼-I-x2F-O" class="headerlink" title="é“¾å¼ I&#x2F;O"></a>é“¾å¼ I&#x2F;O</h3><p>é“¾å¼ I&#x2F;O èƒ½å‡å°‘å†å…¥å†…æ ¸æ€å’Œè°ƒåº¦å™¨çš„æ¬¡æ•°ï¼Œå¢å¼ºæ€§èƒ½ã€‚åªéœ€ç”¨<code>&amp;&amp;</code>è¿æ¥è¯·æ±‚å³å¯ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// co_await ä¼˜å…ˆçº§å¤ªé«˜ï¼Œé¡»åŠ æ‹¬å·</span></span><br><span class="line"><span class="type">int</span> x = <span class="built_in">co_await</span> (<span class="built_in">A</span>() &amp;&amp; <span class="built_in">timeout</span>(<span class="built_in">B</span>(), <span class="number">3</span>s) &amp;&amp; <span class="built_in">C</span>());</span><br></pre></td></tr></table></figure>

<p>å…ˆåš Aï¼Œç„¶ååš Bï¼ˆé™æ—¶ 3 ç§’ï¼‰ï¼Œï¼ˆå¦‚æœæ²¡æœ‰è¶…æ—¶æˆ–é”™è¯¯ï¼‰æœ€ååš Cã€‚æœ‰é”™è¯¯åˆ™è¿”å›é”™è¯¯ï¼Œå¦åˆ™è¿”å› C çš„ç»“æœã€‚</p>
<h3 id="ä¸€ç§’å®šæ—¶å™¨"><a href="#ä¸€ç§’å®šæ—¶å™¨" class="headerlink" title="ä¸€ç§’å®šæ—¶å™¨"></a>ä¸€ç§’å®šæ—¶å™¨</h3><p>æ¥ä¸‹æ¥åªå±•ç¤ºæ ¸å¿ƒä»£ç äº†ï¼Œå› ä¸ºéæ ¸å¿ƒä»£ç å’Œä¸Šé¢å·®ä¸å¤šã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">task&lt;&gt; <span class="built_in">my_clock</span>() &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> cnt = <span class="number">0</span>;;) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Time = %d\n&quot;</span>, cnt++);</span><br><span class="line">        <span class="function"><span class="keyword">co_await</span> <span class="title">timeout</span><span class="params">(<span class="number">1</span>s)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¯éš”ä¸€ç§’ï¼Œåœ¨å±å¹•ä¸Šæ‰“å°æ—¶é—´ã€‚å½“ç„¶ï¼Œè¿™ç§å†™æ³•å®¹æ˜“æœ‰ç´¯è®¡è¯¯å·®ï¼Œåˆ‡å‹¿æ¨¡ä»¿å–”~</p>
<h3 id="ç½‘ç»œè¶…æ—¶å–æ¶ˆ"><a href="#ç½‘ç»œè¶…æ—¶å–æ¶ˆ" class="headerlink" title="ç½‘ç»œè¶…æ—¶å–æ¶ˆ"></a>ç½‘ç»œè¶…æ—¶å–æ¶ˆ</h3><p>ç”¨<code>timeout(req, time)</code>èƒ½å¤Ÿä»¤<code>req</code>è¯·æ±‚é™åˆ¶åœ¨<code>time</code>æ—¶é—´ä»¥å†…ï¼Œè‹¥è¶…æ—¶åˆ™è¿”å›å¤±è´¥ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">task&lt;&gt; <span class="built_in">run</span>(co_context::socket peer) &#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">8192</span>];</span><br><span class="line">    <span class="type">int</span> nr = <span class="keyword">co_await</span> <span class="built_in">timeout</span>(peer.<span class="built_in">recv</span>(buf), <span class="number">3</span>s);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="function"><span class="keyword">co_await</span> <span class="title">lazy::write</span><span class="params">(STDOUT_FILENO, &#123;buf, (<span class="type">size_t</span>)nr&#125;, <span class="number">0</span>)</span></span>;</span><br><span class="line">        nr = <span class="keyword">co_await</span> <span class="built_in">timeout</span>(peer.<span class="built_in">recv</span>(buf), <span class="number">3</span>s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">log_error</span>(-nr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">log_error</span><span class="params">(<span class="type">int</span> err)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (err) &#123;</span><br><span class="line">        <span class="keyword">case</span> ECANCELED: <span class="comment">// è¶…æ—¶å–æ¶ˆ</span></span><br><span class="line">            log::<span class="built_in">e</span>(<span class="string">&quot;timeout!\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>: <span class="comment">// å…¶ä»–é”™è¯¯</span></span><br><span class="line">            log::<span class="built_in">e</span>(<span class="string">&quot;%s\n&quot;</span>, <span class="built_in">strerror</span>(err)); </span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹æ¯æ¬¡TCP<code>recv</code>è°ƒç”¨é™æ—¶3ç§’é’Ÿã€‚</p>
<h3 id="I-x2F-O-å–æ¶ˆ"><a href="#I-x2F-O-å–æ¶ˆ" class="headerlink" title="I&#x2F;O å–æ¶ˆ"></a>I&#x2F;O å–æ¶ˆ</h3><p>I&#x2F;O å¯ä»¥æ— ç†ç”±å–æ¶ˆè®¢å•ï¼Œå‰ææ˜¯è´§è¿˜æ²¡åˆ°ä½ çš„æ‰‹ä¸Šã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">co_await</span> <span class="title">cancel_fd</span><span class="params">(fd)</span></span>;</span><br></pre></td></tr></table></figure>

<p>å–æ¶ˆä¸æŒ‡å®š fd æœ‰å…³çš„ I&#x2F;O æ“ä½œã€‚</p>
<p>PS: å†…éƒ¨è¿˜å¯ä»¥åšæ›´ç»†è‡´çš„å–æ¶ˆæ“ä½œï¼Œåªæ˜¯ä½œè€…è¿˜æ²¡æƒ³å¥½æ€ä¹ˆè®¾è®¡ API æ¯”è¾ƒä¼˜é›…~</p>
<h3 id="å¹¶å‘é‡é™åˆ¶"><a href="#å¹¶å‘é‡é™åˆ¶" class="headerlink" title="å¹¶å‘é‡é™åˆ¶"></a>å¹¶å‘é‡é™åˆ¶</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">counting_semaphore sem&#123;<span class="number">100</span>&#125;;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">co_await</span> sem.<span class="built_in">acquire</span>();</span><br><span class="line">        <span class="built_in">co_spawn</span>([]() -&gt; task&lt;&gt; &#123;</span><br><span class="line">            socket sock&#123;..&#125;;</span><br><span class="line">            <span class="keyword">co_await</span> sock.<span class="built_in">connect</span>(..) &amp;&amp; sock.<span class="built_in">send</span>(..) &amp;&amp; sock.<span class="built_in">recv</span>(..)</span><br><span class="line">                     &amp;&amp; sock.<span class="built_in">close</span>();</span><br><span class="line">            sem.<span class="built_in">release</span>();</span><br><span class="line">        &#125;());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç å°†ä¸šåŠ¡å¹¶å‘é‡é™åˆ¶åœ¨ 100 ä»¥å†…ã€‚æ³¨æ„<code>counting_semaphore</code>æ˜¯é’ˆå¯¹ co_context ç‰¹åˆ¶çš„ï¼Œwait-freeï¼Œæ€§èƒ½æ¯”è¾ƒå¥½ã€‚</p>
<h3 id="å…¶ä»–åç¨‹é—´åŒæ­¥å·¥å…·"><a href="#å…¶ä»–åç¨‹é—´åŒæ­¥å·¥å…·" class="headerlink" title="å…¶ä»–åç¨‹é—´åŒæ­¥å·¥å…·"></a>å…¶ä»–åç¨‹é—´åŒæ­¥å·¥å…·</h3><p>ç±»ä¼¼çš„åŒæ­¥å·¥å…·è¿˜æœ‰<code>mutex</code>ï¼Œ<code>condition_variable</code>ã€‚æ‰€æœ‰çš„åŒæ­¥å·¥å…·çš„ä½¿ç”¨ä½“éªŒå’Œ C++ æ ‡å‡†å®šä¹‰çš„ç±»ä¼¼ï¼Œä¸ä¼šæœ‰é¢å¤–å­¦ä¹ æˆæœ¬å“¦~</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> co_context;</span><br><span class="line">co_context::mutex mtx;</span><br><span class="line"><span class="type">int</span> cnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">task&lt;&gt; <span class="built_in">add</span>() &#123;</span><br><span class="line">    <span class="keyword">auto</span> lock = <span class="keyword">co_await</span> mtx.<span class="built_in">lock_guard</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000000</span>; ++i) ++cnt;</span><br><span class="line">    std::cout &lt;&lt; cnt &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    io_context ctx&#123;<span class="number">2048</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; ++i) ctx.<span class="built_in">co_spawn</span>(<span class="built_in">add</span>());</span><br><span class="line">    ctx.<span class="built_in">run</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä»£ç å°†<code>cnt</code>å®‰å…¨åœ°é€’å¢è‡³ 1e9ã€‚</p>
<h2 id="co-context-çš„ä¸»è¦å†…å®¹"><a href="#co-context-çš„ä¸»è¦å†…å®¹" class="headerlink" title="co_context çš„ä¸»è¦å†…å®¹"></a>co_context çš„ä¸»è¦å†…å®¹</h2><p>co_context åœ¨ 4 ä¸ªæ–¹é¢æœ‰è´¡çŒ®ï¼š</p>
<ul>
<li>liburingcxx: io_uring çš„é«˜æ€§èƒ½ C++ bindingã€‚</li>
<li>io_context: é’ˆå¯¹ L1 cache çš„é«˜æ€§èƒ½è°ƒåº¦å™¨ã€‚</li>
<li>coro: é¢å‘ç”¨æˆ·çš„åç¨‹åº“ï¼Œæä¾›ç®€æ´ã€å¥½ç”¨ã€ç¬¦åˆç›´è§‰çš„ APIï¼Œè¿˜æä¾›äº†åŒæ­¥ syscall çš„åç¨‹ APIï¼ˆåŸºäºåŒæ­¥syscall çš„ä¸Šå±‚åº“å¯ä»¥å¿«é€Ÿåœ°ç§»æ¤åˆ° co_contextï¼‰ã€‚</li>
<li>net: åŸºäº coro æä¾›ä¸€äº›ä¾¿æ·çš„ç½‘ç»œæŠ½è±¡ï¼ˆéå¿…éœ€ï¼‰ã€‚</li>
</ul>
<p>é™äºç¯‡å¹…ï¼Œco_context çš„åŸç†å°†å†™åˆ°å…¶ä»–æ–‡ç« ä¸­ï¼ˆä¹Ÿè®¸å°±æ˜¯å°†æ¯•ä¸šè®¾è®¡æŠ¥å‘Šçš„å†…å®¹æŠ„è¿‡æ¥â€¦â€¦é€ƒï¼‰ã€‚</p>
<p>ä»£ç å®æ—¶åŒæ­¥äº <a href="https://github.com/Codesire-Deng/co_context">Github</a>ï¼Œæ±‚ star~</p>
]]></content>
      <tags>
        <tag>C++</tag>
        <tag>Concurrency</tag>
        <tag>C++åç¨‹</tag>
        <tag>co_context</tag>
      </tags>
  </entry>
  <entry>
    <title>co_context[1]: æ˜“ç”¨æ€§è®¾è®¡</title>
    <url>/2022/06/25/co-context-1/</url>
    <content><![CDATA[<p><a href="https://github.com/Codesire-Deng/co_context">co_context</a> æ˜¯æœ€è¿‘å¼€å‘çš„ C++ å¼‚æ­¥åç¨‹æ¡†æ¶ï¼ŒåŸºäº Linux io_uringã€‚<strong>ã€Œæ˜“ç”¨æ€§ã€</strong>å’Œã€Œæ€§èƒ½ã€æ˜¯æˆ‘ä»¬æœ€é‡è§†çš„å±æ€§ï¼Œè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ä»‹ç»åœ¨ co_context ä¸­æœ‰å…³æ˜“ç”¨æ€§çš„è®¾è®¡ã€‚</p>
<span id="more"></span>

<h2 id="I-x2F-Oï¼šåŒæ­¥é£æ ¼ï¼Œä¸šåŠ¡ä¸“æ³¨"><a href="#I-x2F-Oï¼šåŒæ­¥é£æ ¼ï¼Œä¸šåŠ¡ä¸“æ³¨" class="headerlink" title="I&#x2F;Oï¼šåŒæ­¥é£æ ¼ï¼Œä¸šåŠ¡ä¸“æ³¨"></a>I&#x2F;Oï¼šåŒæ­¥é£æ ¼ï¼Œä¸šåŠ¡ä¸“æ³¨</h2><p>ä»»ä½•æœ‰æ„ä¹‰çš„è®¡ç®—æœºç¨‹åºéƒ½éœ€è¦åš I&#x2F;Oï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œæˆ‘ä»¬ä¸å¾—ä¸è¿½æ±‚æ›´å¥½çš„ I&#x2F;O æ¨¡å‹ã€‚å¾ˆå¤šç½‘ç»œæ–‡ç« å°† I&#x2F;O æ¨¡å‹åˆ†æˆé˜»å¡ã€éé˜»å¡ã€å¤šè·¯å¤ç”¨ç­‰å¤šç§ï¼Œä½†æœ¬äººä¸å¤ªå–œæ¬¢è¿™ç§åˆ†ç±»ï¼ˆé˜»å¡+éé˜»å¡â‰ å…¨é›†ï¼Œè¿åç›´è§‰ï¼‰ã€‚ä»ä»£ç é£æ ¼ä¸Šï¼Œæˆ‘å°† I&#x2F;O æ¨¡å‹åˆ†æˆä¸¤ç§ï¼šåŒæ­¥å¼ï¼Œå‡½æ•°å›è°ƒå¼ã€‚</p>
<p>ä»¥ä¸€ä¸ªç®€å•éœ€æ±‚ä¸ºä¾‹ï¼šç­‰å¾…äº”ç§’é’Ÿåï¼Œæ‰“å°â€œHello, world!â€ã€‚æˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹åŒæ­¥å¼å’Œå‡½æ•°å›è°ƒçš„å†™æ³•ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŒæ­¥å¼ï¼Œä½¿ç”¨C++æ ‡å‡†åº“</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">delay_print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    this_thread::<span class="built_in">sleep_for</span>(<span class="number">5</span>s);</span><br><span class="line">    <span class="built_in">printf</span>(â€œHello, world!\nâ€);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="built_in">delay_print</span>(); <span class="comment">// å¯¼è‡´å½“å‰çº¿ç¨‹ä¼šé˜»å¡5ç§’</span></span><br><span class="line">std::thread t&#123;delay_print&#125;; <span class="comment">// ç”Ÿæˆæ–°çº¿ç¨‹ï¼Œä»¤å…¶é˜»å¡5ç§’</span></span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŒæ­¥å¼ï¼Œä½¿ç”¨co_context</span></span><br><span class="line"><span class="function">task&lt;<span class="type">void</span>&gt; <span class="title">delay_print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">co_await</span> <span class="title">timeout</span><span class="params">(<span class="number">5</span>s)</span></span>;</span><br><span class="line">    <span class="built_in">printf</span>(â€œHello, world!\nâ€);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ä¸šåŠ¡ä»£ç ä¸­ä½¿ç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">co_await</span> <span class="title">delay_print</span><span class="params">()</span></span>; <span class="comment">// å½“å‰åç¨‹æš‚åœ5ç§’åè¢«ç»§ç»­æ‰§è¡Œï¼›å½“å‰çº¿ç¨‹ä¸é˜»å¡ï¼ˆè½¬è€Œæ‰§è¡Œå…¶ä»–åç¨‹ï¼‰</span></span><br><span class="line"><span class="built_in">co_spawn</span>(<span class="built_in">delay_print</span>()); <span class="comment">// ç”Ÿæˆä¸€ä¸ªæ–°åç¨‹ï¼Œ5ç§’åè¢«æ‰§è¡Œï¼›å½“å‰åç¨‹ç»§ç»­æ‰§è¡Œ</span></span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‡½æ•°å›è°ƒï¼Œä½¿ç”¨Boost.Asio</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(<span class="type">const</span> error_code &amp; <span class="comment">/*e*/</span>)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Hello, world!&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    asio::io_context io;</span><br><span class="line">    <span class="function">asio::steady_timer <span class="title">t</span><span class="params">(io, <span class="number">5</span>s)</span></span>;</span><br><span class="line">    t.<span class="built_in">async_wait</span>(&amp;print); <span class="comment">// æ€»æ˜¯ä¸ä¼šé€ æˆé˜»å¡</span></span><br><span class="line">    io.<span class="built_in">run</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">åŒæ­¥é˜»å¡å¼</th>
<th align="left">å‡½æ•°å›è°ƒå¼</th>
<th align="left">co_contextï¼ˆåŒæ­¥å¼ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å­¦ä¹ éš¾åº¦</td>
<td align="left">æ˜“</td>
<td align="left">éš¾</td>
<td align="left"><strong>æ˜“</strong></td>
</tr>
<tr>
<td align="left">ç¼–ç¨‹éš¾åº¦</td>
<td align="left">æ˜“</td>
<td align="left">éš¾</td>
<td align="left"><strong>æ˜“</strong></td>
</tr>
<tr>
<td align="left">é˜…è¯»éš¾åº¦</td>
<td align="left">æ˜“</td>
<td align="left">éå¸¸éš¾</td>
<td align="left"><strong>æ˜“</strong></td>
</tr>
<tr>
<td align="left">è°ƒåº¦è€…</td>
<td align="left">OSï¼ˆçº¿ç¨‹è°ƒåº¦ï¼‰</td>
<td align="left">ç”¨æˆ·ï¼ˆæ˜¾å¼ï¼‰</td>
<td align="left"><strong>ç”¨æˆ·ï¼ˆéšå¼ï¼‰</strong></td>
</tr>
<tr>
<td align="left">å¹¶å‘å®¹é‡å‚è€ƒ</td>
<td align="left">åƒçº§</td>
<td align="left">åä¸‡çº§</td>
<td align="left"><strong>åä¸‡çº§</strong></td>
</tr>
<tr>
<td align="left">å…¸å‹åœºæ™¯</td>
<td align="left">ç£ç›˜ï¼›å®¢æˆ·ç«¯</td>
<td align="left">ç½‘ç»œï¼›æœåŠ¡å™¨</td>
<td align="left"><strong>å…¨åœºæ™¯</strong></td>
</tr>
</tbody></table>
<p>ä»ä¸šåŠ¡é€»è¾‘çš„è§’åº¦çœ‹ï¼ŒåŒæ­¥å¼çš„è¡¨è¾¾æ›´åŠ æµç•…ï¼Œè¯­è¨€å™ªéŸ³æ›´å°ï¼Œ<strong>ç®€å•æ˜“æ‡‚</strong>ï¼›è€Œå‡½æ•°å›è°ƒå†™çš„ä¸šåŠ¡æ¯”è¾ƒé›¶æ•£ï¼Œä»…å› ä¸€ä¸ªè®¡æ—¶å™¨å°±éœ€è¦å°†ä¸šåŠ¡åˆ†å‰²æˆä¸¤éƒ¨åˆ†ï¼ˆç­‰å¾… 5 ç§’ï¼Œæ‰“å° Helloworldï¼‰ï¼Œå½“ä¸šåŠ¡è¶Šæ¥è¶Šå¤æ‚ï¼Œä»£ç åˆ†è£‚å‰²æ®çš„ç°è±¡å°±è¶Šä¸¥é‡ã€‚åªéœ€çœ‹ Boost.Asio çš„ echo server ä¾‹å­å°±èƒ½çŸ¥é“ï¼Œå›è°ƒä¸æ˜¯ä¸€èˆ¬äººèƒ½å–œæ¬¢å†™çš„ã€‚æ‰€ä»¥ï¼Œco_context é€‰æ‹©äº†åŒæ­¥å†™æ³•ã€‚</p>
<h2 id="æŠ½è±¡å±‚æ¬¡ï¼šä»ç³»ç»Ÿè°ƒç”¨å‡ºå‘"><a href="#æŠ½è±¡å±‚æ¬¡ï¼šä»ç³»ç»Ÿè°ƒç”¨å‡ºå‘" class="headerlink" title="æŠ½è±¡å±‚æ¬¡ï¼šä»ç³»ç»Ÿè°ƒç”¨å‡ºå‘"></a>æŠ½è±¡å±‚æ¬¡ï¼šä»ç³»ç»Ÿè°ƒç”¨å‡ºå‘</h2><p>åœ¨ä¼—å¤š C++ å¼‚æ­¥æ¡†æ¶ä¸­ï¼ŒæŠ½è±¡å±‚æ¬¡æœ‰é«˜æœ‰ä½ã€‚<a href="https://www.boost.org/doc/libs/1_79_0/doc/html/boost_asio/overview.html">Asio</a> å¯¹ Proactor æ¨¡å¼çš„åº”ç”¨ç™»å³°é€ æï¼Œåšå‡º Executorï¼ŒStrandï¼ŒBufferï¼ŒStream ç­‰åå‘ç¼–ç¨‹çš„æŠ½è±¡ï¼›æœ€è¿‘æ¯”è¾ƒæ´»è·ƒçš„æœç‹— <a href="https://github.com/sogou/workflow">Workflow</a> é¢å‘ä»»åŠ¡æµæŠ½è±¡ï¼Œç›´æ¥å†…ç½®äº†é€šç”¨ç½‘ç»œåè®®ï¼Œç”¨æˆ·å°†åŸºç¡€ä»»åŠ¡å’Œåè®®ä¸²è”æˆ–å¹¶è”æˆè‡ªå·±çš„åº”ç”¨ï¼›ä¸­æ–‡äº’è”ç½‘æ•™ç§‘ä¹¦çº§åˆ«çš„ <a href="https://github.com/chenshuo/muduo">Muduo</a> é’ˆå¯¹ç½‘ç»œå±‚å’Œä¼ è¾“å±‚æŠ½è±¡ï¼Œå¯¹ç†Ÿç»ƒè®¡ç®—æœºç½‘ç»œçš„åŒå­¦æ¯”è¾ƒå‹å¥½ï¼›è¿˜æœ‰ libeventã€libevã€libuv ç­‰ç­‰â€¦â€¦ä»»ä½•ä¸€ç§æŠ½è±¡éƒ½åœ¨å­¦ä¹ æˆæœ¬å’Œå¼€å‘æ•ˆç‡ä¸Šæœ‰æ‰€ä¼˜åŠ£ã€‚è€Œ co_context çš„åšæ³•æ˜¯ï¼Œç›´æ¥å¯¹<strong>åŒæ­¥é˜»å¡ç³»ç»Ÿè°ƒç”¨</strong>æŠ½è±¡ï¼ˆèµ°æ“ä½œç³»ç»Ÿçš„è·¯ï¼Œè®©æ“ä½œç³»ç»Ÿæ— è·¯å¯èµ°ï¼‰ã€‚ååº•å±‚çš„å¼€å‘è€…åŸºäº co_context å®Œæˆé«˜çº§ä¸šåŠ¡åº“åï¼Œåä¸Šå±‚çš„å¼€å‘è€…åŒæ ·æ˜¯ä»¥åŒæ­¥ç¼–ç¨‹çš„é£æ ¼æ¥æè¿°ä¸šåŠ¡é€»è¾‘ã€‚</p>
<h3 id="ç”¨ç³»ç»Ÿè°ƒç”¨æ„å»ºä½ çš„åº“"><a href="#ç”¨ç³»ç»Ÿè°ƒç”¨æ„å»ºä½ çš„åº“" class="headerlink" title="ç”¨ç³»ç»Ÿè°ƒç”¨æ„å»ºä½ çš„åº“"></a>ç”¨ç³»ç»Ÿè°ƒç”¨æ„å»ºä½ çš„åº“</h3><p>åœ¨ Linux ä¸­ï¼ŒåŒæ­¥é˜»å¡ API ç›´æˆªäº†å½“åœ°è¡¨è¾¾äº†ç¨‹åºå‘˜çš„æ„å›¾ï¼Œè€Œ co_context æä¾›çš„ API æåŠ›åœ°ç»§æ‰¿äº†è¿™ç§ç‰¹æ€§ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Linux ç³»ç»Ÿè°ƒç”¨</span></span><br><span class="line"><span class="type">int</span> n = <span class="built_in">read</span>(fd, buf, count);</span><br><span class="line"><span class="type">int</span> n = <span class="built_in">writev</span>(fd, iov, iovcnt);</span><br><span class="line"><span class="type">int</span> fd = <span class="built_in">accept4</span>(sockfd, addr, addrlen, flags); <span class="comment">// man7.org/linux/man-pages/man2/accept.2.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// co_context</span></span><br><span class="line"><span class="type">int</span> n = <span class="keyword">co_await</span> <span class="built_in">read</span>(fd, buf, count);</span><br><span class="line"><span class="type">int</span> n = <span class="keyword">co_await</span> <span class="built_in">writev</span>(fd, iov, iovcnt);</span><br><span class="line"><span class="type">int</span> fd = <span class="keyword">co_await</span> <span class="built_in">accept</span>(sockfd, addr, addrlen, flags);</span><br></pre></td></tr></table></figure>

<p>ä»å®ç°çš„è§’åº¦ä¸Šè¯´ï¼Œå› ä¸ºåº•å±‚çš„ io_uring ä¹Ÿæ˜¯é¢å‘ç³»ç»Ÿè°ƒç”¨çš„ï¼Œæ‰€ä»¥æä¾›è¿™äº›æ¥å£çš„å®ç°å¹¶ä¸å›°éš¾ã€‚ä»ç”¨æˆ·çš„è§’åº¦çœ‹ï¼Œç”¨è¿™äº›ç³»ç»Ÿè°ƒç”¨æ¥å®ç°åŸºæœ¬çš„åŠŸèƒ½å®åœ¨æ˜¯å¤ªç®€å•äº†ï¼ˆç›¸æ¯”ç”¨å‡½æ•°å›è°ƒï¼‰ã€‚ä¾‹å¦‚ï¼Œå®ç°ä¸€ä¸ª netcat åŸºç¡€åŠŸèƒ½ï¼Œå°† TCP è¿æ¥ä¸Šæ¥æ”¶åˆ°çš„ä»»ä½•ä¿¡æ¯æ‰“å°åˆ° stdoutï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">task&lt;<span class="type">int</span>&gt; <span class="title">hear</span><span class="params">(co_context::socket peer)</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">8192</span>];</span><br><span class="line">    <span class="type">int</span> nr = <span class="keyword">co_await</span> peer.<span class="built_in">recv</span>(buf);</span><br><span class="line">    <span class="keyword">while</span> (nr &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="function"><span class="keyword">co_await</span> <span class="title">lazy::write</span><span class="params">(STDOUT_FILENO, &#123;buf, nr&#125;, <span class="comment">/*offset*/</span><span class="number">0</span>)</span></span>;</span><br><span class="line">        nr = <span class="keyword">co_await</span> peer.<span class="built_in">recv</span>(buf);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// handle_error(-nr); // å½“åœºå¤„ç†é”™è¯¯ç </span></span><br><span class="line">    <span class="comment">// throw std::system_error&#123;-nr, std::system_category(), &quot;hear&quot;&#125;; // æˆ–è€…ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">co_return</span> -nr; <span class="comment">// æˆ–è€…ï¼Œè¿”å›é”™è¯¯ç ã€‚</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œä¸Šå±‚å¯ä»¥åŒæ­¥åœ°è°ƒç”¨<code>hear</code>åç¨‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">task&lt;<span class="type">void</span>&gt; <span class="title">run</span><span class="params">(<span class="type">int</span> some_para)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="type">int</span> err = <span class="keyword">co_await</span> <span class="built_in">hear</span>(sockfd);</span><br><span class="line">    <span class="keyword">if</span> (err != <span class="number">0</span>) <span class="built_in">handle_error</span>(err);</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è€Œ<code>task&lt;void&gt;</code>ï¼ˆæˆ–è€…ç¼©å†™<code>task&lt;&gt;</code>ï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„åç¨‹ç±»å‹ï¼Œå¯ä»¥ç‹¬ç«‹åœ°è¢«ç”Ÿæˆå¹¶è¿è¡Œï¼Œä¾‹å¦‚ï¼Œå¼€å¯ 10000 ä¸ª <code>run()</code> åç¨‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10000</span>; ++i)</span><br><span class="line">    <span class="built_in">co_spawn</span>(<span class="built_in">run</span>(i));</span><br><span class="line"><span class="comment">// æ˜¯ä¸æ˜¯å¾ˆåƒ std::thread&#123;run, i&#125;.detach() ï¼Ÿ</span></span><br></pre></td></tr></table></figure>

<h3 id="åº“-è°ƒåº¦å™¨-x3D-åº”ç”¨"><a href="#åº“-è°ƒåº¦å™¨-x3D-åº”ç”¨" class="headerlink" title="åº“+è°ƒåº¦å™¨&#x3D;åº”ç”¨"></a>åº“+è°ƒåº¦å™¨&#x3D;åº”ç”¨</h3><p>ä¸Šé¢çš„ä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•ç”¨åç¨‹å¼ API å®ç°è‡ªå·±çš„ä¸šåŠ¡åº“ï¼Œä½†æ˜¯ï¼Œå…‰æœ‰åº“æ˜¯ä¸èƒ½åšæˆåº”ç”¨çš„ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè°ƒåº¦å™¨æ¥è¿è¡Œè¿™äº›åº“å‡½æ•°ã€‚è°ƒåº¦å™¨è´Ÿè´£ç®¡ç†æ‰€æœ‰çš„åç¨‹ï¼Œåœ¨åç¨‹å› ç­‰å¾… I&#x2F;O è€Œæš‚åœæ—¶ï¼Œè°ƒåº¦å™¨å¯»æ‰¾ä¸‹ä¸€ä¸ªå°±ç»ªçš„åç¨‹ï¼Œå¹¶æ¢å¤å…¶æ‰§è¡Œï¼Œå¦‚æ­¤å¾€å¤ã€‚è°ƒåº¦å™¨å¯ä»¥æŒæ§ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ã€‚</p>
<p>co_context çš„è°ƒåº¦å™¨åå«<code>io_context</code>ï¼Œè¿™æ˜¯ä» Boost.Asio å€Ÿé‰´è€Œæ¥çš„ã€‚ ä¸ Asio éœ€è¦ç»å¸¸æŒ‡å®š <code>io_context</code> ä¸åŒï¼Œco_context æ˜¯éšå¼æŒ‡å®šçš„ï¼Œé»˜è®¤æ²¿ç”¨å½“å‰çš„è°ƒåº¦å™¨ï¼Œæ‰€ä»¥<strong>è°ƒåº¦å™¨çš„å­˜åœ¨æ„Ÿéå¸¸ä½</strong>ã€‚é€šå¸¸ï¼Œåªæœ‰ä¸ºäº†æ›´å¥½çš„è´Ÿè½½å‡è¡¡ï¼Œå°†ä»»åŠ¡åˆ†é…åˆ°ç‰¹å®šçš„çº¿ç¨‹ç»„ä¸Šï¼Œæ‰éœ€è¦æ˜¾å¼æŒ‡å®šè°ƒåº¦å™¨ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> co_context;</span><br><span class="line"></span><br><span class="line">task&lt;&gt; <span class="built_in">a</span>() &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;a\n&quot;</span>);</span><br><span class="line">    <span class="keyword">co_return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task&lt;&gt; <span class="built_in">b</span>() &#123;</span><br><span class="line">    <span class="built_in">co_spawn</span>(<span class="built_in">a</span>()); <span class="comment">// ä¸æ˜¾å¼æŒ‡å®šï¼Œåˆ™ä½¿ç”¨å½“å‰çš„è°ƒåº¦å™¨</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;b\n&quot;</span>);</span><br><span class="line">    <span class="keyword">co_return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task&lt;&gt; <span class="built_in">c</span>(io_context&amp; io) &#123;</span><br><span class="line">    io.<span class="built_in">co_spawn</span>(<span class="built_in">a</span>()); <span class="comment">// æ˜¾å¼æŒ‡å®šè°ƒåº¦å™¨</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;c\n&quot;</span>);</span><br><span class="line">    <span class="keyword">co_return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    io_context io&#123;<span class="number">32768</span>&#125;;</span><br><span class="line">    io.<span class="built_in">co_spawn</span>(<span class="built_in">b</span>()); <span class="comment">// æ ¹æºçš„co_spawnå¿…é¡»æŒ‡å®šè°ƒåº¦å™¨</span></span><br><span class="line">    io.<span class="built_in">co_spawn</span>(<span class="built_in">c</span>(io));</span><br><span class="line">    io.<span class="built_in">run</span>(); <span class="comment">// è°ƒåº¦å™¨å¼€å§‹å·¥ä½œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é«˜é˜¶-API"><a href="#é«˜é˜¶-API" class="headerlink" title="é«˜é˜¶ API"></a>é«˜é˜¶ API</h2><p>å¾ˆå¤šäººï¼ŒåŒ…æ‹¬æˆ‘çš„æ¯•è®¾ç­”è¾©è€ƒå®˜ï¼Œå¯èƒ½ä¼šå¿½è§†åç¨‹å¼ API çš„å¨åŠ›ã€‚â€œä½ æ˜¯ä¸æ˜¯ä»…ä»…å¯¹ç³»ç»Ÿè°ƒç”¨åšäº†ä¸€ä¸ªè¿ç§»ï¼ˆç®€å•åŒ…è£…ï¼‰ï¼Ÿâ€å½“ç„¶ä¸æ˜¯ï¼Œco_context æä¾›çš„æƒ°æ€§æ±‚å€¼ API å…·æœ‰å¯ç»„åˆçš„èƒ½åŠ›ï¼Œåœ¨<strong>æ˜“ç”¨æ€§</strong>å’Œ<strong>æ€§èƒ½</strong>ä¸Šéƒ½æ˜¯å¤§æ€å™¨ã€‚</p>
<p><img src="/2022/06/25/co-context-1/HO-api.png" alt="é«˜é˜¶API"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç”¨æˆ·å¯ä»¥å°†ä¸¤ä¸ªåŸå§‹çš„ä¸€é˜¶ API ç»„åˆï¼Œå½¢æˆäºŒé˜¶ APIã€‚åªè¦æœ‰æ„ä¹‰ï¼Œç”¨æˆ·è¦å†™æˆä¸‰å››äº”å…­ä¸ƒå…«é˜¶éƒ½ä¸æ˜¯é—®é¢˜ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨è¿è¡Œæ—¶ï¼Œco_context å°†æ•´ä¸ªé«˜<br>é˜¶ API è½¬åŒ–ä¸ºé“¾è¡¨ï¼Œæ•´ä¸ªé“¾è¡¨åªè¿›å…¥ä¸€æ¬¡è°ƒåº¦å™¨ï¼Œåªè¿›å…¥ä¸€æ¬¡ io_uringï¼Œæ˜¾ç„¶å¯ä»¥èŠ‚çœè°ƒåº¦å¼€é”€ã€‚</p>
<p><img src="/2022/06/25/co-context-1/HO-api-principle.png" alt="é«˜é˜¶APIåŸç†"></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ã€Œé¢å‘ç³»ç»Ÿè°ƒç”¨ã€å’Œã€Œé«˜é˜¶ API ã€æ˜¯ä¸€å¥—ç»„åˆæ‹³ï¼Œä»åº•å±‚å¼€å§‹ä¸ºç”¨æˆ·æä¾›äº†æ˜“ç”¨æ€§ï¼ˆå’Œæ€§èƒ½ï¼‰ã€‚å› ä¸ºä½¿ç”¨äº†åŒæ­¥çš„ä»£ç é£æ ¼ï¼Œæˆ‘ä»¬ä¸éš¾å°†å·²æœ‰çš„åŒæ­¥åº“æ”¹å†™æˆ co_context çš„å½¢å¼ï¼Œä»è€Œè·å¾—å¼ºå¤§çš„å¹¶å‘æ€§èƒ½ï¼›å¦‚æœåŸæœ‰åº“æ˜¯åŸºäºç³»ç»Ÿè°ƒç”¨ï¼Œé‚£ä¹ˆâ€¦â€¦å¯èƒ½åŠ ä¸€æ¬¡ç­å°±èƒ½å®Œæˆè¿ç§»äº†ã€‚</p>
<p>co_context åœ¨æ˜“ç”¨æ€§ä¸Šè¿˜æœ‰å…¶ä»–è®¾è®¡ï¼Œä¾‹å¦‚ï¼šC++åç¨‹å¸®ä½ æ‰˜ç®¡äº†å †å†…å­˜ï¼Œä½ ä¸å†éœ€è¦ç”¨<code>shared_ptr</code>äº†ï¼›å½“ä½ å¿˜è®°ç”¨<code>co_await</code>æ—¶ï¼Œ ç¼–è¯‘å™¨ä¼šå‘ä½ é“æ­‰ï¼›ç­‰ç­‰ï¼Œåªä¸è¿‡è¿™äº›å†…å®¹æœ‰ç‚¹å–§å®¾å¤ºä¸»ï¼Œæˆ‘å°±ä¸å¤šå†™äº†ã€‚åœ¨æœªæ¥çš„æ–‡ç« ä¸­ï¼Œæˆ‘å¯èƒ½ä¼šä»‹ç»è¿™äº›æ˜“ç”¨æ€§æ˜¯æ€æ ·å®ç°çš„ã€‚ä¸‹ä¸€ç« ï¼Œæ‰“ç®—å…ˆä»‹ç» co_context çš„æ€§èƒ½è®¾è®¡ï¼Œçœ‹çœ‹å®ƒç”¨äº†å“ªäº› trick æ¥éª—å–æ€§èƒ½ã€‚</p>
<hr>
<p>ä»£ç å®æ—¶åŒæ­¥äº <a href="https://github.com/Codesire-Deng/co_context">Github</a>ï¼Œæ±‚ star~</p>
]]></content>
      <tags>
        <tag>C++</tag>
        <tag>Concurrency</tag>
        <tag>C++åç¨‹</tag>
        <tag>co_context</tag>
      </tags>
  </entry>
  <entry>
    <title>co_context[2]: æ€§èƒ½ä¼˜åŒ–æ‚è°ˆ</title>
    <url>/2022/06/25/co-context-2/</url>
    <content><![CDATA[<p>Helloï¼Œæˆ‘æ˜¯ç­‰ç–¾é£ï¼æœ¬ç¯‡ä»‹ç»åœ¨ <a href="https://github.com/Codesire-Deng/co_context">co_context</a> ä¸­ç”¨åˆ°çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§ï¼Œå¸Œæœ›åœ¨å„ä½ C&#x2F;C++ é“å‹çš„é¡¹ç›®ä¸Šæœ‰æ‰€å¸®åŠ©ã€‚<strong>é‡ç‚¹å°†åœ¨æŠ€å·§çš„å…¥é—¨</strong>ï¼Œè€Œä¸æ˜¯ co_context æœ¬èº«ã€‚</p>
<span id="more"></span>

<h2 id="æ€§èƒ½åˆ†æ"><a href="#æ€§èƒ½åˆ†æ" class="headerlink" title="æ€§èƒ½åˆ†æ"></a>æ€§èƒ½åˆ†æ</h2><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å…¶å®æ˜¯åœ¨ä¼˜åŒ–å·²æœ‰çš„ä»£ç ï¼Œè€Œä¸æ˜¯åœ¨è®¾è®¡å…¨æ–°çš„é«˜æ€§èƒ½ä¸šåŠ¡ã€‚æ‰€ä»¥å»ºè®®åœ¨ä¼˜åŒ–ä¹‹å‰ï¼Œå…ˆåˆ†æå‡ºå“ªäº›ä»£ç æ˜¯<strong>çƒ­ç‚¹</strong>ï¼Œå“ªäº›ä»£ç å ç”¨æœ€å¤šçš„<strong>è¿è¡Œæ—¶é—´&#x2F;ç©ºé—´</strong>ï¼Œç„¶åå†é’ˆå¯¹æ€§åœ°åšä¼˜åŒ–ã€‚ç›¸å…³çš„å·¥å…·æœ‰ perfï¼Œvtuneï¼Œvalgrind ç­‰ç­‰ã€‚éœ€æ³¨æ„æ€§èƒ½åˆ†æå·¥å…·ä¼šä¸ä¼š<strong>æ‹–æ…¢ç¨‹åºè¿è¡Œé€Ÿåº¦</strong>ï¼ˆä¾‹å¦‚ valgrindï¼Œå¥½å®¶ä¼™ç›´æ¥ä»¤æˆ‘çš„ç¨‹åºå‡æ­»ï¼‰ï¼Œå› ä¸ºè¿™ä¼šå¸¦æ¥æµ‹é‡çš„è¯¯å·®ã€‚</p>
<p>é™¤äº†ç°æˆå·¥å…·ï¼Œè¿˜å¯ä»¥ç”¨ <strong>rdtsc æŒ‡ä»¤</strong>åšä½æŸè€—ã€é«˜ç²¾åº¦çš„æ—¶é—´æµ‹é‡ã€‚</p>
<p>åœ¨ co_context é‡Œï¼Œæ€§èƒ½åœ¨ä¸€å¼€å§‹å°±æ˜¯è®¾è®¡é‡ç‚¹ï¼Œæ‰€ä»¥ä¼šå‡è½»ä¸€äº›æ€»ä½“å·¥ä½œé‡ã€‚</p>
<h2 id="æ— é”åŒ–"><a href="#æ— é”åŒ–" class="headerlink" title="æ— é”åŒ–"></a>æ— é”åŒ–</h2><h3 id="ç»†æ•°äº’æ–¥é”ã€Œå››å®—ç½ªã€"><a href="#ç»†æ•°äº’æ–¥é”ã€Œå››å®—ç½ªã€" class="headerlink" title="ç»†æ•°äº’æ–¥é”ã€Œå››å®—ç½ªã€"></a>ç»†æ•°äº’æ–¥é”ã€Œå››å®—ç½ªã€</h3><p>æ— é”è®¾è®¡ï¼Œæ˜¯æ€§èƒ½ä¼˜åŒ–å…¥é—¨çš„ä¸€é“åã€‚æˆ‘ä»¬åœ¨å†™å¤šçº¿ç¨‹ç¨‹åºæ—¶ï¼Œå¾ˆè‡ªç„¶æƒ³åˆ°ç”¨<strong>äº’æ–¥é”ï¼ˆmutexï¼‰</strong>æ¥ä¿æŠ¤å…±äº«æ•°æ®ï¼Œé˜²æ­¢è¯»åˆ°è„æ•°æ®ï¼Œé˜²æ­¢ç«äº‰æ¡ä»¶ï¼ˆrace conditionï¼‰ã€‚äº’æ–¥é”è¿˜æœ‰ä¿¡å·é‡ï¼ˆsemaphoreï¼‰ï¼Œæ¡ä»¶å˜é‡ç­‰å˜ä½“ï¼Œå®ƒä»¬çš„åŸç†éƒ½æ˜¯ç±»ä¼¼çš„ã€‚ä½†å®ƒä»¬ä¼šæœ‰ä¸€äº›æ€§èƒ½ç¼ºé™·ï¼š</p>
<ol>
<li>å’Œçº¿ç¨‹é«˜åº¦ç»‘å®šï¼šå¦‚æœäº’æ–¥é”æŠ¢ä¸åˆ°ï¼Œçº¿ç¨‹å°±é™·å…¥<strong>é˜»å¡</strong>ï¼›</li>
<li>å¼•å…¥é¢å¤–çš„æ•°æ®ç»“æ„ï¼šè‡³å°‘æœ‰ä¸€æ¡å”¤é†’<strong>é˜Ÿåˆ—</strong>ï¼Œè®°å½•å“ªäº›çº¿ç¨‹ç­‰å¾…å”¤é†’ï¼›ä¸”è¿™æ¡é˜Ÿåˆ—æ˜¯<strong>ä¸å®šé•¿</strong>çš„ï¼›</li>
<li>å’Œæ“ä½œç³»ç»Ÿé«˜åº¦ç»‘å®šï¼šçº¿ç¨‹çš„é˜»å¡å’Œå”¤é†’éƒ½è¦èµ°æ“ä½œç³»ç»Ÿ<strong>å†…æ ¸æ€</strong>ï¼›ä¼šæ‰“æ–­ CPU æµæ°´çº¿ï¼Œæ‰€ä»¥æè‡´æ€§èƒ½ä¼˜åŒ–ä¸‹ä¸€èˆ¬ä¸å–œæ¬¢çœ‹è§å†…æ ¸æ€ï¼›</li>
<li>è¦åˆ‡æ¢ä¸Šä¸‹æ–‡ï¼šæ¯æ¬¡åˆ‡çº¿ç¨‹éƒ½è¦æš‚å­˜å’Œæ¢å¤å¯„å­˜å™¨çš„å€¼ï¼Œå¯èƒ½å¼•å‘<strong>å†…å­˜ I&#x2F;O</strong>ã€‚</li>
</ol>
<p>è¯´äº†ä¸€å †å±è¯ï¼Œæ€»ä¹‹<strong>èƒ½é¿å¼€äº’æ–¥é”å°±é¿å¼€</strong>ï¼Œè€Œ co_context æ¯”è¾ƒæ— è„‘ç²—æš´ï¼Œå‡ ä¹ç›´æ¥ç¦ç”¨äº†äº’æ–¥é”ã€‚è¿™ä¹Ÿä¼šå¸¦æ¥ä¸€äº›å‰¯ä½œç”¨ï¼šçº¿ç¨‹åœ¨ç©ºé—²çš„æ—¶å€™ä¹Ÿæ²¡æ³•é˜»å¡ï¼Œä¼šå¯¼è‡´ CPU ç©ºè½¬ï¼Œå¯¹äºå…¶ä»–è¿›ç¨‹æ¥è¯´æ— ç–‘æ˜¯ CPU å¼ºç›—ã€‚ï¼ˆæ‰€ä»¥æˆ‘ä¹Ÿç»™å‡ºäº†å¤‡é€‰æ–¹æ¡ˆï¼šä½¿ç”¨ <code>std::atomic&lt;xxx&gt;::wait/notify</code>ï¼Œå®ƒçš„åŸç†ç±»ä¼¼ futexï¼Œçº¿ç¨‹å¯ä»¥é˜»å¡ï¼‰</p>
<h3 id="æ— é”ä¸–ç•Œçš„ç§©åº"><a href="#æ— é”ä¸–ç•Œçš„ç§©åº" class="headerlink" title="æ— é”ä¸–ç•Œçš„ç§©åº"></a>æ— é”ä¸–ç•Œçš„ç§©åº</h3><p>æ— é”ä¸–ç•Œçš„ç§©åºä¸»è¦é <strong>ã€ŒåŸå­å˜é‡ã€</strong>æ¥ç»´æŒã€‚åŸå­å˜é‡æœ¬è´¨æ˜¯å¯¹ CPU å†…å­˜é¡ºåºã€åŸå­æŒ‡ä»¤ã€ç¼–è¯‘å™¨ä¹±åºçº¦æŸçš„å°è£…ã€‚æœ¬èŠ‚åªåšæœ€åŸºæœ¬çš„å…¥é—¨ä»‹ç»ï¼Œå…¥é—¨ä¹‹åï¼Œè¯»è€…å¯ä»¥å¿«é€Ÿè¯»æ‡‚å…¶ä»–æ–‡ç« ã€‚</p>
<p>æ¯”æ–¹è¯´ï¼Œå¿é•¿è¯´ä»–åˆ°é¹…åŸæ¥ï¼Œåªå¹²ä¸‰ä»¶äº‹ï¼Œç„¶åå°±ç¦»å¼€ã€‚è¿™ä¸‰ä»¶äº‹æ¶‰åŠæœºå¯†ï¼Œå®Œæˆä¹‹å‰å¤–äººæ²¡æ³•çŸ¥é“å…¶çŠ¶æ€ã€‚æœ‰ä¸€å¤©ï¼Œå¿é•¿ç¦»å¼€äº†é¹…åŸï¼Œè¯´æ˜ã€Œä¸‰ä»¶äº‹ã€å·²ç»å®Œæˆäº†ã€‚è‡³äºæ˜¯å“ªä»¶äº‹å…ˆåšå®Œï¼Œå“ªä»¶äº‹ååšå®Œï¼Œæ°‘é—´ä¼—è¯´çº·çº­ã€‚</p>
<p>åœ¨ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä»¤ã€Œå¿é•¿çš„ä½ç½®ã€ä¸ºåŸå­å˜é‡ï¼Œè‹¥ã€Œå¿é•¿çš„ä½ç½®ã€â‰ ã€Œé¹…åŸã€ï¼Œåˆ™ç¼–è¯‘å™¨å’Œ CPU ä¿è¯ä¸‰ä»¶ã€Œäº‹ã€å·²ç»å®Œæˆï¼Œä½†æ˜¯ï¼Œç”±äºä¹±åºä¼˜åŒ–å’Œå†…å­˜é¡ºåºç­‰é—®é¢˜ï¼Œè¿™ä¸‰ä»¶ã€Œäº‹ã€çš„å®Œæˆé¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚æ‰€å¹¸ï¼Œæˆ‘ä»¬ä¸å…³å¿ƒé¡ºåºï¼Œåªè¦è®¿é—®è¿™ä¸‰ä»¶ã€Œäº‹ã€çš„ç»“æœå°±å¯ä»¥äº†ã€‚</p>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬è§£é”äº†ä¸¤ç§ C++ å†…å­˜é¡ºåºï¼š<code>std::memory_order_release</code> å’Œ <code>std::memory_order_acquire</code></p>
<p>æˆ‘ä»¬ç»“åˆä»£ç ä¸¾ä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">std::atomic&lt;<span class="type">int</span>&gt; distance_from_e_city = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹1</span></span><br><span class="line"><span class="built_in">do_A</span>();</span><br><span class="line"><span class="built_in">do_B</span>();</span><br><span class="line"><span class="built_in">do_C</span>();</span><br><span class="line">distance_from_e_city.<span class="built_in">store</span>(<span class="number">100</span>, std::memory_order_release); <span class="comment">// ç¬ç§»100å…¬é‡Œä¸è¿‡åˆ†å§</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹2</span></span><br><span class="line"><span class="keyword">if</span> (distance_from_e_city.<span class="built_in">load</span>(std::memory_order_acquire) &gt; <span class="number">50</span>) &#123;</span><br><span class="line">    <span class="built_in">use_A</span>(); <span class="comment">// å¿…å®šèƒ½çœ‹è§do_Açš„ç»“æœ</span></span><br><span class="line">    <span class="built_in">use_B</span>();</span><br><span class="line">    <span class="built_in">use_C</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–è¯‘å™¨ä¼šä¿è¯<code>std::memory_order_release</code>ä¹‹å‰çš„æŒ‡ä»¤ä¸ä¼šè¢«ä¹±åºåˆ°å…¶ä¹‹åï¼Œä½†æ˜¯ä¸ä¿è¯<code>do_A()</code> <code>do_B()</code> <code>do_C()</code>ä¹‹é—´çš„ä¹±åºã€‚</p>
<p>å¯¹ç§°åœ°ï¼Œ ä¿è¯<code>std::memory_order_acquire</code>ä¹‹åçš„æŒ‡ä»¤ä¸ä¼šè¢«ä¹±åºåˆ°å…¶ä¹‹å‰ï¼Œä½†æ˜¯ä¸ä¿è¯<code>use_A()</code> <code>use_B()</code> <code>use_C()</code>ä¹‹é—´çš„ä¹±åºã€‚</p>
<p>æœ€ç»ˆï¼Œä»¥åŸå­å˜é‡ä¸ºæ¡¥æ¢ï¼Œæˆ‘ä»¬å®ç°äº†å®‰å…¨çš„å…±äº«æ•°æ®è®¿é—®ã€‚è¯»è€…å¯ä»¥å­¦ä¹ <code>std::memory_order_seq_cst</code> <code>std::memory_order_relaxed</code> ç­‰ç­‰æ¥è§£é”æ›´å¤šå§¿åŠ¿ã€‚å…³é”®è¯ï¼šC++ å†…å­˜é¡ºåº</p>
<h3 id="æ— é”æ•°æ®ç»“æ„"><a href="#æ— é”æ•°æ®ç»“æ„" class="headerlink" title="æ— é”æ•°æ®ç»“æ„"></a>æ— é”æ•°æ®ç»“æ„</h3><p>ç†è§£å†…å­˜é¡ºåºä¹‹åï¼Œå°±èƒ½è½»æ¾ä¸Šæ‰‹æ— é”æ•°æ®ç»“æ„äº†ã€‚**å®šé•¿å•ç”Ÿäº§è€…å•æ¶ˆè´¹è€…é˜Ÿåˆ—(SPSC queue)**æ˜¯ä¸€ç§é«˜æ€§èƒ½çš„æ— é”é˜Ÿåˆ—ï¼Œå®ƒæœ‰å¾ˆå¤šçº¦æŸï¼šå®¹é‡å›ºå®šã€åªæ”¯æŒä¸€ä¸ªç”Ÿäº§è€…å’Œä¸€ä¸ªæ¶ˆè´¹è€…ã€‚ä½†å®ƒçš„å»¶è¿Ÿéå¸¸ä½ï¼Œå®ç°éå¸¸ç®€å•ï¼Œåªä¾èµ–å†…å­˜é¡ºåºï¼Œä¸ä¾èµ–äº’æ–¥é”ã€‚co_context ç”¨äº† n æ¡ SPSC é˜Ÿåˆ—æ¥æ¨¡æ‹Ÿâ€œå•ç”Ÿå¤šæ¶ˆâ€å’Œâ€œå¤šç”Ÿå•æ¶ˆâ€åŠŸèƒ½ã€‚</p>
<p>å…¶å®ï¼Œä¿è¯è¶Šå°‘ï¼Œæ€§èƒ½è¶Šé«˜ã€‚SPSC é˜Ÿåˆ—å°šä¸”ä¿ç•™äº†ã€Œå…ˆè¿›å…ˆå‡ºã€çš„é˜Ÿåˆ—æ€§è´¨ï¼Œå€˜è‹¥æŠ›å¼ƒé˜Ÿåˆ—æ€§è´¨ï¼Œè¿˜æœ‰æ›´çŒ›çš„ä¹±åºæ•°æ®ç»“æ„ï¼Œæ€§èƒ½æé«˜å¯é€¼è¿‘100%ã€‚ä½†æ˜¯ï¼Œä¹±åºæ€§ä¼šå¸¦æ¥å¤ªé«˜çš„ debug éš¾åº¦ï¼Œåœ¨è´Ÿè½½å‡è¡¡ä¸Šä¹Ÿä¸å®ç”¨ï¼Œæœ€ç»ˆè¿˜æ˜¯è¢«æˆ‘å¼ƒç”¨äº†ã€‚</p>
<h3 id="ç”¨æˆ·æ€äº’æ–¥é”"><a href="#ç”¨æˆ·æ€äº’æ–¥é”" class="headerlink" title="ç”¨æˆ·æ€äº’æ–¥é”"></a>ç”¨æˆ·æ€äº’æ–¥é”</h3><p>åº•å±‚å¼€å‘è€…å¯ä»¥æ‰¿å—æ²¡æœ‰äº’æ–¥é”çš„ä¸ä¾¿ï¼Œä½†ä¸èƒ½ä¸ç»™åº”ç”¨å±‚æä¾›äº’æ–¥é”çš„ç­‰ä»·å·¥å…·ã€‚co_context ç»™ç”¨æˆ·æä¾›äº†äº’æ–¥é”ã€ä¿¡å·é‡å’Œæ¡ä»¶å˜é‡ï¼Œå®ƒä»¬çš„ API ä¸ C++ æ ‡å‡†åº“å‡ ä¹ä¸€è‡´ï¼Œåœ¨ä½“éªŒä¸Šæ²¡æœ‰å·®åˆ«ï¼Œåœ¨å®ç°ä¸Šæ€§èƒ½ä¼šç•¥å¼ºï¼Œä¸€æ˜¯å› ä¸ºæ— ç­‰å¾…ä¸”å®Œå…¨<strong>ä¸ç»è¿‡å†…æ ¸æ€</strong>ï¼ŒäºŒæ˜¯å› ä¸ºæ²¡æœ‰<strong>å¼•å…¥å †å†…å­˜åˆ†é…</strong>ã€‚æ¶‰åŠçš„æŠ€å·§æ¯”è¾ƒå¤æ‚ï¼Œåœ¨è¿™é‡Œå°±ä¸å±•å¼€ä»‹ç»äº†ï¼Œå…³é”®è¯ï¼šç”¨<strong>ä¾µå…¥å¼é“¾è¡¨</strong>å®ç°ç­‰å¾…é˜Ÿåˆ—ã€‚è¿™é‡Œæ¨èå‚è€ƒ <a href="https://github.com/lewissbaker/cppcoro/blob/master/include/cppcoro/async_mutex.hpp">cppcoro</a> çš„äº’æ–¥é”å®ç°ã€‚</p>
<h2 id="cacheline-ç¼–æ’"><a href="#cacheline-ç¼–æ’" class="headerlink" title="cacheline ç¼–æ’"></a>cacheline ç¼–æ’</h2><p>å¸¸è§ CPU çš„å†…å­˜è¯»å†™éƒ½æ˜¯ä»¥ 64 å­—èŠ‚ä¸ºå•ä½çš„ï¼Œå¯¹åº” CPU çš„ cache ä¹Ÿæ˜¯æ¯ 64 å­—èŠ‚ä¸ºä¸€ä¸ªã€Œcachelineã€ã€‚æ€§èƒ½ä¼˜åŒ–çš„å¿…ä¿®è¯¾ä¹‹ä¸€æ˜¯å¦¥å–„å®‰æ’æ•°æ®åœ¨ cache ä¸­çš„ä½ç½®ã€‚ä¸å¦¥çš„å®‰æ’ä¼šå¯¼è‡´ä»¥ä¸‹æƒ…å†µï¼š</p>
<ol>
<li><strong>ä¼ªå…±äº«ï¼ˆfalse sharingï¼‰</strong>ï¼šçº¿ç¨‹ 1 è¯»å†™å˜é‡ aï¼Œçº¿ç¨‹ 2 è¯»å†™å˜é‡ bï¼Œæœ¬æ˜¯è€æ­»ä¸ç›¸å¾€æ¥ï¼Œå´ååè®© a å’Œ b å¤„äºåŒä¸€ cachelineã€‚</li>
<li><strong>ä¹’ä¹“ç¼“å­˜ï¼ˆcacheline ping-pongingï¼‰</strong>ï¼šå¸¸è§äºä¼ªå…±äº«ã€‚å˜é‡ a å’Œ b ä½äºåŒä¸€ cachelineï¼Œçº¿ç¨‹ 1 åªè¯» aï¼Œçº¿ç¨‹ 2 é¢‘ç¹æ”¹å†™ bã€‚ç»“æœï¼Œæ¯å½“ b è¢«çº¿ç¨‹ 2 ä¿®æ”¹æ—¶ï¼Œçº¿ç¨‹ 1 éƒ½è¦åŒæ­¥ a æ‰€åœ¨çš„ cachelineï¼Œè¿™å®é™…ä¸Šæ˜¯å¤šä½™çš„ã€‚</li>
<li>å¤šä½™è¯»å†™ï¼šå¸¸è§äºæŒ‡é’ˆè§£å¼•ç”¨ã€é€šè®¯åè®®ã€‚å¯ä»¥åªç”¨ä¸€æ¡ cacheline å®Œæˆè·¨æ ¸é€šè®¯ï¼Œå®é™…å´ç”¨äº†å¤šæ¡ã€‚</li>
<li>cache æµªè´¹ï¼šå·æ‡’ï¼Œæ— è„‘å¡ 64 å­—èŠ‚åš paddingã€‚è¿™æ˜¯ä¸è´Ÿè´£ä»»çš„åšæ³•ï¼Œæœ¬è´¨åªæ˜¯å°† cache-miss è½¬ç§»åˆ°å…¶ä»–æ•°æ®ä¸Šã€‚</li>
</ol>
<p>åªè¦å–„ç”¨ C++ çš„<code>alignas</code>å…³é”®å­—ï¼Œé’ˆå¯¹ä»¥ä¸Šé—®é¢˜ï¼Œç›¸ä¿¡è¯»è€…èƒ½æƒ³å‡ºä¼˜åŒ–çš„åŠæ³•ã€‚</p>
<p>co_context å¤§é‡ä½¿ç”¨äº† <code>alignas(64)</code>æ¥æŒ‡å®šç»“æ„ä½“åœ¨ cacheline ä¸­çš„ä½ç½®ï¼Œä»¥ä¼˜åŒ–æ€§èƒ½ã€‚</p>
<h2 id="è·¨æ ¸é€šä¿¡å‹ç¼©"><a href="#è·¨æ ¸é€šä¿¡å‹ç¼©" class="headerlink" title="è·¨æ ¸é€šä¿¡å‹ç¼©"></a>è·¨æ ¸é€šä¿¡å‹ç¼©</h2><p>è¿™ä¸€èŠ‚ä¹Ÿä¸ CPU cache æœ‰å…³ã€‚</p>
<h3 id="è§£å¼•ç”¨çœŸçš„æœ‰å¿…è¦å—ï¼Ÿ"><a href="#è§£å¼•ç”¨çœŸçš„æœ‰å¿…è¦å—ï¼Ÿ" class="headerlink" title="è§£å¼•ç”¨çœŸçš„æœ‰å¿…è¦å—ï¼Ÿ"></a>è§£å¼•ç”¨çœŸçš„æœ‰å¿…è¦å—ï¼Ÿ</h3><p>åœ¨å¤šçº¿ç¨‹ç¨‹åºé‡Œï¼Œç»å¸¸è§åˆ°çº¿ç¨‹ 1 å†™å…¥å˜é‡ aï¼Œç„¶åå°† <code>p=&amp;a</code> å‘Šè¯‰çº¿ç¨‹ 2ï¼Œæœ€åï¼Œçº¿ç¨‹ 2 è¯»å–<code>*p</code> ã€‚è¿™é‡Œå¤§æ¦‚ç‡æ¶‰åŠäº†ä¸¤æ¡ cacheline çš„åŒæ­¥ï¼šä¸€æ¡æ˜¯æŒ‡é’ˆ pï¼Œå¦ä¸€æ¡æ˜¯<code>*p</code>ä¹Ÿå°±æ˜¯å˜é‡ aã€‚ ä½†è¿™çœŸçš„æœ‰å¿…è¦å—ï¼Ÿ</p>
<p>ä»¥ co_context ä¸ºä¾‹ï¼Œä¼˜åŒ–å‰ï¼Œçº¿ç¨‹ 1 å†™å…¥ <code>a.type = xxx</code> ï¼Œ<code>p = &amp;a</code>äº¤ç»™çº¿ç¨‹ 2ï¼Œçº¿ç¨‹ 2 æ ¹æ® <code>p-&gt;type</code> åšä¸åŒçš„æ“ä½œã€‚ä½†æ˜¯ï¼Œç”±äº <code>a.type</code> åªæœ‰ 8 ç§å–å€¼ ï¼Œå¯¹åº”äºŒè¿›åˆ¶ 3 ä¸ª bitï¼Œè€Œå˜é‡ a æ­£å¥½æ˜¯æŒ‰ç…§ 8 å­—èŠ‚å¯¹é½çš„ï¼Œa çš„åœ°å€æœ«å°¾ 3 ä¸ª bit å¿…ç„¶ä¸º 0ï¼Œæ„å‘³ç€ <code>p = &amp;a</code> çš„æœ«å°¾ 3 ä¸ª bit æ²¡æœ‰æºå¸¦ä»»ä½•ä¿¡æ¯ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆä¸è®©è¿™ 3 ä¸ª bit å­˜æ”¾ <code>a.type</code> å‘¢ï¼Ÿ</p>
<p>äºæ˜¯ï¼Œä¼˜åŒ–åï¼Œçº¿ç¨‹ 1 å†™å…¥<code>p = &amp;a; p |= a.type = xxx;</code> ï¼Œp äº¤ç»™çº¿ç¨‹ 2ï¼Œçº¿ç¨‹ 2 æ ¹æ® <code>p &amp; 7</code> åšä¸åŒçš„è½¬å‘ï¼Œå…¨è¿‡ç¨‹æ²¡æœ‰è§£å¼•ç”¨ pï¼ŒèŠ‚çœäº†ä¸€æ¬¡ cacheline ä¼ æ’­ã€‚</p>
<h3 id="ä½¿ç”¨-union-ä½†ä¸æ˜¯-std-variant"><a href="#ä½¿ç”¨-union-ä½†ä¸æ˜¯-std-variant" class="headerlink" title="ä½¿ç”¨ union ä½†ä¸æ˜¯ std::variant"></a>ä½¿ç”¨ union ä½†ä¸æ˜¯ std::variant</h3><p>ï¼ˆè¿™ä¸€æ¡å»ºè®®éå¸¸æ¿€è¿›ï¼Œè¯»è€…ä¸€æ—¦ä½¿ç”¨ï¼Œæœ€å¥½è¡¥ä¸Šå……è¶³çš„æ–‡æ¡£ï¼‰</p>
<p>ä½¿ç”¨ unionï¼ˆè”åˆä½“ï¼‰å¯ä»¥è¿›ä¸€æ­¥å‹ç¼© struct çš„ä½“ç§¯ã€‚æ¯å½“ç”¨ union å°† struct çš„ä½“ç§¯å‡å°åˆ° n*64ï¼Œæ¯æ¬¡åŒæ­¥ cacheline æ‰€ä¼ è¾“çš„ä¿¡æ¯é‡å°±ä¼šæå‡ï¼Œç†è®ºæ€§èƒ½å°±ä¼šå‡ºç°ä¸€æ¬¡è´¨å˜ã€‚</p>
<p>ç”¨ std::variant ä¹Ÿèƒ½è¾¾åˆ°å‹ç¼©ä½“ç§¯çš„ç›®çš„ï¼Œä½†æ˜¯ std::variant çš„ä»¥ç±»å‹ä¸ºå•ä½çš„å¤šæ€ç²’åº¦æ¯”è¾ƒç²—ç³™ï¼Œå†…ç½®çš„å¼‚å¸¸å¤„ç†ä¹Ÿå¸¦æ¥äº†æ€§èƒ½æŸè€—ï¼Œåœ¨æè‡´æ€§èƒ½ä¼˜åŒ–æ—¶å¯èƒ½ä¼šç¦ç”¨ï¼ˆä½† std::variant æ»¡è¶³æ™®é€šé¡¹ç›®æ˜¯ç»°ç»°æœ‰ä½™äº†ï¼‰ã€‚</p>
<h2 id="æ‰¹å¤„ç†è¯·æ±‚"><a href="#æ‰¹å¤„ç†è¯·æ±‚" class="headerlink" title="æ‰¹å¤„ç†è¯·æ±‚"></a>æ‰¹å¤„ç†è¯·æ±‚</h2><p>åœ¨ co_context ä¸­ï¼Œå¾ˆå®¹æ˜“å®Œæˆä¸€ä¸ªæ‰¹å¤„ç†ä¼˜åŒ–ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¼˜åŒ–å‰</span></span><br><span class="line"><span class="function"><span class="keyword">co_await</span> <span class="title">A_IO</span><span class="params">(&amp;buf)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">co_await</span> <span class="title">B_IO</span><span class="params">(&amp;buf)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">co_await</span> <span class="title">C_IO</span><span class="params">(&amp;buf)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼˜åŒ–å</span></span><br><span class="line"><span class="built_in">co_await</span> (<span class="built_in">A_IO</span>(&amp;buf) &amp;&amp; <span class="built_in">B_IO</span>(&amp;buf) &amp;&amp; <span class="built_in">C_IO</span>(&amp;buf));</span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„ä¾‹å­ï¼ŒåŸæœ¬è¦è¿›å…¥è°ƒåº¦å™¨ 3 æ¬¡ï¼Œå°† I&#x2F;O è¯·æ±‚æäº¤ç»™å†…æ ¸æ€ 3 æ¬¡ï¼Œåœ¨ä¼˜åŒ–åç»Ÿç»Ÿå˜ä¸º 1 æ¬¡ã€‚æ‰¹å¤„ç†ä¼˜åŒ–çš„æ€æƒ³æ— è®ºåœ¨åº•å±‚è¿˜æ˜¯æ¶æ„å±‚åº”ç”¨å±‚éƒ½æ˜¯éå¸¸å®ç”¨çš„ã€‚</p>
<p>è¦ç•™æ„çš„æ˜¯æ‰¹å¤„ç†æ˜¯å¦ä¼š<strong>å¯¹å»¶è¿Ÿé€ æˆä¸å¯æ¥å—çš„å½±å“</strong>ï¼Œå¦‚æœä¸ºäº†æ‰¹å¤„ç†è€Œå¼ºè¡Œç­‰å¾…ï¼Œå¯èƒ½å¾—ä¸å¿å¤±ã€‚</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æœ¬ç¯‡ä»‹ç»äº†ä¸€äº› C++ æ€§èƒ½ä¼˜åŒ–çš„æŠ€å·§ï¼Œé‡ç‚¹æ˜¯å†…å­˜é¡ºåºå’Œ CPU cacheã€‚è™½ç„¶æ€§èƒ½ä¼˜åŒ–çš„æ°´å¾ˆæ·±ï¼Œéœ€è¦å¤§é‡çš„åŸºç¡€çŸ¥è¯†å’Œç»éªŒç§¯ç´¯ï¼Œä½†æ­£å› æ­¤æˆ‘ä»¬æœ‰æœºä¼šä¸ºä¸–ç•Œåšåˆ«å‡ºå¿ƒè£çš„è´¡çŒ®ï¼Œåšå®šå‰è¡Œå§éªšå¹´ï¼æœ€åï¼Œæ”¾ä¸¤å¼ ç¥–ä¼ çš„ co_context æ€§èƒ½æµ‹è¯•å›¾ï¼š</p>
<p>netcat ç½‘ç»œååï¼ˆå•è¿æ¥ï¼‰ï¼š<br><img src="/2022/06/25/co-context-2/netcat.png" alt="netcat"></p>
<p>redis-benchmark QPS å’Œå¹³å‡å»¶è¿Ÿï¼ˆå•çº¿ç¨‹ï¼‰ï¼š<br><img src="/2022/06/25/co-context-2/redis-single-thread.png" alt="redis-benchmark"></p>
<hr>
<p>ä»£ç å®æ—¶åŒæ­¥äº <a href="https://github.com/Codesire-Deng/co_context">Github</a>ï¼Œæ±‚ star~</p>
]]></content>
      <tags>
        <tag>C++</tag>
        <tag>Concurrency</tag>
        <tag>C++åç¨‹</tag>
        <tag>co_context</tag>
      </tags>
  </entry>
  <entry>
    <title>CUDA å­¦ä¹ ç¬”è®°</title>
    <url>/2021/08/05/cuda/</url>
    <content><![CDATA[<p>å‚è€ƒèµ„æ–™ï¼š</p>
<ul>
<li>ã€ŠCUDA ç¼–ç¨‹ åŸºç¡€ä¸å®è·µã€‹æ¨Šå“²å‹‡</li>
<li><a href="https://docs.nvidia.com/cuda/index.html">CUDA Toolkit Documentation</a></li>
</ul>
<h2 id="è·å¾—-GPU-åŠ é€Ÿçš„å…³é”®"><a href="#è·å¾—-GPU-åŠ é€Ÿçš„å…³é”®" class="headerlink" title="è·å¾— GPU åŠ é€Ÿçš„å…³é”®"></a>è·å¾— GPU åŠ é€Ÿçš„å…³é”®</h2><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><h4 id="å¿…è¦æ¡ä»¶"><a href="#å¿…è¦æ¡ä»¶" class="headerlink" title="å¿…è¦æ¡ä»¶"></a>å¿…è¦æ¡ä»¶</h4><ol>
<li>æ•°æ®ä¼ è¾“æ¯”ä¾‹è¾ƒå°</li>
<li>æ ¸å‡½æ•°çš„ç®—æœ¯å¼ºåº¦è¾ƒé«˜</li>
<li>æ ¸å‡½æ•°ä¸­å®šä¹‰çš„çº¿ç¨‹æ•°ç›®è¾ƒå¤š</li>
</ol>
<h4 id="æé«˜æ€§èƒ½çš„æŠ€å·§"><a href="#æé«˜æ€§èƒ½çš„æŠ€å·§" class="headerlink" title="æé«˜æ€§èƒ½çš„æŠ€å·§"></a>æé«˜æ€§èƒ½çš„æŠ€å·§</h4><ol>
<li>å‡å°‘ä¸»æœºä¸è®¾å¤‡ä¹‹é—´çš„æ•°æ®ä¼ è¾“</li>
<li>æé«˜æ ¸å‡½æ•°çš„ç®—æœ¯å¼ºåº¦</li>
<li>å¢å¤§æ ¸å‡½æ•°çš„å¹¶è¡Œè§„æ¨¡</li>
</ol>
<span id="more"></span>

<h2 id="SM-æµå¤šå¤„ç†å™¨"><a href="#SM-æµå¤šå¤„ç†å™¨" class="headerlink" title="SM æµå¤šå¤„ç†å™¨"></a>SM æµå¤šå¤„ç†å™¨</h2><p>å®˜æ–¹æœ‰æ—¶ç®€ç§° Multiprocessor</p>
<h3 id="SM-çš„æ„æˆ"><a href="#SM-çš„æ„æˆ" class="headerlink" title="SM çš„æ„æˆ"></a>SM çš„æ„æˆ</h3><ol>
<li>å¯„å­˜å™¨</li>
<li>å…±äº«å†…å­˜</li>
<li>å¸¸é‡å†…å­˜çš„ç¼“å­˜</li>
<li>çº¹ç†å’Œè¡¨é¢å†…å­˜çš„ç¼“å­˜</li>
<li>L1 ç¼“å­˜</li>
<li>ï¼ˆå¸¸è§4ä¸ªï¼‰çº¿ç¨‹æŸè°ƒåº¦å™¨</li>
<li>æ‰§è¡Œæ ¸å¿ƒï¼šINT32, FP32, FP64, å•ç²¾åº¦æµ®ç‚¹æ•°è¶…äºå‡½æ•°çš„ç‰¹æ®Šå‡½æ•°å•å…ƒ(special function unit, SFUs), æ··åˆç²¾åº¦çš„å¼ é‡æ ¸å¿ƒ(tensor cores)</li>
</ol>
<h3 id="SM-çš„å æœ‰ç‡"><a href="#SM-çš„å æœ‰ç‡" class="headerlink" title="SM çš„å æœ‰ç‡"></a>SM çš„å æœ‰ç‡</h3><p>å½“å¹¶è¡Œè§„æ¨¡è¾ƒå°ï¼Œæœ‰äº› SM å æœ‰ç‡ä¸ºé›¶ï¼Œå¯¼è‡´ç¨‹åºæ€§èƒ½ä½ä¸‹ã€‚å½“å¹¶è¡Œè§„æ¨¡è¶³å¤Ÿå¤§æ—¶ï¼Œä¹Ÿæœ‰å¯èƒ½å¾—åˆ°é 100% çš„å æœ‰ç‡ã€‚</p>
<p>è€ƒè™‘æŒ‡æ ‡ï¼ˆæŸ¥è¯¢å®˜æ–¹æ–‡æ¡£ CUDA_Occupancy_Calculator.xls çš„å›¾çµæ¶æ„ï¼‰ï¼š</p>
<ol>
<li>ä¸€ä¸ª SM æœ€å¤šæ‹¥æœ‰çº¿ç¨‹å—ä¸ªæ•°$\ N_b &#x3D; 16$ã€‚</li>
<li>ä¸€ä¸ª SM æœ€å¤šæ‹¥æœ‰çš„çº¿ç¨‹ä¸ªæ•°$\ N_t &#x3D; 1536$ã€‚</li>
<li>çº¿ç¨‹å—å¤§å°æœ€å¤§ä¸º$\ 1024$ã€‚</li>
</ol>
<p>å½“å¹¶è¡Œè§„æ¨¡è¶³å¤Ÿå¤§ï¼ˆæ ¸å‡½æ•°é…ç½®çš„æ€»çº¿ç¨‹æ•°è¶³å¤Ÿå¤šï¼‰ï¼Œéœ€è¦åˆ†å‡ ç§æƒ…å†µè®¨è®º SM çš„ç†è®ºå æœ‰ç‡ï¼š</p>
<ol>
<li>å¯„å­˜å™¨æ ¸å…±äº«å†…å­˜ä½¿ç”¨é‡å¾ˆå°‘ã€‚SM çš„å æœ‰ç‡å®Œå…¨ç”±çº¿ç¨‹å—å¤§å°å†³å®šã€‚é¦–å…ˆï¼Œç”±äºçº¿ç¨‹æŸå¤§å°æ˜¯ 32ï¼Œçº¿ç¨‹å—å¤§å°æœ€å¥½æ˜¯ 32 çš„å€æ•°ã€‚å…¶æ¬¡ï¼Œçº¿ç¨‹å—å¤§å°ä¸èƒ½å°äº$\ N_t&#x2F;N_b$â€‹ï¼Œæ‰å¯èƒ½åˆ©ç”¨æœ€å¤§çº¿ç¨‹æ•°é‡ã€‚å› æ­¤ï¼Œ96 çš„çº¿ç¨‹å—å¤§å°å°±èƒ½è·å¾— 100% çš„å æœ‰ç‡ã€‚ç±»ä¼¼çš„ï¼Œ128 çš„çº¿ç¨‹å—å¤§å°åœ¨å¼€æ™®å‹’æ¶æ„ä¸‹èƒ½è·å¾—æ»¡å æœ‰ç‡ã€‚ï¼ˆæˆ‘é€‰æ‹© 128ï¼‰</li>
<li>å¯„å­˜å™¨å¸¦æ¥å æœ‰ç‡ç“¶é¢ˆã€‚ä¸€ä¸ª SM æœ€å¤šæœ‰ 65536ï¼ˆ64Kï¼‰ä¸ªå¯„å­˜å™¨ã€‚å¦‚æœä»¤çº¿ç¨‹æ•°æœ€å¤§åŒ–ï¼ˆ1536ï¼‰ï¼Œé‚£ä¹ˆå¹³å‡ä¸€ä¸ªçº¿ç¨‹å¯ç”¨ 42.7 ä¸ªå¯„å­˜å™¨ã€‚å½“æ¯ä¸ªçº¿ç¨‹æ‰€ç”¨çš„å¯„å­˜å™¨ä¸ªæ•°å¤§äº 42 æ—¶ï¼ŒSM çš„å æœ‰ç‡å°†ä½äº 50%ã€‚</li>
<li>æœ‰é™çš„å…±äº«å†…å­˜å¯¹å æœ‰ç‡çš„çº¦æŸã€‚ä¸€ä¸ª SM æ‹¥æœ‰ 65536 å­—èŠ‚å…±äº«å†…å­˜ã€‚å¦‚æœçº¿ç¨‹å—å¤§å°ä¸º 128ï¼Œä¸”SM æ˜¯çº¿ç¨‹æ»¡è½½ï¼ˆ1536ï¼‰ï¼Œè¦ä»¤å æœ‰ç‡ä¸º 100%ï¼Œåˆ™ç½‘æ ¼å¤§å°ä¸º 12ï¼Œä¸€ä¸ªçº¿ç¨‹å—æœ€å¤šæœ‰ 5461 å­—èŠ‚çš„å…±äº«å†…å­˜ã€‚</li>
</ol>
<h3 id="è¿è¡Œæ—¶APIæŸ¥è¯¢è®¾å¤‡"><a href="#è¿è¡Œæ—¶APIæŸ¥è¯¢è®¾å¤‡" class="headerlink" title="è¿è¡Œæ—¶APIæŸ¥è¯¢è®¾å¤‡"></a>è¿è¡Œæ—¶APIæŸ¥è¯¢è®¾å¤‡</h3><p>å‚è€ƒ<code>deviceQuery.cpp</code></p>
<h2 id="å…¨å±€å†…å­˜çš„åˆç†ä½¿ç”¨"><a href="#å…¨å±€å†…å­˜çš„åˆç†ä½¿ç”¨" class="headerlink" title="å…¨å±€å†…å­˜çš„åˆç†ä½¿ç”¨"></a>å…¨å±€å†…å­˜çš„åˆç†ä½¿ç”¨</h2><h3 id="åˆå¹¶è®¿é—®"><a href="#åˆå¹¶è®¿é—®" class="headerlink" title="åˆå¹¶è®¿é—®"></a>åˆå¹¶è®¿é—®</h3><p>å…¨å±€å†…å­˜å…·æœ‰æœ€é«˜çš„å»¶è¿Ÿï¼Œæ‰€ä»¥é…ç½®æœ‰ç¼“å­˜ï¼Œæ¯æ¬¡ Cache Miss é»˜è®¤è¯»å– 32 å­—èŠ‚ã€‚ç”±äºç¼“å­˜å‘½ä¸­é—®é¢˜ï¼Œéœ€è¦æé«˜å†…å­˜è®¿é—®çš„åˆå¹¶åº¦ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚ç®€å•èµ·è§ï¼Œåªè€ƒè™‘å…¨å±€å†…å­˜åˆ° L2 ç¼“å­˜ã€‚å¯ä»¥å®šä¹‰åˆå¹¶åº¦(degree of coalescing) ä¸º<strong>ä¸€ä¸ªçº¿ç¨‹æŸ</strong>è¯·æ±‚çš„å­—èŠ‚æ•°é™¤ä»¥å®é™…æ•°æ®ä¼ è¾“å¤„ç†çš„å­—èŠ‚æ•°ã€‚åˆå¹¶åº¦ä½“ç°äº†æ˜¾å­˜å¸¦å®½çš„åˆ©ç”¨ç‡ã€‚</p>
<p>CUDA è¿è¡Œæ—¶ API å‡½æ•°åˆ†é…çš„å†…å­˜çš„é¦–åœ°å€è‡³å°‘æ˜¯256å­—èŠ‚çš„æ•´æ•°å€ã€‚</p>
<p>åªè¦ç¡®ä¿æ¯å½“çº¿ç¨‹æŸè¯»å–ä¸€æ¬¡å†…å­˜åï¼Œè¯¥å†…å­˜å¯¹åº”çš„32å­—èŠ‚èŒƒå›´éƒ½è¢«å½“å‰çº¿ç¨‹æŸåˆ©ç”¨ï¼Œåˆ™åˆå¹¶åº¦å°±æ˜¯100%ã€‚</p>
<p>å¯¹äºä¸€ä¸ªçº¿ç¨‹æŸè®¿é—®åŒä¸€ä¸ªå…¨å±€å†…å­˜åœ°å€çš„ 4 å­—èŠ‚ï¼Œå±äºå¹¿æ’­å¼çš„éåˆå¹¶è®¿é—®ï¼ˆå› ä¸ºåªç”¨äº† 4 å­—èŠ‚è€Œé 32 å­—èŠ‚ï¼Œåˆå¹¶åº¦ä¸º 12.5%ï¼‰ã€‚å¦‚æœå†…å­˜åªè¯»ï¼Œé‚£ä¹ˆé€‚åˆé‡‡ç”¨å¸¸é‡å†…å­˜ã€‚</p>
<h3 id="å†™ä¼˜å…ˆäºåªè¯»"><a href="#å†™ä¼˜å…ˆäºåªè¯»" class="headerlink" title="å†™ä¼˜å…ˆäºåªè¯»"></a>å†™ä¼˜å…ˆäºåªè¯»</h3><p>æœ‰æ—¶å€™åˆå¹¶å†™å…¥ä¸åˆå¹¶è¯»å–æ— æ³•å…¼é¡¾ï¼Œä¾‹å¦‚çŸ©é˜µè½¬ç½®ã€‚æ­¤æ—¶åº”å½“ä¼˜å…ˆä¿è¯å†™å…¥æ˜¯åˆå¹¶çš„ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºä»å¸•æ–¯å¡æ¶æ„å¼€å§‹ï¼Œè‹¥ç¼–è¯‘å™¨åˆ¤å®šä¸€ä¸ªå…¨å±€å†…å­˜å˜é‡åœ¨æ•´ä¸ªæ ¸å‡½æ•°çš„èŒƒå›´å†…éƒ½<strong>åªè¯»</strong>ï¼Œåˆ™ä¼šè‡ªåŠ¨ç”¨å‡½æ•°<code>__ldg()</code>è¯»å–å…¨å±€å†…å­˜ï¼Œé™„å¸¦ç¼“å­˜æ•ˆæœï¼Œç¼“è§£éåˆå¹¶è®¿é—®çš„å½±å“ã€‚ä½†å¯¹äºå…¨å±€å†…å­˜çš„å†™å…¥ï¼Œæ²¡æœ‰ç±»ä¼¼çš„ä¼˜åŒ–æ‰‹æ®µã€‚</p>
<h2 id="å…±äº«å†…å­˜çš„åˆç†ä½¿ç”¨"><a href="#å…±äº«å†…å­˜çš„åˆç†ä½¿ç”¨" class="headerlink" title="å…±äº«å†…å­˜çš„åˆç†ä½¿ç”¨"></a>å…±äº«å†…å­˜çš„åˆç†ä½¿ç”¨</h2><p>åœ¨æ ¸å‡½æ•°å†…ï¼Œä½¿ç”¨<code>__shared__</code>ä¿®é¥°çš„å˜é‡ï¼ˆæ•°ç»„ï¼‰å°†ä½¿ç”¨å…±äº«å†…å­˜ã€‚åŒä¸€çº¿ç¨‹å—ä½¿ç”¨åŒä¸€ä¸ªå…±äº«å†…å­˜å‰¯æœ¬ï¼Œè€Œä¸åŒçº¿ç¨‹å—çš„å…±äº«å†…å­˜æ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼Œä¸å¯è§çš„ã€‚</p>
<p>åˆ©ç”¨å…±äº«å†…å­˜ï¼Œå¯ä»¥æ¶ˆé™¤ä¸€äº›æ— æ³•å…¼é¡¾è¯»å†™åˆå¹¶çš„å…¨å±€å†…å­˜è®¿é—®ï¼Œä¾‹å¦‚æ•°ç»„å½’çº¦ï¼Œå…ˆå°†è¦è¯»å–çš„æ•°æ®ä»å…¨å±€å†…å­˜æ‹·è´è‡³å…±äº«å†…å­˜ï¼ˆç„¶å<code>__syncthreads()</code>åŒæ­¥ä¸€ä¸‹ï¼‰ï¼Œå¯ä»¥å¸¦æ¥ç»†å¾®çš„æ€§èƒ½æå‡ã€‚</p>
<p>å¯¹å…±äº«å†…å­˜çš„è®¿é—®è¶Šé¢‘ç¹ï¼Œæ€§èƒ½æå‡è¶Šæ˜æ˜¾ã€‚</p>
<h3 id="åŠ¨æ€å…±äº«å†…å­˜"><a href="#åŠ¨æ€å…±äº«å†…å­˜" class="headerlink" title="åŠ¨æ€å…±äº«å†…å­˜"></a>åŠ¨æ€å…±äº«å†…å­˜</h3><p>å…±äº«å†…å­˜å¤§å°å¯ä»¥åœ¨æ ¸å‡½æ•°çš„æ‰§è¡Œé…ç½®ä¸­æŒ‡å®šï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">&lt;&lt;&lt;grid_size, block_size, <span class="built_in">sizeof</span>(real) * block_size&gt;&gt;&gt;</span><br></pre></td></tr></table></figure>

<p>åŒæ—¶è¦ä¿®æ”¹å…±äº«å†…å­˜å˜é‡çš„å£°æ˜æ–¹å¼</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// before</span></span><br><span class="line">__shared__ real a[<span class="number">128</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// after</span></span><br><span class="line"><span class="keyword">extern</span> __shared__ real a[];</span><br></pre></td></tr></table></figure>

<p>åŠ¨æ€å’Œé™æ€çš„å£°æ˜æ–¹å¼åœ¨æ€§èƒ½ä¸Šå‡ ä¹æ²¡æœ‰å·®åˆ«ã€‚</p>
<h3 id="é¿å…å…±äº«å†…å­˜çš„bankå†²çª"><a href="#é¿å…å…±äº«å†…å­˜çš„bankå†²çª" class="headerlink" title="é¿å…å…±äº«å†…å­˜çš„bankå†²çª"></a>é¿å…å…±äº«å†…å­˜çš„bankå†²çª</h3><p>å…±äº«å†…å­˜åœ¨ç‰©ç†ä¸Šè¢«åˆ†ä¸º 32 ä¸ªï¼ˆæ°å¥½æ˜¯çº¿ç¨‹æŸå¤§å°ï¼‰ä¸ª bankï¼Œå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€ä¸ª bank ä¼šå¯¼è‡´å†²çªï¼›å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸åŒçš„ bank èƒ½å–å¾—æ›´é«˜çš„æ€§èƒ½ã€‚</p>
<p>é™¤äº†å¼€æ™®å‹’æ¶æ„ï¼ˆ8 å­—èŠ‚ï¼‰å¤–ï¼Œæ¯ 4 ä¸ªå­—èŠ‚è¢«åˆ’åˆ†åˆ°ä¸€ä¸ª bankã€‚ä¾‹å¦‚ <code>0000</code> å±äº bank0ï¼Œ<code>0004</code> å±äº bank1 â€¦â€¦ <code>0128</code> å±äº bank0ã€‚å¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸ª bank çš„ç›¸é‚»å±‚çš„åœ°å€ç›¸å·® 128ã€‚</p>
<p>ä¸€ä¸ªçº¿ç¨‹æŸè¯•å›¾åŒæ—¶è®¿é—®åŒä¸€ä¸ª bank ä¸­çš„ n å±‚æ•°æ®å°†å¯¼è‡´ n æ¬¡ å†…å­˜äº‹åŠ¡(memory transaction)ã€‚äº¦ç§°ä¸º n è·¯ bank å†²çªã€‚n å¾ˆå¤§çš„ bank å†²çªæ˜¯è¦å°½é‡é¿å…çš„ã€‚</p>
<p>åœ¨çŸ©é˜µè½¬ç½®ä¸­ï¼Œå†™å…¥å…±äº«å†…å­˜æ—¶æ˜“äº§ç”Ÿ bank å†²çªï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹æ•°ç»„å¤§å°è§£å†³ã€‚</p>
<p>è®°å¾—åŒç²¾åº¦æµ®ç‚¹æ•°å  8 å­—èŠ‚ã€‚</p>
<h2 id="åŸå­å‡½æ•°"><a href="#åŸå­å‡½æ•°" class="headerlink" title="åŸå­å‡½æ•°"></a>åŸå­å‡½æ•°</h2><p>ä¾‹å¦‚åœ¨æ•°ç»„å½’çº¦ï¼ˆåŠ æ³•ï¼‰ä¸­ï¼Œè¦ä»¤GPUå®Œæˆæ±‚å’Œï¼Œéœ€è¦ä½¿ç”¨åŸå­æ“ä½œã€‚</p>
<h3 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h3><p>åŸå­å‡½æ•°åœ¨å…¨å±€å†…å­˜å’Œå…±äº«å†…å­˜ä¸Šä½“ç°åŸå­æ€§ã€‚</p>
<p>åŸå­å‡½æ•°ä¸ä¾èµ–å†…å­˜æ …æ ï¼Œä¸éœ€è¦çº¿ç¨‹åŒæ­¥æˆ–é¡ºåºçº¦æŸï¼ˆå‚è€ƒ<a href="https://docs.nvidia.com/cuda/cuda-c-programming-guide/index.html#atomic-functions">å®˜æ–¹æ–‡æ¡£</a>ï¼‰ã€‚</p>
<p>åŸå­å‡½æ•°åªèƒ½ç”¨äºè®¾å¤‡å‡½æ•°ã€‚</p>
<h3 id="åŸå­æ€§ç²’åº¦"><a href="#åŸå­æ€§ç²’åº¦" class="headerlink" title="åŸå­æ€§ç²’åº¦"></a>åŸå­æ€§ç²’åº¦</h3><p>ç³»ç»ŸåŸå­æ€§ï¼šåœ¨ä»»æ„ CPU å’Œ GPU çš„ä»»æ„çº¿ç¨‹ä¸Šä¿æŒåŸå­æ€§ã€‚å‡½æ•°åæœ‰åç¼€<code>_system</code>ï¼Œå¦‚<code>atomicAdd_system</code>ã€‚</p>
<p>è®¾å¤‡åŸå­æ€§ï¼šåœ¨å½“å‰ GPU çš„ä»»æ„çº¿ç¨‹ä¸Šä¿æŒåŸå­æ€§ã€‚å‡½æ•°åæ— é™„åŠ åç¼€ã€‚</p>
<p>çº¿ç¨‹å—åŸå­æ€§ï¼šåœ¨å½“å‰ GPU çš„åŒä¸€çº¿ç¨‹å—ä¸­çš„ä»»æ„çº¿ç¨‹ä¸Šä¿æŒåŸå­æ€§ã€‚å‡½æ•°åæœ‰åç¼€<code>_block</code>ï¼Œå¦‚<code>atomicAdd_block</code>ã€‚</p>
<h3 id="åŸå­å‡½æ•°é€ŸæŸ¥"><a href="#åŸå­å‡½æ•°é€ŸæŸ¥" class="headerlink" title="åŸå­å‡½æ•°é€ŸæŸ¥"></a>åŸå­å‡½æ•°é€ŸæŸ¥</h3><p><strong>æ³¨æ„ï¼šæ‰€æœ‰çš„å‡½æ•°éƒ½è¿”å›æ—§å€¼</strong></p>
<p>æ”¯æŒçš„ç±»å‹å¯å‚è€ƒä¹¦ç¬¬ 92 é¡µã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// T in &#123;int, unsigned int, unsigned long long int&#125;</span></span><br><span class="line"><span class="keyword">using</span> UI = <span class="type">unsigned</span> <span class="type">int</span>;</span><br><span class="line"><span class="function">T <span class="title">atomicAdd</span><span class="params">(T *address, T val)</span></span>; <span class="comment">// åŠ æ³•ï¼Œæ”¯æŒæµ®ç‚¹</span></span><br><span class="line"><span class="function">T <span class="title">atomicSub</span><span class="params">(T *address, T val)</span></span>; <span class="comment">// å‡æ³•ï¼Œæ”¯æŒæµ®ç‚¹</span></span><br><span class="line"><span class="function">T <span class="title">atomicExch</span><span class="params">(T *address, T val)</span></span>; <span class="comment">// new = valï¼Œæ”¯æŒfloat</span></span><br><span class="line"><span class="function">T <span class="title">atomicMin</span><span class="params">(T *address, T val)</span></span>; <span class="comment">// æœ€å°å€¼</span></span><br><span class="line"><span class="function">T <span class="title">atomicMax</span><span class="params">(T *address, T val)</span></span>; <span class="comment">// æœ€å¤§å€¼</span></span><br><span class="line"><span class="function">UI <span class="title">atomicInc</span><span class="params">(UI *address, UI val)</span></span>; <span class="comment">// new = (old &gt;= val) ? 0 : (old+1)</span></span><br><span class="line"><span class="function">UI <span class="title">atomicDec</span><span class="params">(UI *address, UI val)</span></span>; <span class="comment">// new = ((old == 0) || (old &gt; val)) ? val : (old-1)</span></span><br><span class="line"><span class="function">T <span class="title">atomicAnd</span><span class="params">(T *address, T val)</span></span>; <span class="comment">// æŒ‰ä½ä¸</span></span><br><span class="line"><span class="function">T <span class="title">atomicOr</span><span class="params">(T *address, T val)</span></span>; <span class="comment">// æŒ‰ä½æˆ–</span></span><br><span class="line"><span class="function">T <span class="title">atomicXor</span><span class="params">(T *address, T val)</span></span>; <span class="comment">// æŒ‰ä½å¼‚æˆ–</span></span><br><span class="line"><span class="function">T <span class="title">atomicCAS</span><span class="params">(T *address, T compare, T val)</span></span>; <span class="comment">// new = old == compare ? val : oldã€‚æ”¯æŒunsigned short int</span></span><br></pre></td></tr></table></figure>

<h2 id="çº¿ç¨‹æŸä¸åä½œç»„"><a href="#çº¿ç¨‹æŸä¸åä½œç»„" class="headerlink" title="çº¿ç¨‹æŸä¸åä½œç»„"></a>çº¿ç¨‹æŸä¸åä½œç»„</h2><h3 id="SIMT"><a href="#SIMT" class="headerlink" title="SIMT"></a>SIMT</h3><p>å•æŒ‡ä»¤-å¤šçº¿ç¨‹ï¼ˆsingle instruction multiple thread, SIMTï¼‰ï¼šä¸åŒçº¿ç¨‹å…±äº«åŒä¸€ä¸ª PCã€‚SIMT çš„é€šç—…æ˜¯åˆ†æ”¯å‘æ•£ï¼ˆbranch divergenceï¼‰ï¼Œæ‰€æœ‰çš„åˆ†æ”¯ä¼šäº§ç”Ÿä¸²è¡Œçš„æ—¶é—´å¼€é”€ã€‚</p>
<p>åœ¨ä¼ç‰¹æ¶æ„ä¹‹å‰ï¼Œä¸€ä¸ªçº¿ç¨‹æŸå…±äº«ä¸€ä¸ª PCã€‚ä¸åŒçº¿ç¨‹æŸä¹‹é—´æ²¡æœ‰åˆ†æ”¯å‘æ•£é—®é¢˜ã€‚</p>
<p>ä»ä¼ç‰¹æ¶æ„å¼€å§‹ï¼Œå¼•å…¥äº†ç‹¬ç«‹çº¿ç¨‹è°ƒåº¦ï¼ˆindependent thread schedulingï¼‰æœºåˆ¶ã€‚æ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„ PCï¼Œä½¿å¾—éœ€è¦ç”¨æˆ·è‡ªå·±æ§åˆ¶çº¿ç¨‹æŸå†…çš„åŒæ­¥ã€‚å¦ä¸€ä¸ªä»£ä»·æ˜¯æ¯ä¸ªçº¿ç¨‹éœ€è¦ç”¨ä¸¤ä¸ªå¯„å­˜å™¨æ¥åš PCã€‚å¦‚æœæ—§ä»£ç å‡ºç°çº¿ç¨‹æŸå†…ä¸å®‰å…¨çš„é—®é¢˜ï¼Œå¯ä»¥æŒ‡å®šè™šæ‹Ÿæ¶æ„ä¸ºä½äºä¼ç‰¹æ¶æ„çš„è®¡ç®—èƒ½åŠ›ã€‚</p>
<h3 id="çº¿ç¨‹æŸå†…çš„çº¿ç¨‹åŒæ­¥"><a href="#çº¿ç¨‹æŸå†…çš„çº¿ç¨‹åŒæ­¥" class="headerlink" title="çº¿ç¨‹æŸå†…çš„çº¿ç¨‹åŒæ­¥"></a>çº¿ç¨‹æŸå†…çš„çº¿ç¨‹åŒæ­¥</h3><p><code>__syncwarp()</code>æ¯”çº¿ç¨‹å—åŒæ­¥å‡½æ•°<code>__syncthreads()</code>æ›´åŠ å»‰ä»·ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‡½æ•°åŸå‹</span></span><br><span class="line"><span class="type">void</span> __syncwarp(<span class="type">unsigned</span> mask = <span class="number">0xffffffff</span>);</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­æ©ç è¡¨ç¤ºå‚ä¸åŒæ­¥çš„çº¿ç¨‹ï¼Œé»˜è®¤ 32 ä¸ªçº¿ç¨‹å…¨éƒ¨å‚ä¸ã€‚</p>
<p>åœ¨åˆ†æ²»æ—¶ï¼Œå½“é—®é¢˜è§„æ¨¡ç¼©å°åˆ°ä¸€ä¸ªçº¿ç¨‹æŸå†…ï¼Œå¯ä»¥ä¸ä½¿ç”¨<code>__syncthreads</code>è€Œç”¨<code>__syncwarp</code>ã€‚</p>
<h3 id="æ›´å¤šçº¿ç¨‹æŸå†…çš„åŸºæœ¬å‡½æ•°"><a href="#æ›´å¤šçº¿ç¨‹æŸå†…çš„åŸºæœ¬å‡½æ•°" class="headerlink" title="æ›´å¤šçº¿ç¨‹æŸå†…çš„åŸºæœ¬å‡½æ•°"></a>æ›´å¤šçº¿ç¨‹æŸå†…çš„åŸºæœ¬å‡½æ•°</h3><p><strong>æ³¨æ„ï¼šè‹¥å½“å‰çº¿ç¨‹ä¸å‚ä¸ï¼Œåˆ™å‡½æ•°çš„è¿”å›å€¼æ˜¯æ— å®šä¹‰çš„ã€‚</strong></p>
<p>çº¿ç¨‹æŸè¡¨å†³å‡½æ•°ï¼ˆwarp vote functionsï¼‰</p>
<p>çº¿ç¨‹æŸåŒ¹é…å‡½æ•°ï¼ˆwarp match functionsï¼‰<em>å¾…ç»­</em></p>
<p>çº¿ç¨‹æŸæ´—ç‰Œå‡½æ•°ï¼ˆwarp shuffle functionsï¼‰</p>
<p>çº¿ç¨‹æŸçŸ©é˜µå‡½æ•°ï¼ˆwarp matrix functionsï¼‰<em>å¾…ç»­</em></p>
<h4 id="çº¿ç¨‹æŸè¡¨å†³"><a href="#çº¿ç¨‹æŸè¡¨å†³" class="headerlink" title="çº¿ç¨‹æŸè¡¨å†³"></a>çº¿ç¨‹æŸè¡¨å†³</h4><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">unsigned</span> __ballot_sync(<span class="type">unsigned</span> mask, <span class="type">int</span> predicate);</span><br><span class="line"><span class="comment">// è‹¥å½“å‰çº¿ç¨‹å‚ä¸ï¼Œåˆ™åŒæ­¥è¡¨å†³ä¸‹ä¸€æ¬¡å‚ä¸æ„æ„¿ï¼ˆå½“ predicate éé›¶ï¼Œåˆ™ä»¤è¿”å›å€¼å¯¹åº”ä½ç½® 1ï¼Œ å¦åˆ™ç½® 0ã€‚ï¼‰ã€‚ç›¸å½“äºä»æ—§æ©ç è¡¨å†³å‡ºä¸€ä¸ªæ–°æ©ç ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> __all_sync(<span class="type">unsigned</span> mask, <span class="type">int</span> predicate);</span><br><span class="line"><span class="comment">// è‹¥å½“å‰çº¿ç¨‹å‚ä¸ï¼Œåˆ™åŒæ­¥æŠ•ç¥¨ï¼Œä¸€ç¥¨å¦å†³ï¼Œè¿”å›æŠ•ç¥¨æ˜¯å¦é€šè¿‡ã€‚æ‰€æœ‰å‚ä¸çº¿ç¨‹éƒ½åŒæ„æ‰é€šè¿‡ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> __any_sync(<span class="type">unsigned</span> mask, <span class="type">int</span> predicate);</span><br><span class="line"><span class="comment">// è‹¥å½“å‰çº¿ç¨‹å‚ä¸ï¼Œåˆ™åŒæ­¥æŠ•ç¥¨ï¼Œä¸€ç¥¨é€šè¿‡ï¼Œè¿”å›æŠ•ç¥¨æ˜¯å¦é€šè¿‡ã€‚</span></span><br></pre></td></tr></table></figure>

<h4 id="çº¿ç¨‹æŸæ´—ç‰Œ"><a href="#çº¿ç¨‹æŸæ´—ç‰Œ" class="headerlink" title="çº¿ç¨‹æŸæ´—ç‰Œ"></a>çº¿ç¨‹æŸæ´—ç‰Œ</h4><p>å®šä¹‰â€œæŸå†…æŒ‡æ ‡â€ <code>int lane_id = threadIdx.x % w</code>ã€‚</p>
<p><code>w</code> æ˜¯é€»è¾‘çº¿ç¨‹æŸå¤§å°ï¼Œåªèƒ½å– 2ã€4ã€8ã€16ã€32 ä¸­çš„ä¸€ä¸ªã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">T __shfl_sync(<span class="type">unsigned</span> mask, T v, <span class="type">int</span> srcLane, <span class="type">int</span> w=warpSize);</span><br><span class="line"><span class="comment">// å‚ä¸çº¿ç¨‹è¿”å›æ ‡å·ä¸º srcLane çš„å˜é‡ v çš„å€¼ã€‚è¿™æ˜¯ä¸€ç§å¹¿æ’­å¼æ•°æ®äº¤æ¢ã€‚ </span></span><br><span class="line"></span><br><span class="line">T __shfl_up_sync(<span class="type">unsigned</span> mask, T v, <span class="type">unsigned</span> d, <span class="type">int</span> w=warpSize);</span><br><span class="line"><span class="comment">// æ ‡å·ä¸º t çš„å‚ä¸çº¿ç¨‹è¿”å›æ ‡å·ä¸º t - d çš„çº¿ç¨‹ä¸­çš„ v çš„å€¼ï¼›è‹¥ t - d &lt; 0 åˆ™è¿”å›åŸæ¥çš„ vã€‚ç›¸å½“äºæ•°æ®å‘ä¸Šå¹³ç§»ã€‚</span></span><br><span class="line"></span><br><span class="line">T __shfl_down_sync(<span class="type">unsigned</span> mask, T v, <span class="type">unsigned</span> d, <span class="type">int</span> w=warpSize);</span><br><span class="line"><span class="comment">// æ ‡å·ä¸º t çš„å‚ä¸çº¿ç¨‹è¿”å›æ ‡å·ä¸º t + d çš„çº¿ç¨‹ä¸­çš„ v çš„å€¼ï¼›è‹¥ t + d &gt;= w åˆ™è¿”å›åŸæ¥çš„ vã€‚ç›¸å½“äºæ•°æ®å‘ä¸‹å¹³ç§»ã€‚</span></span><br><span class="line"></span><br><span class="line">T __shfl_xor_sync(<span class="type">unsigned</span> mask, T v, <span class="type">int</span> laneMask, <span class="type">int</span> w=warpSize);</span><br><span class="line"><span class="comment">// æ ‡å·ä¸º t çš„å‚ä¸çº¿ç¨‹è¿”å›æ ‡å·ä¸º t ^ laneMask çš„çº¿ç¨‹ä¸­çš„ v çš„å€¼ï¼›ç›¸å½“äºå¯¹åº”çš„ä¸¤ä¸ªçº¿ç¨‹äº¤æ¢æ•°æ®ã€‚</span></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨çº¿ç¨‹æŸæ´—ç‰Œä¼˜åŒ–æ•°ç»„å½’çº¦ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">constexpr</span> <span class="type">unsigned</span> <span class="type">int</span> FULL_MASK = <span class="number">0xffffffff</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> __global__ <span class="title">reduce_shfl</span><span class="params">(<span class="type">const</span> real *d_x, real *d_y, <span class="type">const</span> <span class="type">int</span> N)</span> </span>&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> tid = threadIdx.x;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> bid = blockIdx.x;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> n = bid * blockDim.x + tid;</span><br><span class="line">    <span class="keyword">extern</span> __shared__ real s_y[];</span><br><span class="line">    s_y[tid] = (n &lt; N ? d_x[n] : <span class="number">0.0</span>);</span><br><span class="line">    __syncthreads();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> offset = blockDim.x &gt;&gt; <span class="number">1</span>; offset &gt;= <span class="number">32</span>; offset &gt;&gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tid &lt; offset) &#123;</span><br><span class="line">            s_y[tid] += s_y[tid + offset];</span><br><span class="line">        &#125;</span><br><span class="line">        __syncthreads();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    real y = s_y[tid]; <span class="comment">// å¯„å­˜å™¨ä¼˜åŒ–</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> offset = <span class="number">16</span>; offset &gt; <span class="number">0</span>; offset &gt;&gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        y +=  __shfl_down_sync(FULL_MASK, y, offset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (tid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">atomicAdd</span>(d_y, y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="åä½œç»„"><a href="#åä½œç»„" class="headerlink" title="åä½œç»„"></a>åä½œç»„</h3><p>åä½œç»„ï¼ˆcooperative groupsï¼‰å¯ä»¥çœ‹ä½œçº¿ç¨‹å—å’Œçº¿ç¨‹æŸåŒæ­¥æœºåˆ¶çš„æ¨å¹¿ã€‚èŒƒå›´æ¶µç›–çº¿ç¨‹å—å†…éƒ¨ï¼Œçº¿ç¨‹å—ä¹‹é—´ï¼ˆç½‘æ ¼çº§ï¼‰åŠè®¾å¤‡ä¹‹é—´çš„åŒæ­¥ä¸åä½œã€‚</p>
<p>å¼•å…¥å¤´æ–‡ä»¶å’Œå‘½åç©ºé—´</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cooperative_groups.h&gt;</span></span></span><br><span class="line"><span class="keyword">namespace</span> cg = cooperative_groups; <span class="comment">// ä»…ä¾›å‚è€ƒ</span></span><br></pre></td></tr></table></figure>

<h4 id="çº¿ç¨‹å—çº§åˆ«çš„åä½œç»„"><a href="#çº¿ç¨‹å—çº§åˆ«çš„åä½œç»„" class="headerlink" title="çº¿ç¨‹å—çº§åˆ«çš„åä½œç»„"></a>çº¿ç¨‹å—çº§åˆ«çš„åä½œç»„</h4><p>åŸºæœ¬ç±»å‹<code>thread_group</code>ã€‚æœ‰å¦‚ä¸‹æˆå‘˜ï¼š</p>
<ol>
<li><code>void sync()</code> åŒæ­¥ç»„å†…æ‰€æœ‰çº¿ç¨‹</li>
<li><code>unsigned size()</code> è¿”å›ç»„å†…æ€»çš„çº¿ç¨‹æ•°ç›®</li>
<li><code>unsigned thread_rank()</code> è¿”å›å½“å‰çº¿ç¨‹çš„ç»„å†…æ ‡å·</li>
<li><code>bool is_valid()</code> æ£€æŸ¥å®šä¹‰çš„ç»„æ˜¯å¦è¿å CUDA çš„ä»»ä½•é™åˆ¶</li>
</ol>
<p>å¯¼å‡ºç±»å‹<code>thread_block</code>ï¼Œé¢å¤–å‡½æ•°ï¼š</p>
<ol>
<li><code>dim3 group_index()</code> è¿”å›å½“å‰çº¿ç¨‹çš„çº¿ç¨‹å—æŒ‡æ ‡ï¼Œç›¸å½“äº blockIdx</li>
<li><code>dim3 thread_index()</code> ç›¸å½“äº threadIdx</li>
</ol>
<p>äºæ˜¯å¯ä»¥æŠ½è±¡å‡ºå½“å‰çº¿ç¨‹å—ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">thread_block g = <span class="built_in">this_thread_block</span>();</span><br><span class="line">g.<span class="built_in">sync</span>(); <span class="comment">// ç­‰ä»·äº __syncthreads()</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å°† <code>thread_block</code> è¿›è¡Œå¤šæ¬¡åˆ†å‰²ï¼ˆä½†ä¸€ç»„çº¿ç¨‹çš„æ•°é‡åªèƒ½æ˜¯ 2 çš„å¹‚æ¬¡ï¼‰ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">thread_group g32 = <span class="built_in">tiled_partition</span>(<span class="built_in">this_thread_block</span>(), <span class="number">32</span>); <span class="comment">// ç›¸å½“äºçº¿ç¨‹æŸ</span></span><br><span class="line">thread_group g4 = <span class="built_in">tiled_partition</span>(g32, <span class="number">4</span>); <span class="comment">// å†æ¬¡åˆ†å‰²</span></span><br><span class="line"><span class="comment">// ---------- æ¨¡æ¿åŒ–ç‰ˆæœ¬ ----------</span></span><br><span class="line">thread_block_tile&lt;<span class="number">32</span>&gt; g32 = <span class="built_in">tiled_partition</span>&lt;<span class="number">32</span>&gt;(<span class="built_in">this_thread_block</span>());</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„â€œçº¿ç¨‹å—ç‰‡â€å¯ä»¥æ¨¡ä»¿çº¿ç¨‹æŸçš„ä¸€äº›è¡Œä¸ºï¼Œæ¯”å¦‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">unsigned</span> __ballot_sync(<span class="type">int</span> predicate);</span><br><span class="line"><span class="type">int</span> __all_sync(<span class="type">int</span> predicate);</span><br><span class="line"><span class="type">int</span> __any_sync(<span class="type">int</span> predicate);</span><br><span class="line">T __shfl_sync(T v, <span class="type">int</span> srcLane);</span><br><span class="line">T __shfl_up_sync(T v, <span class="type">unsigned</span> d);</span><br><span class="line">T __shfl_down_sync(T v, <span class="type">unsigned</span> d);</span><br><span class="line">T __shfl_xor_sync(T v, <span class="type">int</span> laneMask);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›¸å¯¹çº¿ç¨‹æŸçš„ä¸åŒç‚¹ï¼š1. ä¸å…è®¸æ©ç ï¼Œæ‰€æœ‰çº¿ç¨‹å¿…é¡»å‚ä¸ 2. æ´—ç‰Œå‡½æ•°ä¸å†éœ€è¦å®½åº¦å‚æ•°ï¼Œå®½åº¦ç”±çº¿ç¨‹å—ç‰‡å¤§å°ç¡®å®š</span></span><br></pre></td></tr></table></figure>

<h3 id="å†æ¬¡ä¼˜åŒ–æ•°ç»„å½’çº¦"><a href="#å†æ¬¡ä¼˜åŒ–æ•°ç»„å½’çº¦" class="headerlink" title="å†æ¬¡ä¼˜åŒ–æ•°ç»„å½’çº¦"></a>å†æ¬¡ä¼˜åŒ–æ•°ç»„å½’çº¦</h3><p>è¿™æ¬¡æˆ‘ä»¬é‡‡ç”¨çš„æŠ€å·§æœ‰ï¼š</p>
<ol>
<li>ä½¿ç”¨é™æ€å…¨å±€å†…å­˜</li>
<li>è°ƒç”¨ä¸¤æ¬¡æ ¸å‡½æ•°ï¼Œèˆå¼ƒåŸå­åŠ æ³•å‡½æ•°ï¼ˆè¿™ä¼šæé«˜ç²¾ç¡®åº¦ï¼‰</li>
<li>æé«˜çº¿ç¨‹åˆ©ç”¨ç‡ï¼ˆåœ¨è§„çº¦ä¹‹å‰è¿›è¡Œå°éƒ¨åˆ†æ±‚å’Œï¼‰</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;real.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;widgets.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">unsigned</span> <span class="type">int</span> FULL_MASK = <span class="number">0xffffffff</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> __global__ <span class="title">reduce_cp</span><span class="params">(<span class="type">const</span> real *d_x, real *d_y, <span class="type">const</span> <span class="type">int</span> N)</span> </span>&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> tid = threadIdx.x;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> bid = blockIdx.x;</span><br><span class="line">    <span class="keyword">extern</span> __shared__ real s_y[];</span><br><span class="line"></span><br><span class="line">    real y = <span class="number">0.0</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> stride = blockDim.x * gridDim.x; <span class="comment">// ä»¥ç½‘æ ¼å¤§å°ä¸ºè·¨åº¦</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> n = bid * blockDim.x + tid; n &lt; N; n += stride) &#123;</span><br><span class="line">        y += d_x[n]; <span class="comment">// ç¡®ä¿ä¸€ä¸ªç½‘æ ¼èƒ½è¦†ç›–æ‰€æœ‰æ•°æ®</span></span><br><span class="line">    &#125;</span><br><span class="line">    s_y[tid] = y;</span><br><span class="line">    __syncthreads();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çº¿ç¨‹å—å†…ï¼Œè·¨çº¿ç¨‹æŸæŠ˜åŠå½’çº¦</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> offset = blockDim.x &gt;&gt; <span class="number">1</span>; offset &gt;= <span class="number">32</span>; offset &gt;&gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tid &lt; offset) &#123;</span><br><span class="line">            s_y[tid] += s_y[tid + offset];</span><br><span class="line">        &#125;</span><br><span class="line">        __syncthreads();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    y = s_y[tid];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> offset = <span class="number">16</span>; offset &gt; <span class="number">0</span>; offset &gt;&gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        y += __shfl_down_sync(FULL_MASK, y, offset);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (tid == <span class="number">0</span>) &#123;</span><br><span class="line">        d_y[bid] = y; <span class="comment">// è¿”å›çº¿ç¨‹å—ç»“æœ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> N = <span class="number">1e8</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> GRID_SIZE = <span class="number">10240</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> BLOCK_SIZE = <span class="number">128</span>;</span><br><span class="line">__device__ real d_input[N];</span><br><span class="line">__device__ real d_output[GRID_SIZE];</span><br><span class="line"></span><br><span class="line"><span class="function">real <span class="title">reduce</span><span class="params">(<span class="type">const</span> real *d_x)</span> </span>&#123;</span><br><span class="line">    real *d_y;</span><br><span class="line">    <span class="built_in">CHECK</span>(<span class="built_in">cudaGetSymbolAddress</span>((<span class="type">void</span>**)&amp;d_y, d_output));</span><br><span class="line">    <span class="keyword">constexpr</span> <span class="type">int</span> shared_size = <span class="built_in">sizeof</span>(real) * BLOCK_SIZE;</span><br><span class="line">    reduce_cp&lt;&lt;&lt;GRID_SIZE, BLOCK_SIZE, shared_size&gt;&gt;&gt;(d_x, d_y, N);</span><br><span class="line">    reduce_cp&lt;&lt;&lt;<span class="number">1</span>, <span class="number">1024</span>, <span class="built_in">sizeof</span>(real) * <span class="number">1024</span>&gt;&gt;&gt;(d_y, d_y, GRID_SIZE);</span><br><span class="line"></span><br><span class="line">    real h_y[<span class="number">1</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="built_in">CHECK</span>(<span class="built_in">cudaMemcpy</span>(h_y, d_y, <span class="built_in">sizeof</span>(real), cudaMemcpyDeviceToHost));</span><br><span class="line">    <span class="comment">// CHECK(cudaMemcpyFromSymbol(h_y, d_output, sizeof(real)));</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> h_y[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line">    <span class="type">static</span> real input[N];</span><br><span class="line">    std::<span class="built_in">fill_n</span>(input, N, <span class="number">1.23f</span>);</span><br><span class="line">    <span class="built_in">CHECK</span>(<span class="built_in">cudaMemcpyToSymbol</span>(d_input, input, N * <span class="built_in">sizeof</span>(real)));</span><br><span class="line">    real *d_x;</span><br><span class="line">    <span class="built_in">CHECK</span>(<span class="built_in">cudaGetSymbolAddress</span>((<span class="type">void</span>**)&amp;d_x, d_input));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%f\n&quot;</span>, <span class="built_in">reduce</span>(d_x));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿è¡Œç»“æœï¼š</span></span><br><span class="line"><span class="comment">// 123000064.000000</span></span><br><span class="line"><span class="comment">// å¯¹æ¯” CPU è£¸å½’çº¦æ–¹æ³•çš„åŠ é€Ÿæ¯”ï¼š67</span></span><br></pre></td></tr></table></figure>

<h2 id="CUDA-æµ"><a href="#CUDA-æµ" class="headerlink" title="CUDA æµ"></a>CUDA æµ</h2><h3 id="æ ¸å‡½æ•°å¤–éƒ¨çš„å¹¶è¡Œ"><a href="#æ ¸å‡½æ•°å¤–éƒ¨çš„å¹¶è¡Œ" class="headerlink" title="æ ¸å‡½æ•°å¤–éƒ¨çš„å¹¶è¡Œ"></a>æ ¸å‡½æ•°å¤–éƒ¨çš„å¹¶è¡Œ</h3><p>ä¸»è¦æœ‰ä»¥ä¸‹æƒ…å½¢ï¼š</p>
<ol>
<li>æ ¸å‡½æ•°è®¡ç®—ä¸æ•°æ®ä¼ è¾“ä¹‹é—´çš„å¹¶è¡Œ</li>
<li>ä¸»æœºè®¡ç®—ä¸æ•°æ®ä¼ è¾“ä¹‹é—´çš„å¹¶è¡Œ</li>
<li>ä¸åŒçš„æ•°æ®ä¼ è¾“ä¹‹é—´çš„å¹¶è¡Œ</li>
<li>æ ¸å‡½æ•°è®¡ç®—ä¸ä¸»æœºè®¡ç®—ä¹‹é—´çš„å¹¶è¡Œ</li>
<li>ä¸åŒæ ¸å‡½æ•°ä¹‹é—´çš„å¹¶è¡Œ</li>
</ol>
<p>è‹¥ä¸¤ä¸ªä»»åŠ¡çš„è¿è¡Œæ—¶é—´ç›¸è¿‘ï¼Œåˆ™å°½é‡ä»¤ä»–ä»¬å¹¶è¡Œã€‚åä¹‹ï¼Œåˆ™å¹¶è¡Œå’Œä¸²è¡Œçš„æ€§èƒ½å·®è·ä¸å¤§ã€‚</p>
<p>ä½¿ç”¨ CUDA æµçš„ä¸»è¦ç›®çš„æ˜¯å°½é‡å–å¾—æ ¸å‡½æ•°å¤–éƒ¨çš„å¹¶è¡Œèƒ½åŠ›ã€‚</p>
<h3 id="ä½¿ç”¨-CUDA-æµ"><a href="#ä½¿ç”¨-CUDA-æµ" class="headerlink" title="ä½¿ç”¨ CUDA æµ"></a>ä½¿ç”¨ CUDA æµ</h3><p>CUDA æµçš„ä½¿ç”¨ç›¸å¯¹ç®€å•ï¼Œåªè¦è®°ä½ä¸€äº›è§„åˆ™å°±å¥½ã€‚</p>
<ol>
<li><p>CUDA ç¨‹åºæœ‰ä¸€ä¸ªé»˜è®¤æµã€‚è‹¥ API ä¸éœ€è¦æŒ‡å®šæµå¥æŸ„ï¼Œå¯æ¨æµ‹å®ƒç”¨äºé»˜è®¤æµã€‚</p>
</li>
<li><p>åˆ›å»ºã€é”€æ¯ CUDA æµ</p>
 <figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">cudaStream_t stream[<span class="number">5</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> &amp;s : stream) &#123;</span><br><span class="line">    <span class="built_in">cudaStreamCreate</span>(&amp;s); <span class="comment">// åˆ›å»ºæµï¼Œè·å¾—å¥æŸ„</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> &amp;s : stream) &#123;</span><br><span class="line">    <span class="built_in">cudaStreamDestroy</span>(s); <span class="comment">// é”€æ¯æµï¼Œå¥æŸ„ä¸æŠ¹é™¤</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ£€æµ‹ CUDA æµæ˜¯å¦ç©ºé—² </p>
 <figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">cudaError_t <span class="title">cudaStreamSynchronize</span><span class="params">(cudaStream_t stream)</span></span>; <span class="comment">// é˜»å¡ä¸»æœºï¼Œç›´åˆ° CUDA æµå®Œæˆæ‰€æœ‰æ“ä½œ</span></span><br><span class="line"><span class="function">cudaError_t <span class="title">cudaStreamQuery</span><span class="params">(cudaStream_t stream)</span></span>; <span class="comment">// è¿”å› cudaSuccessï¼ˆå·²å®Œæˆï¼‰/ cudaErrorNotReadyï¼ˆæœªå®Œæˆï¼‰</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>cudaMemcpy</code> ä¼šé˜»å¡ä¸»æœºã€‚ä½†æ˜¯æ ¸å‡½æ•°çš„è°ƒç”¨æ€»æ˜¯å¼‚æ­¥çš„ã€‚åº”è¯¥å°½é‡æ—©åœ°è°ƒç”¨æ ¸å‡½æ•°ï¼Œéšåå†è¿›è¡Œä¸»æœºçš„è®¡ç®—ä»»åŠ¡ã€‚</p>
</li>
<li><p>åœ¨æ ¸å‡½æ•°é…ç½®ä¸­æŒ‡æ´¾ CUDA æµï¼š</p>
 <figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">my_kernel&lt;&lt;&lt;N_grid, N_block, N_shared, stream_id&gt;&gt;&gt;(...); <span class="comment">// å››ä¸ªæ¨¡æ¿å‚æ•°å¿…é¡»é½å…¨</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å¼‚æ­¥çš„æ•°æ®ä¼ è¾“éœ€è¦ï¼š</p>
<ol>
<li>ä½¿ç”¨ <code>cudaMemcpyAsync</code> å‡½æ•°ã€‚</li>
<li>æ¶‰åŠçš„ä¸»æœºå†…å­˜å¿…é¡»æ˜¯ä¸å¯åˆ†é¡µçš„ï¼Œå¦åˆ™ API å°†ä¼šé€€åŒ–ä¸ºåŒæ­¥ç‰ˆæœ¬ã€‚</li>
</ol>
<p> å¼‚æ­¥ä¼ è¾“çš„è¿‡ç¨‹å°†ç”± GPU çš„ DMAï¼ˆdirect memory accessï¼‰æ¥ç®¡ã€‚</p>
</li>
<li><p>å¯ä»¥ç”¨ CUDA è¿è¡Œæ—¶ API æ¥ç”³è¯·ä¸å¯åˆ†é¡µçš„å†…å­˜ï¼ˆnon-pageable memoryï¼‰ï¼Œåˆç§°å›ºå®šå†…å­˜ï¼ˆpinned memoryï¼‰ã€‚ä¸å¯åˆ†é¡µæ„å‘³ç€æ“ä½œç³»ç»Ÿæ— æƒä¿®æ”¹è™šæ‹Ÿåœ°å€æ‰€å¯¹åº”çš„ç‰©ç†åœ°å€ã€‚</p>
 <figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">cudaError_t <span class="title">cudaMallocHost</span><span class="params">(<span class="type">void</span> **ptr, <span class="type">size_t</span> size)</span></span>;</span><br><span class="line"><span class="function">cudaError_t <span class="title">cudaHostAlloc</span><span class="params">(<span class="type">void</span> **ptr, <span class="type">size_t</span> size, <span class="type">size_t</span> flags)</span></span>;</span><br><span class="line"><span class="function">cudaError_t <span class="title">cudaFreeHost</span><span class="params">(<span class="type">void</span> *ptr)</span></span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è‰¯å¥½çš„ CUDA æµæŒ‡æ´¾ä¼šä»æµæ°´çº¿é‡å ä¸­è·å¾—å¹¶è¡ŒåŠ é€Ÿã€‚ä½†æ˜¯ CUDA æµæ˜¯æœ‰å¯åŠ¨å¼€é”€ï¼Œä¸”ç¡¬ä»¶ç¯å¢ƒæœ‰é™ï¼Œè¿‡å¤šçš„ CUDA æµä¼šæ‹‰ä½æ€§èƒ½ã€‚</p>
</li>
</ol>
<h2 id="æŒ‡ä»¤é€ŸæŸ¥"><a href="#æŒ‡ä»¤é€ŸæŸ¥" class="headerlink" title="æŒ‡ä»¤é€ŸæŸ¥"></a>æŒ‡ä»¤é€ŸæŸ¥</h2><h3 id="ç¼–è¯‘å™¨é€‰é¡¹"><a href="#ç¼–è¯‘å™¨é€‰é¡¹" class="headerlink" title="ç¼–è¯‘å™¨é€‰é¡¹"></a>ç¼–è¯‘å™¨é€‰é¡¹</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">--ptxas-options=-v <span class="comment"># æŠ¥é“æ¯ä¸ªæ ¸å‡½æ•°çš„å¯„å­˜å™¨ä½¿ç”¨æ•°é‡</span></span><br><span class="line">--maxrregcount= <span class="comment"># é™åˆ¶æ‰€æœ‰æ ¸å‡½æ•°çš„å¯„å­˜å™¨ä½¿ç”¨é‡</span></span><br></pre></td></tr></table></figure>

<h3 id="ä¿®é¥°ç¬¦"><a href="#ä¿®é¥°ç¬¦" class="headerlink" title="ä¿®é¥°ç¬¦"></a>ä¿®é¥°ç¬¦</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">__global__ <span class="comment"># æ ¸å‡½æ•°ä¿®é¥°ç¬¦</span></span><br><span class="line">__device__ <span class="comment"># è®¾å¤‡å‡½æ•°ã€å˜é‡ä¿®é¥°ç¬¦</span></span><br><span class="line">__host__ <span class="comment"># ä¸»æœºå‡½æ•°ä¿®é¥°ç¬¦ï¼Œä¸€èˆ¬åªä¸__device__åŒæ—¶å‡ºç°</span></span><br><span class="line">__noinline__ <span class="comment"># å»ºè®®å‡½æ•°éå†…è”</span></span><br><span class="line">__forceinline__ <span class="comment"># å»ºè®®å‡½æ•°å†…è”</span></span><br><span class="line">__launch_bounds__() <span class="comment"># ä¿®é¥°æ ¸å‡½æ•°ï¼Œé™åˆ¶å¯„å­˜å™¨ä½¿ç”¨é‡</span></span><br><span class="line">__shared__ <span class="comment"># ä¿®é¥°å…¨å±€å˜é‡ï¼Œä½¿å®ƒæˆä¸ºå…±äº«å†…å­˜</span></span><br><span class="line">__managed__ <span class="comment"># ä¿®é¥°å…¨å±€å˜é‡ï¼Œä½¿å®ƒæˆä¸ºç»Ÿä¸€å†…å­˜ï¼Œå¿…é¡»ä¸__device__åŒæ—¶å‡ºç°</span></span><br></pre></td></tr></table></figure>

<h2 id="å¸¸ç”¨ä»£ç "><a href="#å¸¸ç”¨ä»£ç " class="headerlink" title="å¸¸ç”¨ä»£ç "></a>å¸¸ç”¨ä»£ç </h2><h3 id="CMakeæ¨¡æ¿"><a href="#CMakeæ¨¡æ¿" class="headerlink" title="CMakeæ¨¡æ¿"></a>CMakeæ¨¡æ¿</h3><figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 2021/08/02</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.20</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>(hello LANGUAGES CUDA VERSION <span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span>(USE_DOUBLE <span class="string">&quot;Use real as double, otherwise float&quot;</span> <span class="keyword">OFF</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">find_package</span>(CUDAToolkit REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="comment"># set(CMAKE_CUDA_COMPILER_ID NVIDIA)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># set(ENV&#123;PATH&#125; &quot;C:/Program\ Files\ (x86)/Microsoft\ Visual\ Studio/2019/Community/VC/Tools/MSVC/14.29.30037/bin/Hostx64/x64:$ENV&#123;PATH&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># report registers used in each core function</span></span><br><span class="line"><span class="keyword">add_compile_options</span>(--ptxas-options=-v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include_directories</span>(./<span class="keyword">include</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(hello main.cu)</span><br><span class="line"></span><br><span class="line"><span class="comment"># compute capability, see https://developer.nvidia.com/zh-cn/cuda-gpus#compute</span></span><br><span class="line"><span class="keyword">set_property</span>(<span class="keyword">TARGET</span> hello PROPERTY CUDA_ARCHITECTURES <span class="number">86</span>)</span><br><span class="line"><span class="comment"># set_property(TARGET hello PROPERTY CUDA_ARCHITECTURES 75)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># install(TARGETS hello DESTINATION .)</span></span><br></pre></td></tr></table></figure>

<h3 id="æŠ¥é”™ã€è®¡æ—¶å·¥å…·"><a href="#æŠ¥é”™ã€è®¡æ—¶å·¥å…·" class="headerlink" title="æŠ¥é”™ã€è®¡æ—¶å·¥å…·"></a>æŠ¥é”™ã€è®¡æ—¶å·¥å…·</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// widgets.hpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CHECK(callee)                                            \</span></span><br><span class="line"><span class="meta">    do &#123;                                                         \</span></span><br><span class="line"><span class="meta">        const cudaError_t err = callee;                          \</span></span><br><span class="line"><span class="meta">        <span class="keyword">if</span> (err == cudaSuccess) break;                           \</span></span><br><span class="line"><span class="meta">        printf(<span class="string">&quot;CUDA error at %s(%d)\n&quot;</span>, __FILE__, __LINE__);    \</span></span><br><span class="line"><span class="meta">        printf(<span class="string">&quot;    Function:   %s\n&quot;</span>, __FUNCTION__);            \</span></span><br><span class="line"><span class="meta">        printf(<span class="string">&quot;    Error code: %d\n&quot;</span>, err);                     \</span></span><br><span class="line"><span class="meta">        printf(<span class="string">&quot;    Error hint: %s\n&quot;</span>, cudaGetErrorString(err)); \</span></span><br><span class="line"><span class="meta">        exit(1);                                                 \</span></span><br><span class="line"><span class="meta">    &#125; while (0)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> F&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cudaTiming</span><span class="params">(<span class="type">const</span> F &amp;func)</span> </span>&#123;</span><br><span class="line">    cudaEvent_t start, stop;</span><br><span class="line">    <span class="built_in">CHECK</span>(<span class="built_in">cudaEventCreate</span>(&amp;start));</span><br><span class="line">    <span class="built_in">CHECK</span>(<span class="built_in">cudaEventCreate</span>(&amp;stop));</span><br><span class="line">    <span class="built_in">CHECK</span>(<span class="built_in">cudaEventRecord</span>(start));</span><br><span class="line">    <span class="built_in">cudaEventQuery</span>(start);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">func</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">CHECK</span>(<span class="built_in">cudaEventRecord</span>(stop));</span><br><span class="line">    <span class="built_in">CHECK</span>(<span class="built_in">cudaEventSynchronize</span>(stop));</span><br><span class="line">    <span class="type">float</span> elapsed_time;</span><br><span class="line">    <span class="built_in">CHECK</span>(<span class="built_in">cudaEventElapsedTime</span>(&amp;elapsed_time, start, stop));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;CUDA Time = %g ms.\n&quot;</span>, elapsed_time);</span><br><span class="line">    <span class="built_in">CHECK</span>(<span class="built_in">cudaEventDestroy</span>(start));</span><br><span class="line">    <span class="built_in">CHECK</span>(<span class="built_in">cudaEventDestroy</span>(stop));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> F&gt;</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">hostTiming</span><span class="params">(<span class="type">const</span> F &amp;func)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> start = std::chrono::steady_clock::<span class="built_in">now</span>();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">func</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> end = std::chrono::steady_clock::<span class="built_in">now</span>();</span><br><span class="line">    std::chrono::duration&lt;<span class="type">double</span>, std::milli&gt; duration = end - start;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Host Time = %g ms.\n&quot;</span>, duration.<span class="built_in">count</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç²¾åº¦æ§åˆ¶æ¨¡æ¿"><a href="#ç²¾åº¦æ§åˆ¶æ¨¡æ¿" class="headerlink" title="ç²¾åº¦æ§åˆ¶æ¨¡æ¿"></a>ç²¾åº¦æ§åˆ¶æ¨¡æ¿</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// real.hpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> USE_DOUBLE</span></span><br><span class="line"><span class="keyword">using</span> real = <span class="type">double</span>;</span><br><span class="line"><span class="keyword">constexpr</span> real EPS = <span class="number">1e-15</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="keyword">using</span> real = <span class="type">float</span>;</span><br><span class="line"><span class="keyword">constexpr</span> real EPS = <span class="number">1e-6</span>f;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>GPGPU</tag>
      </tags>
  </entry>
  <entry>
    <title>Javaè¯­æ³•ç¬”è®°</title>
    <url>/2019/10/11/java/</url>
    <content><![CDATA[<p>Since 2018&#x2F;07&#x2F;12</p>
<span id="more"></span>

<h2 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h2><ul>
<li>ä¸C++ä¸åŒ,Javaåœ¨æ–°å»ºå˜é‡æ—¶,ä¸å…è®¸å…¶åç§°ä¸å…¶ä¸Šä¸€çº§ä½œç”¨åŸŸçš„å˜é‡åç›¸åŒ.</li>
<li>è‹¥æŸä¸€æ—¶åˆ»æŸä¸€ä½œç”¨åŸŸä¸­,æŸä¸ªåå­—çš„å˜é‡è¢«é”€æ¯,åˆ™è¯¥åå­—å¯ä»¥å†æ¬¡ä½¿ç”¨.</li>
</ul>
<h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><ul>
<li>æ•´æ•°é»˜è®¤ä¸ºint, å°æ•°é»˜è®¤ä¸ºdouble(8å­—èŠ‚), å­—é¢å€¼ä¸èƒ½å¤§äºç±»å‹æœ€å¤§å€¼.</li>
<li>æ•°å­—å¯ä»¥åŠ åç¼€æŒ‡å®šç±»å‹, longä¸º<code>L</code>, doubleä¸º<code>d</code>, floatä¸º<code>f</code>.</li>
<li>ç¼©çª„è½¬æ¢ä¼šæŠ¥é”™,é™¤éå¼ºåˆ¶ç±»å‹è½¬æ¢(å‰ç½®æ‹¬å·). ç±»å‹æå‡ä¸ä¼šæŠ¥é”™(å¦‚int-&gt;double)</li>
<li>shortæ˜¯16ä½æœ‰ç¬¦å·ç±»å‹, charæ˜¯16ä½<strong>æ— ç¬¦å·</strong>ç±»å‹.</li>
<li>éåŸºç¡€çš„æ•°æ®ç±»å‹åªæœ‰å¼•ç”¨æ•°æ®ç±»å‹,åƒé˜‰å‰²çš„æŒ‡é’ˆ,ä½¿ç”¨ç‚¹å·æ—¶è‡ªåŠ¨è§£å¼•ç”¨.</li>
</ul>
<h2 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h2><ul>
<li><code>int[] array = new int[n];       //    array.length ä¸ºæ•°ç»„é•¿åº¦, è¶Šç•Œä¼šæŠ¥é”™</code></li>
<li><code>int[] array = new int[] &#123;2, 0, 4, 1&#125;;  //arrayé•¿åº¦ä¸º4, ä»…åˆ†é…å†…å­˜å¯åˆå§‹åŒ–</code></li>
<li><code>T[][] array = &#123; &#123;new T(), new T()&#125;,  &#123;new T()&#125; &#125;  //ä½ç»´é•¿åº¦ä¸å®š</code></li>
<li><code>int[][] array = new int[n1][];   array[1] = new int[n2]; //ä½ç»´é•¿åº¦ä¸å®š</code></li>
<li>å‡¡æ˜¯newç”Ÿæˆçš„ä¸œè¥¿éƒ½åœ¨å †å†…å­˜ä¸­, åªæœ‰arrayä½œä¸ºä¸€ä¸ªå¼•ç”¨å­˜åœ¨äºæ ˆå†…å­˜ä¸­</li>
<li>ä¸C++ä¸åŒ, å·²æœ‰æ•°ç»„å(å¼•ç”¨)å¯ä»¥èµ‹å€¼ç»™å¦ä¸€ä¸ªå·²æœ‰æ•°ç»„å(å¼•ç”¨), å…è®¸å˜åŠ¨.</li>
</ul>
<h2 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span>(value) &#123;  <span class="comment">//valueèŒƒå›´åœ¨intå†…,ä¸”ä¸ä¸ºboolean</span></span><br><span class="line"><span class="keyword">case</span> value1:</span><br><span class="line">    <span class="keyword">do</span> sth;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">default</span>:        <span class="comment">//defaultå¯ä»¥æ”¾åœ¨å‰é¢,ç¨‹åºä¿è¯å…¥å£æŒ‘é€‰æ­£ç¡®ä¸”å”¯ä¸€.</span></span><br><span class="line">    <span class="keyword">do</span> sth;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<h2 id="æ„é€ ä»£ç å—"><a href="#æ„é€ ä»£ç å—" class="headerlink" title="æ„é€ ä»£ç å—"></a>æ„é€ ä»£ç å—</h2><ul>
<li>ç±»ä¸­ç”¨<code>&#123;&#125;</code>åŒ…è£¹çš„ä»£ç å—ï¼Œå°†åœ¨æ¯æ¬¡æ„é€ å‡½æ•°è°ƒç”¨æ—¶æ‰§è¡Œ</li>
<li>æ„é€ å¯¹è±¡è§¦å‘çš„åŠ¨ä½œï¼šåˆå§‹åŒ–ï¼ˆé™æ€ä»£ç å—ï¼‰-&gt;super()-&gt;æ„é€ ä»£ç å—-&gt;æ„é€ å‡½æ•°å‰©ä½™éƒ¨åˆ†</li>
</ul>
<h2 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h2><ul>
<li>æ„é€ å‡½æ•°çš„ç¬¬ä¸€è¡Œå¯ä»¥ç”¨<code>this(...)</code>è°ƒç”¨å…¶å®ƒæ„é€ å‡½æ•°. ç¼–è¯‘å™¨ä¼šæ£€æµ‹é€’å½’æ„é€ å™¨è°ƒç”¨å¹¶æŠ¥é”™</li>
<li>ç¼–è¯‘å™¨ä¿è¯è‹¥æœ‰çˆ¶ç±»,æ„é€ æ–¹æ³•ä¸€å®šä¼šè°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•,æ•…<code>this(...)</code>æ„å‘³ç€ä¼šè°ƒç”¨<code>super(....)</code></li>
</ul>
<h2 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h2><ul>
<li>åªå…è®¸ä¸€ä¸ªçˆ¶ç±»<code>class Son extends Father &#123;...&#125;</code></li>
<li>å½“å‰å¯¹è±¡çš„çˆ¶ç±»æŒ‡é’ˆä¸º<code>ThisClass.super</code> <strong>?</strong>,</li>
<li>å­ç±»çš„æ„é€ å‡½æ•°çš„ç¬¬ä¸€è¡Œéƒ½æœ‰éšå¼çš„<code>super()</code>è°ƒç”¨,å¯ä»¥æ›¿æ¢ä¸ºå„ç§æ˜¾å¼è°ƒç”¨</li>
<li><strong>é‡å†™</strong> <em>é’ˆå¯¹æˆå‘˜æ–¹æ³•</em><ul>
<li>ç»§æ‰¿ä¸­å½“å‡½æ•°å, å‚æ•°åˆ—è¡¨(å³ç‰¹å¾æ ‡)ç›¸åŒæ—¶å‘ç”Ÿé‡å†™</li>
<li>è®¿é—®é™åˆ¶çº§åˆ«å¿…é¡»ç›¸åŒæˆ–æ”¾å®½</li>
<li>è‹¥çˆ¶ç±»å‡½æ•°è¿”å›ç±»å‹ä¸ºåŸºç¡€ç±»å‹,åˆ™å­ç±»é‡å†™è¿”å›ç±»å‹å¿…é¡»ç›¸åŒ</li>
<li>è‹¥çˆ¶ç±»è¿”å›å¼•ç”¨ç±»å‹, åˆ™å­ç±»è¿”å›ç›¸åŒæˆ–å…¶å­ç±»ç±»å‹</li>
<li>é‡å†™æ–¹æ³•ä¸èƒ½æŠ›å‡ºæ–°å¼‚å¸¸, åªå¯ä»¥æŠ›å‡ºç›¸åŒ&#x2F;æ›´å°‘å¼‚å¸¸</li>
<li>æŠ½è±¡æ–¹æ³•å¿…é¡»åœ¨å…·ä½“ç±»ä¸­è¢«é‡å†™</li>
<li>çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡æ—¶,ä¼šåŠ¨æ€ç»‘å®šå­ç±»é‡å†™å‡½æ•°</li>
</ul>
</li>
<li><strong>éšè—</strong> <em>é’ˆå¯¹æ‰€æœ‰æˆå‘˜å˜é‡å’Œé™æ€æˆå‘˜æ–¹æ³•</em><ul>
<li>æˆå‘˜å˜é‡ç±»å‹å¯ä»¥æ”¹å˜</li>
<li>çˆ¶ç±»å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡æ—¶,é™æ€ç»‘å®šçˆ¶ç±»è¢«éšè—æˆå‘˜.(ç”±å¯¹è±¡è°ƒç”¨çš„é™æ€æ–¹æ³•å°†è¢«ç¿»è¯‘ä¸ºç”±ç±»è°ƒç”¨çš„é™æ€æ–¹æ³•ã€‚å› æ­¤æ˜¯éšè—è€Œä¸æ˜¯é‡å†™)</li>
<li>ä¸ºä»€ä¹ˆæ˜¯éšè—ï¼Ÿå› ä¸ºå­ç±»çš„æ„é€ å‡½æ•°æ€»ä¼šè°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚è‹¥ä¸€ä¸ªå˜é‡è¢«ä¸¤æ¬¡ä¿®æ”¹ï¼Œå¯èƒ½äº§ç”Ÿéšæ‚£ã€‚</li>
</ul>
</li>
<li><strong>å‘ä¸Šè½¬å‹</strong><ul>
<li>æˆå‘˜æ–¹æ³•<ol>
<li><pre><code>ç¼–è¯‘æ—¶**æ£€æŸ¥å£°æ˜ç±»å‹ç±»**ä¸­æ˜¯å¦å«æœ‰è¢«è°ƒç”¨çš„æˆå‘˜æ–¹æ³•,è€Œä¸æ£€æŸ¥å­ç±»å¯¹è±¡
</code></pre>
<ol start="2">
<li><pre><code>è¿è¡Œæ—¶**æ ¹æ®å¯¹è±¡**è°ƒç”¨æœ€åé‡å†™çš„æˆå‘˜æ–¹æ³•,è€Œä¸ä¾èµ–ä¸å£°æ˜ç±»å‹ç±»
</code></pre>
<ol start="3">
<li><pre><code>è¢«é‡å†™çš„æ–¹æ³•æ²¡æœ‰ä¸¢å¤±,ä½†ä»…èƒ½é€šè¿‡ç±»æ–¹æ³•ä¸­superè®¿é—®.
</code></pre>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
<li>æˆå‘˜å˜é‡<ol>
<li><pre><code>ç¼–è¯‘æ—¶**æ£€æŸ¥å£°æ˜ç±»å‹ç±»**ä¸­æ˜¯å¦å«æœ‰è¢«è®¿é—®çš„æˆå‘˜å˜é‡, è€Œä¸æ£€æŸ¥å­ç±»å¯¹è±¡
</code></pre>
<ol start="2">
<li><pre><code>è¿è¡Œæ—¶**è®¿é—®å£°æ˜ç±»å‹ç±»**ä¸­çš„æˆå‘˜å˜é‡, è€Œä¸è®¿é—®å­ç±»å¯¹è±¡æ‰€é‡å†™çš„
</code></pre>
</li>
</ol>
</li>
</ol>
</li>
</ul>
</li>
<li><code>instanceof</code><ul>
<li>åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºæŸä¸ªç±»çš„å®ä¾‹æˆ–æ˜¯å¦å®ç°äº†æŸä¸ªæ¥å£.</li>
<li>è‹¥åˆ¤æ–­æ˜¯å¦ç±»çš„å®ä¾‹, åˆ™ç¼–è¯‘å™¨è¦æ±‚å¼•ç”¨ç±»å‹å’Œç±»æœ‰å…³è”(è‡³å°‘æœ‰çˆ¶å­å…³ç³»)</li>
<li>å¸¸ç”¨äºå¼ºåˆ¶ç±»å‹è½¬æ¢å‰.</li>
</ul>
</li>
</ul>
<h2 id="é™æ€ä»£ç å—"><a href="#é™æ€ä»£ç å—" class="headerlink" title="é™æ€ä»£ç å—"></a>é™æ€ä»£ç å—</h2><ul>
<li>é™æ€ä»£ç å—åœ¨ç¨‹åºç”Ÿå‘½å‘¨æœŸä¸­æœ€å¤šæ‰§è¡Œä¸€æ¬¡</li>
<li>æ‰§è¡Œé™æ€ä»£ç å—çš„è¡Œä¸ºå«åš<strong>åˆå§‹åŒ–</strong></li>
<li>èƒ½è§¦å‘åˆå§‹åŒ–çš„åŠ¨ä½œæ˜¯<strong>ä¸»åŠ¨å¼•ç”¨</strong><ol>
<li>åˆ›å»ºç±»çš„å®ä¾‹</li>
<li>è®¿é—®ç±»çš„é™æ€å˜é‡(å¸¸é‡é™¤å¤–, å› ä¸ºå¸¸é‡åœ¨ä»£ç ä¸­è¢«ç›´æ¥æ›¿æ¢, ä¸ä¼šæ–°å¼€å†…å­˜)</li>
<li>è®¿é—®ç±»çš„é™æ€æ–¹æ³•</li>
<li>åå°„</li>
<li>å½“å­ç±»è¢«åˆå§‹åŒ–æ—¶, çˆ¶ç±»è¿˜æ²¡åˆå§‹åŒ–, é‚£ä¹ˆå…ˆæ‰§è¡Œçˆ¶ç±»åˆå§‹åŒ–</li>
<li>è™šæ‹Ÿæœºå¯åŠ¨æ—¶, å…ˆåˆå§‹åŒ–å«main()å®šä¹‰çš„ç±»</li>
<li>æ¥å£(ç¦æ­¢äº†staticä»£ç å—)ä¸è¦æ±‚çˆ¶ç±»åˆå§‹åŒ–,ç›´åˆ°çœŸæ­£å¼•ç”¨çˆ¶æ¥å£</li>
</ol>
</li>
<li>ä¸ä¼šè§¦å‘åˆå§‹åŒ–çš„åŠ¨ä½œæ˜¯<strong>è¢«åŠ¨å¼•ç”¨</strong><ol>
<li>å­ç±»è°ƒç”¨çˆ¶ç±»é™æ€å˜é‡æˆ–çˆ¶ç±»é™æ€æ–¹æ³•, åªåˆå§‹åŒ–çˆ¶ç±»</li>
<li>è®¿é—®ç±»çš„å¸¸é‡</li>
<li>å£°æ˜å¯¹è±¡æ•°ç»„(å› ä¸ºå£°æ˜çš„æ˜¯æ•°ç»„å¤´å¼•ç”¨å’Œå¼•ç”¨æ•°ç»„, å®é™…ä¸å«ä»»ä½•è®¿é—®)</li>
<li>è®¿é—®é™æ€å†…éƒ¨ç±»çš„ä»»ä½•ç»„ä»½</li>
</ol>
</li>
</ul>
<h2 id="final"><a href="#final" class="headerlink" title="final"></a>final</h2><ul>
<li>finalä¿®é¥°å˜é‡: å£°æ˜å¸¸é‡, å…¶å†…å®¹ä¸å¯ä¿®æ”¹<ul>
<li>å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹, å…¶å€¼ä¸å¯ä¿®æ”¹</li>
<li>å¯¹äºå¼•ç”¨æ•°æ®ç±»å‹, æŒ‡å‘ä¸èƒ½æ›´æ¢, ä½†æ‰€æŒ‡å‘çš„å†…å®¹ä»å¯ä¿®æ”¹</li>
<li>å¸¸é‡å’Œæ™®é€šå˜é‡ä¸€æ ·å¯ä»¥é‡å†™&#x2F;éšè—.</li>
<li>æ¯ä¸ªå¯¹è±¡éƒ½åŒ…å«å„è‡ªçš„finalå˜é‡, åœ¨æ„é€ å…¶ä¸­åˆå§‹åŒ–</li>
</ul>
</li>
<li>finalä¿®é¥°ç±»: å®šä¹‰ä¸å¯è¢«ç»§æ‰¿ç±»<ul>
<li>ä¸€èˆ¬å‡ºäºå®‰å…¨æ€§åŸå› æ‰ä¼šè€ƒè™‘finalä¿®é¥°ç±»</li>
<li>å› ä¸ºä¸å¯è¢«ç»§æ‰¿, æ‰€ä»¥ç±»ä¸å¯èƒ½ä¸ºabstract, æ–¹æ³•ä¸å«abstract</li>
</ul>
</li>
<li>finalä¿®é¥°æ–¹æ³•: å®šä¹‰ä¸å¯è¢«é‡å†™æ–¹æ³•</li>
</ul>
<h2 id="abstract"><a href="#abstract" class="headerlink" title="abstract"></a>abstract</h2><ul>
<li>abstractä¿®é¥°ç±»: æŒ‡æ˜ç±»æ˜¯æŠ½è±¡ç±», ä¸èƒ½å®ä¾‹åŒ–. å«æŠ½è±¡æ–¹æ³•çš„ç±»å¿…é¡»ç”¨abstractä¿®é¥°.<ul>
<li>æŠ½è±¡ç±»ä¸å¯èƒ½å«finalæ–¹æ³•, ä½†æ— å…¶ä»–é™åˆ¶, å¯åƒæ™®é€šç±»ä¸€æ ·ç¼–å†™.</li>
</ul>
</li>
<li>abstractä¿®é¥°æ–¹æ³•: æŒ‡æ˜æ–¹æ³•æ˜¯æŠ½è±¡æ–¹æ³•, åŸå‹ååŠ åˆ†å·, è€Œä¸èƒ½å†™æ–¹æ³•ä½“.</li>
</ul>
<h2 id="interface"><a href="#interface" class="headerlink" title="interface"></a>interface</h2><ul>
<li>å¯¹åº”å…³é”®å­— <code>implements</code> å®ç°</li>
<li>æ¥å£æ˜¯å¯¹è¡Œä¸ºçš„æŠ½è±¡, æ–¹ä¾¿æè¿°ç±»çš„å…±åŒè¡Œä¸º.</li>
<li>æ¥å£çš„å˜é‡é»˜è®¤ä¸”ä»…é™äº<code>public static final</code>(æ„å‘³ç€åœ¨æ¥å£å¤–èƒ½è®¿é—®)</li>
<li>æ¥å£çš„æ–¹æ³•é»˜è®¤ä¸”ä»…é™äº<code>public abstract</code></li>
<li>æ–°æ¥å£å¯ä»¥ç»§æ‰¿(extends)å¤šä¸ªæ—§æ¥å£.</li>
<li>ç±»å®ç°(implements)æ¥å£åå¿…é¡»é‡å†™æ¥å£æ–¹æ³•, å¦åˆ™å¿…é¡»å®šä¹‰ä¸ºabstractç±».</li>
<li>ç±»å¯ä»¥å®ç°å¤šä¸ªæ–¹æ³•, å³ä½¿è¿™äº›æ–¹æ³•æœ‰åŒåå¸¸é‡æˆ–åŒä¸€å‡½æ•°.<ul>
<li>è‹¥å®ç°å¤šä¸ªæ–¹æ³•åæœ‰åŒåå¸¸é‡, åˆ™å°è¯•è®¿é—®å®ƒä»¬æ—¶ä¼šäº§ç”Ÿç¼–è¯‘æ—¶äºŒä¹‰æ€§é”™è¯¯.</li>
</ul>
</li>
<li>æ¥å£ä½œä¸ºä¸€ç§æ•°æ®ç±»å‹, å¯ä»¥å¼•ç”¨, å¯ä»¥å‘ä¸Šè½¬å‹ä»¥å®ç°å¤šæ€.</li>
</ul>
<h2 id="åŒ…"><a href="#åŒ…" class="headerlink" title="åŒ…"></a>åŒ…</h2><ul>
<li>è®¿é—®ä¸åŒåŒ…ä¸­çš„ç±»éœ€è¦åŠ ä¸Š<code>åŒ…å.</code>, æˆ–è€…ä½¿ç”¨import <code>åŒ…å.ç±»å</code>æˆ–<code>åŒ…å.*</code></li>
<li>åŒ…æ˜¯å¼€æ”¾çš„(å¯ä»¥è·¨å•å…ƒ). ä¸€ä¸ªåŒ…å¯æ‹¥æœ‰å¤šä¸ªpublicç±», ä½†ä¸€ä¸ªå•å…ƒæœ€å¤šæ‹¥æœ‰ä¸€ä¸ªpublicç±», ä¸”å¿…é¡»ä¸å•å…ƒåç›¸åŒ(å¤§å°å†™æ•æ„Ÿ).</li>
<li>åŒä¸€åŒ…ä¸­çš„ç±»å¯ä»¥äº’ç›¸è®¿é—®éprivateæˆå‘˜.</li>
<li>ç»§æ‰¿å¦ä¸€ä¸ªåŒ…çš„ç±»å, ç»§æ‰¿æ‰€å¾—æˆå‘˜æ‰€å±åŒ…ä¸å˜.</li>
</ul>
<h2 id="æ•°æ®æƒé™"><a href="#æ•°æ®æƒé™" class="headerlink" title="æ•°æ®æƒé™"></a>æ•°æ®æƒé™</h2><ul>
<li>ç±»ä¸­æ•°æ®æƒé™ä¿®é¥°ç¬¦<ol>
<li><code>private</code> : æ•°æ®èƒ½åœ¨æœ¬ç±»ä¸­è®¿é—®.</li>
<li><code>(ç©º, å³é»˜è®¤ä¿®é¥°ç¬¦)</code> : æ•°æ®èƒ½åœ¨åŒåŒ…ä¸­è®¿é—®.</li>
<li><code>protected</code> : å½“ç±»ä¸ºpublicæ—¶æœ‰æ„ä¹‰, æ•°æ®èƒ½åœ¨åŒ…å¤–ç»§æ‰¿ç±»ä¸­è®¿é—®.</li>
<li><code>public</code> : å½“ç±»ä¸ºpublicæ—¶æœ‰æ„ä¹‰, æ•°æ®èƒ½åœ¨åŒ…å¤–è®¿é—®.</li>
</ol>
<ul>
<li>åŒç±»å¯¹è±¡å¯ä»¥äº’ç›¸è®¿é—®æœ¬ç±»çš„privateæˆå‘˜.</li>
<li>é‡å†™æ–¹æ³•æ—¶, æƒé™ä¸èƒ½é™ä½, å¦åˆ™ä¼šå½±å“å¤šæ€.</li>
</ul>
</li>
<li>ç±»æƒé™ä¿®é¥°ç¬¦<ol>
<li><code>(ç©º, å³é»˜è®¤ä¿®é¥°ç¬¦)</code> : æœ¬ç±»èƒ½åœ¨åŒåŒ…ä¸­è®¿é—®.</li>
<li><code>public</code> : æœ¬ç±»èƒ½åœ¨åŒ…å¤–è®¿é—®. ä¸€ä¸ªå•å…ƒæœ€å¤šæ‹¥æœ‰ä¸€ä¸ªpublicç±», ä¸”å¿…é¡»ä¸å•å…ƒåç›¸åŒ(å¤§å°å†™æ•æ„Ÿ).</li>
</ol>
</li>
</ul>
<h2 id="å†…éƒ¨ç±»"><a href="#å†…éƒ¨ç±»" class="headerlink" title="å†…éƒ¨ç±»"></a>å†…éƒ¨ç±»</h2><ul>
<li>æˆå‘˜å†…éƒ¨ç±»<ul>
<li>åœ¨ç±»ä¸­ä»¥æˆå‘˜å½¢å¼å®šä¹‰çš„å¦ä¸€ä¸ªç±», ç§°ä¸ºæˆå‘˜å†…éƒ¨ç±».</li>
<li>å†…éƒ¨ç±»æ˜¯å¤–éƒ¨ç±»çš„æˆå‘˜, ä¾èµ–äºå¤–éƒ¨å¯¹è±¡çš„å­˜åœ¨,å› æ­¤ä¸èƒ½å«æœ‰é™æ€æ–¹æ³•æˆ–é™æ€å˜é‡(å¸¸é‡é™¤å¤–).</li>
<li>å…¶ä»–ç±»ä¸­å£°æ˜ç¤ºä¾‹  <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">OuterClass</span> <span class="variable">p1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OuterClass</span>();</span><br><span class="line">OuterClass.<span class="type">InnerClass</span> <span class="variable">p2</span> <span class="operator">=</span> p1.<span class="keyword">new</span> <span class="title class_">InnerClass</span>();</span><br></pre></td></tr></table></figure></li>
<li>å› ä¸ºæ˜¯æˆå‘˜ä¹‹ä¸€, å¯ä»¥è®¿é—®ä»»ä½•å¤–éƒ¨ç±»æˆå‘˜, å­˜åœ¨å¼•ç”¨<code>OuterClass.this</code></li>
</ul>
</li>
<li>é™æ€å†…éƒ¨ç±»<ul>
<li>åœ¨ç±»ä¸­ä»¥é™æ€æˆå‘˜å½¢å¼å®šä¹‰çš„å¦ä¸€ä¸ªç±», ç§°ä¸ºé™æ€å†…éƒ¨ç±».</li>
<li>é™æ€å†…éƒ¨ç±»çš„å¤–éƒ¨ç±»ä¸€å®šå…¨æ˜¯é™æ€çš„.&#x3D;&#x3D;?_?&#x3D;&#x3D;</li>
<li>é™æ€å†…éƒ¨ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜.</li>
<li>é™æ€å†…éƒ¨ç±»å¯ä»¥å®šä¹‰é™æ€æˆå‘˜å˜é‡,é™æ€æˆå‘˜æ–¹æ³•å’Œé™æ€å†…éƒ¨ç±».</li>
<li>åˆå§‹åŒ–æŸä¸ªé™æ€å†…éƒ¨ç±»ä¸ä¼šè§¦å‘å¤–éƒ¨ç±»çš„åˆå§‹åŒ–.</li>
</ul>
</li>
<li>å±€éƒ¨ç±»<ul>
<li>å®šä¹‰åœ¨æ–¹æ³•ä¸­çš„, æœ‰ç±»åçš„ç±», ç§°ä¸ºå±€éƒ¨ç±».</li>
<li>å±€éƒ¨ç±»ä¾èµ–äºæ–¹æ³•çš„è¿è¡Œ, å› æ­¤æœ¬èº«ä¸æ˜¯é™æ€çš„, ä¸èƒ½å«æœ‰é™æ€æˆå‘˜(å¸¸é‡é™¤å¤–). </li>
<li>å±€éƒ¨ç±»å¯ä»¥è®¿é—®æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡(jr8ä¹‹å‰åªèƒ½è®¿é—®final).</li>
<li>è‹¥æ–¹æ³•æ˜¯æˆå‘˜æ–¹æ³•, åˆ™èƒ½è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜, å­˜åœ¨å¼•ç”¨<code>OuterClass.this</code></li>
<li>è‹¥æ–¹æ³•æ˜¯é™æ€æ–¹æ³•, åˆ™åªèƒ½è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜.</li>
</ul>
</li>
<li>åŒ¿åç±»<ul>
<li>åŒ¿åç±»æ˜¯æ²¡æœ‰ç±»åçš„å­ç±», ä½¿ç”¨æ ¼å¼: <code>new FatherClassOrInterface() &#123;...&#125; ;</code></li>
<li>åŒ¿åç±»é€šå¸¸æ„å‘³ç€å‘ä¸Šè½¬å‹, å¹¶å³æ—¶ç”Ÿæˆä¸€ä¸ªå®ä¾‹, å› æ­¤æœ¬èº«ä¸æ˜¯é™æ€çš„.</li>
<li>åŒ¿åç±»å¯ä»¥å‡ºç°åœ¨æˆå‘˜å˜é‡ä¸­&#x2F;æ–¹æ³•ä¸­.</li>
<li>åŒ¿åç±»ä¸èƒ½å®šä¹‰æ–°çš„æ„é€ æ–¹æ³•&#x2F;å®ç°æ–°çš„æ¥å£&#x2F;æ´¾ç”Ÿå‡ºå­ç±».</li>
<li>åŒ¿åç±»è‹¥å‡ºç°åœ¨æˆå‘˜å˜é‡ä¸­, åˆ™ç±»ä¼¼äºæˆå‘˜å†…éƒ¨ç±»; è‹¥å‡ºç°åœ¨æ–¹æ³•ä¸­, åˆ™ç±»ä¼¼äºå±€éƒ¨ç±».</li>
</ul>
</li>
</ul>
<h2 id="å›è°ƒï¼ˆæ€æƒ³ï¼‰"><a href="#å›è°ƒï¼ˆæ€æƒ³ï¼‰" class="headerlink" title="å›è°ƒï¼ˆæ€æƒ³ï¼‰"></a>å›è°ƒï¼ˆæ€æƒ³ï¼‰</h2><ul>
<li>æŸä¸ªå¯¹è±¡Aå¼•å‘å¦ä¸€å¯¹è±¡Bçš„è¡Œä¸ºï¼ŒåŒæ—¶ä½¿BæŒæœ‰Açš„å¼•ç”¨ã€‚Båœ¨è¡Œä¸ºè¿‡ç¨‹ä¸­å†å¼•å‘Açš„è¡Œä¸ºï¼Œæ­¤è°“å›è°ƒã€‚</li>
<li>Açš„å¼•ç”¨ï¼Œå¯èƒ½æ˜¯ç›´æ¥å¼•ç”¨ï¼Œä¹Ÿå¯èƒ½æ˜¯æ¥å£å¼•ç”¨ç­‰</li>
<li>ä»¤BæŒæœ‰Açš„å¼•ç”¨ï¼Œå¯èƒ½é€šè¿‡æ–¹æ³•å‚æ•°ä¼ é€’ï¼Œä¹Ÿå¯èƒ½é€šè¿‡setæˆå‘˜å˜é‡å¼•ç”¨</li>
<li>åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œå›è°ƒå°¤ä¸ºå¸¸ç”¨</li>
</ul>
<h2 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h2><ul>
<li>Throwableçš„ç›´æ¥å­ç±»æœ‰Errorï¼ˆJVMé”™è¯¯ç”¨ï¼‰ï¼ŒExceptionï¼ˆå¼‚å¸¸ç±»ï¼‰ã€‚Exceptionçš„ç›´æ¥å­ç±»æœ‰RuntimeExceptionï¼ˆç®—æœ¯å¼‚å¸¸ï¼Œä¸¢å¤±èµ„æºï¼Œæ‰¾ä¸åˆ°ç±»ï¼Œç©ºæŒ‡é’ˆï¼Œéæ³•å‚æ•°ï¼Œæ•°ç»„è¶Šç•Œï¼ŒæœªçŸ¥å¼‚å¸¸ï¼‰ï¼ŒIOExceptionï¼ˆEOFå¼‚å¸¸ï¼Œæ‰¾ä¸åˆ°æ–‡ä»¶ï¼‰</li>
<li>è¿è¡Œæ—¶å¼‚å¸¸æ— éœ€æ‰‹åŠ¨ç®¡ç†ï¼Œæ‰€æœ‰è¿‡ç¨‹éšå¼è¿›è¡Œã€‚IOExceptionéœ€è¦æ˜¾å¼å¤„ç†ã€‚</li>
<li>å½“ç¨‹åºå‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œéœ€è¦æ‰‹å†™<code>throw new XXException(..)</code>ï¼Œåˆ™æ–¹æ³•ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚åœ¨å¼‚å¸¸è¢«æŠ›å‡ºçš„åœ°æ–¹ï¼Œå¿…é¡»è¢«å¤„ç†ã€‚</li>
<li>å¤„ç†å¼‚å¸¸ï¼š<ul>
<li>ç”¨<code>try&#123;&#125;</code>åŒ…æ‹¬å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸çš„ä»£ç å—ï¼Œåæ¥<code>catch (XXExcepetion e)&#123;&#125; catch (BiggerException e)&#123;&#125;... finally&#123;&#125;</code>ä»£ç å—ã€‚æˆ–åœ¨æ–¹æ³•å£°æ˜ä¸­æ³¨æ˜<code>throws XXException</code>(åˆ™è°ƒç”¨æ­¤æ–¹æ³•çš„æ–¹æ³•å¿…é¡»å¤„ç†æ­¤å¼‚å¸¸)</li>
<li>è‹¥<code>try&#123;&#125;</code>ä»£ç å—ä¸­ç¡®å®æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™ç¨‹åºè·³è‡³catchä»£ç å—ï¼Œå¹¶ç”¨eæ¥æ”¶å¼‚å¸¸å®ä¾‹ä»¥ä¾›åˆ†æã€‚</li>
<li>æ— è®ºåœ¨<code>try&#123;&#125;</code>,<code>catch()&#123;&#125;</code>ä¸­æœ‰æ— é‡åˆ°å¼‚å¸¸ï¼Œç¨‹åºå¿…å®šæ‰§è¡Œ<code>finally&#123;&#125;</code>ï¼Œä¸€èˆ¬åœ¨å…¶ä¸­å›æ”¶èµ„æºã€‚åœ¨<code>finally&#123;&#125;</code>ä¸­å¼•å‘çš„å¼‚å¸¸ä¼šä¸­æ­¢ä½™ä¸‹ä»£ç çš„æ‰§è¡Œã€‚</li>
<li>éœ€è¦åŒä¸€æ—¶é—´åˆ†åˆ«å¤„ç†å¤šä¸ªå¼‚å¸¸æ—¶ï¼ˆæ¯”å¦‚å…³é—­å¤šä¸ªæµï¼‰ï¼Œå¸¸ç”¨tryåµŒå¥—ã€‚æ³¨æ„åœ¨finallyä¸­åˆ¤æ–­å¼•ç”¨æ˜¯å¦ä¸ºç©ºã€‚</li>
</ul>
</li>
</ul>
<h2 id="è¾“å…¥è¾“å‡ºæµ"><a href="#è¾“å…¥è¾“å‡ºæµ" class="headerlink" title="è¾“å…¥è¾“å‡ºæµ"></a>è¾“å…¥è¾“å‡ºæµ</h2><h3 id="å­—èŠ‚æµ"><a href="#å­—èŠ‚æµ" class="headerlink" title="å­—èŠ‚æµ"></a>å­—èŠ‚æµ</h3><ul>
<li>æŠ½è±¡çˆ¶ç±»ï¼šInputStreamï¼ŒOutputStreamï¼ˆæŠ½è±¡æ–¹æ³•æ˜¯read(), write()ï¼‰</li>
<li>æ–‡ä»¶å­—èŠ‚æµï¼šFileInputStreamï¼ŒFileOutputStream<ul>
<li>æ„é€ æ–¹æ³•ï¼ˆå¸¸ç”¨çš„ï¼‰æœ‰(String name)ï¼Œ (File file), OutputStreamè¿˜æœ‰(File file, boolean append), è‹¥appendï¼Œåˆ™æ–‡ä»¶å†™å…¥åœ¨æœ«å°¾</li>
<li><code>int read()</code> ç”¨intè¿”å›ä¸‹ä¸€å­—èŠ‚byteï¼ˆæ— è¾“å…¥åˆ™è¿”å›-1ï¼‰,å¯¹æ–‡ä»¶å•ä¸ªå­—èŠ‚æ“ä½œ.</li>
<li><code>int read(byte b[])</code> å°†æœ€å¤šb.lengthçš„å­—èŠ‚è¯»å…¥åˆ°b[]ï¼Œè¿”å›å®é™…è¯»å…¥çš„å­—èŠ‚æ•°ã€‚åªé‡åˆ°EOFåˆ™è¿”å›-1</li>
<li><code>int read(byte b[], int off, int len)</code> å°†æœ€å¤šlençš„å­—èŠ‚è¯»å…¥åˆ°b[off]æˆ–ä»¥åï¼Œè¿”å›å®é™…è¯»å…¥çš„å­—èŠ‚æ•°ã€‚åªé‡åˆ°EOFåˆ™è¿”å›-1</li>
<li><code>void write(int b)</code> å†™ä¸€ä¸ªå­—èŠ‚bï¼ˆæŠ›å¼ƒé«˜ä½ï¼‰</li>
<li><code>void write(byte b[], int off, int len)</code> ä»<code>b[off]</code>å¼€å§‹å†™å‡ºlenä¸ªå­—èŠ‚</li>
<li><code>void write(byte b[])</code> å†™å‡ºb.lengthä¸ªå­—èŠ‚</li>
<li></li>
</ul>
</li>
<li><code>BufferedInputStream(InputStream)</code> åˆ©ç”¨å†…ç½®çš„ç¼“å†²æ•°ç»„åŠ é€Ÿè¯»å–</li>
<li><code>BufferedOutputStream(OutputStream)</code> åŠ é€Ÿå†™å‡º</li>
</ul>
<h3 id="å­—ç¬¦æµ"><a href="#å­—ç¬¦æµ" class="headerlink" title="å­—ç¬¦æµ"></a>å­—ç¬¦æµ</h3><ul>
<li>æŠ½è±¡çˆ¶ç±»ï¼šReader, Writer</li>
<li>æ–‡ä»¶å­—ç¬¦æµï¼šFileReader, FileWriter(ä½¿ç”¨é»˜è®¤å­—ç¬¦é›†)</li>
<li>è‹¥è¦æŒ‡å®šå­—ç¬¦ç¼–ç å’Œå­—èŠ‚ç¼“å†²åŒºå¤§å°ï¼Œåº”è¯¥æ„é€ InputStreamReader(FileInputStream in, String charsetName);</li>
<li><code>BufferedReader(Reader in)</code>, <code>(Readerin int sz)</code> åŠ é€Ÿè¯»å…¥</li>
<li><code>BufferedWriter(Writer out)</code>, <code>(Writer out, int sz)</code> åŠ é€Ÿå†™å‡º</li>
<li><code>PrintWriter(File file)</code> <code>(String fileName)</code>, <code>(OutputStream out)</code>, <code>(Writer out)</code>æœ‰æ ¼å¼çš„è¾“å‡ºæµ</li>
</ul>
<h2 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h2><h3 id="æ³›å‹ç±»"><a href="#æ³›å‹ç±»" class="headerlink" title="æ³›å‹ç±»"></a>æ³›å‹ç±»</h3><ul>
<li>å¯ä»¥å®šä¹‰æ³›å‹ç±»<code>class&lt;T&gt; &#123;&#125;</code></li>
<li>ä¸èƒ½è°ƒç”¨æ³›å‹å‚æ•°çš„æ„é€ æ–¹æ³•</li>
<li>å¯ä»¥æŒ‡å®šæ³›å‹ç±»ä¸Šç•Œï¼Œä»¥ä½¿ç”¨å…¶æˆå‘˜<code>class&lt;T extends K&gt;</code>ï¼Œç¼–è¯‘å™¨é™æ€åœ°ç¦æ­¢ä»£ç è¶Šè¿‡ä¸Šç•Œã€‚æ³›å‹ç±»åœ¨å„å¤„ä»£ç éƒ½èƒ½è®°ä½å…¶ä¸Šç•Œã€‚</li>
<li>å£°æ˜ä¸€ä¸ªæ³›å‹ç±»å¯¹è±¡æ—¶ï¼Œçœç•¥å°–æ‹¬å·è¡¨ç¤º<code>&lt;Object&gt;</code></li>
<li>åœ¨åŒä¸€æ¡å£°æ˜è¯­å¥ä¸­ï¼Œåé¢çš„å°–æ‹¬å·å¯ä»¥ç•™ç©ºè¡¨ç¤ºåŒä¸Š<code>&lt;&gt;</code></li>
<li>ç±»å‹å‚æ•°æ˜¯è¿è¡Œæ—¶æ„é€ å¯¹è±¡æ‰èƒ½ç¡®å®šçš„ï¼Œå› æ­¤é™æ€æ–¹æ³•ä¸èƒ½ä½¿ç”¨ç±»å‹å‚æ•°</li>
<li>æ³›å‹ç±»æ˜¯éåå˜çš„ï¼Œ<code>A&lt;Person&gt;</code>ä¸<code>A&lt;Student&gt;</code>æ²¡æœ‰å…³è”</li>
<li>ç¦æ­¢å£°æ˜ç±»å‹ä¸ºæ³›å‹ç±»çš„æ•°ç»„(å¯ä»¥ç”¨arrayListä»£æ›¿)</li>
</ul>
<h3 id="å°†æ³›å‹ç±»ç”¨ä½œå‚æ•°"><a href="#å°†æ³›å‹ç±»ç”¨ä½œå‚æ•°" class="headerlink" title="å°†æ³›å‹ç±»ç”¨ä½œå‚æ•°"></a>å°†æ³›å‹ç±»ç”¨ä½œå‚æ•°</h3><ul>
<li>ä½¿ç”¨é€šé…ç¬¦<code>&lt;?&gt;</code>, æ­¤æ—¶å¯ä»¥æŒ‡å®šæ³›å‹å‚æ•°çš„ä¸‹ç•Œï¼ˆsuperï¼‰æˆ–æ›´ä¸¥æ ¼çš„ä¸Šç•Œï¼ˆæ— è§†å˜å¾—å®½æ¾çš„ä¸Šç•Œï¼‰</li>
</ul>
<h3 id="æ³›å‹æ–¹æ³•"><a href="#æ³›å‹æ–¹æ³•" class="headerlink" title="æ³›å‹æ–¹æ³•"></a>æ³›å‹æ–¹æ³•</h3><ul>
<li>å¯ä»¥å®šä¹‰æ³›å‹æ–¹æ³•<code>public static &lt;T&gt; T func()&#123; return null; &#125; </code></li>
<li>ä¸èƒ½è°ƒç”¨æ³›å‹å‚æ•°çš„æ„é€ æ–¹æ³•</li>
<li>å¯ä»¥æŒ‡å®šæ³›å‹å‚æ•°ä¸Šç•Œï¼Œä»¥ä½¿ç”¨å…¶æˆå‘˜<code>public static &lt;T extends K&gt; T func() &#123; return null; &#125;</code>ï¼Œç¼–è¯‘å™¨é™æ€åœ°ç¦æ­¢ä»£ç è¶Šè¿‡ä¸Šç•Œ</li>
<li>ç±»å‹å‚æ•°è§†ä¸ºæ–¹æ³•æ¥å—çš„å®æ•°ï¼Œå› æ­¤å¯ä»¥ç”¨äºå®šä¹‰é™æ€æ–¹æ³•</li>
<li></li>
<li>ç¼–è¯‘å®ç°å°†æŠŠæ³›å‹æ”¹å†™æˆObjectï¼Œå¹¶åœ¨é€‚å½“çš„æ—¶å€™å‘ä¸‹è½¬å‹ã€‚å› æ­¤ï¼Œ</li>
</ul>
<h2 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h2><ul>
<li>æ¥å—æ³›å‹å‚æ•°</li>
<li><code>boolean add(E e)</code></li>
<li><code>boolean addAll(Collention&lt;? extends E&gt; c)</code></li>
<li><code>boolean contains(Object o), containsAll(Collect&lt;?&gt; c)</code></li>
<li><code>boolean equals(Object o)</code></li>
<li><code>boolean isEmpty()</code></li>
<li><code>Iterator&lt;E&gt; iterator()</code></li>
<li><code>boolean remove(Object o)</code> åˆ é™¤æˆåŠŸè¿”å›ture</li>
<li><code>boolean removeAll(Collenton&lt;?&gt; c)</code></li>
<li><code>int size()</code></li>
<li><code>Object[] toArray()</code></li>
<li><code>&lt;T&gt; T[] toArray(T[])</code></li>
</ul>
<h3 id="Collections-ç”±é™æ€æ–¹æ³•æ„æˆçš„ç±»"><a href="#Collections-ç”±é™æ€æ–¹æ³•æ„æˆçš„ç±»" class="headerlink" title="Collections ç”±é™æ€æ–¹æ³•æ„æˆçš„ç±»"></a>Collections ç”±é™æ€æ–¹æ³•æ„æˆçš„ç±»</h3><ul>
<li><code>void sort(Collection&lt;?&gt; c)</code></li>
</ul>
<h2 id="list-å…è®¸é‡å¤çš„åˆ—è¡¨"><a href="#list-å…è®¸é‡å¤çš„åˆ—è¡¨" class="headerlink" title="list å…è®¸é‡å¤çš„åˆ—è¡¨"></a>list å…è®¸é‡å¤çš„åˆ—è¡¨</h2><h3 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h3><ul>
<li><code>void add(int index, E element)</code></li>
<li><code>void add(int index, Collection&lt;? extends E&gt; c)</code></li>
<li>å¸¸ç”¨<code>void ensureCapacity(int minCapacity)</code>å¯ä»¥ä¼˜åŒ–æ–°å¼€å†…å­˜çš„è€—æ—¶</li>
<li><code>int indexOf(Object o)</code> è¿”å›ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œæ— åˆ™-1</li>
<li><code>int lastIndexOf(Object o)</code></li>
<li><code>E remove(int index)</code> åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ </li>
<li><code>E set(int index, E element)</code> æ›¿æ¢æŒ‡å®šä½ç½®çš„å…ƒç´ </li>
<li><code>void sort(Comparator&lt;? super E&gt; c)</code> æ’åº</li>
</ul>
<h3 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h3><ul>
<li>åŒArrayList</li>
<li><code>void addFirst(E e)</code></li>
<li><code>void addLast(E e)</code></li>
<li><code>E getFirst()</code></li>
<li><code>E getLast</code></li>
<li><code>Iterator&lt;E&gt; descendingIterator()</code> é€†åºè¿­ä»£å™¨</li>
<li><code>E pop()</code></li>
<li><code>void push(E e) == addFirst(E e)</code></li>
</ul>
<h2 id="set-ä¸å…è®¸é‡å¤çš„é›†åˆ"><a href="#set-ä¸å…è®¸é‡å¤çš„é›†åˆ" class="headerlink" title="set ä¸å…è®¸é‡å¤çš„é›†åˆ"></a>set ä¸å…è®¸é‡å¤çš„é›†åˆ</h2><ul>
<li><code>boolean(å¦‚æœé›†åˆå‘ç”Ÿæ”¹å˜) remainAll(Collection&lt;?&gt; c), removeAll(Collection&lt;?&gt; c)</code></li>
<li><code>void clear()</code> æ¸…ç©º</li>
</ul>
<h3 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h3><ul>
<li>ä¾èµ–äº<code>HashCode()</code>åˆ¤æ–­å…ƒç´ æ˜¯å¦ç›¸åŒ</li>
<li>åŸºäºObjectçš„<code>HashCode()</code>ä¼šå°†åœ°å€çº³å…¥è®¡ç®—ï¼Œå¯ä»¥è¦†å†™<code>HashCode()</code>ä»¥å¿½ç•¥åœ°å€å·®å¼‚</li>
<li>è‹¥<code>HashCode()</code>ç›¸åŒï¼Œåˆ™è°ƒç”¨<code>equals()</code>åˆ¤æ–­ã€‚åŸºäºObjectçš„<code>equals()</code>ä»…æ¯”è¾ƒåœ°å€ï¼ˆStringç±»å·²è¦†å†™å¥½ï¼‰ã€‚</li>
</ul>
<h3 id="TreeSet"><a href="#TreeSet" class="headerlink" title="TreeSet"></a>TreeSet</h3><ul>
<li>ä¾èµ–äºæ¥å£Comparableçš„<code>compareTo()</code>æˆ–è€…æ¯”è¾ƒç±»çš„<code>compare(,)</code>æ¯”è¾ƒå¤§å°ã€‚ä¼˜å…ˆä½¿ç”¨æ¯”è¾ƒç±»ã€‚å°åœ¨å‰ï¼Œå¤§åœ¨åã€‚</li>
<li>æ¯”è¾ƒç±»éœ€è¦å®ç°æ¥å£Comparator,å¹¶<code>@Override compare(,)</code></li>
<li><code>Iterator&lt;E&gt; descendingIterator()</code> é€†åºè¿­ä»£å™¨</li>
<li><code>Comparator &lt;? super E&gt; comparator()</code> è¿”å›æ¯”è¾ƒå™¨ï¼Œæˆ–null</li>
<li><code>E ceiling(E e)</code> è¿”å›æœ€å°çš„å¤§äºç­‰äºeçš„å…ƒç´ ï¼Œæˆ–null</li>
<li><code>E floor(E e)</code> è¿”å›æœ€å¤§çš„å°äºç­‰äºeçš„å…ƒç´ ï¼Œæˆ–null</li>
<li><code>E higher(E e)</code> è¿”å›æœ€å°çš„å¤§äºeçš„å…ƒç´ ï¼Œæˆ–null</li>
<li><code>E lower(E e)</code> è¿”å›æœ€å¤§çš„å°äºeçš„å…ƒç´ ï¼Œæˆ–null</li>
</ul>
<h2 id="Map-é”®å€¼ç»‘å®š"><a href="#Map-é”®å€¼ç»‘å®š" class="headerlink" title="Map é”®å€¼ç»‘å®š"></a>Map é”®å€¼ç»‘å®š</h2><ul>
<li><code>static interface Map.Entry&lt;K, V&gt;</code></li>
<li><code>int size()</code></li>
</ul>
<h3 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h3><ul>
<li>å…è®¸é”®å€¼ä¸ºnull</li>
<li><code>HashMap()</code> é»˜è®¤å®¹é‡ä¸º16ï¼Œè´Ÿè½½å› å­ä¸º0.75</li>
<li><code>HashMap(int intialCapacity)</code></li>
<li><code>HashMap(int intialCapacity, float loadFactor)</code></li>
<li><code>HashMap(Map&lt;? extends K, ? extends V&gt; m)</code></li>
<li><code>boolean containsKey(Object key)</code></li>
<li><code>boolean containsValue(Object value)</code></li>
<li><code>Set&lt;Map.Entry&lt;K, V&gt;&gt; entrySet()</code></li>
<li><code>V get(Object key)</code></li>
<li><code>Set&lt;K&gt; keySet()</code></li>
<li><code>V put(K key, V value)</code> è¿”å›ä¸Šä¸€ä¸ªå€¼æˆ–null</li>
<li><code>void putAll(Map&lt;? extends K, ? extends V&gt; m)</code> å¤åˆ¶æ˜ å°„</li>
<li><code>V remove(Object key)</code></li>
<li><code>boolean remove(Object key, Object value)</code></li>
<li><code>V replace(K key, V value)</code> å¦‚æœæœ‰é”®åˆ™æ›¿æ¢</li>
<li><code>boolean replace(K key, V oldValue, V newValue)</code> å¦‚æœé”®keyæ˜ å°„åˆ°oldValueåˆ™æ›¿æ¢</li>
<li><code>Collection&lt;V&gt; values()</code>è¿”å›å€¼çš„Collection</li>
</ul>
]]></content>
      <tags>
        <tag>è¯­æ³•</tag>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>Kotlinè¯­æ³•ç¬”è®°</title>
    <url>/2019/10/12/kotlin/</url>
    <content><![CDATA[<p>Since 2019&#x2F;10&#x2F;12</p>
<span id="more"></span>

<h2 id="å˜é‡å’Œå‡½æ•°"><a href="#å˜é‡å’Œå‡½æ•°" class="headerlink" title="å˜é‡å’Œå‡½æ•°"></a>å˜é‡å’Œå‡½æ•°</h2><h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><ol>
<li><code>val a: Int = 10 // å£°æ˜å¸¸é‡</code></li>
<li><code>var b = 6.99 // å£°æ˜å˜é‡</code></li>
</ol>
<table>
<thead>
<tr>
<th>Java</th>
<th>Kotlin</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>int</td>
<td>Int</td>
<td>æ•´å‹</td>
</tr>
<tr>
<td>long</td>
<td>Long</td>
<td>é•¿æ•´å‹</td>
</tr>
<tr>
<td>short</td>
<td>Short</td>
<td>çŸ­æ•´å‹</td>
</tr>
<tr>
<td>float</td>
<td>Float</td>
<td>å•ç²¾åº¦</td>
</tr>
<tr>
<td>double</td>
<td>Double</td>
<td>åŒç²¾åº¦</td>
</tr>
<tr>
<td>boolean</td>
<td>Boolean</td>
<td>å¸ƒå°”å‹</td>
</tr>
<tr>
<td>char</td>
<td>Char</td>
<td>å­—ç¬¦å‹</td>
</tr>
<tr>
<td>byte</td>
<td>Byte</td>
<td>å­—èŠ‚å‹</td>
</tr>
</tbody></table>
<h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">myIntMax</span><span class="params">(p1: <span class="type">Int</span>, p2: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> max(p1, p2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å•è¡¨è¾¾å¼åŒ–ç®€-&gt;</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">myIntMax</span><span class="params">(p1: <span class="type">Int</span>, p2: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> = max(p1, p2)</span><br></pre></td></tr></table></figure>

<p>ç±»å‹æ¨å¯¼åŒ–ç®€-&gt;</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">myIntMax</span><span class="params">(p1: <span class="type">Int</span>, p2: <span class="type">Int</span>)</span></span> = max(p1, p2)</span><br></pre></td></tr></table></figure>

<h2 id="é€»è¾‘æ§åˆ¶"><a href="#é€»è¾‘æ§åˆ¶" class="headerlink" title="é€»è¾‘æ§åˆ¶"></a>é€»è¾‘æ§åˆ¶</h2><h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><p>ç”¨ if å®ç°max()</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">myIntMax</span><span class="params">(p1: <span class="type">Int</span>, p2: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> value = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> (p1 &gt; p2) &#123;</span><br><span class="line">        value = p1</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        value = p2</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ©ç”¨ if çš„è¿”å›å€¼-&gt;</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">if</span> (p1 &gt; p2) &#123;</span><br><span class="line">    p1</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    p2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å•è¡¨è¾¾å¼åŒ–ç®€-&gt;</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">myIntMax</span><span class="params">(p1: <span class="type">Int</span>, p2: <span class="type">Int</span>)</span></span> = <span class="keyword">if</span> (p1 &gt; p2) p1 <span class="keyword">else</span> p2</span><br></pre></td></tr></table></figure>

<h3 id="when"><a href="#when" class="headerlink" title="when"></a>when</h3><p>å¸¦å‚æ•°çš„ whenï¼Œå‚æ•°ç±»å‹æ²¡æœ‰é™åˆ¶</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getScore</span><span class="params">(name: <span class="type">String</span>)</span></span> = <span class="keyword">when</span> (name) &#123;</span><br><span class="line">    <span class="string">&quot;Tom&quot;</span> -&gt; <span class="number">86</span></span><br><span class="line">    <span class="string">&quot;Jim&quot;</span> -&gt; <span class="number">77</span></span><br><span class="line">    <span class="keyword">else</span> -&gt; <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜å¯ä»¥æŒ‰ç±»å‹é€‰æ‹©</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">checkNumber</span><span class="params">(num: <span class="type">Number</span>)</span></span> &#123; <span class="comment">// Number æ˜¯æ•°å­—æ•°æ®ç±»å‹çš„çˆ¶ç±»</span></span><br><span class="line">    <span class="keyword">when</span> (num) &#123;</span><br><span class="line">        <span class="keyword">is</span> <span class="built_in">Int</span> -&gt; println(<span class="string">&quot;num is Int&quot;</span>)</span><br><span class="line">        <span class="keyword">is</span> <span class="built_in">Double</span> -&gt; println(<span class="string">&quot;num is Double&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span> -&gt; println(<span class="string">&quot;number not support&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸å¸¦å‚æ•°çš„ whenï¼Œæ›´åŠ çµæ´»</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getScore</span><span class="params">(name: <span class="type">String</span>)</span></span> = <span class="keyword">when</span> &#123;</span><br><span class="line">    name.startWith(<span class="string">&quot;Tom&quot;</span>) -&gt; <span class="number">86</span></span><br><span class="line">    name == <span class="string">&quot;Jim&quot;</span> -&gt; <span class="number">77</span> <span class="comment">// ä¸éœ€è¦æ˜¾å¼equals()</span></span><br><span class="line">    name == <span class="string">&quot;Jack&quot;</span> -&gt; <span class="number">95</span></span><br><span class="line">    <span class="keyword">else</span> -&gt; <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><p>å’Œ Java ç›¸åŒã€‚</p>
<h3 id="for"><a href="#for" class="headerlink" title="for"></a>for</h3><p>å–æ¶ˆäº† for-i å¾ªç¯ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> range = <span class="number">0.</span><span class="number">.10</span> <span class="comment">// åˆ›å»ºä¸€ä¸ªå·¦é—­å³é—­åŒºé—´</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">0.</span><span class="number">.10</span>) &#123; <span class="comment">// å·¦é—­å³é—­åŒºé—´</span></span><br><span class="line">        println(i)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">0</span> until <span class="number">10</span> step <span class="number">2</span>) &#123; <span class="comment">// å·¦é—­å³å¼€åŒºé—´</span></span><br><span class="line">	    println(i)</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">10</span> downTo <span class="number">1</span> step <span class="number">3</span>) &#123; <span class="comment">// å·¦é—­å³é—­é™åº</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é¢å‘å¯¹è±¡"><a href="#é¢å‘å¯¹è±¡" class="headerlink" title="é¢å‘å¯¹è±¡"></a>é¢å‘å¯¹è±¡</h2><h3 id="ç±»ä¸å¯¹è±¡"><a href="#ç±»ä¸å¯¹è±¡" class="headerlink" title="ç±»ä¸å¯¹è±¡"></a>ç±»ä¸å¯¹è±¡</h3><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123; <span class="comment">// é»˜è®¤publicï¼Œä¸”ä¸å¯ç»§æ‰¿</span></span><br><span class="line">    <span class="keyword">var</span> name = <span class="string">&quot;&quot;</span> <span class="comment">// é»˜è®¤public</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">eat</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(name + <span class="string">&quot; is eating.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> p = Person() <span class="comment">// ä¸éœ€è¦new</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç»§æ‰¿ä¸æ„é€ å‡½æ•°"><a href="#ç»§æ‰¿ä¸æ„é€ å‡½æ•°" class="headerlink" title="ç»§æ‰¿ä¸æ„é€ å‡½æ•°"></a>ç»§æ‰¿ä¸æ„é€ å‡½æ•°</h3><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123; <span class="comment">// openï¼Œå…è®¸ç»§æ‰¿</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸»æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="keyword">val</span> sno: String, <span class="keyword">val</span> grage: <span class="built_in">Int</span>): Person(<span class="comment">/*è°ƒç”¨çˆ¶æ„é€ å‡½æ•°*/</span>) &#123;</span><br><span class="line">    <span class="comment">// sno, grageè‡ªåŠ¨æˆä¸ºç±»æˆå‘˜</span></span><br><span class="line">    <span class="comment">// å¦‚æœä¸æƒ³è‡ªåŠ¨æˆä¸ºç±»æˆå‘˜ï¼Œåˆ™ä¸è¦åŠ valæˆ–varä¿®é¥°ç¬¦</span></span><br><span class="line">    <span class="comment">/* å‘ä¸»æ„é€ å‡½æ•°åŠ é€»è¾‘</span></span><br><span class="line"><span class="comment">    init &#123;</span></span><br><span class="line"><span class="comment">        println(&quot;sno is &quot; + sno)</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ­¤æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">constructor</span>(name: String, age: <span class="built_in">Int</span>): <span class="keyword">this</span>(<span class="string">&quot;dzf&quot;</span>, <span class="number">100</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»…æœ‰æ¬¡æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">// åˆ™å£°æ˜å¤„ä¸éœ€è¦å£°æ˜è°ƒç”¨çˆ¶æ„é€ å‡½æ•°äº†</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stu</span>: <span class="type">Person</span> &#123;</span><br><span class="line">    <span class="comment">// æ²¡æœ‰äº†ä¸»æ„é€ å‡½æ•°ï¼Œè¿™é‡Œå°±ä¸èƒ½this()ï¼Œåªèƒ½super()</span></span><br><span class="line">    <span class="keyword">constructor</span>(name: String, age: <span class="built_in">Int</span>): <span class="keyword">super</span>() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h3><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Study</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">readBooks</span><span class="params">()</span></span> <span class="comment">// å¯ä»¥ä¸å®ç°</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">doHomework</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="comment">// ä¹Ÿå¯ä»¥æä¾›é»˜è®¤å®ç°</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stu</span>(): Person(), Study &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">readBooks</span><span class="params">()</span></span> &#123; <span class="comment">// è¦†ç›–å®ç°</span></span><br><span class="line">        println(<span class="string">&quot;reading.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¯è§æ€§"><a href="#å¯è§æ€§" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h3><table>
<thead>
<tr>
<th>ä¿®é¥°ç¬¦</th>
<th>Java</th>
<th>Kotlin</th>
</tr>
</thead>
<tbody><tr>
<td>public</td>
<td>æ‰€æœ‰ç±»å¯è§</td>
<td>æ‰€æœ‰ç±»å¯è§ï¼ˆé»˜è®¤ï¼‰</td>
</tr>
<tr>
<td>private</td>
<td>å½“å‰ç±»å¯è§</td>
<td>å½“å‰ç±»å¯è§</td>
</tr>
<tr>
<td>protected</td>
<td>å½“å‰ç±»ã€å­ç±»ã€åŒä¸€åŒ…ä¸‹çš„ç±»å¯è§</td>
<td>å½“å‰ç±»ã€å­ç±»å¯è§</td>
</tr>
<tr>
<td>default</td>
<td>åŒä¸€åŒ…ä¸‹çš„ç±»å¯è§</td>
<td>æ— </td>
</tr>
<tr>
<td>internal</td>
<td>æ— </td>
<td>åŒä¸€æ¨¡å—ä¸‹çš„ç±»å¯è§</td>
</tr>
</tbody></table>
<h3 id="æ•°æ®ç±»"><a href="#æ•°æ®ç±»" class="headerlink" title="æ•°æ®ç±»"></a>æ•°æ®ç±»</h3><p>ç±»ä¿®é¥°ç¬¦<code>data</code>ï¼Œè‡ªåŠ¨ç”Ÿæˆå„ç§æ–¹æ³•ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="keyword">class</span> <span class="title class_">Cellphone</span>(<span class="keyword">val</span> brand:String, <span class="keyword">val</span> number:<span class="built_in">Int</span>) <span class="comment">// æ²¡æœ‰ä»£ç ï¼Œçœç•¥å¤§æ‹¬å·</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">Boolean</span> equals(Object)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">Int</span> hashCode()</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">override</span> String toString()</span><br></pre></td></tr></table></figure>

<h3 id="å•ä¾‹ç±»"><a href="#å•ä¾‹ç±»" class="headerlink" title="å•ä¾‹ç±»"></a>å•ä¾‹ç±»</h3><p>ç±»ä¿®é¥°ç¬¦<code>object</code>ï¼Œä½¿ç±»åæˆä¸ºå…¨å±€å”¯ä¸€å¯¹è±¡</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">object</span> Singleton &#123; <span class="comment">// æ³¨æ„æ²¡æœ‰class</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">test</span><span class="params">()</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Singleton.test() <span class="comment">// è°ƒç”¨</span></span><br></pre></td></tr></table></figure>

<h3 id="ä¼´ç”Ÿå•ä¾‹"><a href="#ä¼´ç”Ÿå•ä¾‹" class="headerlink" title="ä¼´ç”Ÿå•ä¾‹"></a>ä¼´ç”Ÿå•ä¾‹</h3><p>åŒ…è£¹åœ¨ <code>companion object &#123;&#125;</code> å†…éƒ¨å³å¯ã€‚æ€§è´¨ç±»ä¼¼é™æ€æˆå‘˜ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Util</span> &#123;</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="comment">// @JvmStatic</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">factory</span><span class="params">()</span></span>: Util &#123;</span><br><span class="line">    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="çœŸæ­£çš„é™æ€æˆå‘˜"><a href="#çœŸæ­£çš„é™æ€æˆå‘˜" class="headerlink" title="çœŸæ­£çš„é™æ€æˆå‘˜"></a>çœŸæ­£çš„é™æ€æˆå‘˜</h4><p>åœ¨ä¼´ç”Ÿå•ä¾‹å†…åŠ å…¥ <code>@JvmStatic</code> æ³¨è§£ï¼Œæˆ–è€…ï¼Œé¡¶å±‚æ–¹æ³•æ˜¯é™æ€æˆå‘˜æ–¹æ³•ã€‚</p>
<p>åœ¨ Java ä¸­ï¼Œå°† kt çš„æ–‡ä»¶åçœ‹ä½œç±»åï¼Œå³å¯è°ƒç”¨ kotlin é¡¶å±‚æ–¹æ³•ã€‚</p>
<h2 id="Lambdaç¼–ç¨‹"><a href="#Lambdaç¼–ç¨‹" class="headerlink" title="Lambdaç¼–ç¨‹"></a>Lambdaç¼–ç¨‹</h2><h3 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h3><p>åˆ—è¡¨</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> list = ArrayList&lt;String&gt;() <span class="comment">// å¯å˜</span></span><br><span class="line">list.add(<span class="string">&quot;Apple&quot;</span>)</span><br><span class="line">list.add(<span class="string">&quot;Banana&quot;</span>)</span><br><span class="line"><span class="comment">// -------------------------------</span></span><br><span class="line"><span class="keyword">val</span> list = listOf(<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Banana&quot;</span>) <span class="comment">// ä¸å¯å˜</span></span><br><span class="line"><span class="keyword">val</span> list2 = mutableListOf(<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Banana&quot;</span>) <span class="comment">// å¯å˜</span></span><br><span class="line"><span class="keyword">for</span> (fruit <span class="keyword">in</span> list) &#123;</span><br><span class="line">    println(fruit)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é›†åˆ</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> <span class="keyword">set</span> = setOf(<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Banana&quot;</span>) <span class="comment">// HashSet</span></span><br></pre></td></tr></table></figure>
<p>Map</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> map = HashMap&lt;String, <span class="built_in">Int</span>&gt;()</span><br><span class="line">map.put(<span class="string">&quot;Apple&quot;</span>, <span class="number">1</span>)</span><br><span class="line">map[<span class="string">&quot;Banana&quot;</span>] = <span class="number">1</span></span><br><span class="line"><span class="comment">// --------------------------------</span></span><br><span class="line"><span class="keyword">val</span> map = mapOf(<span class="string">&quot;Apple&quot;</span> to <span class="number">1</span>, <span class="string">&quot;Banana&quot;</span> to <span class="number">2</span>) <span class="comment">// to æ˜¯ infixå‡½æ•°</span></span><br><span class="line"><span class="keyword">for</span> ((fruit, number) <span class="keyword">in</span> map) &#123;</span><br><span class="line">    println(fruit + <span class="string">&quot; is &quot;</span> + number)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="é›†åˆçš„å‡½æ•°å¼API"><a href="#é›†åˆçš„å‡½æ•°å¼API" class="headerlink" title="é›†åˆçš„å‡½æ•°å¼API"></a>é›†åˆçš„å‡½æ•°å¼API</h3><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> maxLengthFruit: String = list.maxBy&#123; it.length &#125;</span><br><span class="line"><span class="keyword">val</span> newList = list.filter&#123; it.length &lt; <span class="number">5</span> &#125;.map &#123; it.toUpperCase() &#125;</span><br><span class="line"><span class="keyword">val</span> isOk: <span class="built_in">Boolean</span> = newList.all&#123; it.length &lt; <span class="number">5</span> &#125;</span><br><span class="line"><span class="keyword">val</span> isFault: <span class="built_in">Boolean</span> = newList.any&#123; it.length &gt;= <span class="number">5</span> &#125;</span><br></pre></td></tr></table></figure>
<p>Lambdaè¡¨è¾¾å¼è¯­æ³•ç»“æ„ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">&#123;v1: Type, v2: Type -&gt; body&#125;</span><br><span class="line"><span class="comment">// è¿”å›å€¼æ˜¯bodyçš„æœ€åä¸€è¡Œä»£ç </span></span><br></pre></td></tr></table></figure>
<p>Lambdaè¡¨è¾¾å¼ä¸¾ä¾‹</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> lambda = &#123; fruit: String -&gt; fruit.length &#125;</span><br><span class="line"><span class="keyword">val</span> maxLengthFruit = list.maxBy(lambda)</span><br><span class="line"><span class="keyword">val</span> maxLengthFruit = list.maxBy(&#123; fruit: String -&gt; fruit.length &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// lambdaæ˜¯æœ€åä¸€ä¸ªå‚æ•°</span></span><br><span class="line"><span class="keyword">val</span> maxLengthFruit = list.maxBy()&#123; fruit: String -&gt; fruit.length &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// lambdaæ˜¯å”¯ä¸€ä¸€ä¸ªå‚æ•°</span></span><br><span class="line"><span class="keyword">val</span> maxLengthFruit = list.maxBy&#123; fruit: String -&gt; fruit.length &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªåŠ¨æ¨å¯¼å‚æ•°ç±»å‹</span></span><br><span class="line"><span class="keyword">val</span> maxLengthFruit = list.maxBy&#123; fruit -&gt; fruit.length &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// lambdaå†…åªæœ‰ä¸€ä¸ªå‚æ•°</span></span><br><span class="line"><span class="keyword">val</span> maxLengthFruit = list.maxBy&#123; it.length &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Javaå‡½æ•°å¼API"><a href="#Javaå‡½æ•°å¼API" class="headerlink" title="Javaå‡½æ•°å¼API"></a>Javaå‡½æ•°å¼API</h3><p>Javaå•æŠ½è±¡æ–¹æ³•æ¥å£ï¼ˆä¾‹å¦‚Runnableï¼‰</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">Thread(<span class="keyword">object</span> : Runnable &#123; <span class="comment">// object å…³é”®å­—ï¼Œä»£è¡¨ä¸€ä¸ªåŒ¿åå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;Thread is running.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).start()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Runnableåªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•</span></span><br><span class="line">Thread(Runnale &#123;</span><br><span class="line">    println(<span class="string">&quot;Thread is running.&quot;</span>) <span class="comment">// Lambdaè¡¨è¾¾å¼è¦†ç›–run()</span></span><br><span class="line">&#125;).start()</span><br><span class="line"></span><br><span class="line"><span class="comment">// </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Threadçš„å‚æ•°åˆ—è¡¨ä¸­æœ‰ä¸”åªæœ‰Runnable</span></span><br><span class="line">Thread(&#123;</span><br><span class="line">    println(<span class="string">&quot;Thread is running.&quot;</span>) <span class="comment">// Lambdaè¡¨è¾¾å¼è¦†ç›–run()</span></span><br><span class="line">&#125;).start()</span><br><span class="line"></span><br><span class="line"><span class="comment">// lambdaæ˜¯å”¯ä¸€ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">Thread &#123;</span><br><span class="line">    println(<span class="string">&quot;Thread is running.&quot;</span>)</span><br><span class="line">&#125;.start()</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸¾ä¾‹</span></span><br><span class="line">button.setOnClickListener &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¸¸ç”¨æ ‡å‡†å‡½æ•°"><a href="#å¸¸ç”¨æ ‡å‡†å‡½æ•°" class="headerlink" title="å¸¸ç”¨æ ‡å‡†å‡½æ•°"></a>å¸¸ç”¨æ ‡å‡†å‡½æ•°</h3><ol>
<li><code>let</code> è¿”å›æœ€åä¸€è¡Œ <figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">obj?.let &#123;</span><br><span class="line">    it.f()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><code>also</code> è¿”å›æœ¬èº« <figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">obj?.also &#123;</span><br><span class="line">    it.f()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><code>with</code> è¿”å›æœ€åä¸€è¡Œ <figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">with(StringBuilder()) &#123;</span><br><span class="line">    append(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    toString()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><code>run</code> è¿”å›æœ€åä¸€è¡Œ <figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">StringBuilder().run &#123;</span><br><span class="line">    append(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    toString()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><code>apply</code> è¿”å›æœ¬èº« <figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">StringBuilder().apply &#123;</span><br><span class="line">    append(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li></li>
</ol>
<h2 id="ç©ºç±»å‹ç³»ç»Ÿ"><a href="#ç©ºç±»å‹ç³»ç»Ÿ" class="headerlink" title="ç©ºç±»å‹ç³»ç»Ÿ"></a>ç©ºç±»å‹ç³»ç»Ÿ</h2><p>Kotliné»˜è®¤ç¼–è¯‘å™¨å½¢å‚ä¸å¯ä¸ºç©ºã€‚</p>
<h3 id="å¯ç©ºç±»å‹"><a href="#å¯ç©ºç±»å‹" class="headerlink" title="å¯ç©ºç±»å‹"></a>å¯ç©ºç±»å‹</h3><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">doStudy</span><span class="params">(a: <span class="type">Study</span>?, b: <span class="type">Study</span>)</span></span> &#123; <span class="comment">// åŠ é—®å·ï¼Œè¡¨ç¤ºå¯ç©º</span></span><br><span class="line">    a.readBooks() <span class="comment">// ç¼–è¯‘é”™è¯¯ï¼Œæœªå¤„ç†ç©º</span></span><br><span class="line">    a?.readBooks() <span class="comment">// æ­£ç¡®ï¼Œè‹¥aä¸ºnullåˆ™è¿”å›null</span></span><br><span class="line">    a!!.readBooks() <span class="comment">// æ­£ç¡®ï¼Œå‘ç¼–è¯‘å™¨ä¿è¯aä¸ä¸ºç©ºã€‚</span></span><br><span class="line">    <span class="keyword">val</span> c = a ?: b <span class="comment">// c = if (a!=null) a else b</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getTextLength</span><span class="params">(text: <span class="type">String</span>?)</span></span> = text?.length ?: <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">doStudy</span><span class="params">(a: <span class="type">Study</span>?)</span></span> &#123; <span class="comment">// ç®€åŒ–ç‰ˆ</span></span><br><span class="line">    a?.let &#123; <span class="comment">// å†…ç½®çš„letå‡½æ•°</span></span><br><span class="line">        it.readBooks()</span><br><span class="line">        it.doHomework()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>let</code>å‡½æ•°çš„ä¼˜åŠ¿æ˜¯æš‚å­˜äº†å¯¹è±¡å¼•ç”¨ï¼Œä¸æ€•å…¨å±€å˜é‡è¢«å¤šçº¿ç¨‹ä¿®æ”¹ã€‚ç›¸åï¼Œç”¨<code>if</code>æ— æ³•ä¿è¯å…¨å±€å˜é‡çš„éç©ºã€‚</p>
<h2 id="å­—ç¬¦ä¸²å†…åµŒè¡¨è¾¾å¼"><a href="#å­—ç¬¦ä¸²å†…åµŒè¡¨è¾¾å¼" class="headerlink" title="å­—ç¬¦ä¸²å†…åµŒè¡¨è¾¾å¼"></a>å­—ç¬¦ä¸²å†…åµŒè¡¨è¾¾å¼</h2><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;Hello, <span class="subst">$&#123;obj.name&#125;</span>. Nice to meet you.&quot;</span> <span class="comment">// è¡¨è¾¾å¼</span></span><br><span class="line"><span class="string">&quot;Hello, <span class="variable">$name</span>. Nice to meet you&quot;</span> <span class="comment">// å˜é‡</span></span><br></pre></td></tr></table></figure>

<h2 id="ç»‘å®šå‚æ•°"><a href="#ç»‘å®šå‚æ•°" class="headerlink" title="ç»‘å®šå‚æ•°"></a>ç»‘å®šå‚æ•°</h2><p>é€šè¿‡ç»‘å®šå½¢å‚-å®å‚ï¼Œå¯ä»¥è°ƒæ¢å‚æ•°é¡ºåº</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">myfun(str = <span class="string">&quot;abc&quot;</span>, num = <span class="number">123</span>)</span><br></pre></td></tr></table></figure>


]]></content>
      <tags>
        <tag>è¯­æ³•</tag>
        <tag>Kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title>.vimrc</title>
    <url>/2019/08/25/vimrc/</url>
    <content><![CDATA[<h2 id="vimrc-amp-Font"><a href="#vimrc-amp-Font" class="headerlink" title=".vimrc &amp; Font"></a>.vimrc &amp; Font</h2><p><a href="vimrc/null.vimrc">.vimrc</a></p>
<p><a href="vimrc/FiraCode-Retina.ttf">Fira Code Retina</a></p>
<span id="more"></span>


<h2 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h2><p>For 8+ version.</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"><span class="comment">&quot; All system-wide defaults are set in $VIMRUNTIME/debian.vim and sourced by</span></span><br><span class="line"><span class="comment">&quot; the call to :runtime you can find below.  If you wish to change any of those</span></span><br><span class="line"><span class="comment">&quot; settings, you should do it in this file (/etc/vim/vimrc), since debian.vim</span></span><br><span class="line"><span class="comment">&quot; will be overwritten everytime an upgrade of the vim packages is performed.</span></span><br><span class="line"><span class="comment">&quot; It is recommended to make changes after sourcing debian.vim since it alters</span></span><br><span class="line"><span class="comment">&quot; the value of the &#x27;compatible&#x27; option.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; This line should not be removed as it ensures that various options are</span></span><br><span class="line"><span class="comment">&quot; properly set to work with the Vim-related packages available in Debian.</span></span><br><span class="line">runtime! debian.<span class="keyword">vim</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Vim will load $VIMRUNTIME/defaults.vim if the user does not have a vimrc.</span></span><br><span class="line"><span class="comment">&quot; This happens after /etc/vim/vimrc(.local) are loaded, so it will override</span></span><br><span class="line"><span class="comment">&quot; any settings in these files.</span></span><br><span class="line"><span class="comment">&quot; If you don&#x27;t want that to happen, uncomment the below line to prevent</span></span><br><span class="line"><span class="comment">&quot; defaults.vim from being loaded.</span></span><br><span class="line"><span class="comment">&quot; let g:skip_defaults_vim = 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Uncomment the next line to make Vim more Vi-compatible</span></span><br><span class="line"><span class="comment">&quot; <span class="doctag">NOTE:</span> debian.vim sets &#x27;nocompatible&#x27;.  Setting &#x27;compatible&#x27; changes numerous</span></span><br><span class="line"><span class="comment">&quot; options, so any other options should be set AFTER setting &#x27;compatible&#x27;.</span></span><br><span class="line"><span class="comment">&quot;set compatible</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Vim5 and later versions support syntax highlighting. Uncommenting the next</span></span><br><span class="line"><span class="comment">&quot; line enables syntax highlighting by default.</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">has</span>(<span class="string">&quot;syntax&quot;</span>)</span><br><span class="line">  <span class="keyword">syntax</span> <span class="keyword">on</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; If using a dark background within the editing area and syntax highlighting</span></span><br><span class="line"><span class="comment">&quot; turn on this option as well</span></span><br><span class="line"><span class="keyword">set</span> background=dark</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Uncomment the following to have Vim jump to the last position when</span></span><br><span class="line"><span class="comment">&quot; reopening a file</span></span><br><span class="line"><span class="string">&quot;if has(&quot;</span><span class="keyword">autocmd</span><span class="comment">&quot;)</span></span><br><span class="line"><span class="string">&quot;  au BufReadPost * if line(&quot;</span><span class="string">&#x27;\&quot;&quot;) &gt; 1 &amp;&amp; line(&quot;&#x27;</span>\<span class="string">&quot;&quot;</span>) &lt;= <span class="built_in">line</span>(<span class="string">&quot;$&quot;</span>) | <span class="keyword">exe</span> <span class="string">&quot;normal! g&#x27;\&quot;&quot;</span> | <span class="keyword">endif</span></span><br><span class="line"><span class="comment">&quot;endif</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Uncomment the following to have Vim load indentation rules and plugins</span></span><br><span class="line"><span class="comment">&quot; according to the detected filetype.</span></span><br><span class="line"><span class="string">&quot;if has(&quot;</span><span class="keyword">autocmd</span><span class="comment">&quot;)</span></span><br><span class="line"><span class="comment">&quot;  filetype plugin indent on</span></span><br><span class="line"><span class="comment">&quot;endif</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; The following are commented out as they cause vim to behave a lot</span></span><br><span class="line"><span class="comment">&quot; differently from regular Vi. They are highly recommended though.</span></span><br><span class="line"><span class="keyword">set</span> showcmd		<span class="comment">&quot; Show (partial) command in status line.</span></span><br><span class="line"><span class="keyword">set</span> showmatch		<span class="comment">&quot; Show matching brackets.</span></span><br><span class="line"><span class="keyword">set</span> ignorecase		<span class="comment">&quot; Do case insensitive matching</span></span><br><span class="line"><span class="keyword">set</span> smartcase		<span class="comment">&quot; Do smart case matching</span></span><br><span class="line"><span class="string">&quot;set incsearch		&quot;</span> Incremental <span class="built_in">search</span></span><br><span class="line"><span class="keyword">set</span> autowrite		<span class="comment">&quot; Automatically save before commands like :next and :make</span></span><br><span class="line"><span class="keyword">set</span> hidden		<span class="comment">&quot; Hide buffers when they are abandoned</span></span><br><span class="line"><span class="keyword">set</span> mouse=<span class="keyword">a</span>		<span class="comment">&quot; Enable mouse usage (all modes)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> <span class="built_in">cindent</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">number</span></span><br><span class="line"><span class="keyword">set</span> tabstop=<span class="number">4</span></span><br><span class="line"><span class="keyword">set</span> softtabstop=<span class="number">4</span></span><br><span class="line"><span class="keyword">set</span> <span class="built_in">shiftwidth</span>=<span class="number">4</span></span><br><span class="line"><span class="keyword">set</span> autoread</span><br><span class="line"></span><br><span class="line"><span class="comment">&quot; Source a global configuration file if available</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">filereadable</span>(<span class="string">&quot;/etc/vim/vimrc.local&quot;</span>)</span><br><span class="line">  <span class="keyword">source</span> /etc/<span class="keyword">vim</span>/vimrc.local</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;F9&gt;</span> :<span class="keyword">call</span> CompileCPP()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line">func! CompileCPP()</span><br><span class="line">	exec <span class="string">&quot;w&quot;</span></span><br><span class="line">	<span class="keyword">if</span> &amp;<span class="keyword">filetype</span> == <span class="string">&#x27;cpp&#x27;</span></span><br><span class="line">		exec <span class="string">&#x27;!g++ -Wall -DDEBUG % -o %&lt;&#x27;</span></span><br><span class="line">	<span class="keyword">endif</span></span><br><span class="line">endfunc</span><br><span class="line"></span><br><span class="line"><span class="keyword">nnoremap</span> <span class="symbol">&lt;F10&gt;</span> :<span class="keyword">call</span> RunOUT()<span class="symbol">&lt;CR&gt;</span></span><br><span class="line">func! RunOUT()</span><br><span class="line">	exec <span class="string">&#x27;!./%&lt;&#x27;</span></span><br><span class="line">endfunc</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ps-bashrc"><a href="#ps-bashrc" class="headerlink" title="ps. bashrc"></a>ps. bashrc</h2><figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">TEXT::</span><br><span class="line">terminal size : <span class="number">90</span> * <span class="number">34</span></span><br><span class="line"></span><br><span class="line">custom font Fira Code Retina <span class="number">14</span></span><br><span class="line">Cell spaceing <span class="number">1.00</span> <span class="number">1.00</span></span><br><span class="line"></span><br><span class="line">Cursor : Block, Default</span><br><span class="line"></span><br><span class="line">COLORS::</span><br><span class="line">Custom::</span><br><span class="line">	Default: <span class="meta">#D3D7CF, #020F20</span></span><br><span class="line">	Bold: disabled</span><br><span class="line">	Cursor: <span class="meta">#FFFFFF, #0350C9</span></span><br><span class="line">	Hightlight: disabled</span><br><span class="line">	palette: (Tango), blue: <span class="meta">#4A7DBE #7EA9D6</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>å‡å°‘è„±å‘æŒ‡å—</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆç­‰æ•°è®º</title>
    <url>/2019/08/02/%E5%88%9D%E7%AD%89%E6%95%B0%E8%AE%BA/</url>
    <content><![CDATA[<h1 id="æ¨¡æ–¹ç¨‹"><a href="#æ¨¡æ–¹ç¨‹" class="headerlink" title="æ¨¡æ–¹ç¨‹"></a>æ¨¡æ–¹ç¨‹</h1><h2 id="åŸºç¡€æ€§è´¨"><a href="#åŸºç¡€æ€§è´¨" class="headerlink" title="åŸºç¡€æ€§è´¨"></a>åŸºç¡€æ€§è´¨</h2><h3 id="æ¨¡çš„ç­‰ä»·å…³ç³»"><a href="#æ¨¡çš„ç­‰ä»·å…³ç³»" class="headerlink" title="æ¨¡çš„ç­‰ä»·å…³ç³»"></a>æ¨¡çš„ç­‰ä»·å…³ç³»</h3><p><strong>è‡ªåæ€§</strong><br>$$ a\equiv a \mod m $$<br><strong>å¯¹ç§°æ€§</strong><br>$$ a\equiv b \mod m\Leftrightarrow b\equiv a \mod m$$</p>
<span id="more"></span>
<p><strong>ä¼ é€’æ€§</strong><br>$$<br>a\equiv c \mod m, c\equiv b\mod m \Rightarrow a\equiv b \mod m<br>$$</p>
<h3 id="ç­‰å¼çš„æ€§è´¨"><a href="#ç­‰å¼çš„æ€§è´¨" class="headerlink" title="ç­‰å¼çš„æ€§è´¨"></a>ç­‰å¼çš„æ€§è´¨</h3><p><strong>å¯åŠ å‡æ€§</strong><br>$$<br>æ¨¡mæ„ä¹‰ä¸‹\<br>a\equiv b, c\equiv d \Rightarrow a+c\equiv b+d<br>$$<br><strong>å¯ä¹˜æ€§</strong><br>$$<br>æ¨¡mæ„ä¹‰ä¸‹\<br>a\equiv b, c\equiv d \Rightarrow ac\equiv bd<br>$$</p>
<blockquote>
<p>è¯æ˜ï¼šè®¾$a-b&#x3D;km$, $c-d&#x3D;lm$. åˆ™$a&#x3D;b+km$, $c&#x3D;d+lm$, $ac&#x3D;klm^2+(bl+ck)m+bd$, æ˜¾ç„¶$m|(ac-bd)$</p>
<p>æ¨è®ºï¼šæ¨¡$m$æ„ä¹‰ä¸‹,$a\equiv b \Rightarrow an\equiv bn$, $n$æ˜¯è‡ªç„¶æ•°</p>
</blockquote>
<p><strong>æ¶ˆå»å¾‹</strong>ï¼ˆä¹˜æ³•é€†å…ƒçš„å……è¦æ¡ä»¶ï¼‰<br>$$<br>æ¨¡mæ„ä¹‰ä¸‹\<br>ac\equiv bc, gcd(c,m)&#x3D;1 \Rightarrow a\equiv b<br>$$</p>
<blockquote>
<p>è¯æ˜ï¼šm|c(a-b), å› ä¸ºc,må…¬å› å­ä¸º1ï¼Œæ‰€ä»¥m|(a-b).</p>
</blockquote>
<p><strong>å¹‚ä¿æŒæ’ç­‰</strong><br>$$<br>æ¨¡mæ„ä¹‰ä¸‹\<br>a\equiv b \Rightarrow a^n\equiv b^n<br>$$</p>
<p><strong>æ’ç­‰çš„æœ€å¤§ç©ºé—´</strong><br>$$<br>a\equiv b \mod m_1\<br>a\equiv b \mod m_2\<br>\dotsm \<br>a\equiv b \mod m_n \<br>\Downarrow \<br>a\equiv b \mod lcm(m_1, m_2,\dotsm, m_n);<br>$$</p>
<blockquote>
<p>è¯æ˜ï¼š(a-b)æ˜¯$m_1,m_2,\dotsm,m_n$çš„å€æ•°ï¼Œè€ŒlcmåŒ…å«äº†æ‰€æœ‰è´¨å› å­çš„æœ€å¤§æ¬¡å¹‚ã€‚</p>
<p>æ¨è®ºï¼šè‹¥$m_1,m_2,\dotsm,m_n$äº’è´¨ï¼Œåˆ™$a\equiv b \mod m_1m_2\dotsm m_n;$</p>
</blockquote>
<p><strong>æ¢æ¨¡çš„å¦ä¸€ç§é€”å¾„</strong><br>$$<br>a\equiv b \mod c \<br>\Downarrow \<br>ad \equiv bd \mod cd<br>$$</p>
<blockquote>
<p>è¯æ˜ï¼š$c|(a-b)\Rightarrow cd|d(a-b)$ã€‚</p>
</blockquote>
<h2 id="é«˜çº§å®šç†"><a href="#é«˜çº§å®šç†" class="headerlink" title="é«˜çº§å®šç†"></a>é«˜çº§å®šç†</h2><h3 id="è´ç¥–å®šç†"><a href="#è´ç¥–å®šç†" class="headerlink" title="è´ç¥–å®šç†"></a>è´ç¥–å®šç†</h3><p>$$<br>gcd(a,b)æ˜¯a,bçš„çº¿æ€§ç»„åˆã€‚å³å­˜åœ¨æ•´æ•°x,y,ä½¿å¾—xa+yb&#x3D;gcd(a,b).<br>$$</p>
<blockquote>
<p>è¯æ˜ï¼š</p>
<p>å½“$a&#x3D;b$æ—¶ç»“è®ºæ˜¾ç„¶æˆç«‹ã€‚</p>
<p>å½“$a\neq b$æ—¶ï¼Œä¸å¦¨è®¾$a\neq0$ï¼Œå–$d$ä¸º$a,b$çš„æ‰€æœ‰çº¿æ€§ç»„åˆä¸­æœ€å°çš„æ­£æ•´æ•°ã€‚ä½œå¸¦ä½™é™¤æ³•$a&#x3D;qd+r$ï¼Œåˆ™$0\leq r&lt;d$. è‹¥$r\neq 0$,åˆ™$r&#x3D;a-qd$æ˜¯æ¯”dæ›´å°çš„çº¿æ€§ç»„åˆï¼Œä¸å‡è®¾çŸ›ç›¾,æ‰€ä»¥$r&#x3D;0$,$d$æ˜¯$a$çš„å› å­;åŒç†å¯å¾—$d$æ˜¯$b$çš„å› å­,æ•…$d$æ˜¯$a,b$çš„å…¬å› å­.å–$c$ä¸º$a,b$çš„ä»»æ„å…¬å› å­,å¯¹$d&#x3D;(xa+yb)$æå–$c$å¾—$d&#x3D;c(xa&#39;+yb&#39;)$,å¯çŸ¥$c$æ˜¯$d$çš„å› å­,æ‰€ä»¥$|c|\leq d$,æ•…$d&#x3D;gcd(a,b)$.</p>
</blockquote>
<h3 id="ä¸­å›½å‰©ä½™å®šç†"><a href="#ä¸­å›½å‰©ä½™å®šç†" class="headerlink" title="ä¸­å›½å‰©ä½™å®šç†"></a>ä¸­å›½å‰©ä½™å®šç†</h3><p>$$<br>æœ‰çº¿æ€§åŒä½™æ–¹ç¨‹ç»„\<br>x\equiv a_1 \mod m_1\<br>x\equiv a_2 \mod m_2\<br>\dotsm \<br>x\equiv a_3 \mod m_n \<br>å…¶ä¸­m_iä¸¤ä¸¤äº’è´¨ï¼Œåˆ™åœ¨æ¨¡M&#x3D;m_1m_2\dotsm m_næ„ä¹‰ä¸‹è§£æœ‰ä¸”åªæœ‰ä¸€ä¸ªã€‚\<br>æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š<br>è®¾M_iä¸º\frac{M}{m_i}ï¼Œåœ¨æ¨¡m_iæ„ä¹‰ä¸‹M_içš„é€†ä¸ºt_iã€‚åˆ™\<br>x&#x3D;\sum_{i&#x3D;1}^{n} a_it_iM_i<br>$$</p>
<blockquote>
<p>è¯æ˜ï¼š</p>
<p>æ„é€ è§£$x$çš„æ­£ç¡®æ€§ã€‚å¯¹äºæ–¹ç¨‹$i$,$\quad t_iM_i\equiv 1 \mod m_i, M_j\equiv 0 \mod m_i$ã€‚æ‰€ä»¥è§£æ»¡è¶³æ¯ä¸€æ¡æ–¹ç¨‹å¼ã€‚</p>
<p>åœ¨æ¨¡$M$æ„ä¹‰ä¸‹è§£çš„å”¯ä¸€æ€§ã€‚ä»¤$x_1,x_2$ä¸ºæ–¹ç¨‹ç»„çš„ä¸¤ä¸ªä¸åŒçš„è§£,åˆ™$(x_1-x_2)$åˆ†åˆ«æ˜¯$m_1,m_2\dotsm m_n$çš„å€æ•°ï¼Œåˆ™$|(x_1-x_2)|\geq M$ï¼Œåˆ™åœ¨æ¨¡$M$æ„ä¹‰ä¸‹è§£æ˜¯å”¯ä¸€çš„ã€‚</p>
</blockquote>
<h1 id="æ¬§æ‹‰å‡½æ•°"><a href="#æ¬§æ‹‰å‡½æ•°" class="headerlink" title="æ¬§æ‹‰å‡½æ•°"></a>æ¬§æ‹‰å‡½æ•°</h1><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>mçš„åŒ–ç®€å‰©ä½™ç³»ï¼ˆåˆç§°æ—¢çº¦å‰©ä½™ç³»ï¼Œç¼©ç³»ï¼‰ï¼Œ<strong>æœ¬æ–‡è®°ä¸º$Z_m$</strong><br>$$<br>mçš„å‰©ä½™ç³»ä¸­ä¸mäº’è´¨çš„æ•°æ„æˆçš„å­é›†<br>$$</p>
<p>æ¬§æ‹‰å‡½æ•°$\phi(n)$<br>$$<br>mçš„åŒ–ç®€å‰©ä½™ç³»çš„å…ƒç´ ä¸ªæ•°ï¼Œå³|Z_m|<br>$$</p>
<h2 id="æ€§è´¨"><a href="#æ€§è´¨" class="headerlink" title="æ€§è´¨"></a>æ€§è´¨</h2><ol>
<li><p>å¯¹äºè´¨æ•°$p$ï¼Œ$\phi(p)&#x3D;p-1$ </p>
</li>
<li><p>å¯¹äºè´¨æ•°$p$ï¼Œ$\phi(p^k)&#x3D;p^{k-1}(p-1)$</p>
<blockquote>
<p>è¯æ˜ï¼šåœ¨$[1,p^k]$ä¸­ï¼Œä¸ä¸$p^k$äº’è´¨çš„æœ‰${p,2p,3p,\dotsc,p^k}$å…±$\frac{p^k}{p}&#x3D;p^{k-1}$ä¸ªæ•°ï¼Œåˆ™äº’è´¨çš„æœ‰$p^k-p^{k-1}&#x3D;p^{k-1}(p-1)$ä¸ªæ•°ã€‚</p>
</blockquote>
</li>
<li><p><strong>æ¬§æ‹‰å‡½æ•°æ˜¯ç§¯æ€§å‡½æ•°</strong>ï¼Œå³å¯¹äºäº’è´¨çš„ä¸¤æ•°$m_1,m_2$ï¼Œæœ‰$\phi(m_1m_2)&#x3D;\phi(m_1)\phi(m_2)$</p>
</li>
</ol>
<blockquote>
<p>è¯æ˜ï¼šè®¾$a\in Z_{m_1}, b\in Z_{m_2}$ï¼Œåˆ™æœ‰åŒä½™æ–¹ç¨‹ç»„<br>$$ N \equiv a \mod m_1\<br>N \equiv b \mod m_2\ $$<br>å…¶ä¸­$a,m_1$äº’è´¨ï¼Œ$b,m_2$äº’è´¨ï¼Œ$m_1,m_2$äº’è´¨ã€‚åˆ™Nåœ¨æ¨¡$m_1m_2$ä¸‹æœ‰ä¸”ä»…æœ‰å”¯ä¸€è§£$N&#x3D;am_2^{-1}m_2+bm_1^{-1}m_1$ï¼Œæ˜¾ç„¶$N$ä¸$m_1,m_2$éƒ½äº’è´¨ï¼Œæ•…ä¸$m_1m_2$äº’è´¨ï¼Œ$N\in Z_{m_1m_2}$ã€‚å¯¹ä»»æ„çš„$N\in Z_{m_1m_2}$ï¼Œå…¶å¯¹åº”çš„$(a,b)$ä¹Ÿæ˜¯å”¯ä¸€çš„ã€‚ç»¼ä¸Šï¼Œæ˜ å°„$Z_{m_1m_2}\rightarrow Z_{m_1}\times Z_{m_2}$æ˜¯æ»¡å°„ä¹Ÿæ˜¯å•å°„ï¼Œåˆ™æ­¤æ˜ å°„æ˜¯åŒå°„ï¼Œæ•…$|Z_{m_1m_2}|&#x3D;|Z_{m_1}||Z_{m_2}|$ï¼Œå³$\phi(m_1m_2)&#x3D;\phi(m_1)\phi(m_2)$ã€‚</p>
</blockquote>
<ol start="4">
<li>å¯¹äºè´¨æ•°$p$ï¼Œä¸”$p|a$ï¼Œåˆ™$\phi(ap)&#x3D;\phi(a)p$</li>
</ol>
<blockquote>
<p>è¯æ˜ï¼šæå–$a$çš„æ‰€æœ‰på› å­å¾—$ap&#x3D;a&#39;p^xp&#x3D;a&#39;p^{x+1}$ï¼Œç”±ç§¯æ€§å‡½æ•°å¾—<br>$$ \begin{aligned}<br>  \phi(ap)&#x3D;&amp;\phi(a&#39;)\phi(p^{x+1}) \<br>  &#x3D;&amp;\phi(a&#39;)p^x(p-1)\<br>  &#x3D;&amp;\phi(a&#39;)p^{x-1}(p-1)p\<br>  &#x3D;&amp;\phi(a&#39;)\phi(p^x)p\<br>  &#x3D;&amp;\phi(a&#39;p^x)p\<br>  &#x3D;&amp;\phi(a)p<br>\end{aligned} $$</p>
</blockquote>
<ol start="5">
<li>æ¬§æ‹‰å‡½æ•°é€šé¡¹<br>$$<br>ä»¤{p_1,p_2,\dotsc,p_m}ä¸ºnçš„æ‰€æœ‰è´¨å› å­\<br>\phi(n)&#x3D;n\prod_{i&#x3D;1}^m(1-\frac{1}{p_i})<br>$$</li>
</ol>
<blockquote>
<p>è¯æ˜ï¼š<br>$$\begin{aligned}<br>  è®¾n&#x3D;&amp;\prod_{i&#x3D;1}^mp_i^{x_i}\<br>  ç”±ç§¯æ€§&amp;å‡½æ•°å¾—\<br>  \phi(n)&#x3D;&amp;\prod_{i&#x3D;1}^{m}\phi(p_i^{x_i})\<br>  &#x3D;&amp;\prod_{i&#x3D;1}^{m}p_i^{x_i}(1-\frac{1}{p_i})\<br>  &#x3D;&amp;n\prod_{i&#x3D;1}^m(1-\frac{1}{p_i})<br>  \end{aligned}<br>$$</p>
</blockquote>
<ol start="6">
<li>$\phi(n)(n&gt;2)$æ˜¯å¶æ•°</li>
</ol>
<blockquote>
<p>è¯æ˜ï¼šç”±æ¬§å‡ é‡Œå¾—ç®—æ³•å¯çŸ¥$\forall i \in [1,n]$ä¸”$i$ä¸näº’è´¨ï¼Œåˆ™$(n-i)$ä¹Ÿä¸$n$äº’è´¨ã€‚å¹¶ä¸”$i \neq (n-i)$ï¼Œè¿™æ˜¯å› ä¸ºè‹¥ç›¸ç­‰ï¼Œæœ‰$2i&#x3D;n$ï¼Œæ­¤æ—¶$i(i&gt;1)$ä¸ä¸$n$äº’è´¨ã€‚æ‰€ä»¥ä¸$n$äº’è´¨çš„æ•°æˆå¯¹å‡ºç°ï¼Œ$\phi(n)(n&gt;2)$æ˜¯å¶æ•°ã€‚</p>
</blockquote>
<ol start="7">
<li><strong>è´¨å› å­çš„æ¬¡æ•°ä¸è¶…è¿‡æ¬§æ‹‰å‡½æ•°å€¼</strong><br>$$<br>è®¾n&#x3D;p^xsï¼Œå…¶ä¸­gcd(p,s)&#x3D;1ï¼Œåˆ™x\leq \phi(n)<br>$$</li>
</ol>
<blockquote>
<p>è¯æ˜ï¼š<br>$$<br>\begin{aligned}<br>\phi(n)&#x3D;&amp;\phi(p^x)\phi(s) \<br>\geq&amp; \phi(p^x) &#x3D; p^{x-1}(p-1)<br>\end{aligned}\<br>ä¸‹é¢è¯æ˜x\leq p^{x-1}(p-1)<br>$$<br>å–$p&#x3D;2$ï¼ŒéªŒè¯å¾—å½“$x&#x3D;1,2,3$æ—¶ä¸ç­‰å¼éƒ½æˆç«‹ã€‚ç”±å½’çº³æ³•å¯çŸ¥$p&#x3D;2$æ—¶ä¸ç­‰å¼æˆç«‹ã€‚å–$p&gt;2$ï¼Œç­‰å¼å·¦è¾¹ä¸å˜ï¼Œå³è¾¹å˜å¤§ï¼Œä¸ç­‰å¼ä»æˆç«‹ã€‚</p>
</blockquote>
<ol start="8">
<li>$\sum\limits_{d|n}\phi(d) &#x3D; n$</li>
</ol>
<blockquote>
<p>è¯æ˜ï¼š$\forall k \in [1,n]$ï¼Œå¯¹åº”æœ‰ä¸€ä¸ª$d&#x3D;gcd(k,n)$ã€‚æ‰€æœ‰å¯èƒ½çš„$d$å–éäº†$n$çš„æ‰€æœ‰å› å­ã€‚å¯¹$d|n$ï¼Œè€ƒè™‘å…¶å¯¹åº”çš„$k$ï¼Œä¸å¦¨è®¾$k&#x3D;k_1d,n&#x3D;k_2dï¼Œä¸”gcd(k_1,k_2)&#x3D;1,é‚£ä¹ˆk_1\leq k_2$ã€‚æ˜¾ç„¶$k_2&#x3D;\frac{n}{d}$æ˜¯å›ºå®šçš„ï¼Œé‚£ä¹ˆå¯èƒ½çš„$k_1$çš„å–å€¼æœ‰$\phi(k_2)&#x3D;\phi(\frac{n}{d})$ç§ã€‚æ‰€ä»¥<br>$$<br>n&#x3D;\sum\limits_{d|n}\phi(\frac{n}{d})&#x3D;\sum\limits_{d|n}\phi(d)<br>$$</p>
</blockquote>
<h2 id="å®šç†"><a href="#å®šç†" class="headerlink" title="å®šç†"></a>å®šç†</h2><h3 id="æ¬§æ‹‰å®šç†"><a href="#æ¬§æ‹‰å®šç†" class="headerlink" title="æ¬§æ‹‰å®šç†"></a>æ¬§æ‹‰å®šç†</h3><p>$$<br>å¯¹äºäº’è´¨çš„ä¸¤ä¸ªæ•°a,næœ‰\<br>a^{\phi(n)} \equiv 1 \mod n<br>$$</p>
<blockquote>
<p>è¯æ˜ï¼šè®¾$Z_n&#x3D;{x_1,x_2,\dotsc,x_{\phi(n)}}$ï¼Œå› $a,näº’è´¨$ï¼Œåˆ™$ax_i \mod n \in Z_n$ï¼›è€Œå¯¹$x_i\neq x_j$ï¼Œç”±æ¶ˆå»å¾‹æœ‰$ax_i\neq ax_j \mod n$ã€‚æ•…æ¨¡næ„ä¹‰ä¸‹$Z_n&#x3D;{ax_1,ax_2,\dotsc,ax_{\phi(n)}}$ã€‚</p>
<p>æ•…<br>$$<br>\prod_{i&#x3D;1}^{\phi(n)}x_i \equiv \prod_{i&#x3D;1}^{\phi(n)}ax_i \mod n\<br>$$<br>ç”±æ¶ˆå»å¾‹å¾—<br>$$<br>a^{\phi(n)} \equiv 1 \mod n<br>$$</p>
<p>æ¨è®ºï¼š<strong>è´¹é©¬å°å®šç†</strong>ã€‚</p>
</blockquote>
<h3 id="æ‰©å±•æ¬§æ‹‰å®šç†ï¼ˆæ¬§æ‹‰é™å¹‚ï¼‰"><a href="#æ‰©å±•æ¬§æ‹‰å®šç†ï¼ˆæ¬§æ‹‰é™å¹‚ï¼‰" class="headerlink" title="æ‰©å±•æ¬§æ‹‰å®šç†ï¼ˆæ¬§æ‹‰é™å¹‚ï¼‰"></a>æ‰©å±•æ¬§æ‹‰å®šç†ï¼ˆæ¬§æ‹‰é™å¹‚ï¼‰</h3><p>$$<br>æ¨¡mæ„ä¹‰ä¸‹\<br>a^c\equiv<br>\begin{cases}<br>    a^{c \mod \phi(m)}, \qquad &amp;a,mäº’è´¨\<br>    a^c, \qquad &amp;a,mä¸äº’è´¨ï¼Œc&lt;\phi(m)\<br>    a^{c \mod \phi(m)+\phi(m)}, \qquad &amp;a,mä¸äº’è´¨ï¼Œc\geq \phi(m)<br>\end{cases}<br>$$</p>
<blockquote>
<p>è¯æ˜ï¼š$å½“a,mäº’è´¨æ—¶$ï¼Œç”±æ¬§æ‹‰å®šç†çŸ¥$a^{\phi(m)}\equiv 1 \mod m$ï¼Œå®šç†æ˜¾ç„¶æˆç«‹ã€‚</p>
<p>$å½“a,mä¸äº’è´¨ï¼Œc&lt;\phi(m)æ—¶$ï¼Œå®šç†æ˜¾ç„¶æˆç«‹ã€‚</p>
<p>$å½“ a,mä¸äº’è´¨ï¼Œc\geq \phi(m)æ—¶$ï¼Œå–$a$çš„ä»»æ„è´¨å› å­$p$ï¼Œå³$a&#x3D;p^xsä¸”gcd(p,s)&#x3D;1$ï¼Œç”±æ¬§æ‹‰å®šç†çŸ¥<br>$$p^{\phi(s)}\equiv 1 \mod s$$<br>ç”±ç§¯æ€§å‡½æ•°çŸ¥$\phi(s)|\phi(m)$ï¼Œæ•…<br>$$p^{\phi(m)}\equiv 1 \mod s$$<br>åŒä½™æ–¹ç¨‹åŒä¹˜$p^x$(<strong>æ¢æ¨¡çš„å¦ä¸€ç§é€”å¾„</strong>)å¾—<br>$$<br>p^{\phi(m)+x} \equiv p^x \mod m<br>$$<br>ç”±<strong>æ¬§æ‹‰å‡½æ•°çš„æ€§è´¨7</strong>çŸ¥$x\leq \phi(m)$ï¼Œå·²çŸ¥$\phi(m)\leq c$ï¼Œæ‰€ä»¥<br>$$<br>x \leq \phi(m) \leq c\<br>p^c\equiv p^{x+(c-x)}\equiv p^{\phi(m)+x+(c-x)}\equiv p^{\phi(m)+c} \mod m<br>$$<br>ç”±$c(c\geq \phi(m))$çš„ä»»æ„æ€§å’Œæ•°å­¦å½’çº³æ³•å¾—<br>$$<br>p^c\equiv p^{c \mod \phi(m) + \phi(m)} \mod m \<br>$$<br>å¯¹$p$çš„å¹‚$p^k$ï¼Œæ˜“å¾—<br>$$<br>(p^k)^c\equiv p^{kc}\equiv p^{kc \mod \phi(m)+\phi(m)}\<br>\equiv p^{kc\mod \phi(m)+k\phi(m)}\equiv (p^k)^{c \mod \phi(m)+\phi(m)} \mod m<br>$$<br>å¯¹$a&#x3D;\prod\limits_{i&#x3D;1}^np_i^{x_i}$ï¼Œå¾—<br>$$ \begin{aligned}<br>  a^c\equiv &amp; \prod\limits_{i&#x3D;1}^n(p_i^{x_i})^c \<br>  \equiv &amp; \prod\limits_{i&#x3D;1}^n(p_i^{x_i})^{c \mod \phi(m)+\phi(m)} \<br>  \equiv &amp; a^{c \mod \phi(m) + \phi(m)} \mod m<br>\end{aligned}<br>$$</p>
</blockquote>
<hr>
<h1 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h1><h2 id="çº¿æ€§ç­›è´¨æ•°"><a href="#çº¿æ€§ç­›è´¨æ•°" class="headerlink" title="çº¿æ€§ç­›è´¨æ•°"></a>çº¿æ€§ç­›è´¨æ•°</h2><p>æ±‚$[1,n]$å†…çš„æ‰€æœ‰ç´ æ•°ã€‚</p>
<ol>
<li>ç®—æ³•æ ¸å¿ƒæ˜¯<strong>æ¯ä¸ªåˆæ•°åªè¢«å…¶æœ€å°è´¨å› å­ç­›åˆ°</strong>ã€‚</li>
<li>å½“å‰åˆ¤æ–­å®Œ$i$æ˜¯å¦è´¨æ•°ã€‚æ¥ä¸‹æ¥ç­›å»içš„å€æ•°ã€‚æšä¸¾å·²çŸ¥è´¨æ•°$p_j$ï¼Œç­›å»$p_j*i$ã€‚è‹¥$p_j$æ˜¯$i$çš„æœ€å°è´¨å› å­åˆ™breakã€‚è¿™æ˜¯å› ä¸ºiä»¥åç­›çš„æ•°éƒ½ä»¥$p_j$ä¸ºæœ€å°è´¨å› å­ï¼Œè¿™äº›æ•°è‚¯å®šèƒ½è¢«å…¶ä»–çš„$i$æšä¸¾$p_j$ç­›å»ï¼Œä¸å¿…é‡å¤ç­›ã€‚<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">getPrime</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// memset(vis, 0, sizeof(vis));</span></span><br><span class="line">    pcnt = <span class="number">0</span>;</span><br><span class="line">    vis[<span class="number">0</span>] = vis[<span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">2</span>; i&lt;=n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!vis[i]) prime[pcnt++] = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>; j&lt;pcnt &amp;&amp; prime[j]*i&lt;=n; ++j) &#123;</span><br><span class="line">            vis[prime[j]*i] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="çº¿æ€§ç­›æ¬§æ‹‰å‡½æ•°"><a href="#çº¿æ€§ç­›æ¬§æ‹‰å‡½æ•°" class="headerlink" title="çº¿æ€§ç­›æ¬§æ‹‰å‡½æ•°"></a>çº¿æ€§ç­›æ¬§æ‹‰å‡½æ•°</h2><p>æ±‚$[1,n]$å†…æ‰€æœ‰æ¬§æ‹‰å‡½æ•°å€¼</p>
<ol>
<li>ç®—æ³•æ ¸å¿ƒæ˜¯<strong>ç§¯æ€§å‡½æ•°</strong>å’Œ<strong>æ¬§æ‹‰å‡½æ•°æ€§è´¨4</strong></li>
<li>åœ¨çº¿æ€§ç­›çš„åŒæ—¶å®Œæˆæ¬§æ‹‰å‡½æ•°è®¡ç®—ã€‚å½“å‰åˆ¤æ–­å®Œ$i$æ˜¯å¦è´¨æ•°ï¼Œè‹¥æ˜¯åˆæ•°ï¼Œåˆ™å‡½æ•°å€¼åœ¨å‰é¢è®¡ç®—è¿‡äº†ï¼›è‹¥æ˜¯è´¨æ•°ï¼Œç›´æ¥èµ‹å€¼$\phi(i)&#x3D;i-1$ã€‚æšä¸¾å·²çŸ¥è´¨æ•°$p_j$æ—¶ï¼Œè‹¥$p_j$ä¸æ˜¯$i$çš„å› å­ï¼Œç”±ç§¯æ€§å‡½æ•°å¯çŸ¥$\phi(i\cdot p_j)&#x3D;\phi(i)\cdot \phi(p_j)&#x3D;\phi(i)\cdot (p_j-1)$ ; è‹¥$p_j$æ˜¯$i$çš„å› å­ï¼Œç”±<strong>æ€§è´¨4</strong>å¾—$\phi(i\cdot p_j)&#x3D;\phi(i)\cdot p_j$ï¼Œç„¶åbreakã€‚<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">getPhi</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// memset(phi, 0, sizeof(phi));</span></span><br><span class="line">    pcnt = <span class="number">0</span>;</span><br><span class="line">    phi[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">2</span>; i&lt;=n; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (phi[i] == <span class="number">0</span>) &#123;</span><br><span class="line">            prime[pcnt++] = i;</span><br><span class="line">            phi[i] = i - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j=<span class="number">0</span>; j&lt;pcnt &amp;&amp; i*prime[j]&lt;=n; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i % prime[j] == <span class="number">0</span>) &#123;</span><br><span class="line">                phi[i * prime[j]] = phi[i] * prime[j];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                phi[i * prime[j]] = phi[i] * (prime[j]<span class="number">-1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼ˆè¾—è½¬ç›¸é™¤æ³•ï¼‰"><a href="#æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼ˆè¾—è½¬ç›¸é™¤æ³•ï¼‰" class="headerlink" title="æ¬§å‡ é‡Œå¾—ç®—æ³•ï¼ˆè¾—è½¬ç›¸é™¤æ³•ï¼‰"></a><strong>æ¬§å‡ é‡Œå¾—ç®—æ³•</strong>ï¼ˆè¾—è½¬ç›¸é™¤æ³•ï¼‰</h2><p>æ±‚$gcd(a,b)$ã€‚</p>
<ol>
<li>$gcd(a, 0)$çš„ç»“æœæ˜¾ç„¶ç­‰äº$a$ã€‚</li>
<li>å½“$aï¼Œb$å…¨ä¸ä¸ºé›¶ï¼Œåˆ™$gcd(a,b) &#x3D; gcd(b, a \mod b )$ä½¿é—®é¢˜è§„æ¨¡å‡å°ã€‚<blockquote>
<p>è¯æ˜ï¼šä»¤$c&#x3D;a\mod b$,åˆ™$a&#x3D;kb+c$.è®¾$r$æ˜¯$a,b$çš„å…¬çº¦æ•°ï¼Œåˆ™$r|a-kb$å³$r|c$.è®¾$r$æ˜¯$b,c$çš„å…¬çº¦æ•°,åˆ™$r|kb+c$å³$r|a$.å¯è§$a,b$çš„å…¬çº¦æ•°å’Œ$b,a\mod b$çš„å…¬çº¦æ•°å®Œå…¨ç›¸åŒï¼Œåˆ™æœ€å¤§å…¬çº¦æ•°ä¹Ÿå¿…ç„¶ç›¸åŒã€‚</p>
<p>åº”ç”¨ï¼šä»$1$åˆ°$n(n&gt;2)$ä¸­ä¸$n$äº’è´¨çš„æ•°æˆå¯¹å‡ºç°ï¼Œæ¯ä¸€å¯¹å’Œä¸º$n$</p>
</blockquote>
</li>
</ol>
<h2 id="æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•"><a href="#æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•" class="headerlink" title="æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•"></a><strong>æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•</strong></h2><p>æ±‚$ax+by&#x3D;gcd(a,b)$çš„ä¸€ç»„æ•´æ•°è§£$x,y$ã€‚</p>
<ol>
<li>ç›´æ¥ç”±<strong>è´ç¥–å®šç†</strong>å¯çŸ¥æ•´æ•°è§£ä¸€å®šå­˜åœ¨ã€‚ï¼ˆè´ç¥–å®šç†ï¼šå­˜åœ¨æ•´æ•°$sï¼Œt$ä½¿å¾—$sa+tb&#x3D;gcd(a,b)$ï¼‰</li>
<li>ç”±è¾—è½¬ç›¸é™¤æ³•çŸ¥$bx&#39;+(a%b)y&#39;&#x3D;gcd(b,a%b)&#x3D;gcd(a,b)$çš„è§£ä¹Ÿå­˜åœ¨ã€‚ç”±æ•´æ•°é™¤æ³•å¾—<br>$$\begin{aligned}<br> bx&#39;+(a%b)y&#39;&#x3D;&amp;bx&#39;+(a-\frac{a}{b}b)y&#39;\<br> &#x3D;&amp;b(x&#39;-\frac{a}{b}y&#39;)+ay&#39;&#x3D;gcd(a,b)<br>\end{aligned}<br>$$</li>
<li>é€’å½’è¿›è¡Œæ±‚è§£ï¼Œç›´åˆ°$b&#x3D;0$ï¼Œæ˜¾ç„¶æœ‰è§£$1a+0b&#x3D;gcd(a,b)$ï¼Œä»¤$x&#x3D;1, y&#x3D;0$ï¼Œå›æº¯ï¼Œå¾—è§£$x&#x3D;y&#39;, y&#x3D;x&#39;-\frac{a}{b}y&#39;$</li>
<li>å®é™…å†™ä»£ç æ—¶ç”¨å¼•ç”¨ï¼Œå‡å°‘ä¸´æ—¶å˜é‡ã€‚<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">exgcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> &amp;d, <span class="type">int</span> &amp;x, <span class="type">int</span> &amp;y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">0</span>) &#123;</span><br><span class="line">        x = <span class="number">1</span>; y = <span class="number">0</span>;</span><br><span class="line">        d = a;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">exgcd</span>(b, a%b, d, y, x); <span class="comment">// xå’Œyå®Œæˆäº†äº¤æ¢</span></span><br><span class="line">    y -= a / b * x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="ç±»æ¬§å‡ é‡Œå¾—ç®—æ³•"><a href="#ç±»æ¬§å‡ é‡Œå¾—ç®—æ³•" class="headerlink" title="ç±»æ¬§å‡ é‡Œå¾—ç®—æ³•"></a><strong>ç±»æ¬§å‡ é‡Œå¾—ç®—æ³•</strong></h2><p>æ±‚ç­‰å·®æ•°åˆ—å¯¹æ¯ä¸€é¡¹åšæ•´æ•°é™¤æ³•çš„å’Œï¼Œå³<br>$$<br>lgcd(a, b, c, n) &#x3D; \sum_{i&#x3D;0}^{n-1}\lfloor \frac{ai+b}{c}\rfloor<br>$$</p>
<ol>
<li><p>é¦–å…ˆæ ‡å‡†åŒ–$a,b$ï¼Œä½¿æ»¡è¶³$a\geq 0, b\geq 0$ï¼Œåœ¨ç­”æ¡ˆä¸­é¢„å…ˆå‡å»è¡¥ä¸Šçš„$c$å³å¯ã€‚</p>
</li>
<li><p>æŠŠ$a,b$ä¸­å«$c$çš„è´¡çŒ®æ‹†å‡ºæ¥ï¼Œä½¿é—®é¢˜è§„æ¨¡å˜å°ã€‚ç­”æ¡ˆåŠ ä¸Š$n\lfloor \frac{b}{c}\rfloor + \frac{(n-1)n}{2}\lfloor \frac{a}{c}\rfloor$ã€‚å³<br>$$<br>\sum_{i&#x3D;0}^{n-1}\lfloor \frac{ai+b}{c}\rfloor &#x3D; \sum_{i&#x3D;0}^{n-1}\lfloor \frac{(a%c)i+(b%c)}{c}\rfloor + n\lfloor \frac{b}{c}\rfloor + \frac{(n-1)n}{2}\lfloor \frac{a}{c}\rfloor<br>$$<br>ç°åœ¨å¯ä»¥ä»¤$a&#39;&#x3D;a%c,\quad b&#39;&#x3D;b%c$ã€‚</p>
</li>
<li><p>è®¡ç®—$\sum\limits_{i&#x3D;0}^{n-1}\lfloor \frac{a&#39;i+b&#39;}{c}\rfloor$ï¼Œå¾—åˆ°çš„å•†è‚¯å®šä»‹äº$[0,\lfloor\frac{a&#39;(n-1)+b&#39;}{c}\rfloor]$ï¼Œè®¾æŸæ¬¡é™¤æ³•å¾—åˆ°çš„å•†æ˜¯$x$ï¼Œå¯ä»¥è®¤ä¸º$[1,x]$ä¸­æ¯ä¸€ä¸ªæ•°å¯¹ç­”æ¡ˆè´¡çŒ®äº†$1$ï¼Œè€ƒè™‘æ¯ä¸ªæ•°çš„æ€»è´¡çŒ®ï¼Œåˆ™<br>$$<br>\sum\limits_{i&#x3D;0}^{n-1}\lfloor \frac{a&#39;i+b&#39;}{c}\rfloor &#x3D; \sum_{j&#x3D;1}^{\lfloor\frac{a&#39;(n-1)+b&#39;}{c}\rfloor} \sum_{i&#x3D;0}^{n-1} [\lfloor \frac{a&#39;i+b&#39;}{c}\rfloor \geq j]<br>$$</p>
</li>
<li><p>æ¥ä¸‹æ¥å˜æ¢ä¸ç­‰å¼$\lfloor \frac{a&#39;i+b&#39;}{c}\rfloor \geq j$ã€‚ å–æ•´ç¬¦å·ä¸å½±å“å¤§äºç­‰äºå·çš„åˆ¤æ–­ï¼Œå¯ç›´æ¥å»æ‰ï¼›å¯ç›´æ¥é€šåˆ†ï¼›ç§»é¡¹å¾—$a&#39;i\geq jc-b&#39;$ã€‚æ•´æ•°é™¤æ³•çš„åŒé™¤ä¼šå½±å“å¤§äºç­‰äºå·çš„åˆ¤æ–­ï¼Œä½†ä¸å½±å“å¤§äºå·ï¼Œäºæ˜¯å³è¾¹å‡ä¸€ï¼Œä¸¤è¾¹åŒé™¤$a&#39;$å¾—$i&gt;\frac{jc-b&#39;-1}{a&#39;}$ã€‚</p>
</li>
<li><p>ä¸ºäº†æ–¹ä¾¿ç»Ÿè®¡åˆæ³•çš„$i$ï¼Œä¹Ÿä¸ºäº†è½¬åŒ–å½¢å¼æ»¡è¶³é€’å½’ï¼Œåˆ©ç”¨è¡¥é›†ç»Ÿè®¡æ•°é‡ã€‚å¯¹äºå›ºå®šçš„$j$ï¼Œ<br>$$ \begin{aligned}<br> \sum\limits_{i&#x3D;0}^{n-1} [i&gt;\frac{jc-b&#39;-1}{a&#39;}] &#x3D;&amp; n-\sum\limits_{i&#x3D;0}^{n-1} [i\leq\frac{jc-b&#39;-1}{a&#39;}] \<br> &#x3D;&amp; n-(\lfloor\frac{jc-b&#39;-1}{a&#39;}\rfloor+1)<br>\end{aligned}<br>$$</p>
</li>
<li><p>å¥—ä¸Šå‰ä¸€å±‚Sigmaï¼Œå¾—åˆ°é€’å½’å½¢å¼ï¼ˆ<strong>æ³¨æ„jå˜æˆä»0å¼€å§‹</strong>ï¼‰<br>$$<br>ä»¤m&#x3D;{\lfloor\frac{a&#39;(n-1)+b&#39;}{c}\rfloor} \<br>\sum_{j&#x3D;0}^{m-1}[n-(\lfloor\frac{(j+1)c-b&#39;-1}{a&#39;}\rfloor+1)] &#x3D; (n-1)m-lgcd(c, c-b&#39;-1,a&#39;,m)<br>$$</p>
</li>
</ol>
<h3 id="æ¨¡æ¿"><a href="#æ¨¡æ¿" class="headerlink" title="æ¨¡æ¿"></a>æ¨¡æ¿</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Sum&#123;(ai+b)/c&#125; for i=0..n-1</span></span><br><span class="line"><span class="function">LL <span class="title">lgcd</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c, LL n)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (n == <span class="number">0</span> || c == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	LL res = n*(b/c) + (n<span class="number">-1</span>)*n/<span class="number">2</span>*(a/c);</span><br><span class="line">	a = a % c; b = b % c;</span><br><span class="line">	LL m = (a*(n<span class="number">-1</span>)+b)/c;</span><br><span class="line">	<span class="keyword">return</span> (n<span class="number">-1</span>)*m - <span class="built_in">lgcd</span>(c, c-b<span class="number">-1</span>, a, m) + res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="æ‚é¡¹"><a href="#æ‚é¡¹" class="headerlink" title="æ‚é¡¹"></a>æ‚é¡¹</h1><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><ol>
<li>è´¨å› æ•°åˆ†è§£æ—¶ï¼Œè´¨å› æ•°è¦ä¹ˆå°äºç­‰äº$\sqrt{n}$ï¼Œè¦ä¹ˆç­‰äº$n$ã€‚ä¸è¦æ¼æ‰ç­‰äº$n$çš„æƒ…å†µã€‚</li>
<li>1e8+7ä»¥å†…çš„è´¨æ•°<br>æœ‰5761456ä¸ªï¼Œçº¦ä¸º6e6ï¼Œçº¦ä¸ºèŒƒå›´çš„1&#x2F;15ã€‚<br><strong>èŒƒå›´è¶Šå¤§ï¼Œè´¨æ•°çš„å æ¯”è¶Šå°</strong></li>
</ol>
]]></content>
      <tags>
        <tag>æ•°å­¦</tag>
      </tags>
  </entry>
  <entry>
    <title>åšå¼ˆ</title>
    <url>/2019/07/08/%E5%8D%9A%E5%BC%88/</url>
    <content><![CDATA[<h1 id="ç»„åˆæ¸¸æˆ"><a href="#ç»„åˆæ¸¸æˆ" class="headerlink" title="ç»„åˆæ¸¸æˆ"></a>ç»„åˆæ¸¸æˆ</h1><ol>
<li>ä¸¤ä¸ªæ¸¸æˆè€…è½®æµæ“ä½œ</li>
<li>æ¸¸æˆçš„çŠ¶æ€é›†æœ‰é™ï¼Œæ¯ç§çŠ¶æ€æœ€å¤šå‡ºç°ä¸€æ¬¡ï¼ˆæ¸¸æˆå¯ä»¥ç»“æŸï¼‰</li>
<li>æ— æ³•æ“ä½œçš„è¾“ï¼Œå¦ä¸€ä¸ªè·èƒœï¼ˆæ¸¸æˆå¿…æœ‰èƒœè´Ÿï¼‰</li>
<li>å…¬å¹³æ¸¸æˆã€‚ä¸¤ä¸ªæ¸¸æˆè€…é¢å¯¹ç›¸åŒçš„çŠ¶æ€å…è®¸æœ‰ç›¸åŒçš„æ“ä½œã€‚</li>
</ol>
<span id="more"></span>

<h3 id="çŠ¶æ€åˆ¤å®š"><a href="#çŠ¶æ€åˆ¤å®š" class="headerlink" title="çŠ¶æ€åˆ¤å®š"></a>çŠ¶æ€åˆ¤å®š</h3><ol>
<li>ä¸€ä¸ªçŠ¶æ€æ˜¯å¿…èƒœçŠ¶æ€(N)å½“ä¸”ä»…å½“å®ƒè‡³å°‘æœ‰ä¸€ä¸ªåç»§æ˜¯å¿…è´¥çŠ¶æ€ã€‚</li>
<li>ä¸€ä¸ªçŠ¶æ€æ˜¯å¿…è´¥çŠ¶æ€(P)å½“ä¸”ä»…å½“å®ƒçš„æ‰€æœ‰åç»§éƒ½æ˜¯å¿…èƒœçŠ¶æ€ã€‚</li>
<li>ç‰¹åˆ«åœ°ï¼Œæ²¡æœ‰åç»§çš„çŠ¶æ€æ˜¯å¿…è´¥çŠ¶æ€ã€‚</li>
</ol>
<h3 id="åæ‰‹å¿…èƒœçš„å¿…è¦æ¡ä»¶"><a href="#åæ‰‹å¿…èƒœçš„å¿…è¦æ¡ä»¶" class="headerlink" title="åæ‰‹å¿…èƒœçš„å¿…è¦æ¡ä»¶"></a>åæ‰‹å¿…èƒœçš„å¿…è¦æ¡ä»¶</h3><p>å¦‚æœåæ‰‹æœ‰å¿…èƒœç­–ç•¥ï¼Œåˆ™æ— è®ºå…ˆæ‰‹æ€ä¹ˆå–ï¼Œéƒ½ä¼šå­˜åœ¨åç»§å¯å¯¼è‡´å¿…è´¥çŠ¶æ€ï¼ˆå³å…ˆæ‰‹çš„æ‰€æœ‰åç»§éƒ½æ˜¯å¿…èƒœï¼‰ã€‚è‹¥å…ˆæ‰‹èƒ½ç›´æ¥åˆ°è¾¾å¿…è´¥çŠ¶æ€ï¼Œåˆ™åæ‰‹å¿…è¾“ã€‚</p>
<p>å¦‚Chomp!æ¸¸æˆï¼ˆm*næ£‹ç›˜ï¼Œæ¯æ¬¡å–æŸä¸ªç‚¹çš„æ‰€æœ‰å³ä¸Šæ ¼å­ï¼Œå–åˆ°æœ€åä¸€ä¸ªè¾“ï¼‰ä¸­ï¼Œåªè¦æ ¼å­å¤§äº1ï¼Œå…ˆæ‰‹å–æœ€å³ä¸Šçš„ä¸€ä¸ªæ ¼å­ï¼Œè‹¥åæ‰‹èƒ½å¯¼è‡´å¿…è´¥çŠ¶æ€ï¼Œåˆ™å¼€å±€å…ˆæ‰‹æ¨¡ä»¿åæ‰‹çš„ç­–ç•¥å³å¯ã€‚æ•…æ ¼å­å¤§äº1æ—¶åæ‰‹å¿…è´¥ã€‚</p>
<h2 id="SGå‡½æ•°"><a href="#SGå‡½æ•°" class="headerlink" title="SGå‡½æ•°"></a>SGå‡½æ•°</h2><p>è®¾æœ‰çŠ¶æ€xï¼Œä»¤SG(x) &#x3D; mex(S), Sä¸ºxçš„æ‰€æœ‰åç»§çŠ¶æ€çš„SGå€¼çš„é›†åˆï¼Œmex(S)ä¸ºä¸åœ¨é›†åˆä¸­çš„æœ€å°éè´Ÿæ•´æ•°ã€‚å¯¹äºæ²¡æœ‰åç»§çš„çŠ¶æ€ï¼ŒSG&#x3D;0ï¼Œå› ä¸ºSæ˜¯ç©ºé›†ã€‚å…¶ä½™çš„SGå€¼å¯ç”±é€’æ¨å¾—åˆ°ã€‚<br>å½“ä¸”ä»…å½“SG(x) &#x3D;&#x3D; 0, xæ˜¯å¿…è´¥çŠ¶æ€ã€‚</p>
<h2 id="SGå®šç†"><a href="#SGå®šç†" class="headerlink" title="SGå®šç†"></a>SGå®šç†</h2><p>ä¸€ä¸ªæ€»æ¸¸æˆçš„SGå€¼ç­‰äºå­æ¸¸æˆçš„SGå€¼çš„Nimå’Œï¼ˆå¼‚æˆ–å’Œï¼‰</p>
<h3 id="è¯æ˜"><a href="#è¯æ˜" class="headerlink" title="è¯æ˜"></a>è¯æ˜</h3><ol>
<li>è¯æ˜PçŠ¶æ€çš„æ‰€æœ‰åç»§éƒ½æ˜¯NçŠ¶æ€<ol>
<li>å¼‚æˆ–å’Œä¸ºé›¶ï¼Œå¯¹è½¬ç§»ä»»æ„ä¸€çŠ¶æ€ï¼Œåˆ™å¼‚æˆ–å’Œå¿…ä¸ä¸ºé›¶ï¼ˆæ–°çŠ¶æ€å¼‚æˆ–æ—§çŠ¶æ€ä¸ä¸ºé›¶ï¼‰ï¼Œå³åç»§å¿…ä¸ºN</li>
</ol>
</li>
<li>è¯æ˜NçŠ¶æ€çš„åç»§å­˜åœ¨PçŠ¶æ€<ol>
<li>å¼‚æˆ–å’Œä¸ä¸ºé›¶ï¼Œ</li>
</ol>
</li>
</ol>
<h3 id="Nimæ¸¸æˆ"><a href="#Nimæ¸¸æˆ" class="headerlink" title="Nimæ¸¸æˆ"></a>Nimæ¸¸æˆ</h3><p>æœ‰nå †ç«æŸ´ï¼Œæ¯å †æœ‰aiæ ¹ç«æŸ´ã€‚æ¯æ¬¡é€‰æ‹©ä¸€å †å–èµ°ä»»æ„æ ¹ï¼Œä¸èƒ½å–çš„æ¸¸æˆè€…è¾“ã€‚</p>
<p>è€ƒè™‘åªæœ‰ä¸€å †çš„æƒ…å†µï¼Œè®¾å‰©ä½™ç«æŸ´æ•°ä¸ºxã€‚è‹¥x&#x3D;&#x3D;0ï¼Œæ²¡æœ‰åç»§çŠ¶æ€ï¼ŒSG(0) &#x3D; 0; è‹¥x&#x3D;&#x3D;1ï¼Œæ‰€æœ‰åç»§çŠ¶æ€çš„SGé›†åˆ{0}ï¼Œåˆ™SG(1) &#x3D; 1; è‹¥x&#x3D;&#x3D;2ï¼Œå¯¹åº”çš„S&#x3D;&#x3D;{0ï¼Œ1}ï¼ŒSG(2) &#x3D; 2; å½’çº³æ³•è¯æ˜SG(x) &#x3D; x;</p>
<p>åº”ç”¨SGå®šç†ï¼Œå¯¹äºå¤šå †æ¸¸æˆï¼Œæ€»æ¸¸æˆSGå€¼ä¸ºæ‰€æœ‰å­æ¸¸æˆçš„SGå€¼çš„Nimå’Œï¼Œå³æ‰€æœ‰å †ç«æŸ´æ•°çš„å¼‚æˆ–å’Œã€‚å½“ä¸”ä»…å½“å¼‚æˆ–å’Œä¸º0ï¼Œå…ˆæ‰‹å¿…è´¥ã€‚</p>
<h2 id="ç»„åˆæ¸¸æˆé¢˜è§£æ³•"><a href="#ç»„åˆæ¸¸æˆé¢˜è§£æ³•" class="headerlink" title="ç»„åˆæ¸¸æˆé¢˜è§£æ³•"></a>ç»„åˆæ¸¸æˆé¢˜è§£æ³•</h2><p>å°èŒƒå›´å†…æš´åŠ›è®¡ç®—å­æ¸¸æˆSGå€¼ï¼Œæ‰¾è§„å¾‹æ‰¾åˆ°SGå…¬å¼ã€‚</p>
<h1 id="åšå¼ˆæœç´¢"><a href="#åšå¼ˆæœç´¢" class="headerlink" title="åšå¼ˆæœç´¢"></a>åšå¼ˆæœç´¢</h1><p>CF ROUND 460 DIV2 F</p>
<h1 id="é¢˜"><a href="#é¢˜" class="headerlink" title="é¢˜"></a>é¢˜</h1><ol>
<li>åœ†æ¡Œæ”¾åœ†ç›˜<ol>
<li>å¯¹ç§°æ€§ã€‚å…ˆæ‰‹å é¢†åœ†å¿ƒï¼Œåé¢è¢«ä¸€æ­¥éƒ½æ¨¡ä»¿å¦ä¸€æ–¹ã€‚</li>
</ol>
</li>
<li>ç¡¬å¸ç¯å–1-Kè¿ç»­<ol>
<li>åˆ†ç±»è®¨è®ºK</li>
</ol>
</li>
<li>å¨ä½å¤«åšå¼ˆï¼šä¸¤å †çŸ³å­ï¼Œå–ä»»æ„ä¸ªæ—¶å¯å¯¹ä¸¤å †åŒæ—¶æ“ä½œ<ol>
<li>è®°ç»“è®º(x0&#x3D;0, y0&#x3D;0),(xk&#x3D;mex{xi,yi}, yk&#x3D;xk+k)å¿…è´¥</li>
<li>$a_k&#x3D;\frac{\sqrt{5}+1}{2}k$</li>
<li>æ‰©å±•ï¼šä¸‰å †ï¼Œå¯åŒæ—¶æ“ä½œä¸¤å †<ol>
<li>å¿…è´¥æ€å°‘ï¼Œè·³è¿‡å¿…èƒœæ€</li>
</ol>
</li>
</ol>
</li>
<li>æ¯æ¬¡ä¸€å †åˆ†åˆ«æˆå¼‚æˆ–åŠ æ•°ä¸¤å †ï¼ˆæ¯å †å°äºæºå †ï¼‰</li>
<li>åNIMæ¸¸æˆï¼Œå…ˆæ‰‹å¿…èƒœæ¡ä»¶<ol>
<li>æ¯å †çŸ³å­åªæœ‰ä¸€ä¸ªï¼ŒNIMå’Œä¸ºé›¶</li>
<li>æœ‰ä¸€å †çŸ³å­å¤šäºä¸€ä¸ªï¼ŒNIMå’Œä¸ä¸ºé›¶</li>
</ol>
</li>
<li>SJå®šç†ï¼ˆæ³›åŒ–åNIMæ¸¸æˆï¼‰å…ˆæ‰‹å¿…èƒœæ¡ä»¶<ol>
<li>æ¯ä¸ªå­æ¸¸æˆSGå€¼&lt;&#x3D;1ï¼ŒSGå¼‚æˆ–å’Œä¸ºé›¶</li>
<li>å­˜åœ¨ä¸€ä¸ªå­æ¸¸æˆSG&gt;1ï¼ŒSGå¼‚æˆ–å’Œä¸ä¸ºé›¶</li>
</ol>
</li>
<li>Every-SGç­–ç•¥<ol>
<li>å¿…èƒœæ€ä½¿æ­¥éª¤å°½é‡é•¿</li>
<li>å¿…è´¥æ€ä½¿æ­¥éª¤å°½é‡çŸ­</li>
<li>å…ˆæ‰‹è·èƒœå……è¦æ¡ä»¶ï¼šæ‰€æœ‰å•ä¸€æ¸¸æˆSGå€¼æœ€å¤§å€¼æ˜¯å¥‡æ•°</li>
</ol>
</li>
<li>æœ‰æ ¹æ— å‘å›¾åˆ è¾¹æ¸¸æˆ<ol>
<li>è‹¥æ— ç¯ï¼ŒColonå®šç†</li>
<li>å¯èƒ½æœ‰ç¯ï¼ŒFushionç­‰ä»·ç¼©ç¯å˜æ ‘</li>
</ol>
</li>
<li>é½è‚¯å¤šå¤«å®šç†ï¼šä»»ä½•æ­£æ•´æ•°å¯ä»¥å”¯ä¸€çš„è¡¨ç¤ºä¸ºè‹¥å¹²ä¸ªä¸è¿ç»­çš„æ–æ³¢é‚£å¥‘æ•°ä¹‹å’Œ</li>
<li>åŠ¨æ€å‡æ³•æ¸¸æˆï¼ˆä¸€å€ï¼Œä¸¤å€ï¼Œkå€ï¼‰</li>
<li>ç¿»ç¡¬å¸ï¼Œæœ€å³å¿…é¡»ç”±æ­£å˜å<ol>
<li>å¤šç§æ‰©å±•</li>
<li>æ‰“è¡¨å§</li>
<li>tartanå®šç†<ol>
<li>äºŒç»´ç¡¬å¸åˆ†è§£æˆä¸€ç»´ç¡¬å¸çš„ç§¯ï¼Œlogn2æ±‚nimç§¯ã€‚è¿™ç§ç§¯æœ‰ç»“åˆå¾‹ï¼Œå¯æ‰©å±•åˆ°æ›´é«˜ç»´</li>
<li></li>
</ol>
</li>
</ol>
</li>
</ol>
]]></content>
      <tags>
        <tag>æ•°å­¦</tag>
      </tags>
  </entry>
  <entry>
    <title>å¾®ç§¯åˆ†å­¦å¤‡å¿˜å½•</title>
    <url>/2019/02/03/%E5%BE%AE%E7%A7%AF%E5%88%86%E5%AD%A6%E5%A4%87%E5%BF%98%E5%BD%95/</url>
    <content><![CDATA[<!-- ä»Šæ—¥ç«‹å¿—ï¼Œåšä¸€ä¸ªå¯¹æ•°å­¦æ•æ„Ÿçš„å¤§å­¦ç”Ÿï¼ -->

<span id="more"></span>

<h1 id="å‡å€¼ä¸ç­‰å¼"><a href="#å‡å€¼ä¸ç­‰å¼" class="headerlink" title="å‡å€¼ä¸ç­‰å¼"></a>å‡å€¼ä¸ç­‰å¼</h1><h2 id="å››ç§å‡å€¼"><a href="#å››ç§å‡å€¼" class="headerlink" title="å››ç§å‡å€¼"></a>å››ç§å‡å€¼</h2><ol>
<li>å¹³æ–¹å¹³å‡å€¼ $Q_n&#x3D;\sqrt{ \frac{\sum_{i&#x3D;1}^n x_i^2}{n} }$</li>
<li>ç®—æœ¯å¹³å‡å€¼ $A_n&#x3D;\frac{\sum_{i&#x3D;1}^n x_i}{n}$</li>
<li>å‡ ä½•å¹³å‡å€¼ $G_n&#x3D;\sqrt[n]{x_1 x_2 \cdots x_n}$</li>
<li>è°ƒå’Œå¹³å‡å€¼ $H_n&#x3D;\frac{1}{\sum_{i&#x3D;1}^n {\frac{1}{x_i}}}$</li>
</ol>
<h2 id="å››ç§å‡å€¼çš„å¤§å°å…³ç³»"><a href="#å››ç§å‡å€¼çš„å¤§å°å…³ç³»" class="headerlink" title="å››ç§å‡å€¼çš„å¤§å°å…³ç³»"></a>å››ç§å‡å€¼çš„å¤§å°å…³ç³»</h2><p>$$ Q_n \geq A_n \geq G_n \geq H_n $$</p>
<h3 id="è¯æ˜-G-n-leq-A-n"><a href="#è¯æ˜-G-n-leq-A-n" class="headerlink" title="è¯æ˜$G_n \leq A_n$"></a>è¯æ˜$G_n \leq A_n$</h3><ul>
<li><p>åˆ†æ: é‡‡ç”¨æ•°å­¦å½’çº³æ³•. æ˜“è¯$n&#x3D;2$çš„æƒ…å†µ. ä»¤$a&#x3D;A_n$. è¦ä»n-1æ¨å‡ºn, å…ˆè®©å¼€næ¬¡æ–¹è½¬ä¸ºå¹‚æ¬¡. å·¦ç«¯è®¾æ³•å˜ä¸º$a_1a_2\cdots a_n$, å³ç«¯è®¾æ³•å˜ä¸º$a^{n-1}\times a$. åŸå³è¾¹æ˜¯n-1ä¸ªæ•°æ±‚å‡, è¦å˜æˆnä¸ªæ•°æ±‚å‡, éœ€è¦ä¿®æ”¹ç¬¬ä¸€é¡¹ä»¥åŠ å…¥$a_n$. ä»¤$\frac{a_2+\cdots +a_{n-1}+x}{n-1}&#x3D;a$, å·¦è¾¹åªèƒ½å¹³åˆ†n-1ä»½, å°‘äº†ä¸€ä»½æ°ä¸ºa, åˆ™$x&#x3D;a_1+a_n-a$. åŸå·¦è¾¹å¯¹åº”åœ°è¦å°†$a_1$æ›¿æ¢æˆ$a_1+a_n-a$, ä¸”æœ€åè¡¥ä¹˜äº†$a$, æ‰€ä»¥åº”è¯¥å»ºç«‹å…³ç³»$a_1a_n$~$a(a_1+a_n-a)$. ä»ä¸ç­‰å¼$(a-a_1)(a-a_n)\leq 0$å¯ä»¥è·å¾—è¿™ä¸ªå…³ç³».</p>
</li>
<li><p>è¯æ˜:<br>  ä¸å¦¨è®¾$a_1, a_2$ä¸ºæ‰€æœ‰é¡¹ä¸­çš„æœ€å°,æœ€å¤§å€¼.  $a&#x3D;\frac{a_1+\cdots +a_n}{n}$, åˆ™$a_1\leq a\leq a_n$.<br>  $$(a-a_1)(a-a_n)\leq 0 \Rightarrow a_1a_n \leq a(a_1+a_n-a)$$<br>  æ˜“è¯n&#x3D;2æ—¶æˆç«‹.<br>  å‡è®¾å½“n-1æ—¶æˆç«‹,å³<br>  $$\sqrt[n-1]{a_2+\cdots +a_{n-1}+(a_1+a_n-a)}\leq \frac{a_2+\cdots +a_{n-1}+(a_1+a_n-a)}{n-1}&#x3D;a$$<br>  $$a_1a_2\cdots a_n\leq a2+\cdots +a_{n-1}+a(a_1+a_n-a)\leq a^{n-1}\cdot a&#x3D;a^n $$<br>  $$\therefore\sqrt[n]{a_1\cdots a_n}\leq a&#x3D;\frac{a_1+\cdots +a_n}{n}$$</p>
</li>
</ul>
<h1 id="æ•°åˆ—"><a href="#æ•°åˆ—" class="headerlink" title="æ•°åˆ—"></a>æ•°åˆ—</h1><h2 id="æ”¶æ•›æ•°åˆ—å®šä¹‰"><a href="#æ”¶æ•›æ•°åˆ—å®šä¹‰" class="headerlink" title="æ”¶æ•›æ•°åˆ—å®šä¹‰"></a>æ”¶æ•›æ•°åˆ—å®šä¹‰</h2><p>$è®¾æ•°åˆ—a_nåŠå¸¸æ•°a, è‹¥\forall \epsilon &gt; 0, \exists N \in Z^+,å½“n&gt;Næ—¶, æ€»æœ‰|a_n-a|&lt;\epsilon, åˆ™ç§°æ•°åˆ—{a_n}çš„æé™ä¸ºa, è®°ä½œ$<br>$$\lim\limits_{n\to \infty}a_n&#x3D;aæˆ–a_n \to a(n\to \infty)$$<br>$æ­¤æ—¶ä¹Ÿç§°æ•°åˆ—æ”¶æ•›, å¦åˆ™ç§°æ•°åˆ—å‘æ•£.$</p>
<h2 id="æ”¶æ•›æ•°åˆ—çš„æ€§è´¨"><a href="#æ”¶æ•›æ•°åˆ—çš„æ€§è´¨" class="headerlink" title="æ”¶æ•›æ•°åˆ—çš„æ€§è´¨"></a>æ”¶æ•›æ•°åˆ—çš„æ€§è´¨</h2><ul>
<li>æ”¶æ•›æ•°åˆ—çš„æé™å”¯ä¸€<ul>
<li>è¯æ³•: åè¯æ³•.å–$\epsilon &#x3D; \frac{b-a}{2}$, å½“$n&gt;max{N_1, N_2}, \frac{a+b}{2} &lt; a_n &lt; \frac{a+b}{2}$, çŸ›ç›¾.</li>
</ul>
</li>
<li>æ”¶æ•›æ•°åˆ—å¿…æœ‰ç•Œ<ul>
<li>$\epsilon å–1, n&gt;N_1æ—¶, a-1&lt;a_n&lt;a+1. å†è€ƒè™‘å‰N_1æœ‰é™é¡¹, å¯çŸ¥æœ‰ç•Œ$</li>
<li>å‡½æ•°æ”¶æ•›æ— æ³•ä¿è¯å‰æœ‰é™é¡¹</li>
<li>æ¨è®º: æ— ç•Œæ•°åˆ—å‘æ•£.</li>
<li>æœ‰ç•Œä¸ä¸€å®šæ”¶æ•›(è·³è·ƒå‹)</li>
<li>å‘æ•£ä¸ä¸€å®šæ— ç•Œ(è·³è·ƒå‹)</li>
</ul>
</li>
<li>æ”¶æ•›æ•°åˆ—çš„ä¸ç­‰å¼æ€§è´¨<ul>
<li>$\lim a_n &lt; \lim b_n, åˆ™\exists N, å½“n&gt;N, a_n&lt;b_n$</li>
<li>åä¹‹ä¸ä¸€å®šæˆç«‹, æé™å¯èƒ½ç›¸ç­‰</li>
<li>æ¨è®º: è‹¥$a_n \geq b_n,$åˆ™$a \geq b$</li>
</ul>
</li>
<li>ä¿å·æ€§<ul>
<li>è‹¥æé™å€¼éé›¶, åˆ™æœ‰è¿ç»­æ— ç©·å¤šé¡¹çš„ç¬¦å·å’Œæé™å€¼ç›¸åŒ</li>
<li>ä¿å·æ€§æ˜¯ä¸ç­‰å¼æ€§è´¨çš„æ¨è®º</li>
<li>æ¨è®º: è‹¥æœ‰è¿ç»­æ— ç©·å¤šé¡¹éè´Ÿ(éæ­£), åˆ™æé™å€¼éè´Ÿ(éæ­£) (æé™å€¼å¯èƒ½ä¸º0).</li>
</ul>
</li>
<li>ä¸¤æ•°åˆ—æé™çš„å››åˆ™è¿ç®—<ul>
<li>æ¡ä»¶æ˜¯ä¸¤æ•°åˆ—æé™å­˜åœ¨. ä½œä¸ºé™¤æ•°çš„æé™éé›¶.</li>
<li>æ¨å¹¿: æœ‰é™é¡¹æ•°åˆ—æé™å¯è¿›è¡Œå››åˆ™è¿ç®—.<ul>
<li>æ¡ä»¶: å„é¡¹æ•°åˆ—æé™å­˜åœ¨, ä½œä¸ºé™¤æ•°çš„æé™éé›¶.</li>
<li>å¯¹äºåˆ†å¼, è°ƒæ•´åˆ†å­åˆ†æ¯ä½¿ä¸Šä¸‹æé™å­˜åœ¨, å¥—ç”¨å››åˆ™è¿ç®—åŒ–å‡ºåˆ†å­åˆ†æ¯æé™.</li>
<li>å¯¹äº$\infty -\infty$å‹, é€šåˆ†æˆ–æœ‰ç†åŒ–æˆåˆ†å¼.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="å®šç†"><a href="#å®šç†" class="headerlink" title="å®šç†"></a>å®šç†</h2><blockquote>
<p>æ”¹å˜æ•°åˆ—çš„æœ‰é™é¡¹, æ•°åˆ—çš„æ”¶æ•›æ€§å’Œæé™ä¸å˜</p>
</blockquote>
<ul>
<li>è‹¥æ”¶æ•›æ•°åˆ—è¢«æ”¹å˜, è®¾è¢«æ”¹å˜çš„æœ€åä¸€é¡¹æ˜¯k, å–$N&#x3D;\max(k, N_1)$, å°±èƒ½ç»´æŒ$\epsilon-N$å®šä¹‰.</li>
<li>è‹¥å‘æ•£æ•°åˆ—æ”¹å˜æœ‰é™é¡¹, å˜ä¸ºæ”¶æ•›æ•°åˆ—, åˆ™ä¸ä¸ŠçŸ›ç›¾.</li>
</ul>
<h2 id="lim-limits-n-rightarrow-infty-a-n-x3D-a-epsilon-N-å®šä¹‰"><a href="#lim-limits-n-rightarrow-infty-a-n-x3D-a-epsilon-N-å®šä¹‰" class="headerlink" title="$\lim\limits_{n\rightarrow\infty} a_n&#x3D;a$ $\epsilon-N$å®šä¹‰"></a>$\lim\limits_{n\rightarrow\infty} a_n&#x3D;a$ $\epsilon-N$å®šä¹‰</h2><blockquote>
<p>$\forall \epsilon &gt;0, \exists N\in Z^*, å½“n&gt;Næ—¶, æ€»æœ‰|a_n-a|&lt;\epsilon.$</p>
</blockquote>
<h2 id="å¸¸è§æ•°åˆ—æé™"><a href="#å¸¸è§æ•°åˆ—æé™" class="headerlink" title="å¸¸è§æ•°åˆ—æé™"></a>å¸¸è§æ•°åˆ—æé™</h2><ul>
<li>$\lim\limits_{n\rightarrow\infty} \sqrt[n]{n}&#x3D;1$<ul>
<li>åˆ†æ: ä»¤$h_n&#x3D;\sqrt[n]{n}-1&gt;0$, éš¾ä»¥ç›´æ¥ç”±$h_n-0&lt;\epsilon$æ¨ç®—å‡º$N$, åº”å½“é€‚å½“æ”¾å¤§$h_n$. å˜å½¢å¾—$n&#x3D;(h_n+1)^n$, åº”ä»¤å³è¾¹ç¼©å°å¹¶æŠ›å¼ƒnæ¬¡æ–¹. ç”¨äºŒé¡¹å¼å®šç†å±•å¼€, æœ€ç»ˆå¾—åˆ°$h_n&lt;æŸä¸ªå€¼$.</li>
<li>è¯æ˜:<br>  ä»¤$h_n&#x3D;\sqrt[n]{n}-1&gt;0$, åˆ™<br>  $$n&#x3D;(h_n+1)^n&#x3D;1+nh_n+\frac{n(n-1)}{2}h_n^2+\cdots+h_n^n&gt;1+\frac{n(n-1)}{2}h_n^2$$<br>  $$\Rightarrow n&gt;1+\frac{n(n-1)}{2}h_n^2\Rightarrow h_n&lt;\sqrt{\frac{2}{n}}$$<br>  ä»¤$\sqrt{\frac{2}{n}}&lt;\epsilon$, å¾—$n&gt;\frac{2}{\epsilon^2}$<br>  $\therefore \forall \epsilon &gt;0, å–N&gt;\frac{2}{\epsilon^2}, åˆ™å½“n&gt;Næ—¶,æ€»æœ‰|\sqrt[n]{n}-1|&lt;\epsilon$.<br>  $\therefore \lim\limits_{n\rightarrow\infty} \sqrt[n]{n}&#x3D;1$</li>
</ul>
</li>
<li>$\lim\limits_{n\to\infty} \sqrt[n]{k\frac{1}{n}} &#x3D; 1(k&gt;0)$</li>
<li>$q^n \to 0(|q|&lt;1, n \to \infty)$<ul>
<li>åˆ†æ: è‹¥q&#x3D;0... è‹¥q!&#x3D;0, å–n &gt; $[\frac{\ln \epsilon}{\ln |q|}]$.</li>
</ul>
</li>
<li>$\lim\limits_{n \to \infty} \sqrt[n]{a}&#x3D;1$<ul>
<li>åˆ†æ: è‹¥a&#x3D;1... è‹¥a&gt;1, å¼ºè¡Œ$\log_a$. è‹¥a&lt;1, å€’æ•°.</li>
</ul>
</li>
<li>$\lim\limits_{n\to \infty} \sqrt{n+1}-\sqrt{n} &#x3D; 0$<ul>
<li>åˆ†æ: åˆ†å­æœ‰ç†åŒ–å, åˆ†æ¯ç¼©å°(é€‚å½“æ”¾å¤§æ³•).</li>
</ul>
</li>
<li>$\lim\limits_{n\to \infty} \frac{1}{n^k} &#x3D; 0(k&gt;0)$</li>
<li>$\lim\limits_{n\to \infty} \frac{n^k}{a^n} &#x3D; 0$<ul>
<li>åˆ†æ: å•è°ƒæœ‰ç•Œ. æ±‚ä¸€ä¸‹$\lim\limits_{n\to\infty} \frac{x_{n+1}}{x_n}$. è¯æ˜æ”¶æ•›åå¯¹é€’æ¨å¼ä¸¤è¾¹æ±‚æé™.</li>
</ul>
</li>
<li>$\lim\limits_{n\to \infty} \frac{a^n}{n!} &#x3D; 0$</li>
<li>$\lim\limits_{n\to\infty} åˆ†å¼: è§‚å¯Ÿæœ€é«˜æ¬¡$</li>
<li>$\lim\limits_{n\to\infty} \sqrt[n]{a_1^n+\cdots+a_m^n} &#x3D; max(a_1,\cdots,a_m), a_i&gt;0$ ä¸‹æ–‡åˆ†æ</li>
<li>$\lim\limits_{n\to\infty}(1+\frac{1}{n})^k &#x3D; 1, kæ˜¯ä»»æ„å¸¸æ•°$ ä¸‹æ–‡åˆ†æ. <strong>è¿™æ„å‘³ç€ä¸å¯¹æ¥ä¸‹æ¥ä¸€ä¸ªæé™é€ æˆå½±å“</strong></li>
<li>$\lim\limits_{n\to\infty}(1+\frac{1}{n})^n&#x3D;e(eçš„ä¸€ä¸ªå®šä¹‰)$ æ”¶æ•›æ€§åœ¨ä¸‹æ–‡åˆ†æ</li>
<li>$\lim\limits_{n\to\infty} \frac{1}{0!}+\frac{1}{1!}+\frac{1}{2!}+\frac{1}{3!}+\cdots + \frac{1}{n!} &#x3D; e$ å¤¹é€¼å‡†åˆ™, è¯¾ä»¶1_2-3 22é¡µ</li>
</ul>
<h2 id="æ— ç©·å¤§æ•°åˆ—å®šä¹‰"><a href="#æ— ç©·å¤§æ•°åˆ—å®šä¹‰" class="headerlink" title="æ— ç©·å¤§æ•°åˆ—å®šä¹‰"></a>æ— ç©·å¤§æ•°åˆ—å®šä¹‰</h2><blockquote>
<p>$è®¾æ•°åˆ—a_nåŠå¸¸æ•°a, è‹¥\forall M &gt; 0, \exists N \in Z^+,å½“n&gt;Næ—¶, æ€»æœ‰|a_n| &gt;M, åˆ™ç§°æ•°åˆ—{a_n}æ˜¯æ— ç©·å¤§æ•°åˆ—, æˆ–ç§°{a_n}è¶‹äºæ— ç©·å¤§, è®°ä½œ$<br>$$\lim\limits_{n\to \infty}a_n&#x3D;\inftyæˆ–a_n \to \infty(n\to \infty)$$<br>$ç‰¹åˆ«åœ°, æœ‰æ­£æ— ç©·å¤§æ•°åˆ—å’Œè´Ÿæ— ç©·å¤§æ•°åˆ—, è®°ä½œ.\lim\limits_{n\to \infty}a_n&#x3D;+\inftyæˆ–\lim\limits_{n\to \infty}a_n&#x3D;-\infty$</p>
</blockquote>
<ul>
<li>æ— ç©·å¤§æ•°åˆ—æ˜¯å‘æ•£æ•°åˆ—(æé™ä¸å­˜åœ¨), æ˜¯æ— ç•Œæ•°åˆ—</li>
<li>å‘æ•£æ•°åˆ—ä¸ä¸€å®šæ˜¯æ— ç©·å¤§æ•°åˆ—</li>
<li>æ— ç•Œæ•°åˆ—ä¸ä¸€å®šæ˜¯æ— ç©·å¤§æ•°åˆ—</li>
</ul>
<h2 id="æ•°åˆ—æé™å­˜åœ¨çš„å‡†åˆ™"><a href="#æ•°åˆ—æé™å­˜åœ¨çš„å‡†åˆ™" class="headerlink" title="æ•°åˆ—æé™å­˜åœ¨çš„å‡†åˆ™"></a>æ•°åˆ—æé™å­˜åœ¨çš„å‡†åˆ™</h2><h3 id="å¤¹é€¼å®šç†"><a href="#å¤¹é€¼å®šç†" class="headerlink" title="å¤¹é€¼å®šç†"></a>å¤¹é€¼å®šç†</h3><ol>
<li>$\lim\limits_{n\to\infty}a_n&#x3D;\lim\limits_{n\to\infty}b_n&#x3D;a$</li>
<li>$a_n\leq c_n\leq b_n(n&gt;N_0)$</li>
<li>$\Rightarrow \lim\limits_{n\to\infty}c_n&#x3D;a$</li>
</ol>
<ul>
<li>åˆ†æ: å–$n&gt;max {N_0,N_1,N_2}$, æ­¤æ—¶a_n, b_néƒ½åœ¨é‚»åŸŸå†…, æ‰€ä»¥å¤¹ç€çš„c_nä¹Ÿåœ¨é‚»åŸŸå†….</li>
</ul>
<h4 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h4><ul>
<li>$\lim\limits_{n\to\infty} n(\frac{1}{n^2+\pi}+\cdots+\frac{1}{n^2+n\pi})$<ul>
<li>åˆ†æ: åˆ†åˆ«æ”¾å¤§ç¼©å°åˆ†æ¯.</li>
</ul>
</li>
<li>$\lim\limits_{n\to\infty} \sqrt[n]{a_1^n+\cdots+a_m^n} &#x3D; max(a_1,\cdots,a_m), a_i&gt;0$<ul>
<li>åˆ†æ: å¸¸æ•°åœ¨å¼€æ— ç©·æ¬¡æ–¹æ ¹æ—¶å¯ä»¥å¿½ç•¥, å› æ­¤åªæŒ‘å‡ºæœ€å¤§çš„, ç¼©å°ç³»æ•°ä¸º1, æ”¾å¤§ç³»æ•°ä¸ºmå³å¯.</li>
</ul>
</li>
<li>$\lim\limits_{n\to\infty} \frac{1}{2}\frac{3}{4}\frac{5}{6}\cdots\frac{2n-1}{2n} &#x3D; 0$<ul>
<li>åˆ†æ: å¤§äºé›¶æ˜¯æ˜¾ç„¶çš„, å°†åˆ†å­å¹³æ–¹å†å¼€æ–¹, åˆ©ç”¨$1\cdot 3&lt;2^2$å½¢å¼æ”¾å¤§åˆ†å­çº¦åˆ†.</li>
</ul>
</li>
<li>$\lim\limits_{n\to\infty}(1+\frac{1}{n})^k &#x3D; 1, kæ˜¯ä»»æ„å¸¸æ•°$<ul>
<li>åˆ†æ: k&#x3D;0æ—¶æ˜¾ç„¶. kä¸ºæ­£æ•´æ•°æ—¶ç”±æœ‰é™é¡¹æé™å››åˆ™è¿ç®—å¯å¾—, kä¸ºè´Ÿæ•´æ•°æ—¶å€’æ•°. ä¸€èˆ¬åœ°, å¦m&#x3D;kå‘ä¸‹å–æ•´, $(1+\frac{1}{n})^m \leq (1+\frac{1}{n})^k \leq (1+\frac{1}{n})^{m+1})$, å¤¹é€¼.</li>
</ul>
</li>
<li>å·²çŸ¥$|a_{n+1}|\leq q|a_n|(n&gt;N, 0&lt;q&lt;1)$,è¯æ˜æ•°åˆ—æé™ä¸º0.<ul>
<li>åˆ†æ:$n\to\infty$,è€ƒè™‘ç¬¬N+né¡¹, æ­¤æ—¶$0\leq|a_{N+n}|\leq q^{n-1}|a_{N+1}|\to 0$</li>
</ul>
</li>
</ul>
<h3 id="æ•°åˆ—æ”¶æ•›å……è¦æ¡ä»¶-ä»»ä¸€å­æ•°åˆ—éƒ½æ”¶æ•›ä¸”æé™ç›¸ç­‰"><a href="#æ•°åˆ—æ”¶æ•›å……è¦æ¡ä»¶-ä»»ä¸€å­æ•°åˆ—éƒ½æ”¶æ•›ä¸”æé™ç›¸ç­‰" class="headerlink" title="æ•°åˆ—æ”¶æ•›å……è¦æ¡ä»¶: ä»»ä¸€å­æ•°åˆ—éƒ½æ”¶æ•›ä¸”æé™ç›¸ç­‰"></a>æ•°åˆ—æ”¶æ•›å……è¦æ¡ä»¶: ä»»ä¸€å­æ•°åˆ—éƒ½æ”¶æ•›ä¸”æé™ç›¸ç­‰</h3><h4 id="å­æ•°åˆ—"><a href="#å­æ•°åˆ—" class="headerlink" title="å­æ•°åˆ—"></a>å­æ•°åˆ—</h4><ul>
<li>åŸæ•°åˆ—ä¸­å–æ— ç©·å¤šé¡¹å¹¶æŒ‰åŸæœ‰çš„æ¬¡åºæ’åˆ—.</li>
<li>ä¸€èˆ¬çº¦å®š$å­æ•°åˆ—n_k\geq kåŸæ•°åˆ—$</li>
</ul>
<h4 id="å……è¦è¯æ˜"><a href="#å……è¦è¯æ˜" class="headerlink" title="å……è¦è¯æ˜"></a>å……è¦è¯æ˜</h4><ul>
<li>åˆ†æ:<ul>
<li>å……åˆ†æ€§. åŸæ•°åˆ—n&gt;Næ—¶åœ¨é‚»åŸŸå†…, åˆ™å­æ•°åˆ—å–Kä½¿$n_K&gt;N$, å½“k&gt;Kæ—¶, $n_k&gt;n_K&gt;N$åœ¨é‚»åŸŸå†….</li>
<li>å¿…è¦æ€§. åŸæ•°åˆ—æ˜¯åŸæ•°åˆ—çš„å­æ•°åˆ—.</li>
</ul>
</li>
</ul>
<h4 id="æ¨è®º"><a href="#æ¨è®º" class="headerlink" title="æ¨è®º"></a>æ¨è®º</h4><blockquote>
<p>æ•°åˆ—å‘æ•£çš„å……è¦æ¡ä»¶æ˜¯ä¸¤ä¸ªå­æ•°åˆ—æé™å­˜åœ¨ä½†ä¸ç›¸ç­‰, æˆ–ä¸€ä¸ªå­æ•°åˆ—å‘æ•£.</p>
</blockquote>
<ul>
<li>è®¾æ³•æ„é€ æ˜“äºè¯æ˜çš„å­æ•°åˆ—. å¸¸å’Œä¸‰è§’å‡½æ•°å‘¨æœŸæ€§æœ‰å…³ç³».</li>
</ul>
<blockquote>
<p>è‹¥å‡ ä¸ªå­æ•°åˆ—çš„æé™å­˜åœ¨ä¸”ç›¸åŒ, åŒ…å«çš„é¡¹çš„å¹¶é›†ç­‰äºåŸæ•°åˆ—çš„æ‰€æœ‰é¡¹, åˆ™å¯å¾—åŸæ•°åˆ—çš„æé™.</p>
</blockquote>
<ul>
<li>åˆ†æ: å–N&gt;max{N1, N2, ...}, ä»»æ„é¡¹éƒ½åœ¨é‚»åŸŸå†….</li>
</ul>
<h3 id="å•è°ƒæœ‰ç•Œå‡†åˆ™-å•è°ƒæœ‰ç•Œæ•°åˆ—å¿…æœ‰æé™"><a href="#å•è°ƒæœ‰ç•Œå‡†åˆ™-å•è°ƒæœ‰ç•Œæ•°åˆ—å¿…æœ‰æé™" class="headerlink" title="(å•è°ƒæœ‰ç•Œå‡†åˆ™)å•è°ƒæœ‰ç•Œæ•°åˆ—å¿…æœ‰æé™"></a>(å•è°ƒæœ‰ç•Œå‡†åˆ™)å•è°ƒæœ‰ç•Œæ•°åˆ—å¿…æœ‰æé™</h3><ul>
<li>åŒºåˆ†ä¸¥æ ¼å•è°ƒå’Œä¸ä¸¥æ ¼å•è°ƒ.</li>
<li>ç»Ÿç§°å•è°ƒæ•°åˆ—.</li>
<li>åˆ†æ: ç”±ç¡®ç•ŒåŸç†å¾—å¾…è¯æé™a.</li>
</ul>
<h4 id="ä¾‹å­-1"><a href="#ä¾‹å­-1" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h4><ul>
<li>$æ•°åˆ—:(1+\frac{1}{n})^næ”¶æ•›$<ul>
<li>åˆ†æ: å•è°ƒæ€§.å‡å€¼ä¸ç­‰å¼$\sqrt[n+1]{(1+\frac{1}{n})^n\cdot 1}&lt;\frac{n(1+\frac{1}{n})+1}{n+1}&#x3D;1+\frac{1}{n+1}$, æ•…$a_n&lt;a_{n+1}$. æœ‰ç•Œæ€§. äºŒé¡¹å¼å±•å¼€, å„é¡¹æ”¾å¤§å‰©åˆ†æ¯é˜¶ä¹˜, é˜¶ä¹˜æ”¾å¤§åˆ°åˆ†æ¯ä¸º2çš„å¹‚, ç­‰æ¯”æ±‚å’Œ.</li>
</ul>
</li>
<li>$\lim\limits_{n\to \infty} \frac{n^k}{a^n} &#x3D; 0$<ul>
<li>åˆ†æ: å•è°ƒæœ‰ç•Œ. æ±‚ä¸€ä¸‹$\lim\limits_{n\to\infty} \frac{x_{n+1}}{x_n}$. è¯æ˜æ”¶æ•›åå¯¹é€’æ¨å¼ä¸¤è¾¹æ±‚æé™.</li>
</ul>
</li>
</ul>
<h4 id="å•è°ƒå¸¸ç”¨æ–¹æ³•"><a href="#å•è°ƒå¸¸ç”¨æ–¹æ³•" class="headerlink" title="å•è°ƒå¸¸ç”¨æ–¹æ³•"></a>å•è°ƒå¸¸ç”¨æ–¹æ³•</h4><ul>
<li>é€’æ¨å¼ç›´æ¥çœ‹å‡º, æˆ–æ±‚ä¸¤è¾¹æé™åçœ‹å‡º</li>
<li>ä½œå·®æ³•&#x2F;ä½œå•†æ³•, ç»“åˆä¸Šä¸‹ç•Œçœ‹å‡º</li>
</ul>
<h4 id="æœ‰ç•Œå¸¸ç”¨æ–¹æ³•"><a href="#æœ‰ç•Œå¸¸ç”¨æ–¹æ³•" class="headerlink" title="æœ‰ç•Œå¸¸ç”¨æ–¹æ³•"></a>æœ‰ç•Œå¸¸ç”¨æ–¹æ³•</h4><ul>
<li>é€’æ¨å¼æ”¾ç¼©&#x2F;å‡å€¼ä¸ç­‰å¼, å¾—åˆ°ç•Œ</li>
<li>ç¬¦å·æ˜¾ç„¶</li>
</ul>
<h1 id="ä¸‰è§’å‡½æ•°"><a href="#ä¸‰è§’å‡½æ•°" class="headerlink" title="ä¸‰è§’å‡½æ•°"></a>ä¸‰è§’å‡½æ•°</h1><h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><ul>
<li>ä½™åˆ‡ $\cot x &#x3D; \frac{\cos x}{\sin x} &#x3D; \frac{1}{\tan x}$</li>
<li>æ­£å‰² $\sec x &#x3D; \frac{1}{\cos x}$</li>
<li>ä½™å‰² $\csc x &#x3D; \frac{1}{\sin x}$</li>
</ul>
<h2 id="å˜æ¢"><a href="#å˜æ¢" class="headerlink" title="å˜æ¢"></a>å˜æ¢</h2><h3 id="å¼¦å’Œå…¬å¼"><a href="#å¼¦å’Œå…¬å¼" class="headerlink" title="å¼¦å’Œå…¬å¼"></a>å¼¦å’Œå…¬å¼</h3><ul>
<li>$\sin^2 x + \cos^2 x &#x3D; 1$</li>
<li>$1 + \cot^2 x &#x3D; \csc^2 x$</li>
<li>$\tan^2 x + 1 &#x3D; \sec^2 x$</li>
</ul>
<h3 id="è¯±å¯¼å…¬å¼"><a href="#è¯±å¯¼å…¬å¼" class="headerlink" title="è¯±å¯¼å…¬å¼"></a>è¯±å¯¼å…¬å¼</h3><ul>
<li>åŠå‘¨æœŸæ€§<ul>
<li>$\sin(x+\pi) &#x3D; -\sin(x)$</li>
<li>$\cos(x+\pi) &#x3D; -\cos(x)$</li>
<li>$\tan x, \cot xæœ€å°æ­£å‘¨æœŸæ˜¯\pi$</li>
</ul>
</li>
<li>å¥‡å¶æ€§<ul>
<li>$\sin(-x) &#x3D; -\sin(x) å¥‡å‡½æ•°$</li>
<li>$\cos(-x) &#x3D; \cos(x) å¶å‡½æ•°$</li>
<li>$\tan(-x) &#x3D; -\tan(x) å¥‡å‡½æ•°$</li>
<li>$\cot(-x) &#x3D; -\cot(x) å¥‡å‡½æ•°$</li>
</ul>
</li>
<li>åœ†å…³äºyè½´å¯¹ç§°æ€§<ul>
<li>$\sin(\pi-x) &#x3D; \sin(x)$</li>
<li>$\cos(\pi-x) &#x3D; -\cos(x)$</li>
<li>$\tan, \cotçš„å‘¨æœŸæ˜¯\pi, å¥—ç”¨å¥‡å‡½æ•°æ€§è´¨$</li>
</ul>
</li>
<li>ç›´è§’åŠ <ul>
<li>$\sin(\pi&#x2F;2+x) &#x3D; \cos x$</li>
<li>$\cos(\pi&#x2F;2+x) &#x3D; -\sin x$</li>
<li>$\tan(\pi&#x2F;2+x) &#x3D; -\cot x$</li>
<li>$\cot(\pi&#x2F;2+x) &#x3D; -\tan x$</li>
</ul>
</li>
<li>ç›´è§’å‡(ä½™è§’)<ul>
<li>$\sin(\pi&#x2F;2-x) &#x3D; \cos x$</li>
<li>$\cos(\pi&#x2F;2-x) &#x3D; \sin x$</li>
<li>$\tan(\pi&#x2F;2-x) &#x3D; \cot x$</li>
<li>$\cot(\pi&#x2F;2-x) &#x3D; \tan x$</li>
</ul>
</li>
<li>å€è§’å…¬å¼<ul>
<li>$\sin2x &#x3D; 2\sin x\cos x$</li>
<li>$\cos2x &#x3D; \cos^2 x - \sin^2 x$</li>
<li>$\tan2x &#x3D; \frac{2\tan x}{1-\tan^2x}$</li>
</ul>
</li>
<li>åŠè§’å…¬å¼<ul>
<li>æ¥æº<br>  $$ \cos 2x &#x3D; 2 \cos^2 x-1 &#x3D; 1-2\sin^2 x $$</li>
<li>$\cos^2 \frac{x}{2} &#x3D; \frac{1+\cos x}{2}$</li>
<li>$\sin^2 \frac{x}{2} &#x3D; \frac{1-\cos x}{2}$</li>
<li>$\tan \frac{x}{2} &#x3D; \frac{\sin \frac{x}{2}}{\cos \frac{x}{2}}_{(åŒä¹˜å‡‘å€è§’)} &#x3D;\frac{\sin x}{1+ \cos x} &#x3D; \frac{1-\cos x}{\sin x}$</li>
</ul>
</li>
<li>ä¸‡èƒ½å…¬å¼<ul>
<li>$\sin x &#x3D; \sin(2\frac{x}{2}) &#x3D; 2\sin\frac{x}{2}\cos\frac{x}{2} &#x3D; \frac{2\tan \frac{x}{2}}{\sec^2\frac{x}{2}}&#x3D;\frac{2\tan \frac{x}{2}}{1+\tan^2 \frac{x}{2}}$</li>
<li>$\cos x &#x3D; \sin(2\frac{x}{2}) &#x3D; \cos^2\frac{x}{2} - \sin^2\frac{x}{2} &#x3D; \frac{1-\tan^2\frac{x}{2}}{1+\tan^2\frac{x}{2}}$</li>
<li>$\tan x &#x3D; \frac{2\tan\frac{x}{2}}{1-\tan^2\frac{x}{2}}$</li>
</ul>
</li>
<li>ç§¯åŒ–å’Œå·®<ul>
<li>ç”¨$\sin(a \pm b)$å‡‘$\sin\cdot \cos$</li>
<li>ç”¨$\cos(a \pm b)$å‡‘$\sin \cdot\sin, \cos\cdot \cos.$</li>
<li>$\sin a \cos b &#x3D; \frac{1}{2}(\sin(a+b)+\sin(a-b))$</li>
<li>$\cos a \sin b &#x3D; \frac{1}{2}(\sin(a+b)-\sin(a-b))$</li>
<li>$\cos a \cos b &#x3D; \frac{1}{2}(\cos(a+b)+\cos(a-b))$</li>
<li>$\sin a \sin b &#x3D; -\frac{1}{2}(\cos(a+b)-\cos(a-b))$</li>
</ul>
</li>
<li>å’Œå·®åŒ–ç§¯<ul>
<li>$a&#x3D;\frac{a+b}{2}+\frac{a-b}{2}$</li>
<li>$b&#x3D;\frac{a+b}{2}-\frac{a-b}{2}$</li>
<li>$\sin a + \sin b &#x3D; 2\sin\frac{a+b}{2}\cos\frac{a-b}{2}$</li>
<li>$\sin a - \sin b &#x3D; 2\cos\frac{a+b}{2}\sin\frac{a-b}{2}$</li>
<li>$\cos a + \cos b &#x3D; 2\cos\frac{a+b}{2}\cos\frac{a-b}{2}$</li>
<li>$\cos a - \cos b &#x3D; -2\sin\frac{a+b}{2}\sin\frac{a-b}{2}$</li>
<li>å¸…+å¸…&#x3D;å¸…å“¥</li>
<li>å¸…-å¸…&#x3D;å“¥å¸…</li>
<li>å“¥+å“¥&#x3D;å“¥å“¥</li>
<li>å“¥-å“¥&#x3D;è´Ÿå«‚å«‚</li>
</ul>
</li>
</ul>
<h1 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h1><h2 id="æ— ç©·å°é‡"><a href="#æ— ç©·å°é‡" class="headerlink" title="æ— ç©·å°é‡"></a>æ— ç©·å°é‡</h2><ul>
<li>å¯¹ä»»æ„eps&gt;0, å­˜åœ¨deltaå»å¿ƒé‚»åŸŸ, ä½¿$|f(x)|&lt;eps$. æ— ç©·å°é‡æ˜¯ä¸€ä¸ªå˜é‡ </li>
<li>æ— ç©·å°æ˜¯æé™ä¸ºé›¶çš„å‡½æ•°</li>
<li>æ— ç©·å°å¯èƒ½åœ¨æŸé‚»åŸŸä¸º0</li>
<li>0æ˜¯å”¯ä¸€ä¸€ä¸ªå¯è§†ä½œæ— ç©·å°çš„å¸¸ç†Ÿ</li>
</ul>
<h3 id="å‡½æ•°æé™ä¸æ— ç©·å°é‡"><a href="#å‡½æ•°æé™ä¸æ— ç©·å°é‡" class="headerlink" title="å‡½æ•°æé™ä¸æ— ç©·å°é‡"></a>å‡½æ•°æé™ä¸æ— ç©·å°é‡</h3><ul>
<li>ï¼ˆå®šç†ï¼‰$x \to x_0$,f(x)æé™ä¸ºA$\Leftrightarrow f(x)&#x3D;A+a(x)$, a(x)ä¸ºæ— ç©·å°é‡</li>
</ul>
<h3 id="æ— ç©·å°é˜¶çš„æ¯”è¾ƒ"><a href="#æ— ç©·å°é˜¶çš„æ¯”è¾ƒ" class="headerlink" title="æ— ç©·å°é˜¶çš„æ¯”è¾ƒ"></a>æ— ç©·å°é˜¶çš„æ¯”è¾ƒ</h3><ul>
<li>$\lim\limits_{x \to x_0^+} \frac{f(x)}{(x-x_0)^k} &#x3D; c \neq 0$,åˆ™å½“$x \to x_0$æ—¶,f(x)æ˜¯$(x-x_0)$çš„ké˜¶æ— ç©·å°.</li>
<li>ç‰¹æ®Šçš„æ— ç©·å°é‡<ul>
<li>$x \to 0, f(x),g(x)æ˜¯æ— ç©·å°é‡,ä¸”f(x)&#x3D;(x+1)g(x), åˆ™f(x) \sim g(x)$, å°½ç®¡ä»–ä»¬æœ€é«˜æ¬¡æ•°ä¸ç›¸åŒ</li>
<li>æœ€é«˜æ¬¡æ•°ä¸åŒè€Œç­‰ä»·, æ„å‘³ç€ç›¸ä¹˜ä¸æ”¹å˜ç­‰ä»·æ€§, ä½†ç›¸åŠ ä¼šæ”¹å˜ç­‰ä»·æ€§.</li>
<li>å…·ä½“ä¾‹å­:$f(x)&#x3D;x^3-x \sim x^2-x, g(x)&#x3D;x, f(x)+g(x)&#x3D;x^3, ä½†x^2-x+x&#x3D;x^2ä¸ç­‰ä»·äºx^3$</li>
<li>åŒé˜¶ä¸å¦ä¸æœ€é«˜æ¬¡æ•°æ— å…³, ä¸€åˆ‡åˆ¤å®šä»¥æ¯”å€¼ä¸ºå‡†.</li>
</ul>
</li>
</ul>
<h3 id="å¸¸ç”¨çš„ç­‰ä»·æ— ç©·å°é‡"><a href="#å¸¸ç”¨çš„ç­‰ä»·æ— ç©·å°é‡" class="headerlink" title="å¸¸ç”¨çš„ç­‰ä»·æ— ç©·å°é‡"></a>å¸¸ç”¨çš„ç­‰ä»·æ— ç©·å°é‡</h3><h4 id="x-to-0-æ—¶"><a href="#x-to-0-æ—¶" class="headerlink" title="$x \to 0$æ—¶"></a>$x \to 0$æ—¶</h4><ul>
<li>$\sin x \sim x$</li>
<li>$\tan x \sim x$</li>
<li>$1 - \cos x \sim \frac{1}{2}x$</li>
<li>$\sqrt[n]{1+x}-1 \sim \frac{1}{n}x$ (nä¸ºæ­£æ•´æ•°)(æ³¨æ„æ˜¯åŠ å·)</li>
<li>$\arcsin x \sim x, (u&#x3D;\arcsin x)$</li>
<li>$\arctan x \sim x$</li>
<li>$\ln(1+x) \sim x, (\lim \ln(1+x)^{\frac{1}{x}})$</li>
<li>$e^x-1 \sim x, (u&#x3D;e^x-1, \lim \frac{u}{\ln(1+u)})$</li>
<li>$a^x-1 \sim x\ln a, (\lim \frac{e^{x\ln a}-1}{x}&#x3D;\lim \frac{x\ln a}{x} &#x3D; \ln a), a &gt; 0$</li>
<li>$(1+x)^a-1 \sim ax, (\lim \frac{(1+x)^a-1}{x}&#x3D;\lim \frac{e^{a \ln (1+x)}-1}{x} &#x3D; \lim \frac{a \ln (1+x)}{x} &#x3D; a), a \neq 0$</li>
<li>xå¯ä»¥ç”¨å…¶ä»–å‡½æ•°æ›¿ä»£ï¼Œåªè¦è¶‹å‘äº0å³å¯</li>
</ul>
<h3 id="å¸¸ç”¨å˜æ¢"><a href="#å¸¸ç”¨å˜æ¢" class="headerlink" title="å¸¸ç”¨å˜æ¢"></a>å¸¸ç”¨å˜æ¢</h3><ul>
<li>$\lim \limits_{x \to 0} (1-x)^{\frac {1}{x}} &#x3D; \frac{1}{e}$</li>
<li>$\sin x + x^2&#x3D;x(\frac{\sin x}{x} + x)$</li>
<li>$\tan x - \sin x &#x3D; \tan x(1- \cos x)$</li>
<li>$a^x &#x3D; e^{x \ln a}$ (ç•™æ„åé¢æœ‰æ²¡æœ‰-1é…åˆç­‰ä»·æ— ç©·å°æ›¿æ¢)</li>
<li>$x^a &#x3D; e^{a \ln x}$</li>
<li>åœ¨$x \to \infty, æ±‚\lim e^{f(x)g(x)}, ç•™æ„æœ€é«˜æ¬¡ç›¸åŒ\Rightarrow ç³»æ•°æ¯”$</li>
<li>$\lim \limits_{n \to \infty} (\frac{\sqrt[n]{a_1}+\cdots +\sqrt[n]{a_m}}{m}-1)n &#x3D; \lim \limits_{x \to 0} (\frac{a_1^x+\cdots + a_m^x}{m}-1)\frac{1}{x} &#x3D; \lim \limits_{x \to 0} \frac{x\ln a_1 + \cdots + x\ln a_m}{mx} &#x3D; \ln \sqrt[m]{a_1 \cdots a_m}, mæ˜¯æ­£æ•´æ•°, å½’ç»“å‡†åˆ™$</li>
<li>æ¬¡æ–¹ç›¸åŒ, åº•æ•°ä¸åŒ,å¼ºè¡ŒåŒé™¤?!<blockquote>
<p>æ±‚$\lim \limits_{x \to 0} \frac{(1+x)^\frac{1}{x}+(1+2x)^\frac{1}{2x}}{\sin x} &#x3D; \frac{e}{2}$</p>
</blockquote>
</li>
<li>æ±‚æé™çš„æœ€å, æœ‰ç•Œé‡(å°¤å…¶ä¸$\sin\infty$,$\cos \infty$æœ‰å…³)ä¹˜æ— ç©·å°é‡ç­‰äºæ— ç©·å°é‡</li>
</ul>
<h3 id="æ— ç©·å°é‡é˜¶æ•°çš„æ€§è´¨"><a href="#æ— ç©·å°é‡é˜¶æ•°çš„æ€§è´¨" class="headerlink" title="æ— ç©·å°é‡é˜¶æ•°çš„æ€§è´¨"></a>æ— ç©·å°é‡é˜¶æ•°çš„æ€§è´¨</h3><ul>
<li>$o(x^n)+o(x^m) &#x3D; o(x^m), x \to 0, n&gt;m&gt;0$</li>
<li>$o(x^n) \cdot o(x^m) &#x3D; o(x^{n+m}), x \to 0$</li>
<li>æ— ç©·å°é‡ç›¸åŠ ï¼Œé«˜é˜¶ä¸¢å¤±ï¼Œä¿ç•™ä½é˜¶.</li>
<li>æ— ç©·å°é‡ç›¸ä¹˜ï¼Œé˜¶æ•°ç›¸åŠ .</li>
<li>æ— ç©·å°é‡$o(é«˜é˜¶)&#x3D;o(ä½é˜¶)$æ˜¯æ­£ç¡®çš„.</li>
<li>æ— ç©·å°é‡å¯ä»¥å†™æˆ$f(x)&#x3D;g(x)+o(x^2)$, æ±‚æé™æ—¶è®¾æ³•å‡ºç°$\frac {o(x^2)}{kx^2}$å³å¯æ¶ˆå»</li>
</ul>
<h2 id="è¯æ˜é¢˜"><a href="#è¯æ˜é¢˜" class="headerlink" title="è¯æ˜é¢˜"></a>è¯æ˜é¢˜</h2><ul>
<li>è¯æ˜$x \to 0, f(x) &#x3D; g(x)+o(h(x))$<blockquote>
<p>è®¡ç®—$\lim\limits_{x \to 0}\frac{f(x)-g(x)}{h(x)} &#x3D; 0$</p>
</blockquote>
</li>
<li>è¯æ˜å‡½æ•°æ˜¯æ— ç©·å°é‡<blockquote>
<p>è¯æ˜å‡½æ•°æé™ä¸º0</p>
</blockquote>
</li>
<li>è¯æ˜å‡½æ•°æ˜¯æ— èŠ‚é‡<blockquote>
<p>å¯¹ä»»æ„M&gt;0,æ‰¾åˆ°$|f(x)| &gt; M$</p>
</blockquote>
</li>
</ul>
<h2 id="æ— ç©·å¤§é‡"><a href="#æ— ç©·å¤§é‡" class="headerlink" title="æ— ç©·å¤§é‡"></a>æ— ç©·å¤§é‡</h2><ul>
<li>å¯¹ä»»æ„M&gt;0ï¼Œå­˜åœ¨ç©ºå¿ƒé‚»åŸŸ(x0, $\delta$), ä½¿$|f(x)| &gt;M$, åˆ™f(x)æ˜¯åœ¨$x \to x0$æ—¶çš„æ— ç©·å¤§é‡</li>
<li>æ— ç©·å¤§é‡ä¸æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°</li>
<li>æ— ç©·å¤§é‡çš„æé™ä¸å­˜åœ¨</li>
</ul>
<h3 id="æ— ç©·å¤§é‡ä¸æ— ç©·å°é‡çš„å…³ç³»"><a href="#æ— ç©·å¤§é‡ä¸æ— ç©·å°é‡çš„å…³ç³»" class="headerlink" title="æ— ç©·å¤§é‡ä¸æ— ç©·å°é‡çš„å…³ç³»"></a>æ— ç©·å¤§é‡ä¸æ— ç©·å°é‡çš„å…³ç³»</h3><ul>
<li>æ— ç©·å¤§é‡çš„å€’æ•°é‡æ˜¯æ— ç©·å°é‡</li>
<li>è‹¥æ— ç©·å°é‡æ’ä¸ä¸ºé›¶,åˆ™è¯¥æ— ç©·å°é‡çš„å€’æ•°é‡ä¸ºæ— ç©·å¤§é‡</li>
</ul>
<h2 id="ç­‰ä»·é‡"><a href="#ç­‰ä»·é‡" class="headerlink" title="ç­‰ä»·é‡"></a>ç­‰ä»·é‡</h2><ul>
<li>ä¸è®ºæ— ç©·å¤§æˆ–æ— ç©·å°, åªè¦$\lim\limits_{x \to x_0} \frac{f(x)}{g(x)}&#x3D;1$, å°±ç§°$å½“x \to x_0æ—¶,f(x)ä¸g(x)æ˜¯ç­‰ä»·çš„é‡, è®°ä½œf(x) \sim g(x), (x \to x_0)$</li>
<li>g(x)å¯ä»¥æ˜¯ä¸ä¸ºé›¶çš„å¸¸æ•°.æ•…å¯ä»¥æœ‰$f(x)~A, (A \neq 0)$</li>
<li>å‡½æ•°ç­‰ä»·äºé›¶æ— æ„ä¹‰</li>
<li>æé™ç›¸ç­‰æ˜¯ç­‰ä»·çš„éå¿…è¦éå……åˆ†æ¡ä»¶(å¯èƒ½ä¸¤å‡½æ•°çš„æé™éƒ½ä¸å­˜åœ¨, å¦å¤–è¿˜éœ€è¦åŒé˜¶)</li>
</ul>
<h3 id="ç­‰ä»·é‡æ›¿æ¢å®šç†"><a href="#ç­‰ä»·é‡æ›¿æ¢å®šç†" class="headerlink" title="ç­‰ä»·é‡æ›¿æ¢å®šç†"></a>ç­‰ä»·é‡æ›¿æ¢å®šç†</h3><ul>
<li>è‹¥å‡½æ•°åˆ†åˆ«ç­‰ä»·,ä¸”$\lim \frac{f&#39;(x)g&#39;(x)}{h&#39;(x)}&#x3D;A$, åˆ™$\lim \frac{f(x)g(x)}{h(x)} &#x3D; \lim \frac{f&#39;(x)g&#39;(x)}{h&#39;(x)}&#x3D;A$<ul>
<li>ä¸¤é¡¹ç›¸åŠ ä¸èƒ½ç›´æ¥ä½¿ç”¨ç­‰ä»·é‡æ›¿æ¢</li>
<li>å¯ä»¥ä½¿ç”¨$\lim f(x)+g(x) &#x3D; \lim f(x) + \lim g(x) &#x3D; \lim f&#39;(x) + \lim g&#39;(x) &#x3D; \lim f&#39;(x)+g&#39;(x)$, è¿™é‡Œè¦æ±‚å„å‡½æ•°æé™éƒ½å­˜åœ¨.</li>
<li>å¸¸ç”¨æé™å€¼(å¸¸æ•°)å¯ä»¥ä»£å…¥, ä½†ä¸ä¿è¯é¡ºåˆ©è®¡ç®—å‡ºæé™.</li>
</ul>
</li>
</ul>
<h2 id="ç»™å‡½æ•°æé™-æ±‚å‚æ•°"><a href="#ç»™å‡½æ•°æé™-æ±‚å‚æ•°" class="headerlink" title="ç»™å‡½æ•°æé™, æ±‚å‚æ•°"></a>ç»™å‡½æ•°æé™, æ±‚å‚æ•°</h2><ul>
<li>æ±‚ç­‰ä»·é‡,ç¡®å®šå‚æ•°</li>
<li>ç›´æ¥ç§»é¡¹å¾—å‡º$å¸¸æ•°&#x3D;\lim g(x)&#x3D;A$</li>
</ul>
<h1 id="å¾®åˆ†"><a href="#å¾®åˆ†" class="headerlink" title="å¾®åˆ†"></a>å¾®åˆ†</h1><h2 id="å®šä¹‰-1"><a href="#å®šä¹‰-1" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><blockquote>
<p>è®¾$y&#x3D;f(x)$åœ¨$x$çš„æŸé‚»åŸŸ$U(x)$å†…æœ‰å®šä¹‰ï¼Œè‹¥$\Delta y &#x3D; f(x+ \Delta x)-f(x)$å¯è¡¨ç¤ºä¸º<br>$$<br>\Delta y &#x3D; A\Delta x + o(\Delta x) \quad (\Delta \rightarrow 0),<br>$$<br>å…¶ä¸­$A$æ˜¯ä¸$\Delta x$æ— å…³çš„é‡ï¼Œåˆ™ç§°$y&#x3D;f(x)$åœ¨ç‚¹$x$å¤„å¯å¾®. $A\Delta x$æ˜¯$\Delta y$çš„çº¿æ€§ä¸»éƒ¨ï¼Œå¹¶ç§°å…¶ä¸º$y&#x3D;f(x)$åœ¨ç‚¹$x$å¤„çš„å¾®åˆ†ï¼Œè®°ä¸º$dy, dy &#x3D; A\Delta x$ã€‚</p>
</blockquote>
<h1 id="ç§¯åˆ†"><a href="#ç§¯åˆ†" class="headerlink" title="ç§¯åˆ†"></a>ç§¯åˆ†</h1><h2 id="å˜ä¸Šä¸‹é™ç§¯åˆ†çš„æ±‚å¯¼å…¬å¼"><a href="#å˜ä¸Šä¸‹é™ç§¯åˆ†çš„æ±‚å¯¼å…¬å¼" class="headerlink" title="å˜ä¸Šä¸‹é™ç§¯åˆ†çš„æ±‚å¯¼å…¬å¼"></a>å˜ä¸Šä¸‹é™ç§¯åˆ†çš„æ±‚å¯¼å…¬å¼</h2><p>d s^b(y)_a(y) &#x3D;  f(b(y))b&#39;(y) - f(a(y))a&#39;(y)</p>
<p>[toc]</p>
]]></content>
      <tags>
        <tag>æ•°å­¦</tag>
      </tags>
  </entry>
  <entry>
    <title>æ•°ä½DP</title>
    <url>/2019/08/20/%E6%95%B0%E4%BD%8DDP/</url>
    <content><![CDATA[<h1 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h1><h2 id="æ±‚-L-R-ä¸­æ»¡è¶³-y-geq-x-ä¸”y-mod-x-x3D-x-oplus-y-çš„æ•°å¯¹-x-y-çš„ä¸ªæ•°"><a href="#æ±‚-L-R-ä¸­æ»¡è¶³-y-geq-x-ä¸”y-mod-x-x3D-x-oplus-y-çš„æ•°å¯¹-x-y-çš„ä¸ªæ•°" class="headerlink" title="æ±‚$[L,R]$ä¸­æ»¡è¶³$y\geq x,ä¸”y\mod x&#x3D;x\oplus y$çš„æ•°å¯¹$(x,y)$çš„ä¸ªæ•°"></a>æ±‚$[L,R]$ä¸­æ»¡è¶³$y\geq x,ä¸”y\mod x&#x3D;x\oplus y$çš„æ•°å¯¹$(x,y)$çš„ä¸ªæ•°</h2><span id="more"></span>

<h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ol>
<li>é¢˜ç›®æ¶‰åŠä½æ“ä½œï¼Œå¯¹æ‰€æœ‰æ•°ä»¥äºŒè¿›åˆ¶çœ‹å¾…ã€‚xå’Œyçš„æœ€é«˜ä½åº”ç›¸åŒï¼Œè¿™æ˜¯å› ä¸º$y\mod x&lt;x$ï¼Œå…¶äºŒè¿›åˆ¶æœ€é«˜ä½æœ‰é™åˆ¶ã€‚</li>
<li>ä¸¤æ•°æœ€é«˜ä½ç›¸åŒï¼Œåˆ™yä¸è¶…è¿‡xçš„ä¸¤å€ã€‚$y\mod x &#x3D; y-x &#x3D; y\oplus x$ã€‚</li>
<li>$y-x$ä¸å¯èƒ½é€€ä½ã€‚ç”±$y\geq x$æ‰¾åˆ°ä¸¤è€…ä¸åŒçš„æœ€é«˜ä½ï¼ˆyä¸€å®šæ˜¯1ï¼Œxä¸€å®šæ˜¯0ï¼‰ï¼Œè¿™ä¸€ä½å¼‚æˆ–å’Œä¸º1ï¼Œè‹¥ä½ä½é€€ä½ï¼Œåˆ™å·®ä¸º0ï¼ŒçŸ›ç›¾ï¼Œæ•…ä½ä½ä¸èƒ½é€€ä½ã€‚ç”±ä½ä½ä¸èƒ½é€€ä½ï¼Œåˆ†ç±»è®¨è®º$1-0, 1-1, 0-0$ä¸‰ç§æƒ…å†µï¼Œå‘ç°æ›´ä½ä½ä¹Ÿä¸èƒ½é€€ä½ï¼Œç”±å½’çº³æ³•å¯çŸ¥$y-x$ä¸å¯èƒ½é€€ä½ã€‚</li>
<li>ç»¼ä¸Šï¼Œä»¥bitsetçœ‹å¾…ï¼Œ$x\subseteq y$ã€‚</li>
<li>è€ƒè™‘è®°å¿†åŒ–æœç´¢ã€‚$x,y$éƒ½å—åˆ°ä¸Šä¸‹ç•Œé™åˆ¶ï¼Œä¸”$y\geq x$ï¼Œæ•…åˆ†åˆ«dpæšä¸¾$x,y$çš„åˆæ³•å–å€¼ã€‚å¦å¤–è¦è®°å½•çŠ¶æ€ä¿è¯$x,y$çš„æœ€é«˜ä½ç›¸åŒã€‚</li>
</ol>
<p>$$<br>è®¾f[pos][xDown][xUp][yUp][lead]\<br>è¡¨ç¤ºç¬¬posä½ä¹‹åï¼Œxæ˜¯å¦å‹ä¸‹ç•Œï¼Œxæ˜¯å¦å‹ä¸Šç•Œï¼Œyæ˜¯å¦å‹ä¸Šç•Œï¼Œxyæ˜¯å¦å–è¿‡æœ€é«˜ä½æ—¶çš„åˆæ³•æ–¹æ¡ˆæ•°<br>$$</p>
<h3 id="è§£"><a href="#è§£" class="headerlink" title="è§£"></a>è§£</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function">ULL <span class="title">dfs</span><span class="params">(<span class="type">int</span> pos, <span class="type">bool</span> xDown, <span class="type">bool</span> xUp, <span class="type">bool</span> yUp, <span class="type">bool</span> lead)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (pos &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	ULL &amp;res = ans[pos][xDown][xUp][yUp][lead];</span><br><span class="line">	<span class="keyword">if</span> (res != <span class="number">0</span>) <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> xLow = xDown ? L[pos] : <span class="number">0</span>;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> xHigh = xUp ? R[pos] : <span class="number">1</span>;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> yHigh = yUp ? R[pos] : <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=xLow; i&lt;=xHigh; ++i) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j=i; j&lt;=yHigh; ++j) &#123;</span><br><span class="line">			<span class="keyword">if</span> (lead &amp;&amp; i!=j) <span class="keyword">continue</span>;</span><br><span class="line">			res += <span class="built_in">dfs</span>(pos<span class="number">-1</span>, xDown&amp;&amp;i==xLow, xUp&amp;&amp;i==xHigh, yUp&amp;&amp;j==yHigh, lead&amp;&amp;i==<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> (res %= MOD);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>åŠ¨æ€è§„åˆ’</tag>
      </tags>
  </entry>
  <entry>
    <title>æ–œç‡ä¼˜åŒ–DP</title>
    <url>/2019/08/25/%E6%96%9C%E7%8E%87%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<h2 id="å•çŠ¶æ€çš„æ–œç‡ä¼˜åŒ–"><a href="#å•çŠ¶æ€çš„æ–œç‡ä¼˜åŒ–" class="headerlink" title="å•çŠ¶æ€çš„æ–œç‡ä¼˜åŒ–"></a>å•çŠ¶æ€çš„æ–œç‡ä¼˜åŒ–</h2><p>å†™å‡ºçŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œå½¢å¦‚ï¼š<br>$$ f[j]&#x3D;\max_{i&#x3D;1}^{j-1} { F_1(j)+F_2(i)+F_3(i,j)} $$<br>ç”±äº$F_3$æ¶‰åŠiå’Œjï¼Œè‹¥æšä¸¾ä¸¤ä¸ªå˜é‡ä¼šè¶…æ—¶ã€‚</p>
<p>åŒ–ç®€æ–¹ç¨‹ï¼Œå¾—åˆ°</p>
<span id="more"></span>
<p>$$ f[j]&#x3D;\max_{i&#x3D;1}^{j-1} {F_2(i)+F_4(j)*F_5(i) } + const(j) $$</p>
<p>è¿™é‡Œæ¶‰åŠçš„æ¯ä¸ªå‡½æ•°éƒ½èƒ½äº‹å…ˆç®—å‡ºã€‚äºæ˜¯æ±‚æœ€å¤§å€¼è½¬åŒ–ä¸ºçº¿æ€§è§„åˆ’ï¼šå°†$f[j]$çœ‹ä½œbï¼Œ$F_2(i)$çœ‹ä½œyï¼Œ$-F_4(j)$çœ‹ä½œkï¼Œ$F_5(i)$çœ‹ä½œxï¼Œåˆ™å½¢å¼å¯è½¬åŒ–ä¸º$b&#x3D;y-kx$ï¼Œæ±‚bçš„æœ€å¤§å€¼ã€‚ç»´æŠ¤å¯èƒ½çš„ç‚¹é˜Ÿåˆ—ï¼Œåˆ™è¿™æ˜¯ä¸€æ¡ä¸Šå‡¸çº¿ï¼Œç”¨äºŒåˆ†æ‰¾åˆ°æœ€ç›¸è¿‘æ–œç‡çš„çº¿æ®µçš„å¯¹åº”ç‚¹å³å¯ã€‚</p>
<p>æŸäº›é¢˜ç›®çš„$F_4(j)$å…·æœ‰å•è°ƒæ€§ï¼Œå³ç›®æ ‡ç›´çº¿çš„æ–œç‡æœ‰å•è°ƒæ€§ï¼Œåˆ™å¯ç”¨æœ´ç´ å•è°ƒé˜Ÿåˆ—ä»£æ›¿äºŒåˆ†ã€‚</p>
<p>ä¹Ÿå¯ä»¥å°†maxæ”¹æˆminï¼Œè¿™æ—¶æ±‚æœ€å°çš„bï¼Œç»´æŠ¤ä¸‹å‡¸çº¿å³å¯ã€‚</p>
<h2 id="åŒçŠ¶æ€çš„æ–œç‡ä¼˜åŒ–"><a href="#åŒçŠ¶æ€çš„æ–œç‡ä¼˜åŒ–" class="headerlink" title="åŒçŠ¶æ€çš„æ–œç‡ä¼˜åŒ–"></a>åŒçŠ¶æ€çš„æ–œç‡ä¼˜åŒ–</h2><p>æ‹“å±•å•çŠ¶æ€ä¸‹çš„æ–¹ç¨‹ï¼Œå½¢å¦‚ï¼š<br>$$ f(j,k]&#x3D;\max_{i&#x3D;1}^{j} { F_1(j,k]+F_2(i,j]+F_3(i,j,k)} $$<br>åŒæ ·åŒ–ç®€æ–¹ç¨‹ï¼Œå¾—åˆ°<br>$$ f(j,k]&#x3D;\max_{i&#x3D;1}^{j} { F_2(i,j]+F_4(i)*F_5(j,k]} + const(j,k]$$<br>ç±»ä¼¼åœ°ä»¤$F_4(i)$ä¸ºæ¨ªåæ ‡xï¼Œå¾…æ±‚çš„$f(j,k]$çœ‹ä½œæˆªè·bï¼Œ$F_2(i,j]$çœ‹ä½œçºµåæ ‡yæ„å»ºçº¿æ€§è§„åˆ’ã€‚ä¹‹åçš„æ­¥éª¤åŒä¸Šã€‚</p>
<p>æ–œç‡ä¼˜åŒ–çš„ç›®çš„æ˜¯å‡å°‘æšä¸¾å‰é©±çŠ¶æ€çš„æ—¶é—´ï¼Œç”¨O(1)æˆ–O(log n)å®ŒæˆçŠ¶æ€è½¬ç§»ã€‚è¿™å°†è¦æ±‚åœ¨å®ŒæˆçŠ¶æ€è®¡ç®—åï¼Œå°†æ–°è·å¾—çš„ç‚¹åŠ å…¥å‡¸çº¿ä¸­ã€‚åŠ ç‚¹åï¼Œè§†æƒ…å†µé€‰æ‹©æ˜¯å¦ç»´æŠ¤å‡¸æ€§ã€‚<br>å¯¹äºåŒçŠ¶æ€çš„é¢˜ç›®ï¼Œä¸åŒçš„jå¯¹åº”ä¸åŒçš„å‡¸çº¿ï¼ˆè¿™æ˜¯å› ä¸º$F_2(i,j]$ä¼šéšjå˜åŒ–ï¼Œå³ç‚¹çš„åæ ‡ä¼šå˜åŒ–ï¼‰ã€‚åº”å½“åˆ¤æ–­å¯¹äºåŒä¸€ä¸ªjã€ä¸åŒçš„kï¼Œèƒ½å¦ä»åŒä¸€æ¡å‡¸çº¿å¾—åˆ°ç­”æ¡ˆã€‚</p>
<p>å¦‚æœåŠ ç‚¹æ“ä½œçš„æ¨ªåæ ‡å…·æœ‰éå•è°ƒæ€§ï¼Œå¯èƒ½éœ€è¦æ•°æ®ç»“æ„æ”¯æŒäºŒåˆ†æŸ¥æ‰¾ã€ä¸­é—´åŠ ç‚¹ã€ä¸­é—´åˆ ç‚¹çš„æ“ä½œã€‚å¦‚æœä¸éœ€è¦å³æ—¶ç»´æŠ¤ï¼Œå¯ä»¥ç”¨æ’åºå®Œæˆç»´æŠ¤ã€‚</p>
]]></content>
      <tags>
        <tag>åŠ¨æ€è§„åˆ’</tag>
      </tags>
  </entry>
  <entry>
    <title>åœ¨ACMä¸­ä½¿ç”¨C++</title>
    <url>/2019/08/28/%E5%9C%A8ACM%E4%B8%AD%E4%BD%BF%E7%94%A8C/</url>
    <content><![CDATA[<p>ä»Šå¤©åˆåŒå’å•æ¥æ°´åšå®¢äº†â€¦â€¦ï¼ˆä¸åŠ¡æ­£ä¸šï¼‰</p>
<h1 id="ä»¤äººå°–å«çš„STL"><a href="#ä»¤äººå°–å«çš„STL" class="headerlink" title="ä»¤äººå°–å«çš„STL"></a>ä»¤äººå°–å«çš„STL</h1><h2 id="algorithm-ç³»åˆ—"><a href="#algorithm-ç³»åˆ—" class="headerlink" title="algorithm ç³»åˆ—"></a><strong>algorithm</strong> ç³»åˆ—</h2><h3 id="fill-fill-n-å¡«å……æ•°ç»„"><a href="#fill-fill-n-å¡«å……æ•°ç»„" class="headerlink" title="fill, fill_n å¡«å……æ•°ç»„"></a><strong>fill</strong>, <strong>fill_n</strong> å¡«å……æ•°ç»„</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">fill</span>(a, a+n, INF);</span><br><span class="line"><span class="built_in">fill_n</span>(a, n, INF);</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h3 id="unique-unique-copy-å¯¹æ’åºåæ•°ç»„å»é‡"><a href="#unique-unique-copy-å¯¹æ’åºåæ•°ç»„å»é‡" class="headerlink" title="unique, unique_copy å¯¹æ’åºåæ•°ç»„å»é‡"></a><strong>unique</strong>, <strong>unique_copy</strong> å¯¹æ’åºåæ•°ç»„å»é‡</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sort</span>(a, a+n);</span><br><span class="line"><span class="built_in">unique_copy</span>(a, a+n, b, é‡è½½==);</span><br><span class="line"><span class="built_in">unique</span>(a, a+n, é‡è½½==);</span><br></pre></td></tr></table></figure>

<h3 id="reverse-reverse-copy-é•œåƒç¿»è½¬æ•°ç»„"><a href="#reverse-reverse-copy-é•œåƒç¿»è½¬æ•°ç»„" class="headerlink" title="reverse, reverse_copy é•œåƒç¿»è½¬æ•°ç»„"></a><strong>reverse</strong>, <strong>reverse_copy</strong> é•œåƒç¿»è½¬æ•°ç»„</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">reverse_copy</span>(a, a+n, b);</span><br><span class="line"><span class="built_in">reverse</span>(a, a+n);</span><br></pre></td></tr></table></figure>

<h3 id="rotate-rotate-copy-æ•°ç»„è½®æ¢"><a href="#rotate-rotate-copy-æ•°ç»„è½®æ¢" class="headerlink" title="rotate, rotate_copy æ•°ç»„è½®æ¢"></a><strong>rotate</strong>, <strong>rotate_copy</strong> æ•°ç»„è½®æ¢</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> a[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;;</span><br><span class="line"><span class="built_in">rotate_copy</span>(a, a+<span class="number">2</span>, a+<span class="number">6</span>, b); <span class="comment">// b == &#123;3, 4, 5, 6, 1, 2&#125;</span></span><br><span class="line"><span class="built_in">rotate</span>(a, a+<span class="number">5</span>, a+<span class="number">6</span>); <span class="comment">// a == &#123;6, 1, 2, 3, 4, 5&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="random-shuffle-éšæœºæ‰“ä¹±æ•°ç»„"><a href="#random-shuffle-éšæœºæ‰“ä¹±æ•°ç»„" class="headerlink" title="random_shuffle éšæœºæ‰“ä¹±æ•°ç»„"></a><strong>random_shuffle</strong> éšæœºæ‰“ä¹±æ•°ç»„</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">random_shuffle</span>(a, a+n);</span><br></pre></td></tr></table></figure>

<h3 id="partial-sort-æ•°ç»„ä¸€æ¬¡æ€§å–å‰kå°"><a href="#partial-sort-æ•°ç»„ä¸€æ¬¡æ€§å–å‰kå°" class="headerlink" title="partial_sort æ•°ç»„ä¸€æ¬¡æ€§å–å‰kå°"></a><strong>partial_sort</strong> æ•°ç»„ä¸€æ¬¡æ€§å–å‰kå°</h3><p>æ—¶é—´å¤æ‚åº¦$n \log m$</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">partial_sort</span>(a, a+k, a+n, é‡è½½&lt;);</span><br></pre></td></tr></table></figure>

<h3 id="partition-partition-copy-å…ƒç´ åˆ†æˆä¸¤ç»„"><a href="#partition-partition-copy-å…ƒç´ åˆ†æˆä¸¤ç»„" class="headerlink" title="partition, partition_copy å…ƒç´ åˆ†æˆä¸¤ç»„"></a><strong>partition</strong>, <strong>partition_copy</strong> å…ƒç´ åˆ†æˆä¸¤ç»„</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">Point* mid = <span class="built_in">partition</span>(p, p+n, [o1, o2](<span class="type">const</span> Point&amp; a) &#123;</span><br><span class="line">        <span class="built_in">return</span> (o2-o1).<span class="built_in">det</span>(a-o1) &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="comment">// ä»¥ç›´çº¿(o1, o2)ä¸ºç•Œå°†å¹³é¢ä¸Šçš„ç‚¹åˆ’åˆ†æˆä¸¤ç»„</span></span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰<code>stable_partition</code>ç‰ˆæœ¬</p>
<h3 id="merge-inplace-merge-å½’å¹¶æ•°ç»„"><a href="#merge-inplace-merge-å½’å¹¶æ•°ç»„" class="headerlink" title="merge, inplace_merge å½’å¹¶æ•°ç»„"></a><strong>merge</strong>, <strong>inplace_merge</strong> å½’å¹¶æ•°ç»„</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¦æ±‚åˆ†åˆ«æœ‰åº</span></span><br><span class="line"><span class="built_in">merge</span>(a, a+aLen, b, b+bLen, c, é‡è½½&lt;); <span class="comment">// éåŸåœ°åˆå¹¶</span></span><br><span class="line"><span class="built_in">inplace_merge</span>(a, a+mid+<span class="number">1</span>, a+aLen, é‡è½½&lt;); <span class="comment">// åŸåœ°åˆå¹¶</span></span><br></pre></td></tr></table></figure>

<h3 id="equal-range-æ‰¾åˆ°å­˜åœ¨åŒºé—´"><a href="#equal-range-æ‰¾åˆ°å­˜åœ¨åŒºé—´" class="headerlink" title="equal_range æ‰¾åˆ°å­˜åœ¨åŒºé—´"></a><strong>equal_range</strong> æ‰¾åˆ°å­˜åœ¨åŒºé—´</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sort</span>(a, a+n);</span><br><span class="line"><span class="comment">// ç­‰ä»·äºä½¿ç”¨lower_boundå’Œupper_bound</span></span><br><span class="line">pair&lt;<span class="type">int</span>*, <span class="type">int</span>*&gt; bounds = <span class="built_in">equal_range</span>(a, a+n, <span class="number">10</span>, é‡è½½&lt;);</span><br></pre></td></tr></table></figure>

<h3 id="make-heap-O-n-å»ºå †"><a href="#make-heap-O-n-å»ºå †" class="headerlink" title="make_heap O(n)å»ºå †"></a><strong>make_heap</strong> O(n)å»ºå †</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">make_heap</span>(a, a+n, é‡è½½&lt;);</span><br></pre></td></tr></table></figure>

<h3 id="sort-heap-å¯¹å †æ’åº"><a href="#sort-heap-å¯¹å †æ’åº" class="headerlink" title="sort_heap å¯¹å †æ’åº"></a><strong>sort_heap</strong> å¯¹å †æ’åº</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">make_heap</span>(a, a+n, é‡è½½&lt;);</span><br><span class="line"><span class="built_in">sort_heap</span>(a, a+n, é‡è½½&lt;);</span><br></pre></td></tr></table></figure>

<h3 id="push-heap-å †åŠ å…¥ä¸€ä¸ªå…ƒç´ "><a href="#push-heap-å †åŠ å…¥ä¸€ä¸ªå…ƒç´ " class="headerlink" title="push_heap å †åŠ å…¥ä¸€ä¸ªå…ƒç´ "></a><strong>push_heap</strong> å †åŠ å…¥ä¸€ä¸ªå…ƒç´ </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">a[n++] = <span class="number">666</span>;</span><br><span class="line"><span class="built_in">push_heap</span>(a, a+n, é‡è½½&lt;);</span><br></pre></td></tr></table></figure>

<h3 id="pop-heap-å †åˆ é™¤é¡¶ç«¯å…ƒç´ "><a href="#pop-heap-å †åˆ é™¤é¡¶ç«¯å…ƒç´ " class="headerlink" title="pop_heap å †åˆ é™¤é¡¶ç«¯å…ƒç´ "></a><strong>pop_heap</strong> å †åˆ é™¤é¡¶ç«¯å…ƒç´ </h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">pop_heap</span>(a, a+n--, é‡è½½&lt;);</span><br></pre></td></tr></table></figure>

<h3 id="lexicographical-compare-å­—å…¸åºå°äº"><a href="#lexicographical-compare-å­—å…¸åºå°äº" class="headerlink" title="lexicographical_compare å­—å…¸åºå°äº"></a><strong>lexicographical_compare</strong> å­—å…¸åºå°äº</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">lexicographical_compare</span>(s1, s1+len1, s2, s2+len2))</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;s1 &lt; s2\n&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="next-permutation-prev-permutation-æ±‚ä¸‹ä¸€æ’åˆ—"><a href="#next-permutation-prev-permutation-æ±‚ä¸‹ä¸€æ’åˆ—" class="headerlink" title="next_permutation, prev_permutation æ±‚ä¸‹ä¸€æ’åˆ—"></a><strong>next_permutation</strong>, <strong>prev_permutation</strong> æ±‚ä¸‹ä¸€æ’åˆ—</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> a[] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line"><span class="built_in">prev_permutation</span>(a, a+<span class="number">5</span>);</span><br><span class="line"><span class="built_in">next_permutation</span>(a, a+<span class="number">5</span>);</span><br></pre></td></tr></table></figure>

<h2 id="Containers-ç³»åˆ—"><a href="#Containers-ç³»åˆ—" class="headerlink" title="Containers ç³»åˆ—"></a><strong>Containers</strong> ç³»åˆ—</h2><p><em>ç”¨åˆ°çƒ‚çš„çŸ¥è¯†ç‚¹å°±ä¸å¤šæäº†ã€‚è¿™é‡Œåªå†™å®¹æ˜“å¿˜çš„ã€‚</em></p>
<h3 id="bitset"><a href="#bitset" class="headerlink" title="bitset"></a><strong>bitset</strong></h3><h4 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h4><ol>
<li><code>bitset&lt;size_t N&gt; foo(int);</code></li>
<li><code>bitset&lt;size_t N&gt; foo(std::string);</code></li>
</ol>
<h4 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h4><ol>
<li>é•¿åº¦åœ¨ç¼–è¯‘æœŸç¡®å®š</li>
<li>é«˜ä½åœ¨å·¦ï¼Œä½ä½åœ¨å³</li>
<li>é‡è½½çš„æ–¹æ‹¬å·å¯ä»¥ç›´æ¥è¯»å–ã€æ“ä½œä½</li>
</ol>
<h4 id="å¸¸ç”¨å‡½æ•°"><a href="#å¸¸ç”¨å‡½æ•°" class="headerlink" title="å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h4><ol>
<li><code>size_t count()</code> è¿”å›1çš„ä¸ªæ•°</li>
<li><code>bool test(size_t pos)</code> è¿”å›éå¼•ç”¨çš„<code>foo[pos]</code></li>
<li><code>bool any()</code> æ˜¯å¦æœ‰1</li>
<li><code>bool none()</code> æ˜¯å¦å…¨0</li>
<li><code>bool all()</code> æ˜¯å¦å…¨1</li>
<li><code>bitset&amp; set()</code>  å…¨éƒ¨ä½è®¾ç½®ä¸º1</li>
<li><code>bitset&amp; set(size_t pos, bool val=true)</code> è®¾ç½®æŸä¸ªä½</li>
<li><code>bitset&amp; reset()</code> å…¨éƒ¨è®¾ç½®ä¸º0  ï¼ˆä¹Ÿå¯æœ‰å‚æ•°posï¼‰</li>
<li><code>bitset&amp; flip()</code> åè½¬å…¨éƒ¨ä½  ï¼ˆä¹Ÿå¯æœ‰å‚æ•°posï¼‰</li>
<li><code>string to_string(char zero, char one)</code> æŒ‰è¦æ±‚è½¬åŒ–ä¸ºstring</li>
<li><code>unsigned long to_ulong()</code> è½¬åŒ–ä¸ºUL</li>
<li><code>ULL to_ullong</code> è½¬åŒ–ä¸ºULL ï¼ˆC++11ï¼‰</li>
</ol>
<h3 id="map"><a href="#map" class="headerlink" title="map"></a><strong>map</strong></h3><h4 id="æ„é€ å‡½æ•°-1"><a href="#æ„é€ å‡½æ•°-1" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h4><ol>
<li><code>map&lt;type1, type2&gt; mymap;</code></li>
<li><code>map&lt;type1, type2&gt; mymap(&#123;&#125;)</code></li>
</ol>
<h4 id="ç‰¹æ€§-1"><a href="#ç‰¹æ€§-1" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h4><ol>
<li>å†…éƒ¨ç”¨å¹³è¡¡æ ‘å®ç°</li>
<li>ä¸å…è®¸é‡å¤çš„Key</li>
<li>è®¿é—®å¿…é¡»ç”¨è¿­ä»£å™¨ <code>map&lt;type1, type2&gt;::iterator it;</code></li>
<li><code>it-&gt;first</code> æ˜¯Keyï¼Œä¸å¯æ›´å˜ï¼Œ<code>it-&gt;second</code> æ˜¯Valueï¼Œå¯ä»¥ä¿®æ”¹ã€‚</li>
<li>æŸ¥æ‰¾å…ƒç´ å¿…é¡»ç”¨<code>it = mymap.find(Key)</code>ï¼Œå¤±è´¥åˆ™è¿”å›<code>mymap.end();</code></li>
</ol>
<h4 id="å¸¸ç”¨å‡½æ•°-1"><a href="#å¸¸ç”¨å‡½æ•°-1" class="headerlink" title="å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h4><ol>
<li>é‡è½½æ–¹æ‹¬å·ï¼Œè‹¥Keyä¸å­˜åœ¨åˆ™å»ºç«‹Keyå¯¹åº”çš„é»˜è®¤æ„é€ Valueã€‚è¿”å›Valueçš„å¼•ç”¨ã€‚</li>
<li><code>insert()</code> æ¯”è¾ƒå¤æ‚ï¼Œå¸¸ç”¨ä¾‹å­ï¼š<code>mp.insert(pair&lt;char, int&gt;(&#39;a&#39;, 1));</code></li>
<li><code>iterator begin()</code> æŒ‡å‘å¤´å…ƒç´ çš„è¿­ä»£å™¨ ï¼ˆrbegin()æŒ‡å‘æœ€åä¸€ä¸ªå…ƒç´ ï¼‰</li>
<li><code>iterator end()</code> æŒ‡å‘å°¾å…ƒç´ çš„åä¸€ä¸ªè¿­ä»£å™¨ï¼ˆrend()æŒ‡å‘å¤´å…ƒç´ çš„å‰ä¸€ä¸ªè¿­ä»£å™¨ï¼‰</li>
<li><code>iterator find(Key)</code> è¿”å›Keyå¯¹åº”çš„è¿­ä»£å™¨ï¼Œå¤±è´¥åˆ™è¿”å›end()ã€‚</li>
<li><code>clear()</code> æ¸…ç©ºæ‰€æœ‰é”®å€¼å¯¹ï¼Œsizeå½’é›¶ã€‚</li>
<li><code>size_type erase (const key_type&amp; k);</code> åˆ é™¤Keyå¯¹åº”çš„é”®å€¼å¯¹ï¼Œè¿”å›åˆ é™¤ä¸ªæ•°</li>
<li><code>iterator erase (const_iterator position);</code> åˆ é™¤è¿­ä»£å™¨æŒ‡å‘çš„é”®å€¼å¯¹ï¼Œè¿”å›ç´§æ¥ä¸‹ä¸€ä¸ªé”®å€¼å¯¹çš„è¿­ä»£å™¨ã€‚</li>
<li><code>iterator erase (const_iterator first, const_iterator last);</code> åˆ é™¤è¿­ä»£å™¨æŒ‡å‘çš„å·¦é—­å³å¼€åŒºé—´çš„é”®å€¼å¯¹ï¼Œè¿”å›ç´§æ¥ç€ä¸‹ä¸€ä¸ªé”®å€¼å¯¹çš„è¿­ä»£å™¨ï¼ˆæˆ–<code>end()</code>ï¼‰ã€‚</li>
<li>æ³¨æ„ï¼ŒC++98ä¸­<code>erase()</code>ä¸ä¼šè¿”å›è¿­ä»£å™¨ï¼Œè€Œæ˜¯è¿”å›void</li>
<li><code>iterator lower_bound (const key_type&amp; k);</code> æ‰€åœ¨ä¸Šç•Œè¿­ä»£å™¨</li>
<li><code>iterator upper_bound (const key_type&amp; k);</code> æ‰€åœ¨ä¸‹ç•Œè¿­ä»£å™¨</li>
</ol>
<h3 id="set"><a href="#set" class="headerlink" title="set"></a><strong>set</strong></h3><p>ç»“ç‚¹åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œä¸å…è®¸é‡å¤çš„çº¢é»‘æ ‘ã€‚</p>
<h4 id="å¸¸ç”¨å‡½æ•°-2"><a href="#å¸¸ç”¨å‡½æ•°-2" class="headerlink" title="å¸¸ç”¨å‡½æ•°"></a>å¸¸ç”¨å‡½æ•°</h4><ol>
<li>è¿­ä»£å™¨begin(), end(), rbegin(), rend().</li>
<li>å®¹é‡empty(), size();</li>
<li>æ’å…¥<ul>
<li><code>pair&lt;iterator, bool&gt; insert(const value_type&amp; val);</code> åŒæ—¶æœ‰éconstçš„å³å€¼å¼•ç”¨ç‰ˆæœ¬ã€‚</li>
<li>è¿”å›çš„pairåŒ…æ‹¬ä¸€ä¸ªæŒ‡å‘è¢«æ’å…¥å€¼çš„è¿­ä»£å™¨ï¼ŒboolæŒ‡æ˜æ˜¯å¦çœŸçš„å‘ç”Ÿäº†æ’å…¥æ“ä½œã€‚ï¼ˆå¦‚æœå…ƒç´ è¢«æ¥å°±å­˜åœ¨ï¼Œå°±ä¸ºfalseï¼‰</li>
</ul>
</li>
<li>åˆ é™¤<ul>
<li><code>iterator erase(const_iterator position);</code> åˆ é™¤æŒ‡å®šè¿­ä»£å™¨ä½ç½®çš„å…ƒç´ ã€‚è¿”å›ç´§æ¥ç€çš„ä¸‹ä¸€ä¸ªå…ƒç´ çš„è¿­ä»£å™¨ã€‚</li>
<li><code>iterator erase(const_iterator first, cosnt_iterator last);</code> åˆ é™¤æŒ‡å®šè¿­ä»£å™¨çš„å·¦é—­å³å¼€åŒºé—´çš„å…ƒç´ ã€‚è¿”å›ç´§æ¥ç€çš„ä¸‹ä¸€ä¸ªå…ƒç´ çš„è¿­ä»£å™¨ã€‚</li>
<li><code>size_type erase(const value_type&amp; val);</code> åˆ é™¤æŒ‡å®šçš„å€¼ã€‚ è¿”å›è¢«åˆ é™¤çš„å…ƒç´ ä¸ªæ•°ï¼ˆ0æˆ–1ï¼‰ã€‚</li>
</ul>
</li>
<li>äº¤æ¢ <code>swap(set&amp; x);</code> äº¤æ¢ä¸¤ä¸ªç±»å‹ç›¸åŒçš„setã€‚</li>
<li>æ¸…ç©º <code>clear();</code></li>
<li>æŸ¥æ‰¾ <code>iterator find(const value_type&amp; val);</code></li>
<li>è®¡æ•° <code>size_type count(const value_type&amp; val) const;</code></li>
<li>ä¸Šä¸‹ç•Œï¼ˆå·¦é—­å³å¼€ï¼‰<ul>
<li><code>iterator lower_bound (const value_type&amp; val);</code></li>
<li><code>iterator upper_bound (const value_type&amp; val);</code></li>
<li><code>pair&lt;iterator,iterator&gt; equal_range (const value_type&amp; val);</code> åŒ…æ‹¬äº†ä¸‹ç•Œå’Œä¸Šç•Œã€‚</li>
</ul>
</li>
</ol>
<h2 id="Cæ ‡å‡†åº“-ç³»åˆ—"><a href="#Cæ ‡å‡†åº“-ç³»åˆ—" class="headerlink" title="Cæ ‡å‡†åº“ ç³»åˆ—"></a><strong>Cæ ‡å‡†åº“</strong> ç³»åˆ—</h2><h3 id="assert-æ–­è¨€"><a href="#assert-æ–­è¨€" class="headerlink" title="assert æ–­è¨€"></a><strong>assert</strong> æ–­è¨€</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">assert</span>(<span class="keyword">this</span>-&gt;ch[<span class="number">0</span>]-&gt;fa == <span class="keyword">this</span>);</span><br><span class="line"><span class="built_in">assert</span>(<span class="keyword">this</span>-&gt;ch[<span class="number">1</span>]-&gt;fa == <span class="keyword">this</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NDEBUG</span></span><br><span class="line"><span class="comment">// NDEBUG æ ‡è®°å¯åˆ é™¤assert</span></span><br></pre></td></tr></table></figure>

<h3 id="isdigit-åˆ¤æ–­å­—ç¬¦æ˜¯å¦åè¿›åˆ¶æ•°"><a href="#isdigit-åˆ¤æ–­å­—ç¬¦æ˜¯å¦åè¿›åˆ¶æ•°" class="headerlink" title="isdigit åˆ¤æ–­å­—ç¬¦æ˜¯å¦åè¿›åˆ¶æ•°"></a><strong>isdigit</strong> åˆ¤æ–­å­—ç¬¦æ˜¯å¦åè¿›åˆ¶æ•°</h3><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cctype&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c=<span class="built_in">getchar</span>()))</span><br><span class="line">    <span class="keyword">if</span> (c==<span class="string">&#x27;-&#x27;</span>) minus = <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<h1 id="æ³¯ç­äººæ€§çš„æ•°æ®ç±»å‹"><a href="#æ³¯ç­äººæ€§çš„æ•°æ®ç±»å‹" class="headerlink" title="æ³¯ç­äººæ€§çš„æ•°æ®ç±»å‹"></a>æ³¯ç­äººæ€§çš„æ•°æ®ç±»å‹</h1><h2 id="å†…å­˜ä½¿ç”¨"><a href="#å†…å­˜ä½¿ç”¨" class="headerlink" title="å†…å­˜ä½¿ç”¨"></a>å†…å­˜ä½¿ç”¨</h2><table>
<thead>
<tr>
<th align="center">ç±»å‹</th>
<th align="center">å­—èŠ‚æ•°</th>
<th align="center">ä¼°è®¡èŒƒå›´</th>
</tr>
</thead>
<tbody><tr>
<td align="center">int</td>
<td align="center">4</td>
<td align="center">Â±2e9</td>
</tr>
<tr>
<td align="center">short</td>
<td align="center">2</td>
<td align="center">Â±3e4</td>
</tr>
<tr>
<td align="center">char</td>
<td align="center">1</td>
<td align="center">ä¿æœ‰127</td>
</tr>
<tr>
<td align="center">float</td>
<td align="center">4</td>
<td align="center">37æ•°é‡çº§ï¼Œ7ä½</td>
</tr>
<tr>
<td align="center">double</td>
<td align="center">8</td>
<td align="center">307æ•°é‡çº§ï¼Œ15ä½</td>
</tr>
<tr>
<td align="center">long double</td>
<td align="center">16</td>
<td align="center">4931æ•°é‡çº§ï¼Œ20ä½</td>
</tr>
<tr>
<td align="center">long long</td>
<td align="center">8</td>
<td align="center">9e18</td>
</tr>
<tr>
<td align="center">__int128_t</td>
<td align="center">16</td>
<td align="center">8.5e37</td>
</tr>
</tbody></table>
<blockquote>
<p>è®¡ç®—structå†…å­˜æ—¶è¦å°å¿ƒï¼æœ€å¥½ä½¿ç”¨<code>sizeof</code>çš„æ–¹å¼è®¡ç®—å†…å­˜ã€‚</p>
</blockquote>
<h2 id="scanfå’Œprintf"><a href="#scanfå’Œprintf" class="headerlink" title="scanfå’Œprintf"></a>scanfå’Œprintf</h2><table>
<thead>
<tr>
<th align="center">ç±»å‹</th>
<th align="center">ç¬¦å·</th>
</tr>
</thead>
<tbody><tr>
<td align="center">unsigned int</td>
<td align="center">%u %o(8è¿›åˆ¶) %x(16è¿›åˆ¶)</td>
</tr>
<tr>
<td align="center">unsigned long long</td>
<td align="center">%llu</td>
</tr>
<tr>
<td align="center">double</td>
<td align="center">å…¥%lfï¼Œå‡º%f</td>
</tr>
<tr>
<td align="center">long double</td>
<td align="center">%Lf</td>
</tr>
<tr>
<td align="center">__int128_t</td>
<td align="center">ä¸å¯ç”¨</td>
</tr>
</tbody></table>
<h2 id="è¯»å…¥è¡Œ"><a href="#è¯»å…¥è¡Œ" class="headerlink" title="è¯»å…¥è¡Œ"></a>è¯»å…¥è¡Œ</h2><p>gets()å·²ç»è¢«åˆ é™¤ã€‚</p>
<p>è¯»å…¥intä¹‹ç±»çš„æ“ä½œä¸ä¼šåƒæ‰è¡Œæœ«ï¼Œè¿™ä¼šå¯¼è‡´ä¸‹ä¸€ä¸ª<code>getline(st, size)</code>å¾—åˆ°ç©ºä¸²ã€‚</p>
<p>ä¿é™©èµ·è§ï¼Œåº”å½“è‡ªå®šä¹‰è¯»å…¥è¡Œã€‚</p>
]]></content>
      <tags>
        <tag>C++</tag>
      </tags>
  </entry>
  <entry>
    <title>æœèŠ±å¤•æ‹¾-æ ‘å½¢ç»“æ„åŒºåˆ†</title>
    <url>/2016/06/15/%E6%9C%9D%E8%8A%B1%E5%A4%95%E6%8B%BE-%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84%E5%8C%BA%E5%88%86/</url>
    <content><![CDATA[<span id="more"></span>

<h2 id="Treap"><a href="#Treap" class="headerlink" title="Treap"></a>Treap</h2><ul>
<li>æ¯ä¸ªç»“ç‚¹æœ‰éšæœºçš„ä¼˜å…ˆçº§ï¼Œä½¿æ ‘æ»¡è¶³ä¼˜å…ˆçº§æ ‘ï¼ˆå †ï¼‰çš„æ€§è´¨ï¼Œå…¶ä½™æ˜¯æ™®é€šæ’åºäºŒå‰æ ‘</li>
<li>æ—‹è½¬ï¼š<ul>
<li><strong>å‚æ•°æ˜¯å­æ ‘æ ¹(å¼•ç”¨å­æ ‘æ ¹çš„å„¿å­æŒ‡é’ˆï¼Œå¦åˆ™è¦æ”¹ä¸€ç³»åˆ—çˆ¶å­æŒ‡é’ˆ)</strong> ï¼Œæ—‹è½¬ å³æ˜¯ <strong>æ²‰é™</strong>ï¼Œå¦ä¸€è¾¹çš„å­©å­ä¸Šå‡ï¼Œä½†è¯¥å­©å­å¯èƒ½ä¸¢å¤±ä¸€ä¸ªå­æ ‘ã€‚</li>
<li><strong>å¼•ç”¨åŸå­æ ‘æ ¹</strong>å¯æ–¹ä¾¿ä¿®æ”¹çˆ¶äº²æŒ‡å‘è‡ªå·±çš„æŒ‡é’ˆã€‚</li>
<li>æ€»æ˜¯<strong>å› ä¸ºæŸ¥æ‰¾æ‰ä¼šå¼•å‘æ—‹è½¬</strong>ï¼Œæ‰€ä»¥æ—‹è½¬å‚æ•°æ€»æ˜¯å¼•ç”¨ã€‚</li>
<li>æ²¡æœ‰è¿”å›å€¼ï¼Œå› ä¸ºæ–°å­æ ‘æ ¹å°±æ˜¯çˆ¶äº²çš„å„¿å­æŒ‡é’ˆã€‚</li>
<li>è®°å¾—ç»´æŠ¤å…¶ä»–æ•°æ®åŸŸã€‚</li>
</ul>
</li>
<li>æ’å…¥ï¼š<ul>
<li><strong>è‡ªå¸¦æŸ¥æ‰¾</strong></li>
<li>æ–°ç»“ç‚¹åˆ†é…éšæœºä¼˜å…ˆçº§ï¼Œåƒæ’åºäºŒå‰æ ‘ä¸€æ ·<strong>æ’åˆ°ä¸€ä¸ªå¶å­</strong>ä¸Šï¼ˆæ¯ä¸ªç»“ç‚¹æœ‰è®¡æ•°å™¨ï¼Œå¯èŠ‚çœæ’å…¥ç›¸åŒç»“ç‚¹ï¼‰ï¼Œç„¶åæ—‹è½¬ç»´æŠ¤ä¼˜å…ˆçº§æ ‘ã€‚</li>
<li>é€’å½’åœ°å†™ï¼Œ<strong>insert()ååˆ¤æ–­</strong>ä¸€ä¸‹æ˜¯å¦éœ€è¦leftRotate() &#x2F; rightRotate()ã€‚</li>
</ul>
</li>
<li>åˆ é™¤ï¼š<ul>
<li><strong>è‡ªå¸¦æŸ¥æ‰¾</strong></li>
<li>æ‰¾åˆ°å¾…åˆ é™¤ç»“ç‚¹ï¼Œ<strong>ä¿®æ”¹è®¡æ•°å™¨ï¼ˆå½“ä¸”ä»…å½“è®¡æ•°å™¨å¤§äº1ï¼ï¼‰</strong>ã€‚å¦‚æœè®¡æ•°å™¨å°±æ˜¯1ï¼Œå°±è¦å°†è‡ªå·±æ—‹åˆ°å¤–ç»“ç‚¹ï¼ˆæ²¡æœ‰å„¿å­æˆ–æœ‰ä¸€ä¸ªå„¿å­ï¼‰ï¼Œè½»æ¾è‡ªæ€ã€‚</li>
<li><strong>å¼•ç”¨root</strong>å¯ä»¥æ–¹ä¾¿åˆ æ‰çˆ¶äº²æŒ‡å‘è‡ªå·±çš„æŒ‡é’ˆã€‚</li>
<li>å¦ä¸€ç§åˆ é™¤æ–¹æ³•ï¼šå‚è€ƒæ™®é€šæ’åºäºŒå‰æ ‘çš„åˆ é™¤ï¼Œä½†ä¼˜å…ˆçº§ä¸èƒ½è¢«æ‹·è´ã€‚éé€’å½’åœ°å†™èƒ½ä¼˜åŒ–æ—¶é—´ã€‚</li>
</ul>
</li>
<li>æŸ¥æ‰¾ï¼š<ul>
<li>å’Œä¸€èˆ¬çš„äºŒå‰æ’åºæ ‘ä¸€æ ·ã€‚</li>
<li>è¿”å›å€¼å¯ä»¥å†™æˆ<strong>åœ°å€å¼•ç”¨ï¼Ÿ</strong></li>
</ul>
</li>
<li>åˆ†ç¦»ï¼š<ul>
<li>ä¾èµ–äºsizeï¼Œå°†æ ‘åˆ†ç¦»ä¸ºä¸¤ä¸ªæŒ‡å®šå¤§å°çš„æ ‘ã€‚</li>
<li>å…ˆæ‰¾åˆ°å‰²è¾¹ï¼Œå¼ºè¡ŒåŠ å…¥ä¸€ä¸ªè™šæ‹Ÿç»“ç‚¹ï¼ˆä¼˜å…ˆçº§ä¸ºæ— é™å¤§ï¼‰ï¼Œæ—‹è½¬åˆ°æ ¹ï¼Œè¿™æ—¶å·¦å³å­æ ‘å·²ç»è¢«åˆ†ç¦»ã€‚</li>
</ul>
</li>
<li>åˆå¹¶ï¼š<ul>
<li>åˆå¹¶å’Œåˆ†ç¦»ç›¸åã€‚è¦æ±‚å…¶ä¸­ä¸€æ£µtreapçš„æ‰€æœ‰ç»“ç‚¹å°äºå¦ä¸€æ£µã€‚</li>
<li>å¼ºè¡ŒåŠ å…¥ä¸€ä¸ªè™šæ‹Ÿç»“ç‚¹ä½œä¸ºæ ¹ï¼ˆä¼˜å…ˆçº§ä¸ºæ— é™å°ï¼‰ï¼Œè¿æ¥ä¸¤æ£µtreapï¼Œç„¶ååˆ é™¤è™šæ‹Ÿç»“ç‚¹ã€‚</li>
</ul>
</li>
</ul>
<h2 id="Splay"><a href="#Splay" class="headerlink" title="Splay"></a>Splay</h2><ul>
<li>æ‹¥æœ‰å°†æŸä¸€ä¸ªç»“ç‚¹æ—‹è½¬åˆ°æ ¹çš„æ“ä½œSplay(&amp;root, const x)ï¼Œå¹¶åœ¨å¤§å¤šæ•°æ“ä½œä¸­ä¸»åŠ¨è°ƒç”¨splay()</li>
<li>æ–°å»ºç»“ç‚¹newNode(const v, const father &#x3D; 0)<ul>
<li>è¿”å›åœ°å€</li>
</ul>
</li>
<li>æ—‹è½¬ï¼š<ul>
<li>å› ä¸ºsplay()æ—‹è½¬æ¶‰åŠå¾ˆå¤šä»£ç»“ç‚¹ï¼Œä¸èƒ½ç”¨å¼•ç”¨ç®€åŒ–ä»£ç ï¼Œå¿…é¡»å­˜çˆ¶äº²æŒ‡é’ˆã€‚å¯¹åº”çš„å­©å­æŒ‡é’ˆã€çˆ¶äº²æŒ‡é’ˆå¿…é¡»æˆå¯¹ä¿®æ”¹ã€‚</li>
<li><strong>å‚æ•°æ˜¯è¢«æ—‹è½¬å­æ ‘æ ¹çš„å­©å­</strong>ï¼Œå…ˆå¤„ç†ç¥–å…ˆçš„å­©å­æŒ‡é’ˆï¼Œå†å¤„ç†å­©å­çš„çˆ¶äº²æŒ‡é’ˆï¼Œæœ€åå¤„ç†è¢«æ—‹è½¬çš„ä¸¤ä¸ªç»“ç‚¹çš„æŒ‡é’ˆã€‚â€œä¸Šæœ‰è€ ä¸‹æœ‰å° æ±‚æ”¾è¿‡...â€</li>
<li>å¯èƒ½ä¼šå¯¼è‡´<strong>splayæ ‘æ ¹çš„æ”¹å˜</strong>ï¼Œä½†æ˜¯åªæœ‰splay()å¯¼è‡´æ—‹è½¬ï¼Œsplay()ä¸­è‡ªå¸¦æ ¹çš„è®°å½•ã€‚</li>
<li>æ²¡æœ‰è¿”å›å€¼ï¼Œå› ä¸ºåœ°å€å¯¹åº”çš„å†…å®¹æ²¡æœ‰å˜ã€‚</li>
</ul>
</li>
<li>Splay(&amp;root, const x)ï¼š<ul>
<li>å‚æ•°rootæ˜¯splayæ ‘æ ¹ï¼Œxæ˜¯ç»“ç‚¹åœ°å€ã€‚<strong>rootå¿…é¡»å¼•ç”¨</strong>ï¼Œå› ä¸ºsplayæ“ä½œä¼šæ›´æ”¹æ ‘æ ¹ã€‚</li>
<li><strong>æ‰€æœ‰åŒ…å«splay()çš„å‡½æ•°</strong>éƒ½è¦å¼•ç”¨root</li>
<li>ä¾èµ–äºç¥–å…ˆä¸¤ä»£ã€‚è‹¥xä»…æœ‰çˆ¶äº²è€Œæ²¡æœ‰ç¥–çˆ¶ï¼Œç›¸åº”åœ°æ—‹è½¬å°±å¥½äº†ã€‚<strong>å¦‚æœxæœ‰ç¥–çˆ¶ï¼Œè€Œä¸”ä¸‰ç‚¹â€œå…±çº¿â€ï¼Œå°±è¦å…ˆæ—‹è½¬çˆ¶äº²</strong>ï¼Œåæ—‹è½¬xï¼›å¦‚æœä¸‰ç‚¹ä¸â€œå…±çº¿â€ï¼Œæ­£å¸¸åœ°åšå°±å¥½ã€‚</li>
</ul>
</li>
<li>æ’å…¥(&amp;root, const v)<ul>
<li><strong>è‡ªå¸¦æŸ¥æ‰¾</strong></li>
<li>å…ˆåˆ¤æ ¹ï¼Œç„¶åå¼€å§‹å¾ªç¯</li>
<li>ä¿å­˜çˆ¶äº²yï¼Œå¼•ç”¨å­©å­xï¼Œè‹¥x&#x3D;&#x3D;0 åˆ™ x&#x3D;newNode</li>
<li>å› ä¸ºæ’å…¥åŒ…å«äº†splay()ï¼Œæ‰€ä»¥è¦å¸¦å¼•ç”¨rootã€‚</li>
</ul>
</li>
<li>åˆ é™¤(&amp;root, const v)ï¼š<ul>
<li><strong>è‡ªå¸¦æŸ¥æ‰¾</strong></li>
<li>å› ä¸ºåˆ é™¤åŒ…å«äº†splay()ï¼Œæ‰€ä»¥è¦å¸¦<strong>å¼•ç”¨root</strong>ã€‚</li>
<li>å¦‚æœè¢«åˆ ç»“ç‚¹æ˜¯<strong>å¤–ç»“ç‚¹</strong>ï¼Œè½»æ¾è‡ªæ€ï¼Œsplay()æ›¿èº«æˆ–è€…splay()çˆ¶äº²ã€‚</li>
<li>å¦‚æœè¢«åˆ ç»“ç‚¹ä¸æ˜¯å¤–ç»“ç‚¹ï¼Œé‚£ä¹ˆè¢«åˆ ç»“ç‚¹è‚¯å®šæœ‰å‰é©±å’Œåç»§<strong>åœ¨å­æ ‘ä¸Š</strong>ï¼Œä»»å–ä¸€ä¸ªä»£æ›¿è‡ªå·±ï¼Œç„¶åsplay()è‡ªå·±</li>
</ul>
</li>
<li>å‰é©±åç»§(&amp;root const v) &#x2F; (&amp;root const x)<ul>
<li><strong>å°†xæ—‹åˆ°æ ¹</strong>ï¼Œå‰é©±å°±æ˜¯å·¦å­æ ‘çš„æœ€å³ç»“ç‚¹ï¼Œåç»§å°±æ˜¯å³å­æ ‘çš„æœ€å·¦ç»“ç‚¹ã€‚</li>
<li>å› ä¸ºåŒ…å«äº†splay()ï¼Œæ‰€ä»¥è¦å¸¦<strong>å¼•ç”¨root</strong>ã€‚</li>
</ul>
</li>
<li>æœ‰åºåˆå¹¶join(&amp;s1, s2)ï¼š<ul>
<li>å°†s1çš„æœ€å¤§å…ƒç´ splayåˆ°æ ¹ï¼Œç„¶åå°†s2è®¾ä¸ºs1çš„å³å­æ ‘</li>
<li>å› ä¸ºå«æœ‰splay()ï¼Œæ‰€ä»¥è¦å¸¦<strong>å¼•ç”¨root</strong>ã€‚</li>
</ul>
</li>
<li>æ— åºåˆå¹¶Merge(s1, s2)ï¼š<ul>
<li><strong>ä¾èµ–äºé¢å¤–æ•°æ®åŸŸsize</strong></li>
<li>éå†sizeå°çš„splayæ ‘ï¼Œé€ä¸ªæ’å…¥åˆ°å¦ä¸€é¢—splayæ ‘ä¸Š</li>
</ul>
</li>
<li>åˆ’åˆ†split(&amp;root, const v)<ul>
<li><strong>è‡ªå¸¦æŸ¥æ‰¾</strong></li>
<li>å°†å…³é”®å­—ä¸ºvçš„ç»“ç‚¹splayåˆ°æ ¹ï¼Œå·¦å³å­æ ‘åˆ†å¼€å³å¯ã€‚</li>
<li>å› ä¸ºå«æœ‰splay()ï¼Œæ‰€ä»¥è¦å¸¦<strong>å¼•ç”¨root</strong>ã€‚</li>
</ul>
</li>
<li><strong>splayæ ‘åº”ç”¨åŒºé—´æ“ä½œ</strong><ul>
<li><strong>å…³é”®å­—å°†æ˜¯ä¸‹æ ‡ï¼Œæˆ–è€…æ²¡æœ‰å…³é”®å­—</strong>ã€‚åœ¨ä¸€äº›ä¸‹æ ‡å¯èƒ½é›†ä½“ç§»åŠ¨çš„åœºåˆï¼Œå®œä¸è®¾å…³é”®å­—ã€‚</li>
<li><strong>ç»“ç‚¹è®°å½•å­æ ‘çš„æ€»ä½“ä¿¡æ¯</strong>ï¼Œç±»ä¼¼çº¿æ®µæ ‘ï¼Œå¯åŒ…å«å»¶è¿Ÿæ ‡è®°ã€‚</li>
<li>å¯¹åŒºé—´[a,b]æ“ä½œï¼šå°†a-1æ—‹åˆ°æ ¹ï¼Œåˆ‡æ‰å³å­æ ‘(b+1åœ¨å…¶ä¸­)ï¼Œå†å°†b+1æ—‹è½¬åˆ°æ ¹ï¼Œé‡æ–°è¿æ¥ä¸¤æ£µæ ‘ã€‚è¿™æ—¶<strong>b+1çš„å·¦å­æ ‘å°±æ˜¯[a,b]</strong> ã€‚</li>
<li>åœ¨[a,a+1]ä¸­é—´æ’å…¥ä¸€äº›æ•°ï¼šå°†è¢«æ’å…¥çš„æ•°æ„å»ºæˆsplayæ ‘ã€‚å°†aæ—‹åˆ°æ ¹ï¼Œa+1æ—‹åˆ°æ ¹çš„å³å­©å­ã€‚å°†æ–°å»ºçš„splayæ ‘æŒ‚æˆa+1çš„å·¦å­©å­ã€‚</li>
<li>é‡è¦çš„äº‹æƒ…è¯´néä¹Ÿä¸å«Œå¤šï¼šå°å¿ƒrootè¢«æ›´æ”¹ã€‚å…·ä½“åœ°è¯´å°±æ˜¯splay()è¦æ¢æ ¹ï¼Œåªæœ‰splay()æ‰èƒ½ä½¿ç”¨æ—‹è½¬ã€‚</li>
</ul>
</li>
</ul>
<h2 id="æ™®é€šæ’åºäºŒå‰æ ‘"><a href="#æ™®é€šæ’åºäºŒå‰æ ‘" class="headerlink" title="æ™®é€šæ’åºäºŒå‰æ ‘"></a>æ™®é€šæ’åºäºŒå‰æ ‘</h2><ul>
<li>é‡ç‚¹æ˜¯å‰é©±å’Œåç»§</li>
<li>å‰é©±(const v)<ul>
<li><strong>å¿…é¡»è‡ªå¸¦æŸ¥æ‰¾</strong></li>
<li>åœ¨æŸ¥æ‰¾æˆåŠŸä¹‹å‰ï¼Œ<strong>è®°å½•æœ€åä¸€ä¸ªå¾€å³èµ°çš„ç»“ç‚¹</strong>ï¼Œå› ä¸ºå®ƒå¯èƒ½æ˜¯å‰é©±</li>
<li>æŸ¥æ‰¾æˆåŠŸä¹‹åï¼Œå¦‚æœç»“ç‚¹æœ‰å·¦å­æ ‘ï¼Œé‚£ä¹ˆå·¦å­æ ‘çš„æœ€å¤§ç»“ç‚¹ä¸€å®šæ˜¯å‰é©±</li>
<li>å¦‚æœä¸€ä¸ªç»“ç‚¹æ˜¯æ•´æ£µæ ‘çš„æœ€å·¦ï¼ˆæœ€å°ï¼‰ç»“ç‚¹ï¼Œé‚£ä¹ˆå®ƒæ²¡æœ‰å‰é©±ã€‚</li>
</ul>
</li>
<li>åç»§(const v)<ul>
<li>åŒå‰é©±</li>
</ul>
</li>
</ul>
]]></content>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>æœèŠ±å¤•æ‹¾</tag>
      </tags>
  </entry>
  <entry>
    <title>æœèŠ±å¤•æ‹¾-åˆ†æ²»æœ€å°å‰²</title>
    <url>/2016/04/27/%E6%9C%9D%E8%8A%B1%E5%A4%95%E6%8B%BE-%E5%88%86%E6%B2%BB%E6%9C%80%E5%B0%8F%E5%89%B2/</url>
    <content><![CDATA[<p>å¯¹äºè¯¢é—®ç½‘ç»œå›¾ä¸­æ¯ä¸ªç‚¹å¯¹çš„æœ€å¤§æµï¼ˆæœ€å°å‰²å®¹é‡ï¼‰ï¼Œæ€»æ˜¯å¯ä»¥å°†å›¾ç®€åŒ–æˆnä¸ªç‚¹n-1æ¡è¾¹çš„æ ‘å‹å›¾ï¼Œè¾¹ä¸Šæ ‡æœ‰ä¸€äº›å®¹é‡ï¼Œä½¿å¾—åœ¨æ ‘ä¸Šè¯¢é—®æ¯ä¸ªç‚¹å¯¹çš„æœ€å¤§æµç­‰ä»·äºåŸé—®é¢˜ã€‚</p>
<span id="more"></span>

<p>ä¸Šæ–‡æåˆ°çš„æ ‘å«ä½œGomoryâ€“Hu treeï¼Œå…¶æ„é€ æ–¹æ³•æ˜¯ï¼š</p>
<ol>
<li>å°†æ‰€æœ‰ç‚¹çš„æ”¾åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚</li>
<li>é€‰ä¸€ä¸ªå…ƒç´ ä¸ªæ•°è‡³å°‘ä¸º2çš„é›†åˆï¼ˆä¸å¦¨è®¾å…¶ä¸ºé›†åˆRï¼‰ä¸­ä»»å–ä¸¤ä¸ªç‚¹ä½œä¸ºåŸå›¾çš„æºç‚¹å’Œæ±‡ç‚¹ï¼Œè·‘ä¸€æ¬¡æœ€å¤§æµï¼Œå°±ä¼šå°†åŸå›¾ä¸Šçš„æ‰€æœ‰ç‚¹åˆ†å‰²ä¸ºä¸¤éƒ¨åˆ†ï¼Œè¦ä¹ˆä¸Sè”é€šï¼Œè¦ä¹ˆä¸Tè”é€šã€‚</li>
<li>åœ¨æ®‹ä½™å›¾ä¸­ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹vâˆˆRï¼Œè‹¥vä¸Sè”é€šï¼Œåˆ™vç•™åœ¨é›†åˆRï¼Œå¦åˆ™å°†vç§»é™¤å¹¶æ”¾ç½®äºæ–°é›†åˆR&#39;ä¸­ã€‚åœ¨Gomoryâ€“Hu treeä¸­ï¼Œæœ‰è¾¹(R,R&#39;)ï¼Œè¾¹æƒï¼ˆå®¹é‡ï¼‰æ˜¯2.ä¸­æœ€å¤§æµçš„å€¼ã€‚</li>
<li>è¿˜åŸåŸç½‘ç»œå›¾ï¼Œé‡å¤2ï¼Œ3ï¼Œ4è‡³æ‰€æœ‰é›†åˆæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå…ƒç´ ã€‚æ­¤æ—¶Gomoryâ€“Hu treeå»ºå›¾å®Œæ¯•ã€‚</li>
</ol>
<p>è¯¢é—®ç½‘ç»œå›¾ä¸­æ¯ä¸ªç‚¹å¯¹çš„æœ€å¤§æµï¼Œç­‰ä»·äºè¯¢é—®Gomoryâ€“Hu treeä¸Šå¯¹åº”ç‚¹è·¯å¾„è¾¹æƒçš„æœ€å°å€¼ï¼Œå¯ä»¥ç”¨æ ‘é“¾å‰–åˆ†ç»´æŠ¤ã€‚</p>
<h1 id="bzoj4519-ä¸åŒçš„æœ€å°å‰²"><a href="#bzoj4519-ä¸åŒçš„æœ€å°å‰²" class="headerlink" title="bzoj4519 ä¸åŒçš„æœ€å°å‰²"></a>bzoj4519 ä¸åŒçš„æœ€å°å‰²</h1><h2 id="cuts"><a href="#cuts" class="headerlink" title="cuts"></a>cuts</h2><h4 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h4><p>å­¦è¿‡å›¾è®ºçš„åŒå­¦éƒ½çŸ¥é“æœ€å°å‰²çš„æ¦‚å¿µï¼šå¯¹äºä¸€ä¸ªå›¾ï¼ŒæŸä¸ªå¯¹å›¾ä¸­ç»“ç‚¹çš„åˆ’åˆ†å°†å›¾ä¸­æ‰€æœ‰ç»“ç‚¹åˆ†æˆ<br>ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå¦‚æœç»“ç‚¹ s,t ä¸åœ¨åŒä¸€ä¸ªéƒ¨åˆ†ä¸­ï¼Œåˆ™ç§°è¿™ä¸ªåˆ’åˆ†æ˜¯å…³äº s,t çš„å‰²ã€‚å¯¹äºå¸¦æƒå›¾æ¥è¯´ï¼Œå°†<br>æ‰€æœ‰é¡¶ç‚¹å¤„åœ¨ä¸åŒéƒ¨åˆ†çš„è¾¹çš„æƒå€¼ç›¸åŠ æ‰€å¾—åˆ°çš„å€¼å®šä¹‰ä¸ºè¿™ä¸ªå‰²çš„å®¹é‡ï¼Œè€Œ s,t çš„æœ€å°å‰²æŒ‡çš„æ˜¯åœ¨<br>å…³äº s,t çš„å‰²ä¸­å®¹é‡æœ€å°çš„å‰²ã€‚<br>è€Œå¯¹å†²åˆº NOI ç«èµ›çš„é€‰æ‰‹è€Œè¨€ï¼Œæ±‚å¸¦æƒå›¾ä¸­ä¸¤ç‚¹çš„æœ€å°å‰²å·²ç»ä¸æ˜¯ä»€ä¹ˆéš¾äº‹äº†ã€‚æˆ‘ä»¬å¯ä»¥æŠŠ<br>è§†é‡æ”¾å®½ï¼Œè€ƒè™‘æœ‰ N ä¸ªç‚¹çš„æ— å‘è¿é€šå›¾ä¸­æ‰€æœ‰ç‚¹å¯¹çš„æœ€å°å‰²çš„å®¹é‡ï¼Œå…±èƒ½å¾—åˆ° N ( N ? 1)<br>2 ä¸ªæ•°å€¼ã€‚<br>è¿™äº›æ•°å€¼ä¸­äº’ä¸ç›¸åŒçš„æœ‰å¤šå°‘ä¸ªå‘¢ï¼Ÿè¿™ä¼¼ä¹æ˜¯ä¸ªæœ‰è¶£çš„é—®é¢˜ã€‚</p>
<h4 id="è¾“å…¥æ ¼å¼"><a href="#è¾“å…¥æ ¼å¼" class="headerlink" title="è¾“å…¥æ ¼å¼"></a>è¾“å…¥æ ¼å¼</h4><p>è¾“å…¥æ–‡ä»¶ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•° Nï¼Œ Mï¼Œè¡¨ç¤ºç‚¹æ•°å’Œè¾¹æ•°ã€‚æ¥ä¸‹æ¥ M è¡Œï¼Œæ¯è¡Œä¸‰ä¸ªæ•° uï¼Œ vï¼Œ wï¼Œè¡¨ç¤º<br>ç‚¹ u å’Œç‚¹ vï¼ˆä» 1 å¼€å§‹æ ‡å·ï¼‰ä¹‹é—´æœ‰æ¡è¾¹æƒå€¼æ˜¯ wã€‚</p>
<h4 id="è¾“å‡ºæ ¼å¼"><a href="#è¾“å‡ºæ ¼å¼" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h4><p>è¾“å‡ºæ–‡ä»¶ç¬¬ä¸€è¡Œä¸ºä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºä¸ªæ•°ã€‚</p>
<h4 id="æ ·ä¾‹è¾“å…¥"><a href="#æ ·ä¾‹è¾“å…¥" class="headerlink" title="æ ·ä¾‹è¾“å…¥"></a>æ ·ä¾‹è¾“å…¥</h4><p>4 4<br>1 2 3<br>1 3 6<br>2 4 5<br>3 4 4</p>
<h4 id="æ ·ä¾‹è¾“å‡º"><a href="#æ ·ä¾‹è¾“å‡º" class="headerlink" title="æ ·ä¾‹è¾“å‡º"></a>æ ·ä¾‹è¾“å‡º</h4><p>3</p>
<h4 id="èŒƒå›´çº¦å®š"><a href="#èŒƒå›´çº¦å®š" class="headerlink" title="èŒƒå›´çº¦å®š"></a>èŒƒå›´çº¦å®š</h4><p>? å¯¹äº 50% çš„æ•°æ®ï¼Œ N â‰¤ 200ï¼Œ M â‰¤ 2000<br>? å¯¹äº 100% çš„æ•°æ®ï¼Œ 1 â‰¤ N â‰¤ 850ï¼Œ 1 â‰¤ M â‰¤ 8500ï¼Œ 1 â‰¤ w â‰¤ 100000</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ri</span><span class="params">(<span class="type">int</span>&amp;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">860</span>, M = <span class="number">8510</span>*<span class="number">4</span>, INF = <span class="number">1</span>&lt;&lt;<span class="number">29</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> to[M], nex[M], index[MAXN], mcap[M], cap[M], cur=<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> pn[MAXN], tmppn[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> cap)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> q[MAXN], qh, qt, flag[MAXN], fa[MAXN], path[MAXN], FLOW[MAXN], cntf=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">bfs</span><span class="params">(<span class="type">int</span> S, <span class="type">int</span> T)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	qh = <span class="number">0</span>; qt = <span class="number">1</span>;</span><br><span class="line">	<span class="built_in">memset</span>(flag, <span class="number">-1</span>, <span class="built_in">sizeof</span>(<span class="type">int</span>)*(n+<span class="number">3</span>));</span><br><span class="line">	flag[S] = <span class="number">1</span>;</span><br><span class="line">	q[<span class="number">0</span>] = S;</span><br><span class="line">	<span class="keyword">while</span> (qh &lt; qt)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">int</span> x = q[qh++];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=index[x]; i!=<span class="number">-1</span>; i=nex[i])</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (flag[to[i]]==<span class="number">-1</span> &amp;&amp; cap[i]&gt;<span class="number">0</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				flag[to[i]] = flag[x]+<span class="number">1</span>;</span><br><span class="line">				q[qt++] = to[i];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> flag[T];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Dinic</span><span class="params">(<span class="type">int</span> S, <span class="type">int</span> T)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> depth;</span><br><span class="line">	<span class="type">int</span> flow = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">bfs</span>(S, T)!=<span class="number">-1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		fa[depth=<span class="number">1</span>] = S;</span><br><span class="line">		<span class="keyword">while</span> (<span class="number">0</span> &lt; depth)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (fa[depth] == T)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="type">int</span> minc = INF, mink;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>; i&lt;depth; ++i)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> (cap[path[i]] &lt; minc)</span><br><span class="line">					&#123;</span><br><span class="line">						minc = cap[path[i]];</span><br><span class="line">						mink = i;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				flow += minc;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>; i&lt;depth; ++i)</span><br><span class="line">				&#123;</span><br><span class="line">					cap[path[i]] -= minc;</span><br><span class="line">					cap[path[i]^<span class="number">1</span>]+= minc;</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				depth = mink;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="type">bool</span> alive = <span class="literal">false</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i=index[fa[depth]]; i!=<span class="number">-1</span>; i=nex[i])</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (flag[fa[depth]]+<span class="number">1</span>==flag[to[i]] &amp;&amp; cap[i]&gt;<span class="number">0</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					path[depth] = i;</span><br><span class="line">					fa[++depth] = to[i];</span><br><span class="line">					alive = <span class="literal">true</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (!alive) &#123; flag[fa[depth]] = <span class="number">-1</span>; --depth; &#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	FLOW[cntf++] = flow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==r) <span class="keyword">return</span>;</span><br><span class="line">	<span class="built_in">memcpy</span>(cap, mcap, <span class="built_in">sizeof</span>(<span class="type">int</span>)*cur);</span><br><span class="line">	<span class="built_in">Dinic</span>(pn[l], pn[r]);</span><br><span class="line">	<span class="type">int</span> lpart = l<span class="number">-1</span>, rpart = r+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=l; i&lt;=r; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (flag[pn[i]]!=<span class="number">-1</span>)</span><br><span class="line">			tmppn[++lpart] = pn[i];</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			tmppn[--rpart] = pn[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=l; i&lt;=r; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		pn[i] = tmppn[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">dfs</span>(l, lpart);</span><br><span class="line">	<span class="built_in">dfs</span>(rpart, r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;cuts.in&quot;</span>, <span class="string">&quot;r&quot;</span>, stdin);</span><br><span class="line">	<span class="built_in">freopen</span>(<span class="string">&quot;cuts.out&quot;</span>, <span class="string">&quot;w&quot;</span>, stdout);</span><br><span class="line">	<span class="built_in">memset</span>(index, <span class="number">-1</span>, <span class="built_in">sizeof</span>(index));</span><br><span class="line">	<span class="built_in">ri</span>(n);</span><br><span class="line">	<span class="built_in">ri</span>(m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>, a, b, c; i&lt;m; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">ri</span>(a); <span class="built_in">ri</span>(b); <span class="built_in">ri</span>(c);</span><br><span class="line">		<span class="built_in">addEdge</span>(a, b, c);</span><br><span class="line">		<span class="built_in">addEdge</span>(b, a, c);</span><br><span class="line"><span class="comment">//		assert(cur &lt; 8500*4);</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; ++i) pn[i] = i;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">dfs</span>(<span class="number">1</span>, n);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">sort</span>(FLOW, FLOW+cntf);</span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> ans = <span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>; i&lt;cntf; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (FLOW[i]!=FLOW[i<span class="number">-1</span>]) ++ans;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, ans);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">int</span> c)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	to[cur] = b; mcap[cur] = c; nex[cur] = index[a]; index[a] = cur++;</span><br><span class="line">	to[cur] = a; mcap[cur] = <span class="number">0</span>; nex[cur] = index[b]; index[b] = cur++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ri</span><span class="params">(<span class="type">int</span> &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">char</span> c;</span><br><span class="line">	<span class="keyword">while</span> ((c=<span class="built_in">getchar</span>())&lt;<span class="string">&#x27;0&#x27;</span> || <span class="string">&#x27;9&#x27;</span>&lt;c);</span><br><span class="line">	x = c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">	<span class="keyword">while</span> (<span class="string">&#x27;0&#x27;</span>&lt;=(c=<span class="built_in">getchar</span>()) &amp;&amp; c&lt;=<span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">		x = <span class="number">10</span>*x + c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line"><span class="comment">//	cerr &lt;&lt; x &lt;&lt; endl;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>æœèŠ±å¤•æ‹¾</tag>
        <tag>å›¾è®º</tag>
      </tags>
  </entry>
  <entry>
    <title>æœèŠ±å¤•æ‹¾-æ¡¥ä¸å¼ºè¿é€šåˆ†é‡</title>
    <url>/2015/11/06/%E6%9C%9D%E8%8A%B1%E5%A4%95%E6%8B%BE-%E6%A1%A5%E4%B8%8E%E5%BC%BA%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/</url>
    <content><![CDATA[<p>[toc]</p>
<span id="more"></span>

<h1 id="æ¡¥"><a href="#æ¡¥" class="headerlink" title="æ¡¥"></a>æ¡¥</h1><ul>
<li>æ¡¥æ˜¯åœ¨æ— å‘å›¾ä¸­ä¸åœ¨ç¯ä¸Šçš„è¾¹.</li>
<li>å¦‚æœéš”æ–­æ¡¥ï¼Œæ— å‘å›¾å°†è¢«åˆ†ä¸ºä¸¤ä¸ªä¸è¿é€šçš„å­å›¾.</li>
</ul>
<h1 id="å‰²ç‚¹"><a href="#å‰²ç‚¹" class="headerlink" title="å‰²ç‚¹"></a>å‰²ç‚¹</h1><ul>
<li>å¦‚æœåˆ å»ä¸€ä¸ªç‚¹, ä½™ä¸‹çš„ç‚¹ä¸è¿é€š, åˆ™è¿™ä¸ªç‚¹æ˜¯å‰²ç‚¹.</li>
<li>å‰²ç‚¹ä¸ä¾èµ–æ¡¥, æ¡¥ä¸Šä¹Ÿä¸ä¸€å®šå­˜åœ¨å‰²ç‚¹.</li>
</ul>
<h1 id="å¦‚ä½•æ‰¾æ¡¥å’Œå‰²ç‚¹"><a href="#å¦‚ä½•æ‰¾æ¡¥å’Œå‰²ç‚¹" class="headerlink" title="å¦‚ä½•æ‰¾æ¡¥å’Œå‰²ç‚¹"></a>å¦‚ä½•æ‰¾æ¡¥å’Œå‰²ç‚¹</h1><ol>
<li>ä»»é€‰å›¾ä¸Šä¸€ç‚¹ä¸ºæ ¹, dfs.<ul>
<li>è®°å½•æ¯ä¸ªèŠ‚ç‚¹é¦–æ¬¡è¢«è®¿é—®çš„æ¬¡åº, è®°ä½œdfn[x].</li>
<li>è®°å½•æ¯ä¸ªèŠ‚ç‚¹èƒ½è¿æ¥æˆ–é€šè¿‡å­èŠ‚ç‚¹è¿æ¥åˆ°çš„æœ€æ—©èŠ‚ç‚¹çš„dfn, ä¸”ä¸èƒ½æ²¿çˆ¶äº²è¾¹, è®°ä½œlow[x].</li>
<li>dfs(x)å°†è¿”å›low[x].</li>
</ul>
</li>
<li>åœ¨æ¯ä¸ªdfsä¸­, è®¾å½“å‰èŠ‚ç‚¹ä¸ºx, æšä¸¾è¾¹è¿åˆ°y.<ul>
<li>å¦‚æœdfn[y]æœªå®šä¹‰, åˆ™yæ˜¯xåœ¨æœç´¢æ ‘ä¸Šçš„å„¿å­. low[x] &#x3D; min(low[x], dfs(y)).</li>
<li>å¦‚æœy &#x3D;&#x3D; fa[x], åˆ™yæ˜¯xåœ¨æœç´¢æ ‘ä¸Šçš„çˆ¶äº², ä¸ç®¡æ­¤y</li>
<li>è‹¥dfn[y]æœ‰å®šä¹‰ä¸”y!&#x3D;fa[x], åˆ™yå³æ˜¯xé€šè¿‡éçˆ¶å­è¾¹è¿åˆ°çš„èŠ‚ç‚¹, å°è¯•ç”¨dfn[y]æ›´æ–°low[x].</li>
</ul>
</li>
<li>åˆ©ç”¨æ¡¥å’Œå‰²ç‚¹çš„æ€§è´¨åˆ¤å®š.</li>
</ol>
<h2 id="æ€§è´¨-x2F-ä¾æ®"><a href="#æ€§è´¨-x2F-ä¾æ®" class="headerlink" title="æ€§è´¨&#x2F;ä¾æ®"></a>æ€§è´¨&#x2F;ä¾æ®</h2><h3 id="æ²¿xçš„è¾¹æ‰¾å…¶ä»–èŠ‚ç‚¹y"><a href="#æ²¿xçš„è¾¹æ‰¾å…¶ä»–èŠ‚ç‚¹y" class="headerlink" title="æ²¿xçš„è¾¹æ‰¾å…¶ä»–èŠ‚ç‚¹y."></a>æ²¿xçš„è¾¹æ‰¾å…¶ä»–èŠ‚ç‚¹y.</h3><ol>
<li>dfn[y]æœ‰å®šä¹‰ &lt;&#x3D;&#x3D;&gt; yæ˜¯xåœ¨æœç´¢æ ‘ä¸­çš„ç¥–å…ˆ<ul>
<li>å……åˆ†æ€§æ˜¯æ˜¾ç„¶çš„.</li>
<li>å¿…è¦æ€§: è‹¥yä¸æ˜¯ç¥–å…ˆ, åˆ™yæ˜¯å…„å¼Ÿæˆ–ç¥–å…ˆçš„å…„å¼Ÿ. åˆå› ä¸ºdfn[y]æœ‰å®šä¹‰, æ‰€ä»¥yä¸€å®šå®Œæˆäº†dfsçš„è¿‡ç¨‹, ä½†xå’Œyè¿æ¥çš„è¾¹å´æ²¡æœ‰å¤„ç†, çŸ›ç›¾.</li>
<li>å°è¯•ç”¨dfn[y]æ›´æ–°low[x], è€Œä¸æ˜¯ç”¨low[y]. (ä½¿å›æº¯è¾¹ä¸ç»è¿‡ç¥–å…ˆç‚¹). è¿™æ ·èƒ½ä¿æŒç®—æ³•çš„æ­£ç¡®æ€§. å¦åˆ™å› ä¸ºå›æº¯è¾¹ç»è¿‡å‰²ç‚¹åœ¨æ‰¾å‰²ç‚¹æ—¶äº§ç”Ÿé”™è¯¯.</li>
</ul>
</li>
<li>è‹¥yæ˜¯xåœ¨æœç´¢æ ‘ä¸Šçš„éç¬¬ä¸€ä¸ªå„¿å­:<ul>
<li>è‹¥xæ˜¯æ ¹, åˆ™yä¸ä¹‹å‰çš„å„¿å­ä»¥xä¸ºå‰²ç‚¹.</li>
<li>è‹¥xä¸æ˜¯æ ¹, åˆ™yä¸ä¹‹å‰çš„å„¿å­å¯èƒ½ç»è¿‡xçš„ç¥–å…ˆè”é€š.<ul>
<li>å¦‚æœéªŒè¯yä¸xçš„ç¥–å…ˆä¸è¿é€š, åˆ™xæ˜¯ä¸¤è€…çš„å‰²ç‚¹.</li>
<li>å¦‚æœéªŒè¯yä¸xçš„ç¥–å…ˆä¸è¿é€š, åˆ™xæ˜¯yä¸å…¶ä»–å„¿å­çš„å‰²ç‚¹(å¦åˆ™yå·²ç»è¢«è®¿é—®è¿‡, ä¸ä¼šæ˜¯xçš„å„¿å­.)</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="æ¡¥çš„æ€§è´¨"><a href="#æ¡¥çš„æ€§è´¨" class="headerlink" title="æ¡¥çš„æ€§è´¨"></a>æ¡¥çš„æ€§è´¨</h3><ol>
<li>æ¡¥æ˜¯ä¸€æ¡è¾¹, è¿æ¥ç€åœ¨æœç´¢æ ‘ä¸­çš„çˆ¶äº²å’Œå„¿å­&#x2F;ç¥–å…ˆå’Œå„¿å­</li>
<li>è®¾ä¸€æ¡è¾¹è¿æ¥ç€ç¥–å…ˆèŠ‚ç‚¹u, å„¿å­èŠ‚ç‚¹v, è‹¥dfn[u]&lt;low[v], åˆ™è‹¥è¾¹åˆ é™¤, ç¥–å…ˆå„¿å­æ— æ³•è¿é€š, å³æ­¤è¾¹æ˜¯æ¡¥. åä¹‹äº¦ç„¶: è¾¹(u, v)æ˜¯æ¡¥ &lt;&#x3D;&#x3D;&gt; dfn[u]&lt;low[v] (uæ˜¯vçš„ç¥–å…ˆ)</li>
</ol>
<h3 id="å‰²ç‚¹çš„æ€§è´¨"><a href="#å‰²ç‚¹çš„æ€§è´¨" class="headerlink" title="å‰²ç‚¹çš„æ€§è´¨"></a>å‰²ç‚¹çš„æ€§è´¨</h3><ol>
<li>å‰²ç‚¹æ˜¯ä¸€ä¸ªç‚¹, å®ƒè¦ä¹ˆæ˜¯æ ¹èŠ‚ç‚¹, è¦ä¹ˆæœ‰ä¸€ä¸ªçˆ¶äº²èŠ‚ç‚¹.</li>
<li>å¯¹äºæ ¹èŠ‚ç‚¹, è‹¥æœç´¢æ ‘ä¸Šæ ¹èŠ‚ç‚¹æœ‰å¤šä½™ä¸€ä¸ªå„¿å­, åˆ™ä»»æ„ä¸¤å¯¹å„¿å­ä»¥æ ¹èŠ‚ç‚¹ä¸ºå‰²ç‚¹.</li>
<li>å¯¹äºéæ ¹èŠ‚ç‚¹, è®¾ä¸ºu, å…¶çˆ¶äº²ä¸ºfa, å„¿å­v(i), è‹¥dfn[u] &lt;&#x3D; low[v], åˆ™è‹¥uåˆ é™¤, fa&#x2F;vä¸è¿é€š, å³uæ˜¯å‰²ç‚¹;  ç‰¹åˆ«åœ°, dfn[u] &lt;&#x3D; low[v1], åˆ™v1ä¸v2, v3....éƒ½ä»¥faä¸ºå‰²ç‚¹.</li>
</ol>
<p>æ‰¾æ¡¥ï¼šç”¨dfséå†å›¾ï¼Œè®°å½•ç»“ç‚¹è®¿é—®æ¬¡åºï¼›å½“æŸä¸ªç»“ç‚¹æœ‰ä¸€æ¡è¾¹é€šå¾€å·²è¢«è®¿é—®è¿‡çš„ç»“ç‚¹æ—¶ï¼Œä»£è¡¨æ‰¾åˆ°äº†ç¯ï¼›ä¸åœ¨ç¯ä¸Šçš„è¾¹å°±æ˜¯æ¡¥ã€‚</p>
<h1 id="å¼ºè¿é€šåˆ†é‡"><a href="#å¼ºè¿é€šåˆ†é‡" class="headerlink" title="å¼ºè¿é€šåˆ†é‡"></a>å¼ºè¿é€šåˆ†é‡</h1><p>åœ¨æœ‰å‘å›¾ä¸­ä¸¤ä¸ªé¡¶ç‚¹Viï¼ŒVjä¹‹é—´æœ‰ä¸€æ¡ä»Viåˆ°Vjçš„æœ‰å‘è·¯å¾„ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€æ¡ä»vjåˆ°viçš„æœ‰å‘è·¯å¾„ï¼Œåˆ™ç§°ä¸¤ä¸ªé¡¶ç‚¹å¼ºè¿é€šã€‚å¦‚æœæœ‰å‘å›¾Gçš„æ¯ä¸¤ä¸ªé¡¶ç‚¹éƒ½å¼ºè¿é€šï¼Œç§°Gæ˜¯ä¸€ä¸ªå¼ºè¿é€šå›¾ã€‚æœ‰å‘å›¾çš„æå¤§å¼ºè¿é€šå­å›¾ï¼Œç§°ä¸ºå¼ºè¿é€šåˆ†é‡ï¼ˆç™¾åº¦ç™¾ç§‘ï¼‰</p>
<p>Kosarajuç®—æ³•:</p>
<p>1ã€æ·±æœéå†åŸå›¾Gå›¾ï¼Œè®°å½•æ¯ä¸ªç»“ç‚¹ç¦»å¼€æ—¶é—´ï¼ˆååºéå†ï¼‰ï¼›</p>
<p>2ã€é€‰æ‹©å…·æœ‰æœ€æ™šç¦»å¼€æ—¶é—´çš„é¡¶ç‚¹ï¼Œå¯¹åå›¾GTè¿›è¡Œéå†ï¼Œåˆ é™¤èƒ½å¤Ÿéå†åˆ°çš„é¡¶ç‚¹ï¼Œè¿™äº›é¡¶ç‚¹æ„æˆä¸€ä¸ªå¼ºè¿é€šåˆ†é‡ã€‚</p>
<p>3ã€å¦‚æœè¿˜æœ‰ç‚¹æ²¡æœ‰è¢«åˆ é™¤ï¼Œé‡å¤2ï¼Œå¦åˆ™ç®—æ³•ç»“æŸ</p>
<p>Kosarajuç®—æ³•æ€§è´¨ï¼šå¦‚æœå°†æ±‚å‡ºæ¥çš„å¼ºè¿é€šåˆ†é‡æ”¶ç¼©æˆä¸€ä¸ªç‚¹ï¼Œå¹¶ä¸”ç”¨æ±‚å‡ºæ¯ä¸ªå¼ºè¿é€šåˆ†é‡çš„é¡ºåºæ¥æ ‡è®°æ”¶ç¼©åçš„ç»“ç‚¹ï¼Œé‚£ä¹ˆè¿™ä¸ªé¡ºåºå…¶å®å°±æ˜¯å¼ºè¿é€šåˆ†é‡æ”¶ç¼©æˆç‚¹åå½¢æˆçš„æœ‰å‘æ— ç¯å›¾çš„æ‹“æ‰‘åºåˆ—ã€‚</p>
]]></content>
      <tags>
        <tag>æœèŠ±å¤•æ‹¾</tag>
        <tag>å›¾è®º</tag>
      </tags>
  </entry>
  <entry>
    <title>æœèŠ±å¤•æ‹¾-æ ‘é“¾å‰–åˆ†</title>
    <url>/2016/04/24/%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86/</url>
    <content><![CDATA[<p>æ ‘é“¾å‰–åˆ†çš„åå­—éå¸¸é«˜å¤§ä¸Šï¼Œ å…¶å®ä¸éš¾ï¼Œ æœ¬è´¨æ˜¯å°†æ ‘åˆ†è§£æˆå‡ æ¡é“¾ï¼Œ æ˜ å°„åœ¨çº¿æ®µæ ‘ï¼ˆæ ‘çŠ¶æ•°ç»„ã€Splayç­‰ï¼‰ä¸Šï¼Œ å½“æˆ‘ä»¬éœ€è¦åœ¨æ ‘ä¸Šçš„è·¯å¾„ï¼ˆé¢˜ç›®é€šå¸¸ç»™å®šä¸¤ä¸ªç»“ç‚¹ï¼Œåœ¨ä»–ä»¬çš„è·¯å¾„ä¸Šæ“ä½œï¼‰è¿›è¡Œæ“ä½œæ—¶ï¼Œ å°±èƒ½è½¬åŒ–æˆåœ¨çº¿æ®µæ ‘ï¼ˆç­‰æ•°æ®ç»“æ„ï¼‰ä¸Šè¿›è¡Œæ“ä½œï¼Œ æ¥ä¸‹æ¥ä»¥æ ‘è½¬çº¿æ®µæ ‘ä¸ºä¾‹ã€‚</p>
<span id="more"></span>

<p>æ ‘é“¾å‰–åˆ†æœ€é‡è¦çš„åœ°æ–¹åœ¨äºåˆ†è§£æ ‘çš„è§„åˆ™ï¼Œ ä¸‹é¢æ˜¯ä¸€ç§é€šç”¨çš„åˆ†è§£æ–¹æ³•ï¼šå¯¹äºæ¯ä¸ªç»“ç‚¹ï¼Œå¦‚æœå®ƒæœ‰å„¿å­ï¼Œé‚£ä¹ˆå–å…¶å­æ ‘æœ€é‡ï¼ˆå­æ ‘ç»“ç‚¹æœ€å¤šï¼‰çš„å„¿å­ä¸ºâ€œé‡å„¿å­â€ï¼Œ é‡å„¿å­ä¸å…¶çˆ¶äº²çš„è¿è¾¹ç§°ä¸ºâ€œé‡è¾¹â€ã€‚ç›¸å¯¹çš„ï¼Œå…¶ä½™çš„å„¿å­æˆä¸ºâ€œè½»å„¿å­â€ï¼Œè½»å„¿å­ä¸çˆ¶äº²çš„è¿è¾¹ç§°ä¸ºè½»è¾¹ ã€‚è¿ç»­çš„é‡è¾¹æ„æˆâ€œé‡é“¾â€ï¼Œåœ¨åŒä¸€æ¡é‡é“¾ä¸Šçš„ç‚¹ åœ¨çº¿æ®µæ ‘ä¸­ æŒ‰é‡é“¾çš„é¡ºåºç›¸é‚»ã€‚æ˜¾ç„¶ï¼Œéå¶å­ç»“ç‚¹éƒ½æœ‰é‡å„¿å­ï¼Œ å®ƒä»¬å¿…å®šèƒ½æ˜ å°„åˆ°å”¯ä¸€çš„é‡é“¾ä¸Šã€‚å¯¹äºå¤šä¸ªåŒçˆ¶äº²çš„å¶å­ç»“ç‚¹ï¼Œéšä¾¿å–ä¸€ä¸ªä½œä¸ºé‡å„¿å­å°±å¯ä»¥äº†ã€‚å¯ä»¥æƒ³è±¡ï¼Œ è½»è¾¹è¿æ¥ç€ä¸ç›¸äº¤çš„é‡é“¾ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªç»“ç‚¹éƒ½èƒ½å”¯ä¸€çš„æ˜ å°„åˆ°çº¿æ®µçš„æŸä¸€ä¸ªç‚¹ä¸Šã€‚</p>
<p><img src="/2016/04/24/%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86/%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86%E4%BE%8B%E5%AD%90.png" alt="æ ‘é“¾å‰–åˆ†ä¾‹å­"></p>
<p>è¿™æ ·ä¸€æ¥ï¼Œä¸€äº›æ•°æ®ç»“æ„å°±èƒ½å¤Ÿæ¨å¹¿åˆ°æ ‘ä¸Šã€‚æ¯”å¦‚èƒ½æ±‚åŒºé—´æœ€å€¼ã€åŒºé—´æ±‚å’Œçš„çº¿æ®µæ ‘ï¼Œåœ¨æ˜ å°„åšå¥½åï¼Œå°±èƒ½å¥—ç”¨åœ¨æ ‘ä¸Šã€‚<br>å‡å¦‚æˆ‘ä»¬è¦æ±‚æ ‘ä¸Šä¸¤ç‚¹(u,v)ä¹‹é—´çš„è·¯å¾„çš„æƒå€¼å’Œã€‚ä¾‹å¦‚ä¸Šå›¾æ±‚(11, 14)é—´è·¯å¾„æƒå€¼å’Œï¼Œåˆ†åˆ«ä»11å’Œ14å¾€ä¸Šè·³ï¼Œè·³åˆ°é‡é“¾çš„é¡¶ç«¯ï¼Œï¼ˆä¸ºäº†ä¸è¶…è¿‡ä¸¤ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆï¼Œ è¦é€‰æ‹©æ›´æ·±çš„é‡é“¾å¤´è·³ï¼‰ï¼Œ11è·³åˆ°2ï¼Œç”¨çº¿æ®µæ ‘æ±‚å‡º(2,11)çš„å’Œï¼ˆåˆ©ç”¨é‡é“¾åœ¨æ˜ å°„çº¿æ®µä¸Šè¿ç»­çš„ç‰¹ç‚¹ï¼‰ï¼Œæš´åŠ›åŠ ä¸€ä¸‹è½»è¾¹(1,2)ï¼Œæ­¤æ—¶ä¸¤æ–¹é¢åŒæ—¶è·³åˆ°é‡é“¾å¤´1ï¼Œç”¨çº¿æ®µæ ‘æ±‚å‡º(1,14)çš„å’Œï¼Œå¾—åˆ°ç­”æ¡ˆã€‚</p>
<h1 id="ç®—æ³•åˆ†æ"><a href="#ç®—æ³•åˆ†æ" class="headerlink" title="ç®—æ³•åˆ†æ"></a>ç®—æ³•åˆ†æ</h1><h2 id="ä¸»è¦æ•°æ®"><a href="#ä¸»è¦æ•°æ®" class="headerlink" title="ä¸»è¦æ•°æ®"></a>ä¸»è¦æ•°æ®</h2><ol>
<li>æ ‘<ul>
<li>è¿™éƒ¨åˆ†æ˜¯ç”±é¢˜ç›®ç»™å‡ºçš„æ•°æ®</li>
<li>é¢˜ç›®è¦æ±‚åœ¨æ ‘ä¸Šçš„è·¯å¾„åšæ®µä¿®æ”¹, æ®µè¯¢é—®.</li>
<li>å¦‚æœæ ‘å¾ˆå¤§, è¾“å…¥ä»£ä»·å¯èƒ½ä¹Ÿå¾ˆå¤§, åº”è¯¥è€ƒè™‘è‡ªå®šä¹‰è¾“å…¥. å­—ç¬¦ä¸²è¾“å…¥ç”¨scanf.</li>
</ul>
</li>
<li>é«˜çº§æ ‘å½¢æ•°æ®ç»“æ„<ul>
<li>èƒ½å¤Ÿæ»¡è¶³é¢˜ç›®è¦æ±‚çš„ä¿®æ”¹, è¯¢é—®æ“ä½œ.</li>
<li>åŸºç¡€æ•°æ®æ¥è‡ªä¸€æ®µé¢„å¤„ç†åºåˆ—, è€Œä¸æ˜¯ç›´æ¥æ¥è‡ªè¾“å…¥.</li>
</ul>
</li>
<li>è¾“å…¥æ ‘åˆ°è‡ªå®šä¹‰æ•°æ®ç»“æ„çš„æ˜ å°„<ul>
<li>ç®€ç§°æ ‘é“¾å‰–åˆ†.</li>
<li>å°†è¾“å…¥æ ‘å‰ªæˆè‹¥å¹²æ¡é“¾, ä½œä¸ºé«˜çº§æ•°æ®ç»“æ„çš„åŸºç¡€æ•°æ®.</li>
</ul>
</li>
</ol>
<h2 id="å‰–åˆ†æ–¹æ³•"><a href="#å‰–åˆ†æ–¹æ³•" class="headerlink" title="å‰–åˆ†æ–¹æ³•"></a>å‰–åˆ†æ–¹æ³•</h2><p>åœ¨ç”Ÿæˆæ˜ å°„çš„è¿‡ç¨‹ä¸­, å¯¹äºåŸæ ‘çš„æ¯ä¸ªèŠ‚ç‚¹, æœ‰å…­ä¸ªä¿¡æ¯è¦å¤„ç†.</p>
<ol>
<li>çˆ¶äº²èŠ‚ç‚¹ - é˜²æ­¢é‡å¤æœç´¢</li>
<li>èŠ‚ç‚¹æ·±åº¦ - é˜²æ­¢è¶Šè¿‡æœ€è¿‘å…¬å…±ç¥–å…ˆ</li>
<li>å­æ ‘å¤§å° - å†³å®šé‡å„¿å­</li>
<li>é‡å„¿å­ - æ„æˆé‡é“¾</li>
<li>é“¾ä¸Šç¼–å· - æ˜ å°„åˆ°åºåˆ—</li>
<li>é‡é“¾å¤´ - æ‰¾åˆ°ç¼–å·è¿ç»­çš„æ®µ</li>
</ol>
<ul>
<li>1,2,5,6æ˜¯è‡ªé¡¶å‘ä¸‹è®¡ç®—çš„, 3,4å¿…é¡»è‡ªåº•å‘ä¸Šè®¡ç®—.</li>
<li>bfsè®¡ç®—1,2. åå‘bfsè®¡ç®—3,4.</li>
<li>æ¨¡æ‹Ÿæ ˆ(#defineæˆé˜Ÿåˆ—æ•°ç»„)è®¡ç®—5,6. ä¸ºäº†ä¿è¯é‡é“¾ç¼–å·è¿ç»­, é‡å„¿å­åå…¥æ ˆ.</li>
<li>å¦‚æœå€¼åœ¨è¾¹ä¸Š, å°†å€¼æ”¾è¿›å­èŠ‚ç‚¹ä¸­. è¯¢é—®æ—¶æ³¨æ„è½»è¾¹çš„çº³å…¥.</li>
</ul>
<h2 id="æ˜ å°„è¯¢é—®"><a href="#æ˜ å°„è¯¢é—®" class="headerlink" title="æ˜ å°„è¯¢é—®"></a>æ˜ å°„è¯¢é—®</h2><ul>
<li>å¦‚æœä¸¤ç‚¹æ‰€åœ¨é‡é“¾çš„é‡é“¾å¤´ä¸åŒ, æ„å‘³ç€ä¸¤ç‚¹ä¸åœ¨åŒä¸€æ¡é‡é“¾. ä¸ºäº†é˜²æ­¢ä¸€æ¡é‡é“¾å¤´å·²ç»è¶Šè¿‡æœ€è¿‘å…¬å…±ç¥–å…ˆ, é€‰æ‹©é‡é“¾å¤´æ·±åº¦å¤§çš„è®¡ç®—. è¯¢é—®æ˜ å°„æ®µ, æŠŠè½»è¾¹ä¹Ÿç®—åœ¨å†…(è½»è¾¹ä¿¡æ¯æ”¾åœ¨äº†é‡é“¾å¤´èŠ‚ç‚¹ä¸­). è®¡ç®—åèŠ‚ç‚¹æ¢æˆé‡é“¾å¤´çš„çˆ¶äº².</li>
<li>å¦‚æœä¸¤èŠ‚ç‚¹åœ¨åŒä¸€æ¡é‡é“¾ä¸Š, é¦–å…ˆæŠŠæ·±åº¦å®‰æ’å¥½, ç‰¹åˆ¤ä¸¤èŠ‚ç‚¹æ˜¯å¦ç›¸åŒ. å¦‚æœè¯¢é—®è¾¹, è¿™æ—¶å€™çš„è®¡ç®—ä¸è½»è¾¹æ— å…³, æ³¨æ„æŠŠæµ…èŠ‚ç‚¹ç¼–å·åŠ ä¸€.</li>
</ul>
<h3 id="å…³äºçº¿æ®µæ ‘å»¶è¿Ÿæ ‡è®°"><a href="#å…³äºçº¿æ®µæ ‘å»¶è¿Ÿæ ‡è®°" class="headerlink" title="å…³äºçº¿æ®µæ ‘å»¶è¿Ÿæ ‡è®°"></a>å…³äºçº¿æ®µæ ‘å»¶è¿Ÿæ ‡è®°</h3><ul>
<li>pushDownæ„å‘³ç€å½“å‰æ®µæœ‰å¤šä½™, è¦åˆ†ä¸¤åŠ, ä½†ä¸ä¸€å®šä¸¤åŠéƒ½ç»§ç»­é€’å½’. <strong>æ‰€ä»¥é€’å½’åä¸¤åŠéƒ½å¯èƒ½å¸¦æœ‰å»¶è¿Ÿæ ‡è®°</strong>. </li>
<li>pushUpåœ¨ä¿®æ”¹æ“ä½œä¸­å‡ºç°, ä¸”å‰é¢å¿…æœ‰pushDown, æ„å‘³ç€å½“å‰æ®µçš„å»¶è¿Ÿæ“ä½œå·²ç»è¡¥å¥½. pushUpç»“æŸå<strong>å½“å‰æ®µä¸€å®šä¸å¸¦å»¶è¿Ÿæ ‡è®°</strong>.</li>
</ul>
<p>æ±‚è·¯å¾„æœ€å€¼ä¹Ÿå¦‚æ³•ç‚®åˆ¶ã€‚<br>ä¸‹é¢ç»™å‡ºå®ç°æ ‘ä¸Šè·¯å¾„æ±‚æœ€å€¼ã€æ±‚å’Œçš„ä»£ç ï¼Œé¢˜ç›®å¯¹åº”HYSBZ 1036ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> mmst(a, b) memset(a, b, sizeof(a))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson (root&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson ((root&lt;&lt;1)|1)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">30010</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXE = MAXN&lt;&lt;<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ri</span><span class="params">(<span class="type">int</span> &amp;x)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, q;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> to[MAXE], nex[MAXE], Mindex[MAXN], cur=<span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> w[MAXN], v[MAXN], top[MAXN], fa[MAXN], son[MAXN], siz[MAXN], depth[MAXN], z=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> SUM[MAXN&lt;&lt;<span class="number">2</span>], MAX[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">const</span> <span class="type">int</span> a, <span class="type">const</span> <span class="type">int</span> b)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">(<span class="type">const</span> <span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	son[x] = <span class="number">0</span>;</span><br><span class="line">	siz[x] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=Mindex[x]; i!=<span class="number">-1</span>; i=nex[i])</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (to[i] != fa[x])</span><br><span class="line">		&#123;</span><br><span class="line">			fa[to[i]] = x;</span><br><span class="line">			depth[to[i]] = depth[x] + <span class="number">1</span>;</span><br><span class="line">			<span class="built_in">dfs</span>(to[i]);</span><br><span class="line">			<span class="keyword">if</span> (siz[to[i]] &gt; siz[son[x]]) son[x] = to[i];</span><br><span class="line">			siz[x] += siz[to[i]];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">set_tree</span><span class="params">(<span class="type">const</span> <span class="type">int</span> x, <span class="type">const</span> <span class="type">int</span> tp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	top[x] = tp;</span><br><span class="line">	w[x] = ++z;</span><br><span class="line">	<span class="keyword">if</span> (son[x]!=<span class="number">0</span>) <span class="built_in">set_tree</span>(son[x], tp);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=Mindex[x]; i!=<span class="number">-1</span>; i=nex[i])</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (to[i]!=fa[x] &amp;&amp; to[i]!=son[x])</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">set_tree</span>(to[i], to[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> p, <span class="type">int</span> val, <span class="type">int</span> root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==r) &#123; SUM[root] = MAX[root] = val; <span class="keyword">return</span> ; &#125;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (p&lt;=mid) <span class="built_in">update</span>(l, mid, p, val, lson);</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">update</span>(mid+<span class="number">1</span>, r, p, val, rson);</span><br><span class="line">	SUM[root] = SUM[lson] + SUM[rson];</span><br><span class="line">	MAX[root] = <span class="built_in">max</span>(MAX[lson], MAX[rson]);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qMax</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> MAX[root];</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="type">int</span> ref = -MAXN;</span><br><span class="line">	<span class="keyword">if</span> (L&lt;=mid) ref = <span class="built_in">qMax</span>(l, mid, L, R, lson);</span><br><span class="line">	<span class="keyword">if</span> (mid&lt;R) ref = <span class="built_in">max</span>(ref, <span class="built_in">qMax</span>(mid+<span class="number">1</span>, r, L, R, rson));</span><br><span class="line">	<span class="keyword">return</span> ref;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qSum</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> SUM[root];</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="type">int</span> ref = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (L&lt;=mid) ref = <span class="built_in">qSum</span>(l, mid, L, R, lson);</span><br><span class="line">	<span class="keyword">if</span> (mid&lt;R) ref += <span class="built_in">qSum</span>(mid+<span class="number">1</span>, r, L, R, rson);</span><br><span class="line">	<span class="keyword">return</span> ref;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findMax</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> ref = -MAXN;</span><br><span class="line">	<span class="type">int</span> f1 = top[a], f2 = top[b];</span><br><span class="line">	<span class="keyword">while</span> (f1 != f2)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (depth[f1] &lt; depth[f2]) &#123; <span class="built_in">swap</span>(a, b); <span class="built_in">swap</span>(f1, f2); &#125;</span><br><span class="line">		ref = <span class="built_in">max</span>(ref, <span class="built_in">qMax</span>(<span class="number">1</span>, z, w[f1], w[a], <span class="number">1</span>));</span><br><span class="line">		a = fa[f1];</span><br><span class="line">		f1 = top[a];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (a == b) <span class="keyword">return</span> <span class="built_in">max</span>(ref, v[a]);</span><br><span class="line">	<span class="keyword">if</span> (depth[a] &gt; depth[b]) <span class="built_in">swap</span>(a, b);</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">max</span>(ref, <span class="built_in">qMax</span>(<span class="number">1</span>, z, w[a], w[b], <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">findSum</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> ref = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> f1 = top[a], f2 = top[b];</span><br><span class="line">	<span class="keyword">while</span> (f1 != f2)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (depth[f1] &lt; depth[f2]) &#123; <span class="built_in">swap</span>(a, b); <span class="built_in">swap</span>(f1, f2); &#125;</span><br><span class="line">		ref += <span class="built_in">qSum</span>(<span class="number">1</span>, z, w[f1], w[a], <span class="number">1</span>);</span><br><span class="line">		a = fa[f1];</span><br><span class="line">		f1 = top[a];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (a == b) <span class="keyword">return</span> ref + v[a];</span><br><span class="line">	<span class="keyword">if</span> (depth[a] &gt; depth[b]) <span class="built_in">swap</span>(a, b);</span><br><span class="line">	<span class="keyword">return</span> ref + <span class="built_in">qSum</span>(<span class="number">1</span>, z, w[a], w[b], <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//	freopen(&quot;tes.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">	<span class="built_in">mmst</span>(Mindex, <span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">ri</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>, a, b; i&lt;n; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">    	<span class="built_in">ri</span>(a); <span class="built_in">ri</span>(b);</span><br><span class="line">    	<span class="built_in">addEdge</span>(a, b);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">    	<span class="built_in">ri</span>(v[i]);</span><br><span class="line">    </span><br><span class="line">    siz[<span class="number">0</span>] = <span class="number">0</span>; depth[<span class="number">1</span>] = <span class="number">1</span>; fa[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">set_tree</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">    	<span class="built_in">update</span>(<span class="number">1</span>, z, w[i], v[i], <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">ri</span>(q);</span><br><span class="line">    <span class="type">char</span> que[<span class="number">7</span>];</span><br><span class="line">    <span class="type">int</span> q1, q2;</span><br><span class="line">    <span class="keyword">while</span> (q--)</span><br><span class="line">    &#123;</span><br><span class="line">    	<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, que);</span><br><span class="line">    	<span class="built_in">ri</span>(q1); <span class="built_in">ri</span>(q2);</span><br><span class="line">    	<span class="keyword">if</span> (que[<span class="number">1</span>] == <span class="string">&#x27;M&#x27;</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">findMax</span>(q1, q2));</span><br><span class="line">    	<span class="keyword">else</span> <span class="keyword">if</span> (que[<span class="number">1</span>] == <span class="string">&#x27;S&#x27;</span>) <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">findSum</span>(q1, q2));</span><br><span class="line">    	<span class="keyword">else</span> <span class="built_in">update</span>(<span class="number">1</span>, z, w[q1], v[q1]=q2, <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">const</span> <span class="type">int</span> a, <span class="type">const</span> <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	to[cur] = b; nex[cur] = Mindex[a]; Mindex[a] = cur++;</span><br><span class="line">	to[cur] = a; nex[cur] = Mindex[b]; Mindex[b] = cur++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ri</span><span class="params">(<span class="type">int</span> &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">char</span> c; <span class="type">bool</span> minus = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">while</span> ((c=<span class="built_in">getchar</span>())&lt;<span class="string">&#x27;0&#x27;</span> || <span class="string">&#x27;9&#x27;</span>&lt;c) <span class="keyword">if</span> (c==<span class="string">&#x27;-&#x27;</span>) minus=<span class="literal">true</span>;</span><br><span class="line">	x = c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">	<span class="keyword">while</span> (<span class="string">&#x27;0&#x27;</span>&lt;=(c=<span class="built_in">getchar</span>()) &amp;&amp; c&lt;=<span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">		x = <span class="number">10</span>*x+c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">	<span class="keyword">if</span> (minus) x = -x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–ç¨‹æ—¶æœ‰å‡ ç‚¹è¦ç•™æ„ï¼š</p>
<ul>
<li>æ³¨æ„æƒå€¼åœ¨æ ‘ä¸­æ‘†æ”¾çš„ä½ç½®ï¼Œ åœ¨è¾¹ä¸Šæˆ–è€…åœ¨ç»“ç‚¹ä¸Šï¼Œé€šå¸¸å¯ä»¥è½¬åŒ–æˆåœ¨ç»“ç‚¹ä¸Šã€‚</li>
<li>åœ¨ä¸€æ¡é‡é“¾ä¸Šï¼Œæ·±åº¦å°çš„ç‚¹åœ¨çº¿æ®µæ ‘å·¦è¾¹ï¼Œæ·±åº¦å¤§çš„åœ¨å³è¾¹ï¼ˆç›¸å¯¹è€Œè¨€ï¼‰ã€‚</li>
<li>find()ä¸­å½“f1=&#x3D;f2åï¼Œè·¯å¾„a~bæ˜¯å°šæœªè¢«è®¡ç®—çš„ï¼Œç‰¹åˆ«æ˜¯è¦ç•™æ„if (a=&#x3D;b)ï¼Œå°†å…¶æƒå€¼è®°ä¸Šã€‚</li>
<li>dfs()å…ˆè§£å†³æ·±åº¦ã€å¤§å°ï¼ˆè½»é‡ï¼‰ã€é‡å„¿å­ã€çˆ¶äº²çš„é—®é¢˜ã€‚</li>
<li>set_tree()åè§£å†³topé‡é“¾å¤´æ ‡è®°ã€å®‰æ’æ˜ å°„çš„é—®é¢˜ã€‚</li>
</ul>
<h4 id="2016-06-02æ–°å¢"><a href="#2016-06-02æ–°å¢" class="headerlink" title="2016.06.02æ–°å¢"></a>2016.06.02æ–°å¢</h4><p>æ”¹è¿›ä¸¤ä¸ªåˆå§‹åŒ–ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªåˆå§‹åŒ–å…ˆç”¨å®½æœè§£å†³æ·±åº¦è®¡æ•°å’Œçˆ¶äº²æŒ‡é’ˆçš„é¢„å¤„ç†ï¼Œç„¶ååå‘éå†é˜Ÿåˆ—ï¼Œç”¨æ”¹è¿›çš„æ–¹å¼è®¡ç®—sizeå’Œé‡å„¿å­ã€‚</li>
<li>ç¬¬äºŒä¸ªåˆå§‹åŒ–ç”¨ç²—ç•¥çš„æ¨¡æ‹Ÿæ ˆï¼Œé‡å„¿å­ä¼˜å…ˆåšæ·±æœï¼Œç”±æµ…åˆ°æ·±è®¡ç®—idå’Œtopã€‚</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ri</span><span class="params">(<span class="type">int</span> &amp;)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> MAXN = <span class="number">30010</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> n, m;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">bool</span> GETMAX = <span class="literal">true</span>, GETSUM = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> val[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> SUM[MAXN&lt;&lt;<span class="number">2</span>], MAX[MAXN&lt;&lt;<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> depth[MAXN], fa[MAXN], top[MAXN], wson[MAXN], siz[MAXN], id[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> cur = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> to[MAXN&lt;&lt;<span class="number">1</span>], nex[MAXN&lt;&lt;<span class="number">1</span>], _index[MAXN];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> q[MAXN];</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> r)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> p, <span class="type">int</span> v, <span class="type">int</span> root=<span class="number">1</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">queryMAX</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> root=<span class="number">1</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">querySUM</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> root=<span class="number">1</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">qtree</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b, <span class="type">const</span> <span class="type">bool</span> flag)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> ref = (flag == GETMAX ? -MAXN : <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">while</span> (top[a]!=top[b])</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (depth[top[a]] &lt; depth[top[b]]) <span class="built_in">swap</span>(a, b);</span><br><span class="line">		<span class="keyword">if</span> (flag==GETMAX) ref = <span class="built_in">max</span>(ref, <span class="built_in">queryMAX</span>(<span class="number">1</span>, n, id[top[a]], id[a]));</span><br><span class="line">		<span class="keyword">else</span> ref += <span class="built_in">querySUM</span>(<span class="number">1</span>, n, id[top[a]], id[a]);</span><br><span class="line">		a = fa[top[a]];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (depth[a]&gt;depth[b]) <span class="built_in">swap</span>(a, b);</span><br><span class="line">	<span class="keyword">if</span> (flag == GETMAX) ref = <span class="built_in">max</span>(ref, <span class="built_in">queryMAX</span>(<span class="number">1</span>, n, id[a], id[b]));</span><br><span class="line">	<span class="keyword">else</span> ref += <span class="built_in">querySUM</span>(<span class="number">1</span>, n, id[a], id[b]);</span><br><span class="line">	<span class="keyword">return</span> ref;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//	freopen(&quot;tes.in&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">	</span><br><span class="line">	<span class="built_in">memset</span>(_index, <span class="number">-1</span>, <span class="built_in">sizeof</span>(_index));</span><br><span class="line">	<span class="built_in">memset</span>(wson, <span class="number">0</span>, <span class="built_in">sizeof</span>(wson));</span><br><span class="line">	<span class="built_in">memset</span>(siz, <span class="number">0</span>, <span class="built_in">sizeof</span>(siz));</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">ri</span>(n);</span><br><span class="line">	</span><br><span class="line">	<span class="type">int</span> u, v;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>; i&lt;n; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">ri</span>(u); <span class="built_in">ri</span>(v);</span><br><span class="line">		<span class="built_in">addEdge</span>(u, v);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">ri</span>(val[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">bfs</span>();</span><br><span class="line">	<span class="built_in">dfs</span>();</span><br><span class="line">	<span class="built_in">build</span>(n);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; ++i)</span><br><span class="line">		<span class="built_in">update</span>(<span class="number">1</span>, n, id[i], val[i]);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">ri</span>(m);</span><br><span class="line">	<span class="type">char</span> rd[<span class="number">7</span>];</span><br><span class="line">	<span class="keyword">while</span> (m--)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, rd);</span><br><span class="line">		<span class="built_in">ri</span>(u); <span class="built_in">ri</span>(v);</span><br><span class="line">		<span class="keyword">if</span> (rd[<span class="number">1</span>] == <span class="string">&#x27;M&#x27;</span>)</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">qtree</span>(u, v, GETMAX));</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (rd[<span class="number">1</span>]==<span class="string">&#x27;S&#x27;</span>)</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, <span class="built_in">qtree</span>(u, v, GETSUM));</span><br><span class="line">		<span class="keyword">else</span> <span class="built_in">update</span>(<span class="number">1</span>, n, id[u], v);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;	</span><br><span class="line">	<span class="type">int</span> head = <span class="number">0</span>, tail = <span class="number">1</span>;</span><br><span class="line">	q[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">	fa[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">	depth[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (head &lt; tail)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">const</span> <span class="type">int</span> x = q[head++];</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=_index[x]; i!=<span class="number">-1</span>; i=nex[i])</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (to[i] != fa[x])</span><br><span class="line">			&#123;</span><br><span class="line">				depth[to[i]] = depth[x] + <span class="number">1</span>;</span><br><span class="line">				fa[to[i]] = x;</span><br><span class="line">				q[tail++] = to[i];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=tail<span class="number">-1</span>; i&gt;=<span class="number">0</span>; --i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">const</span> <span class="type">int</span> x = q[i], y = fa[x];</span><br><span class="line">		siz[y] += (++siz[x]);</span><br><span class="line">		<span class="keyword">if</span> (siz[wson[y]] &lt; siz[x]) wson[y] = x;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> sta q</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">dfs</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> num = <span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> tail = <span class="number">1</span>;</span><br><span class="line">	sta[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">	top[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">while</span> (tail != <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">const</span> <span class="type">int</span> x = sta[--tail];</span><br><span class="line">		id[x] = ++num;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i=_index[x]; i!=<span class="number">-1</span>; i=nex[i])</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (to[i]!=fa[x] &amp;&amp; to[i]!=wson[x])</span><br><span class="line">			&#123;</span><br><span class="line">				top[to[i]] = to[i];</span><br><span class="line">				sta[tail++] = to[i];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (wson[x] != <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			top[wson[x]] = top[x];</span><br><span class="line">			sta[tail++] = wson[x];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> lson (root&lt;&lt;1)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> rson ((root&lt;&lt;1)|1)</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> p, <span class="type">int</span> v, <span class="type">int</span> root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (l==r)</span><br><span class="line">	&#123;</span><br><span class="line">		SUM[root] = MAX[root] = v;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> mid = (l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (p&lt;=mid) <span class="built_in">update</span>(l, mid, p, v, lson);</span><br><span class="line">			<span class="keyword">else</span> <span class="built_in">update</span>(mid+<span class="number">1</span>, r, p, v, rson);</span><br><span class="line">	SUM[root] = SUM[lson] + SUM[rson];</span><br><span class="line">	MAX[root] = <span class="built_in">max</span>(MAX[lson], MAX[rson]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">build</span><span class="params">(<span class="type">int</span> r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	r &lt;&lt;= <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;=r; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		SUM[i] = <span class="number">0</span>;</span><br><span class="line">		MAX[i] = -MAXN;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">queryMAX</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> MAX[root];</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="type">int</span> ref = -MAXN;</span><br><span class="line">	<span class="keyword">if</span> (L&lt;=mid) ref = <span class="built_in">queryMAX</span>(l, mid, L, R, lson);</span><br><span class="line">	<span class="keyword">if</span> (mid&lt;R) ref = <span class="built_in">max</span>(ref, <span class="built_in">queryMAX</span>(mid+<span class="number">1</span>, r, L, R, rson));</span><br><span class="line">	<span class="keyword">return</span> ref;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">querySUM</span><span class="params">(<span class="type">int</span> l, <span class="type">int</span> r, <span class="type">int</span> L, <span class="type">int</span> R, <span class="type">int</span> root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (L&lt;=l &amp;&amp; r&lt;=R) <span class="keyword">return</span> SUM[root];</span><br><span class="line">	<span class="type">const</span> <span class="type">int</span> mid = (l+r) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">	<span class="type">int</span> ref = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (L&lt;=mid) ref = <span class="built_in">querySUM</span>(l, mid, L, R, lson);</span><br><span class="line">	<span class="keyword">if</span> (mid&lt;R) ref += <span class="built_in">querySUM</span>(mid+<span class="number">1</span>, r, L, R, rson);</span><br><span class="line">	<span class="keyword">return</span> ref;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">addEdge</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	to[cur] = b; nex[cur] = _index[a]; _index[a] = cur++;</span><br><span class="line">	to[cur] = a; nex[cur] = _index[b]; _index[b] = cur++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">ri</span><span class="params">(<span class="type">int</span> &amp;x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">char</span> c;</span><br><span class="line">	<span class="type">bool</span> mus = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">while</span> ((c=<span class="built_in">getchar</span>())&lt;<span class="string">&#x27;0&#x27;</span> || <span class="string">&#x27;9&#x27;</span>&lt;c) <span class="keyword">if</span> (c==<span class="string">&#x27;-&#x27;</span>) mus = <span class="literal">true</span>;</span><br><span class="line">	x = c-<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">	<span class="keyword">while</span> (<span class="string">&#x27;0&#x27;</span>&lt;=(c=<span class="built_in">getchar</span>()) &amp;&amp; c&lt;=<span class="string">&#x27;9&#x27;</span>)</span><br><span class="line">		x = <span class="number">10</span>*x + c - <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">	<span class="keyword">if</span> (mus) x = -x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>æ•°æ®ç»“æ„</tag>
        <tag>æœèŠ±å¤•æ‹¾</tag>
      </tags>
  </entry>
  <entry>
    <title>æ±‡ç¼–è¯­è¨€</title>
    <url>/2019/09/16/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/</url>
    <content><![CDATA[<p>ä¸ä¼šæ±‡ç¼–ï¼Œå¼ºè¡Œåˆšè½¯ä¿ï¼Œ<del>ç‘Ÿç‘Ÿå‘æŠ–</del>ç¨³å¾—ä¸€åŒ¹</p>
<p><em>æœ¬æ–‡çš„ç¼–æ’°ä»…é¢å‘ä½œè€…æœ¬äºº</em></p>
<h1 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h1><h2 id="Cè¯­æ³•"><a href="#Cè¯­æ³•" class="headerlink" title="Cè¯­æ³•"></a>Cè¯­æ³•</h2><ol>
<li>æŒ‡é’ˆä½œå·®å¾—åˆ°åŒºé—´å…ƒç´ ä¸ªæ•°ã€‚<strong>æŒ‡é’ˆçš„ç±»å‹å‚ä¸è®¡ç®—ï¼</strong></li>
<li>è¦åŠ¨æ€æ”¹å˜å‡½æ•°ä½“ï¼Œéœ€è¦åœ¨ç¼–è¯‘æœŸèµ‹äºˆæƒé™ã€‚</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> comment(linker, <span class="string">&quot;/section:test,RWE&quot;</span>)</span></span><br></pre></td></tr></table></figure>
<span id="more"></span>

<ol>
<li><code>__asm int 3</code>åŠ å…¥æ±‡ç¼–æ–­ç‚¹ï¼ˆODï¼‰ã€‚è¦åœ¨ODä¸­å¯ç”¨StrongODï¼Œç¦ç”¨è·³è¿‡int3ï¼›å¹¶è®¾ç½®æµ‹è¯•é€‰é¡¹</li>
<li></li>
<li></li>
</ol>
<h2 id="Windows-exeç»“æ„"><a href="#Windows-exeç»“æ„" class="headerlink" title="Windows exeç»“æ„"></a>Windows exeç»“æ„</h2><ol>
<li>401000Hè¿™ä¸ªå†…å­˜åœ°å€å¯¹åº”çš„æ–‡ä»¶åœ°å€æ˜¯1000H</li>
</ol>
<h1 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h1><h2 id="Quickviewï¼šæ›´æ”¹EXEæ•°æ®"><a href="#Quickviewï¼šæ›´æ”¹EXEæ•°æ®" class="headerlink" title="Quickviewï¼šæ›´æ”¹EXEæ•°æ®"></a>Quickviewï¼šæ›´æ”¹EXEæ•°æ®</h2><ol>
<li>æŒ‰<code>F5</code>å¯ä»¥æŒ‰åœ°å€å®šä½</li>
<li>æä¾›ä¸‰ç§æ¨¡å¼ï¼š16è¿›åˆ¶æ ¼å¼ï¼Œæ±‡ç¼–æ ¼å¼ï¼Œçº¯æ–‡æœ¬æ ¼å¼ï¼›æŒ‰<code>F2</code>åˆ‡æ¢åˆ°32ä½æ¨¡å¼</li>
<li>æŒ‰<code>Alt+F9</code>ä¿å­˜</li>
<li>æŒ‰<code>ins</code>é€‰æ‹©å—ï¼ˆå¼€å§‹å’Œç»“æŸå„æŒ‰ä¸€æ¬¡ï¼‰ï¼Œé€‰æ‹©åæŒ‰<code>shift</code>åº•éƒ¨å‡ºç°å—å·¥å…·</li>
<li></li>
</ol>
<h2 id="ODï¼šå•æ­¥è·Ÿè¸ªEXE"><a href="#ODï¼šå•æ­¥è·Ÿè¸ªEXE" class="headerlink" title="ODï¼šå•æ­¥è·Ÿè¸ªEXE"></a>ODï¼šå•æ­¥è·Ÿè¸ªEXE</h2><ol>
<li>å¯ä»¥ç”¨æ¥è¿½è¸ªå»å£³ä»£ç </li>
<li>å¯ä»¥dumpæ•°æ®å—åˆ°æ–‡ä»¶</li>
<li>å¯ä»¥è®¾ç½®ç¡¬ä»¶æ–­ç‚¹ï¼Œå½“æŸå‚¨å­˜ä½ç½®å‘ç”Ÿæ›´æ”¹æ—¶ä¸­æ–­</li>
<li><code>Alt+B</code>ç®¡ç†æ–­ç‚¹ï¼Œ<code>ç©ºæ ¼</code>åˆ‡æ¢</li>
<li></li>
</ol>
<h2 id="IDAï¼šé™æ€åˆ†æEXE"><a href="#IDAï¼šé™æ€åˆ†æEXE" class="headerlink" title="IDAï¼šé™æ€åˆ†æEXE"></a>IDAï¼šé™æ€åˆ†æEXE</h2><ol>
<li>æŒ‰<code>G</code>å®šä½</li>
<li>å¯é€šè¿‡åŠ å£³åæŠ—é™æ€åˆ†æã€‚</li>
</ol>
<h1 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h1><h2 id="é¢å¯¹åŠ å£³"><a href="#é¢å¯¹åŠ å£³" class="headerlink" title="é¢å¯¹åŠ å£³"></a>é¢å¯¹åŠ å£³</h2><ol>
<li>ç”¨ODåŠ¨æ€è¿½è¸ªï¼Œå°è¯•è¿˜åŸè¢«åŠ å£³ä»£ç ï¼ˆç­‰å¾…å»å£³ï¼‰ï¼Œå†ç”¨QVè¿˜åŸEXEï¼ˆç”¨å—å¤åˆ¶çš„åŠæ³•åŠ å¿«é€Ÿåº¦ï¼‰</li>
</ol>
<h2 id="é¢å¯¹åºåˆ—å·"><a href="#é¢å¯¹åºåˆ—å·" class="headerlink" title="é¢å¯¹åºåˆ—å·"></a>é¢å¯¹åºåˆ—å·</h2><ol>
<li><p>è§‚å¯Ÿåˆ°ç°è±¡ï¼šå¼¹æ¡†å¹¶æ¶ˆå¤±ã€‚å¯è¡ŒåŠæ³•ï¼šè·Ÿè¸ªCreateWindow&#x2F;ShowWindow&#x2F;DestoryWindowï¼ˆæ¨èï¼‰</p>
</li>
<li><p>ç”¨ODåŠ¨æ€è¿½è¸ªï¼Œå°è¯•ä¸­æ–­DestoryWindowï¼Œè§‚å¯Ÿå †æ ˆé¡¶ç«¯æ‰¾åˆ°å‡ºæ ˆåçš„ç¨‹åºè¿è¡Œä½ç½®ï¼ˆæˆ–ç›´æ¥è·‘retn)</p>
</li>
<li><p>å¯¹ä¸å½“åœºåˆ¤æ–­çš„åœºåˆï¼ˆæ²¡æœ‰æ˜æ˜¾ç°è±¡ï¼‰ æ€€ç–‘æœ‰æ–‡ä»¶&#x2F;æ³¨å†Œè¡¨è¯»å†™ <code>FileMon + RegMon = ProcMon</code></p>
<p> RegCreateKey()<br> RegQueryValue()<br> RegSetValue()</p>
<p> CreateFile<br> CreateFileEx<br> ReadFile<br> WriteFile</p>
</li>
<li><p>è½¯ä»¶æ–­ç‚¹ï¼šå½“å‰æ–­ç‚¹æŒ‡ä»¤çš„é¦–å­—èŠ‚æ”¹ä¸º<code>0xCC</code>ï¼ˆå¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤ä¸ºint 3ï¼‰ã€‚ å¯èƒ½è¢«ç¨‹åºè‡ªæ£€ã€‚</p>
</li>
<li><p>ç¡¬ä»¶æ–­ç‚¹ï¼šé€‰ä¸­æŸæ¡æŒ‡ä»¤-&gt;æ–­ç‚¹-&gt;ç¡¬ä»¶æ‰§è¡Œã€‚  æ£€æŸ¥å·²è®¾ç½®çš„æ–­ç‚¹ï¼šè°ƒè¯•-&gt;ç¡¬ä»¶æ–­ç‚¹... åŸç†ï¼šCPUè°ƒè¯•å¯„å­˜å™¨ä¿å­˜äº†æ–­ç‚¹åœ°å€å’Œæ–­ç‚¹æ¡ä»¶ï¼Œæ¯ä¸ªå‘¨æœŸéƒ½ä¼šæ£€æŸ¥æ¡ä»¶ã€‚è§¦å‘æ¡ä»¶æœ‰<code>execute</code>ï¼Œ<code>read</code>, <code>write</code>ã€‚  è¦è®¾ç½®è¯»&#x2F;å†™æ–­ç‚¹ï¼Œé€‰ä¸­å˜é‡çš„é¦–å­—èŠ‚-&gt;å³é”®-&gt;æ–­ç‚¹-&gt;ç¡¬ä»¶å†™å…¥-&gt;DWORDï¼ˆå¯¹åº”çš„ç±»å‹ï¼‰ã€‚è¦è®¾ç½®DWORDæ–­ç‚¹å¯¹å˜é‡é¦–å­—èŠ‚æœ‰è¦æ±‚ã€‚è¯»&#x2F;å†™å®Œæˆååˆ°è¾¾æ–­ç‚¹ã€‚<br>å¯ä»¥ç”¨<code>printf(&quot;%p&quot;,...)</code>çŸ¥é“è¦è·Ÿè¸ªçš„å˜é‡çš„åœ°å€ã€‚</p>
</li>
<li><p>åˆ©ç”¨è¯»&#x2F;å†™ç¡¬ä»¶æ–­ç‚¹ï¼Œå½“æ“ä½œåºåˆ—å·æ—¶å°±èƒ½æ–­ä½ã€‚<code>Ctrl+B</code>æœç´¢å·²è¾“å…¥çš„åºåˆ—å·æ‰¾åˆ°å†…å­˜åœ°å€ã€‚è·³è·ƒå‡ æ¬¡çœ‹åˆ°<code>rep movs</code>ï¼ˆå­—ç¬¦ä¸²æ‹·è´ï¼‰ï¼Œæ­¤æ—¶å–æ¶ˆæ–­ç‚¹ï¼Œå›åˆ°ç”¨æˆ·ä»£ç ï¼Œè·³å‡ºå‡ æ¬¡ï¼Œçœ‹åˆ°getText</p>
</li>
<li><p>å¦‚æœè¿›å…¥ç³»ç»Ÿä»£ç ï¼Œåˆ™åº”è·³å‡ºåˆ°ç”¨æˆ·ä»£ç <code>Alt+F9</code>ï¼Œå†æŒ‰<code>Ctrl+F9</code>è·³å‡ºä¸€äº›å‡½æ•°ã€‚</p>
</li>
<li><p><code>CallWindowProcA</code>çš„ä½œç”¨æ˜¯ç”±ç³»ç»Ÿå†…æ ¸æ¥å›è°ƒç”¨æˆ·äº‹å…ˆå†™çš„æ¶ˆæ¯å¤„ç†å‡½æ•°</p>
</li>
</ol>
<h1 id="æ±‡ç¼–è§„åˆ™"><a href="#æ±‡ç¼–è§„åˆ™" class="headerlink" title="æ±‡ç¼–è§„åˆ™"></a>æ±‡ç¼–è§„åˆ™</h1><ol>
<li>cdq edx:eax, idiv, edx &#x3D; edx:eax %n</li>
</ol>
<h1 id="é€†å‘å·¥ç¨‹å†å²"><a href="#é€†å‘å·¥ç¨‹å†å²" class="headerlink" title="é€†å‘å·¥ç¨‹å†å²"></a>é€†å‘å·¥ç¨‹å†å²</h1><ol>
<li>å¾®è½¯å¼€å‘<code>debug</code>ï¼Œ<code>codeview</code>, å®è“å¼€å‘<code>TurboDebug</code>;</li>
</ol>
<h2 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h2><ol>
<li><code>debug</code> ç¼–ç¨‹ï¼ša(assemble) åœ°å€+æ±‡ç¼–è¯­è¨€ï¼Œåç§»åœ°å€å›ºå®šä»100å¼€å§‹   (ODä¸­æ”¹æŒ‡ä»¤ç›¸å½“äºaï¼Œè‹¥ä¸‹ä¸€æ¡è¯­å¥å®æ•ˆï¼Œä¼šæœ‰å®‰å…¨æªæ–½ï¼Œæ”¹90NULL)ã€‚</li>
<li>u(unassemble) åæ±‡ç¼–ï¼ŒæŒ‡å®šå¼€å§‹åœ°å€å’Œæœ«åœ°å€ï¼ˆl+é•¿åº¦äº¦å¯)ï¼Œåæ±‡ç¼–å¯¹åº”åœ°å€å†…çš„æœºå™¨è¯­è¨€ã€‚</li>
<li>r(register) æŸ¥çœ‹å¯„å­˜å™¨ SF+PL-NG UPä¸ŠDNä¸‹.  r + å¯„å­˜å™¨åå­—, ä¿®æ”¹å†…å­˜</li>
<li>p (optional åœ°å€) å•æ­¥å‰è¿›ï¼Œç›®æ ‡åœ°å€æ˜¯æ‰§è¡Œå®Œæ¯•çš„</li>
<li>g (optional &#x3D;é¦–åœ°å€ (optional) æœ«åœ°å€) (ä»csip)è·³è·ƒç›´åˆ°int 3(æœ«åœ°å€æ˜¯æœªæ‰§è¡Œçš„);</li>
<li>d(dump) æŸ¥çœ‹å†…å­˜ å¯ä»¥æŒ‡å®š(d cs:100 120 || d cs:100 l20)</li>
<li>e(edit) ä¿®æ”¹å†…å­˜ åœ°å€ + &quot;string&quot; || hex</li>
<li>t(track in)</li>
</ol>
<h2 id="åŠ å¯†è½¯ä»¶"><a href="#åŠ å¯†è½¯ä»¶" class="headerlink" title="åŠ å¯†è½¯ä»¶"></a>åŠ å¯†è½¯ä»¶</h2><ol>
<li><code>lock89</code>, <code>lockup</code>, ä½œè€…ï¼šæ¨é“æ²…, ç¡¬ç›˜æŒ‡çº¹åŠ å¯†æŠ€æœ¯</li>
<li><code>lock93</code>, <code>lock93NT</code>, å‘¨è¾‰</li>
<li><code>BitLock</code>, é›·å†›</li>
</ol>
<h1 id="é©»ç•™å†…å­˜ç¨‹åº"><a href="#é©»ç•™å†…å­˜ç¨‹åº" class="headerlink" title="é©»ç•™å†…å­˜ç¨‹åº"></a>é©»ç•™å†…å­˜ç¨‹åº</h1><h2 id="éœ€è¦æŠ€æœ¯"><a href="#éœ€è¦æŠ€æœ¯" class="headerlink" title="éœ€è¦æŠ€æœ¯"></a>éœ€è¦æŠ€æœ¯</h2><ol>
<li>é©»ç•™å†…å­˜</li>
<li>ä¸­æ–­</li>
</ol>
<p><code>es:[bx]</code> 0:32æ˜¯ä¸€ä¸ªä¸­æ–­å‘é‡çš„åœ°å€</p>
<p>0:0 ~ 0:3FF æ˜¯ä¸­æ–­å‘é‡è¡¨ï¼Œæ¯ä¸ªä¸­æ–­å‘é‡å ç”¨4å­—èŠ‚ã€‚ ä¾‹å¦‚<code>int 00h</code>çš„ä¸­æ–­å‘é‡å‚¨å­˜åœ¨0:0 ~ 0:3ä¹‹é—´; <code>int 01h</code>çš„ä¸­æ–­å‘é‡å‚¨å­˜åœ¨0:4 ~ 0:7ä¹‹é—´ã€‚</p>
<p>å½“cpuæ‰§è¡Œ<code>int 00h</code>æ—¶ï¼š<br>pushf ä¿æŠ¤å½“å‰æ ‡å¿—ä½ï¼ˆflagï¼‰çš„çŠ¶æ€<br>push cs å½“å‰çŸ­åœ°å€<br>push ä¸‹æ¡æŒ‡ä»¤çš„åç§»åœ°å€<br>cli<br>jmp 8756h:3412h</p>
<p>&#x2F;&#x2F; cli disable interrupt    (clear interrupt)<br>&#x2F;&#x2F; sti enable.              (set interrupt)</p>
<p>8756h:3412h æ˜¯ä¸­æ–­æœåŠ¡ç¨‹åºçš„å…¥å£åœ°å€<br>    â€¦â€¦<br>    iret; ä¸­æ–­è¿”å›</p>
<p>å½“cpuæ‰§è¡Œ<code>iret</code>æ—¶ï¼š<br>pop ip;<br>pop cs;<br>popf;       ä»è€Œå®ç°æ¢å¤ç°åœºã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">; è°ƒæ¢ä¸­æ–­å‘é‡è¡¨</span><br><span class="line">cli</span><br><span class="line">mov word ptr es:[bx], offset int_8h</span><br><span class="line">mov es:[bx+2], cs</span><br><span class="line">sti</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jmp dword ptr cs:[old_8h] ; ä¸­æ–­é“¾æ¥   old_8hå®šä¹‰åœ¨codeæ®µå†…æ˜¯å¿…è¦çš„</span><br><span class="line">; iret å¯¼è‡´æ—§ç¨‹åºä¸å†æ‰§è¡Œ</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int_8h:    ; ä¸­æ–­æœåŠ¡</span><br><span class="line">;;;;;;</span><br><span class="line">push ds</span><br><span class="line">push ax</span><br><span class="line">mov ax, data</span><br><span class="line">mov ds, ax</span><br><span class="line">;;;;;;</span><br><span class="line"></span><br><span class="line">inc [count]</span><br><span class="line">cmp [count], 18</span><br><span class="line"></span><br><span class="line">inc cs:[count]  ; count db 0 at the end  å®šä¹‰åœ¨codeæ®µå†…</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">push ... ; è®°å¿†æ‰€æœ‰å¯„å­˜å™¨   ax bx cb dx si di ds</span><br><span class="line"></span><br><span class="line">push cs</span><br><span class="line">pop ds</span><br><span class="line">push cs</span><br><span class="line">pop es</span><br><span class="line">mov al,4</span><br><span class="line">out 70,al</span><br><span class="line">in al,71h // hour</span><br><span class="line">call convert</span><br><span class="line">mov word ptr current_time[?], ax</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">jmp dword ptr cs:[old_8h]  ;è¿”å›æ—§ç¨‹åº</span><br></pre></td></tr></table></figure>


<p>é©»ç•™</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">install:</span><br><span class="line">mov ah, 9</span><br><span class="line"></span><br><span class="line">; program segment prefix(PSP) é•¿åº¦ä¸º100hï¼Œå…¶ä¸­PSP:80hå­˜æ”¾å‘½ä»¤è¡Œå‚æ•°ï¼Œç¨‹åºåˆšåˆšå¼€å§‹æ—¶ ds = es = pspï¼Œ</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">in al, 60h</span><br></pre></td></tr></table></figure>


<h1 id="gamebuster"><a href="#gamebuster" class="headerlink" title="gamebuster"></a>gamebuster</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mount c:... d:\...</span><br><span class="line">gb</span><br><span class="line">pc</span><br><span class="line">[ctrl][ctrl]  åˆ†æ&quot;/åè¿›åˆ¶&quot; &quot;åå…­è¿›åˆ¶&quot;</span><br><span class="line">[alt + 1]</span><br><span class="line">[shift + 1] é”</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="dosboxdeb"><a href="#dosboxdeb" class="headerlink" title="dosboxdeb"></a>dosboxdeb</h2><p>dos mcbs è·å¾—å½“å‰ç¨‹åºçš„PSP ï¼ˆmemory control block)<br>u 01dd:1785  &#x2F;&#x2F; æŸ¥çœ‹åæ±‡ç¼–</p>
<h2 id="å•æ­¥ä¸­æ–­"><a href="#å•æ­¥ä¸­æ–­" class="headerlink" title="å•æ­¥ä¸­æ–­"></a>å•æ­¥ä¸­æ–­</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pushf</span><br><span class="line">pop ax</span><br><span class="line">or ax, 0100h</span><br><span class="line">push ax</span><br><span class="line">popf    ; ä¿®æ”¹ TF = 1</span><br><span class="line"></span><br><span class="line">nop;    ; å½“TF==1ï¼Œæ‰§è¡Œä¸€æ¡æŒ‡ä»¤åè°ƒç”¨ int 1h</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="æŸç§ç—…æ¯’"><a href="#æŸç§ç—…æ¯’" class="headerlink" title="æŸç§ç—…æ¯’"></a>æŸç§ç—…æ¯’</h2><p>ä¿®æ”¹<code>int 21h</code>ä¸­æ–­å‘é‡ä¸º<code>xxxx:yyyy</code>ï¼ŒåŸå‘é‡ä¿å­˜åœ¨å†…éƒ¨å˜é‡<code>old_21h</code>ä¸­ã€‚æ–°æŒ‡ä»¤ä¸º<code>cmp ah 4Bh</code>ï¼Œåˆ¤æ–­æ˜¯å¦è¦æ‰§è¡Œç¨‹åº¦ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">je infect_exe</span><br><span class="line">jmp dword ptr cs:[old_21h]</span><br><span class="line"></span><br><span class="line">infect_exe:</span><br><span class="line">    mov ah, 3dh; AH==3DH è¡¨ç¤ºæ‰“å¼€æ–‡ä»¶</span><br><span class="line">    mov al, 2; è¯»å†™æ–¹å¼</span><br><span class="line">    pushf</span><br><span class="line">    call dword ptr cs:[old_2h]; call éšå«pushæ®µåœ°å€ã€åç§»åœ°å€ ..?</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>åŸå§‹çš„<code>int 21h</code>ä¸­æ–­å‘é‡çš„æ®µåœ°å€&lt;&#x3D;70h</p>
<p>å‡è£…è°ƒç”¨ä¸€ä¸ªæ— ç”¨çš„<code>int 21h</code>åŠŸèƒ½ï¼Œå¦‚è·å–dosç‰ˆæœ¬å·</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mov ah, 30h</span><br><span class="line">pushf</span><br><span class="line">ç½®ä½TF ; ä¸èƒ½æ‰‹åŠ¨int 21hï¼Œå› ä¸ºç³»ç»Ÿå°†flagç½®é›¶</span><br><span class="line">call dword ptr [current_21h]</span><br></pre></td></tr></table></figure>

<h2 id="EXEæ–‡ä»¶æ ¼å¼"><a href="#EXEæ–‡ä»¶æ ¼å¼" class="headerlink" title="EXEæ–‡ä»¶æ ¼å¼"></a>EXEæ–‡ä»¶æ ¼å¼</h2><p>+00 4D, 5A; EXEæ ‡å¿—â€œMZâ€<br>+02 50, 01; æœ€åä¸€ä¸ªæ‰‡åŒºçš„å­—èŠ‚æ•°ä¸º150h ï¼ˆä¾‹å¤–ï¼šå¦‚æœæ˜¯00 00åˆ™æœ€åä¸€ä¸ªæ‰‡åŒºæ˜¯æ»¡è½½ï¼‰<br>+04 02, 00; EXEå ç”¨çš„æ‰‡åŒºæ•°é‡ï¼ˆ200å­—èŠ‚&#x2F;ä¸€ä¸ªæ‰‡åŒºï¼‰<br>+06 02, 00; é‡å®šä½é¡¹æ•°<br>+08 02, 00; æ–‡ä»¶å¤´çš„èŠ‚é•¿åº¦&#x3D;20hï¼Œæ‰€ä»¥å­—èŠ‚é•¿åº¦&#x3D;200h (20h x 10h)<br>+0A 00, 00; è‡³å°‘å†…å­˜   DOSæ˜¯å•ä»»åŠ¡çš„ï¼Œæ‰€ä»¥å†…å­˜é™åˆ¶æ²¡æœ‰å¤ªå¤§æ„ä¹‰<br>+0C FF, FF; è‡³å¤šå†…å­˜<br>+0E 05, 00; SSä¸ç¨‹åºé¦–æ®µåœ°å€çš„è·ç¦» ï¼ˆç¨‹åºé¦–æ®µåœ°å€åœ¨è¿è¡Œæ—¶ç¡®å®š, &#x3D; psp+10hï¼‰<br>+10 00, 01; SP &#x3D; 100h</p>
<p>+12 E8, 20; EXEæ–‡ä»¶å¤´çš„æ ¡éªŒå€¼<br>+14 28, 00; IP&#x3D;0028h            ; æ³¨æ„æ­¤å¤„å…ˆIPåCS   CS:IPç¬¬ä¸€å¥æŒ‡ä»¤<br>+16 02, 00; CSä¸ç¨‹åºé¦–æ®µåœ°å€çš„è·ç¦»<br>+18 1E, 00; é‡å®šä½è¡¨çš„åç§»åœ°å€</p>
<p>; ä¸‹é¢æ˜¯é‡å®šä½è¡¨ã€‚æ¯ä¸ªé‡å®šä½é¡¹4ä¸ªå­—èŠ‚ã€‚æ¯ä¸¤ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªä¿¡æ¯ã€‚<br>+1E 01, 00; é‡å®šä½çš„åç§»åœ°å€&#x3D;0001h<br>+20 02, 00; Î”&#x3D;0002h,<br>; é¦–æ®µåœ°å€+Î”&#x3D;é‡å®šä½çš„æ®µåœ°å€<br>;<br>+22 0D, 00; é‡å®šä½çš„åç§»åœ°å€&#x3D;000Dh<br>+24 02, 00; Î”&#x3D;0002h,<br>; é¦–æ®µåœ°å€+Î”&#x3D;é‡å®šä½çš„æ®µåœ°å€</p>
<p>DOSè¿è¡Œç¨‹åºæ—¶ï¼Œæ–‡ä»¶å¤´ä¸è½½å…¥å†…å­˜ï¼Œæ‰€ä»¥å†…å­˜å¤´å¯è®¤ä¸ºæ˜¯æ–‡ä»¶å¤´é•¿åº¦</p>
<p>200h+2:1 &#x3D; 0:200h + 0:21 &#x3D; 0:211</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mov ah, 2</span><br><span class="line">mov dl, &#x27;A&#x27;</span><br><span class="line">int 21h</span><br><span class="line">mov ah, 1</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mov ax, ds</span><br><span class="line">add ax, 10</span><br><span class="line">add ax, 2</span><br><span class="line">push ax</span><br><span class="line">mov ax, 28h</span><br><span class="line">push ax</span><br><span class="line">retf ; pop ip, pop cs</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">code segment</span><br><span class="line">assume cd:code</span><br><span class="line">shell:</span><br><span class="line">    call next</span><br><span class="line">next:</span><br><span class="line">    pop ax ; ax = ip = nextçš„åœ°å€</span><br><span class="line">    sub ax, (offset next - offset shell)</span><br><span class="line">    mov bx, ax</span><br><span class="line">    </span><br><span class="line">    mov cs:[old_ds+bx], ds</span><br><span class="line">    mov cs:[old_es+bx], es</span><br><span class="line">    mov bp, ds ; psp</span><br><span class="line">    add bp, 10h; é¦–æ®µæ®µåœ°å€</span><br><span class="line">    mov cx, [reloc_count+bx]</span><br><span class="line">    push cs</span><br><span class="line">    pop ds</span><br><span class="line">    mov si, offset reloc_table</span><br><span class="line">    add si, bx</span><br><span class="line">    </span><br><span class="line">reloc_next_item:</span><br><span class="line">    mov ax, [si] ;lodsw ; ax = ds:[si] ; offset</span><br><span class="line">    mov dx, [si+2]                      ; delta segment</span><br><span class="line">    add dx, bp</span><br><span class="line">    mov es, dx</span><br><span class="line">    </span><br><span class="line">    add es:[di], bp</span><br><span class="line">    add si, 4</span><br><span class="line">    dec cx</span><br><span class="line">    jnz reloc_next_item</span><br><span class="line">    </span><br><span class="line">    mov ax, [csip+bx]</span><br><span class="line">    mov dx, [csip+bx+2]</span><br><span class="line">    add dx, bp</span><br><span class="line">    push dx</span><br><span class="line">    push ax</span><br><span class="line">    mov ds, cs:[bx+old_ds]</span><br><span class="line">    mov es, cs:[bx+old_es]</span><br><span class="line">    retf</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">old_ds dw 0</span><br><span class="line">old_es dw 0</span><br><span class="line">csip dw 0, 0</span><br><span class="line">reloc_count dw 0</span><br><span class="line">reloc_table db label byte ; å®šä¹‰ä¸ºdbä½†ä¸èµ‹åˆå€¼</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end shell</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„åŠ å¯†å †æ ˆåå¼•å‘çš„è§£å¯†å¯¹æ–°æ•°æ®çš„å½±å“çš„é—®é¢˜ã€‚</p>
<p>ä¿å­˜sså’Œspï¼Œä¹‹åä¿®æ”¹å®ƒä¸ºä¸€æ®µé¢„ç•™ç©ºé—´</p>
<h1 id="ä¿æŠ¤æ¨¡å¼"><a href="#ä¿æŠ¤æ¨¡å¼" class="headerlink" title="ä¿æŠ¤æ¨¡å¼"></a>ä¿æŠ¤æ¨¡å¼</h1><p><em>32ä½ç³»ç»Ÿä¸‹</em></p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">ä¿æŠ¤æ¨¡å¼</th>
<th align="center">å®æ¨¡å¼</th>
</tr>
</thead>
<tbody><tr>
<td align="center">æœ€å¤§æ®µé•¿åº¦</td>
<td align="center">4G</td>
<td align="center">64K</td>
</tr>
<tr>
<td align="center">è¶Šç•Œè®¿é—®</td>
<td align="center">è¿è¡Œæ—¶é”™è¯¯</td>
<td align="center">å…è®¸</td>
</tr>
<tr>
<td align="center">ç‰©ç†å¯»å€</td>
<td align="center">æŸ¥gdtè¡¨</td>
<td align="center">åŸºå€*10h+10h+åç§»</td>
</tr>
</tbody></table>
<h2 id="æŸ¥gdtè¡¨"><a href="#æŸ¥gdtè¡¨" class="headerlink" title="æŸ¥gdtè¡¨"></a>æŸ¥gdtè¡¨</h2><p>è®¾<code>ds=10h</code>ï¼Œç°é€šè¿‡æŸ¥gdtè¡¨è·å¾—å…¶ç‰©ç†åœ°å€ã€‚gdtè¡¨å‚¨å­˜æè¿°ç¬¦ï¼Œæ¯ä¸ªå 8å­—èŠ‚ã€‚è¡¨çš„é¦–åœ°å€å­˜åœ¨äº<code>gdtr</code>å¯„å­˜å™¨ã€‚</p>
<p>gdt+10h xx xx xx xx xx xx xx xx</p>
<h2 id="idtä¸­æ–­æè¿°ç¬¦è¡¨"><a href="#idtä¸­æ–­æè¿°ç¬¦è¡¨" class="headerlink" title="idtä¸­æ–­æè¿°ç¬¦è¡¨"></a>idtä¸­æ–­æè¿°ç¬¦è¡¨</h2><p>é¦–åœ°å€å­˜åœ¨äº<code>idtr</code>ä¸­ã€‚æ¯é¡¹æœ‰8å­—èŠ‚ã€‚åŸºå€2å­—èŠ‚ï¼Œåç§»4å­—èŠ‚ï¼Œå‰©ä½™2å­—èŠ‚è®°å½•æƒé™ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lgdt fword ptr gdt ; æŠŠgdtè¡¨çš„é¦–åœ°å€å’Œé•¿åº¦è½½å…¥åˆ°gdtrå¯„å­˜å™¨</span><br><span class="line"></span><br><span class="line">cli</span><br><span class="line">smsw ax</span><br><span class="line">and ax, 1Fh</span><br><span class="line">or al, 1</span><br><span class="line">lmsw ax; enable PE bit of MSW or CR0</span><br><span class="line">db 0EAh ; JMP FAR PTR</span><br><span class="line">dw 00h</span><br><span class="line">dw pseg_</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>æ‚é¡¹</tag>
      </tags>
  </entry>
  <entry>
    <title>ç¦»æ•£æ•°å­¦éšç¬”</title>
    <url>/2019/06/30/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6/</url>
    <content><![CDATA[<p><em>æœ¬æ–‡çš„ç¼–æ’°ä»…é¢å‘ä½œè€…æœ¬äºº</em></p>
<h1 id="1-6-Rules-of-Inference"><a href="#1-6-Rules-of-Inference" class="headerlink" title="1.6 Rules of Inference"></a>1.6 Rules of Inference</h1><ol>
<li>Modus ponens å‡è¨€æ¨ç† p &amp; p-&gt;q &#x3D;&gt; q </li>
<li>Modus tollens å–æ‹’å¼ !q &amp; p-&gt;q &#x3D;&gt; !p</li>
<li>Hypothetical syllogism &#x2F;,haÉªpÉ™&#39;Î¸É›tÉªk, &#39;sÉªlÉ™,dÊ’Éªz(É™)m&#x2F; å‡è¨€ä¸‰æ®µè®º p-&gt;q &amp; q-&gt;r &#x3D;&gt; p-&gt;r </li>
<li>Disjunctive syllogism æå–ä¸‰æ®µè®º pVq &amp; !p &#x3D; p</li>
<li>Addtion é™„åŠ å¾‹ p &#x3D;&gt; pVq  ï¼ˆé™„åŠ åœ¨æå–å¼ä¸­ï¼‰</li>
<li>Simplification åŒ–ç®€å¾‹ p&amp;&amp;q &#x3D;&gt; p ï¼ˆåˆå–æ¡ä»¶çš„æ‹†åˆ†ï¼‰</li>
<li>Resolution æ¶ˆè§£å¾‹ pVq &amp; !pVr &#x3D;&gt; qVr æ¡ä»¶ç›¸æ–¥å¿…æœ‰ä¸€T</li>
<li>? Logical equivalence<span id="more"></span></li>
</ol>
<p>$$ \begin{aligned} Step &amp; Reason \ 1. xxx &amp; Premise \ 2. xxx &amp; Contrapositive,of,(1) \ 3. xxx &amp; XXrule,using,(n),and,(m) \end{aligned} $$</p>
<h2 id="Fallacies-è°¬è¯¯"><a href="#Fallacies-è°¬è¯¯" class="headerlink" title="Fallacies è°¬è¯¯"></a>Fallacies è°¬è¯¯</h2><ol>
<li>fallacy of affirming the conclusion è‚¯å®šç»“è®ºçš„è°¬è¯¯ ç”±ç»“è®ºæ¨å‡ºæ¡ä»¶</li>
<li>fallacy of denying the hypothesis  &#x2F;haÉª&#39;pÉ’Î¸ÉªsÉªs&#x2F; å¦å®šå‡è®¾çš„è°¬è¯¯ ä»å¦å®šæ¡ä»¶æ¨å‡ºå¦å®šç»“è®º</li>
</ol>
<h2 id="Rules-of-Inference-for-Quantified-Statements-é‡åŒ–å‘½é¢˜çš„æ¨ç†è§„åˆ™"><a href="#Rules-of-Inference-for-Quantified-Statements-é‡åŒ–å‘½é¢˜çš„æ¨ç†è§„åˆ™" class="headerlink" title="Rules of Inference for Quantified Statements é‡åŒ–å‘½é¢˜çš„æ¨ç†è§„åˆ™"></a>Rules of Inference for Quantified Statements é‡åŒ–å‘½é¢˜çš„æ¨ç†è§„åˆ™</h2><ol>
<li>Universal instantiation å…¨ç§°å®ä¾‹ $\forall xP(x) \implies P(c)$</li>
<li>Universal generalization å…¨ç§°å¼•å…¥ $P(c)$ for an arbitrary $c \implies \forall xP(x)$</li>
<li>Existential instantiaion å­˜åœ¨å®ä¾‹ $\exists xP(x) \implies P(c)$ for some element $c$</li>
<li>Existencial generalization å­˜åœ¨å¼•å…¥ $P(c)$ for some element $c \implies \exists xP(x)$</li>
</ol>
<h2 id="Combining-Rules-of-Inference-for-Propositions-and-Quantified-Statements"><a href="#Combining-Rules-of-Inference-for-Propositions-and-Quantified-Statements" class="headerlink" title="Combining Rules of Inference for Propositions and Quantified Statements"></a>Combining Rules of Inference for Propositions and Quantified Statements</h2><ol>
<li>Universal modus ponens å…¨ç§°å‡è¨€æ¨ç† å¯¹æŸä¸ªå…¨ç§°å®ä¾‹åº”ç”¨å‡è¨€æ¨ç†</li>
<li>Universal modus tollens å…¨ç§°å–æ‹’å¼ å¯¹æŸä¸ªå…¨ç§°å®ä¾‹åº”ç”¨å–æ‹’å¼ï¼ˆå¦å®šç»“è®ºæ¨å‡ºå¦å®šæ¡ä»¶ï¼‰</li>
</ol>
<hr>
<h1 id="1-7-Introduction-to-Proofs"><a href="#1-7-Introduction-to-Proofs" class="headerlink" title="1.7 Introduction to Proofs"></a>1.7 Introduction to Proofs</h1><ol>
<li>theorem &#x2F;&#39;Î¸ÉªÉ™rÉ™m&#x2F; å®šç† ï¼ˆå®šç†çš„è¯æ˜æœ‰å®šä¹‰ã€å…¶ä»–å®šç†ã€å…¬ç†ã€æ¨æ–­è§„åˆ™ï¼‰</li>
<li>lemma &#x2F;&#39;lemÉ™&#x2F; å¼•ç† ç”¨äºè¯æ˜å®šç†çš„å…¶ä»–å®šç†</li>
<li>corollary &#x2F;kÉ™&#39;rÉ’lÉ™rÉª&#x2F; æ¨è®º å®šç†ä¸‹çš„ç›´æ¥ç»“è®º</li>
<li>propositions å‘½é¢˜ å¶å°”ç”¨æ¥ç§°å‘¼ä¸é‡è¦çš„å®šç†ï¼Œæˆ–ç§°äº‹å®ã€ç»“è®º</li>
<li>conjecture &#x2F;kÉ™n&#39;dÊ’ektÊƒÉ™&#x2F; çŒœæƒ³ ä¸€æ—¦æ‰¾åˆ°è¯æ˜ï¼ŒçŒœæƒ³å°±å˜æˆå®šç†ï¼›ä¹Ÿæœ‰å¯èƒ½è¢«è¯ä¼ª</li>
</ol>
<h2 id="To-Proof-p-gt-q-or-to-proof-p"><a href="#To-Proof-p-gt-q-or-to-proof-p" class="headerlink" title="To Proof p-&gt;q (or to proof p)"></a>To Proof p-&gt;q (or to proof p)</h2><ol>
<li>Trivial Proof : å¹³å‡¡è¯æ˜ if q is true then p-&gt;q is true.</li>
<li>Vacuous Proof : ç©ºè¯æ˜ if p is false then p-&gt;q is true.</li>
<li>Direct Proof : Assume p is true and show that q is true by using inferences, axioms, logical equivalences.</li>
<li>Indirect Proof : not begin with the premises and not end with the conclusion</li>
<li>Proof by contraposition åè¯æ³• : Assume !q and show !p is true also. ç›´æ¥è¯æ˜æ³•æ— æ•ˆæ—¶å°è¯•åè¯æ³•</li>
<li>Proof by Contradiction å½’è°¬è¯æ˜æ³• : To proof p, first find a r such that !p -&gt; (r &amp;&amp; !r) is true, therefore !p is false and p is true. å‡è®¾ç»“è®ºçš„å¦å®šä¸ºçœŸï¼Œå¼•å‡ºä¸€ä¸ªçŸ›ç›¾</li>
<li>åä¾‹è¯æ˜æ³• : æŒ‡æ˜ä¸€ä¸ªåä¾‹ï¼Œä»è€Œè¯ä¼ª</li>
</ol>
<hr>
<h1 id="1-8-Proof-Methods-and-Strategy-è¯æ˜çš„æ–¹æ³•å’Œç­–ç•¥"><a href="#1-8-Proof-Methods-and-Strategy-è¯æ˜çš„æ–¹æ³•å’Œç­–ç•¥" class="headerlink" title="1.8 Proof Methods and Strategy è¯æ˜çš„æ–¹æ³•å’Œç­–ç•¥"></a>1.8 Proof Methods and Strategy è¯æ˜çš„æ–¹æ³•å’Œç­–ç•¥</h1><ol>
<li>Proof by cases åˆ†æƒ…å½¢è¯æ˜æ³• tautology : (p1Vp2V...pn)-&gt;q &lt;-&gt; (p1-&gt;q)&amp;&amp;(p2-&gt;q)&amp;&amp;...(pn-&gt;q) ç±»ä¼¼åˆ†ç±»è®¨è®º</li>
<li>Exhaustive Proof ç©·ä¸¾è¯æ˜æ³• å½“å˜é‡çš„å–å€¼æ¯”è¾ƒå°‘çš„æ—¶å€™ï¼Œé€šè¿‡æµ‹è¯•æ‰€æœ‰æƒ…å½¢æ¥è¯æ˜ã€‚</li>
<li>Without loss of generality (WLOG) ä¸å¤±ä¸€èˆ¬æ€§ çœç•¥éå¸¸ç±»ä¼¼çš„æƒ…å½¢ï¼ˆè¯æ˜è¿‡ç¨‹å‡ ä¹ç›¸åŒï¼‰çš„è¯æ˜</li>
</ol>
<h2 id="Existence-Proof-å­˜åœ¨æ€§è¯æ˜"><a href="#Existence-Proof-å­˜åœ¨æ€§è¯æ˜" class="headerlink" title="Existence Proof å­˜åœ¨æ€§è¯æ˜"></a>Existence Proof å­˜åœ¨æ€§è¯æ˜</h2><p>To proof $\exists x P(x)$ :</p>
<ol>
<li>Constructive existence proof æ„é€ æ€§ : Find an explicit c, for which P(c) is true.</li>
<li>Nonconstructive existence proof éæ„é€ æ€§è¯æ˜ ï¼š ä¸ç›´æ¥æ„é€ ä¾‹å­ï¼Œä½†è¯´æ˜å¤šç§æƒ…å†µä¹‹ä¸€å¿…æœ‰ç¬¦åˆçš„ä¾‹å­ï¼›æˆ–è‹¥ä¸å­˜åœ¨ï¼Œå°±å¾—åˆ°æŸäº›çŸ›ç›¾ã€‚</li>
</ol>
<h2 id="Uniqueness-Proof-å”¯ä¸€æ€§è¯æ˜"><a href="#Uniqueness-Proof-å”¯ä¸€æ€§è¯æ˜" class="headerlink" title="Uniqueness Proof å”¯ä¸€æ€§è¯æ˜"></a>Uniqueness Proof å”¯ä¸€æ€§è¯æ˜</h2><p>åŒæ—¶è¯æ˜å­˜åœ¨æ€§å’Œå”¯ä¸€æ€§ï¼Œå³xç¬¦åˆæŸç§æœŸæœ›ï¼Œè€Œè‹¥y!&#x3D;xï¼Œåˆ™yä¸ç¬¦åˆè¿™ç§æœŸæœ›ã€‚ä¹Ÿå¯ä»¥ç­‰ä»·åœ°è¯æ˜è‹¥yç¬¦åˆè¿™ç§æœŸæœ›ï¼Œåˆ™y&#x3D;xã€‚</p>
<hr>
<h1 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h1><ol>
<li>The cardinality of  a finite set A é›†åˆçš„åŸºæ•°ï¼Œ|A|</li>
<li>finite æœ‰é™çš„ &#x2F;faÉªnaÉªt&#x2F;</li>
<li>infinite æ— é™çš„ &#x2F;&#39;ÉªnfÉªnÉ™t&#x2F;</li>
<li>Power Set å¹‚é›† P(A) The set of all subsets of a set A. $|P(A)| &#x3D; 2^{|A|}$</li>
<li>Cartesian Product ç¬›å¡å°”ç§¯ A x B x Cçš„æ„ä¹‰å’Œ(A x B) x Cä¸ä¸€æ ·ï¼</li>
<li>coordinate</li>
</ol>
<h2 id="Set-Operations"><a href="#Set-Operations" class="headerlink" title="Set Operations"></a>Set Operations</h2><ol>
<li>Union &#x2F;&#39;junÉªÉ™n&#x2F;</li>
<li>Intersection</li>
<li>Complementation : complement è¡¥é›†ï¼Œå¿…é¡»æœ‰universal set Uã€‚Aä¸Šä¸€æ¨ªæ </li>
<li>Difference ä¸æ»¡è¶³äº¤æ¢å¾‹ï¼ŒA-B</li>
<li>Symmetric Difference å¯¹ç§°å·® å¼‚æˆ–</li>
</ol>
<h3 id="Set-Identities-é›†åˆæ’ç­‰å¼"><a href="#Set-Identities-é›†åˆæ’ç­‰å¼" class="headerlink" title="Set Identities é›†åˆæ’ç­‰å¼"></a>Set Identities é›†åˆæ’ç­‰å¼</h3><ol>
<li>æ³¨æ„ä¸€ä¸‹åˆ†é…ç‡ï¼Œå¾·æ‘©æ ¹å¾‹ï¼ˆå¦å®šå»æ‹¬å·ï¼‰</li>
<li>å…¶ä»–ä¸ç®¡å•Šå¤ªç®€å•äº†</li>
<li>Membership Tables æˆå‘˜è¡¨ï¼Œæšä¸¾ä»»æ„å…ƒç´ å±äºå„ä¸ªé›†åˆæƒ…å†µï¼Œä»è€ŒéªŒè¯æ’ç­‰å¼ï¼ˆå’ŒçœŸå€¼è¡¨ç±»ä¼¼ï¼‰</li>
</ol>
<h2 id="Funtion-f-maps-A-to-B-f-is-a-mapping-from-A-to-B"><a href="#Funtion-f-maps-A-to-B-f-is-a-mapping-from-A-to-B" class="headerlink" title="Funtion (f maps A to B) (f is a mapping from A to B)"></a>Funtion (f maps A to B) (f is a mapping from A to B)</h2><ol start="0">
<li>assignment æŒ‡æ´¾ï¼Œåˆ†é…ã€‚ æŒ‡å®šf(a)&#x3D;bã€‚</li>
<li>domain å®šä¹‰åŸŸ A</li>
<li>codomain é™ªåŸŸ B</li>
<li>image åƒ b is an image of a under f</li>
<li>preimage åŸåƒ å¯èƒ½æ˜¯å•ä¸ªå…ƒç´ ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªé›†åˆã€‚</li>
<li>f(A) range å€¼åŸŸ</li>
<li>ç­‰ä»·çš„å‡½æ•°å…·æœ‰ç›¸åŒçš„domain &amp; codomain &amp; map each element to the same element of the codomain</li>
<li>$f(S) &#x3D; {f(s)|s\in S}$</li>
<li>$(f_1+f_2)(x) &#x3D; f_1(x)+f_2(x)$</li>
<li>$(f_1*f_2)(x) &#x3D; f_1(x)*f_2(x)$</li>
<li>injection injective å•å°„ one-to-one å¯åœ¨å€¼åŸŸä¸Šå®šä¹‰åå‡½æ•°</li>
<li>surjection surjective (or onto) æ»¡å°„ æ˜ ä¸Š é™ªåŸŸä¸­æ¯ä¸ªå…ƒç´ éƒ½èƒ½æ‰¾åˆ°åŸåƒ</li>
<li>injective and surjective &#x3D;&gt; bijection or one-to-one correspondence åŒå°„ ä¸€ä¸€å¯¹åº”</li>
<li>invertible å¯é€†çš„ Inverse Function åå‡½æ•°</li>
<li>Composition å¤åˆå‡½æ•° $f \circ g &#x3D; f(g(x))$</li>
<li>Factorial&#x2F;fÃ¦k&#39;tÉ”rÉªÉ™l&#x2F; Function é˜¶ä¹˜å‡½æ•°</li>
<li>Partial Function å±€éƒ¨å‡½æ•°ï¼Œå¯¹æŸä¸ªå‡½æ•°æˆªå–éƒ¨åˆ†domain</li>
</ol>
<h2 id="Sequence-åºåˆ—-a-n"><a href="#Sequence-åºåˆ—-a-n" class="headerlink" title="Sequence åºåˆ— ${a_n}$"></a>Sequence åºåˆ— ${a_n}$</h2><p>A funtion from N or N+ to S<br>$$a_n &#x3D; f(n)$$</p>
<ol>
<li>term é¡¹</li>
<li>Geometric Progression å‡ ä½•çº§æ•° a*r^n, n&#x3D;0,1...  (a and r are real numbers)</li>
<li>Arithmetic Progression ç®—æœ¯çº§æ•° ï¼ˆç­‰å·®æ•°åˆ—ï¼‰</li>
<li>Recurrence relation é€’æ¨å…³ç³» </li>
<li>a solution of a recurrence relation æ»¡è¶³é€’æ¨å…³ç³»çš„åºåˆ—ç§°ä¸ºè¿™ä¸ªé€’æ¨å…³ç³»çš„ä¸€ä¸ªè§£</li>
<li>initial conditions åˆå§‹æ¡ä»¶ é€’æ¨å…³ç³»ç”Ÿæ•ˆå‰çš„æ‰€æœ‰terms</li>
<li>solving the recurrence relation æ‰¾åˆ°é€šé¡¹å…¬å¼ è¿™æ ·çš„å…¬å¼å«closed formulaé—­å…¬å¼</li>
<li>iteration è¿­ä»£æ³•ï¼Œæ­£å‘æ›¿æ¢ working upwardï¼› åå‘æ›¿æ¢ working downwardã€‚ ç”¨äºçŒœæµ‹formulaï¼Œç„¶åç”¨the method of inductionæ•°å­¦å½’çº³æ³•è¯æ˜ã€‚</li>
<li>Summation ï¼ˆåºåˆ—çš„éƒ¨åˆ†ï¼‰æ€»å’Œ</li>
<li>in lexicographic order &#x2F;,lÉ›ksÉªkÉ™&#39;grÃ¦fÉªk&#x2F; å­—å…¸åº</li>
</ol>
<h2 id="Matrices-çŸ©é˜µ"><a href="#Matrices-çŸ©é˜µ" class="headerlink" title="Matrices çŸ©é˜µ"></a>Matrices çŸ©é˜µ</h2><ol>
<li>Boolean Product å¸ƒå°”ç§¯ ç±»ä¼¼çŸ©é˜µä¹˜æ³•ï¼Œå„é¡¹æ±‚äº¤ä¹‹åæ±‚å¹¶</li>
<li>Boolean Powers å¤šæ¬¡å¸ƒå°”ç§¯ã€‚ å†™ä½œ$A^{[n]}$, è®°$A^{[n]}&#x3D;I$</li>
</ol>
<hr>
<h1 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h1><ol>
<li>pseudocode &#x2F;&#39;sju:doËŒkod&#x2F; ä¼ªä»£ç </li>
<li>Halt Problem åœæœºé—®é¢˜ï¼Œæ— è§£</li>
<li>Big-O f(x) of big-O of g(x)</li>
<li>|f(x)| &lt; |c*g(x)| (x &gt; k) : the constants c and k are called witnesses. Only one pair of witnesses is needed.</li>
<li>if f &#x3D; O(g) &amp;&amp; g &#x3D; O(f), then the two functions are of the same order.</li>
<li>polynomial &#x2F;,pÉ’lÉª&#39;nÉ™ÊŠmÉªÉ™l&#x2F; å¤šé¡¹å¼</li>
<li>if |f(x)| &gt; |C*g(x)| (x &gt; k) : Big-Omega</li>
<li>if f &#x3D; O(g) &amp;&amp; g &#x3D; O(f), then f &#x3D; Î¸(g) : Big-Theta; f(x) is of order g(x).</li>
<li>brute-force è›®åŠ›ï¼ˆç®—æ³•ï¼‰</li>
<li>Tractable Problem ï¼šPç±»é—®é¢˜ï¼Œå¤šé¡¹å¼æ—¶é—´å†…è§£å†³</li>
<li>Intractable Problem</li>
<li>Unsolvable Problem æ— è§£çš„é—®é¢˜ï¼Œä¾‹å¦‚Halt Problem</li>
<li>Class NP: å¯åœ¨å¤šé¡¹å¼æ—¶é—´å†…éªŒè¯ä¸€ä¸ªè§£çš„é—®é¢˜</li>
<li>NP Complete Class: NPCé—®é¢˜ï¼Œæ‰€æœ‰çš„NPé—®é¢˜éƒ½èƒ½çº¦åŒ–ä¸ºNPCé—®é¢˜ã€‚</li>
</ol>
<hr>
<h1 id="Number-Theory-and-Cryptography-æ•°è®ºå’Œå¯†ç å­¦"><a href="#Number-Theory-and-Cryptography-æ•°è®ºå’Œå¯†ç å­¦" class="headerlink" title="Number Theory and Cryptography æ•°è®ºå’Œå¯†ç å­¦"></a>Number Theory and Cryptography æ•°è®ºå’Œå¯†ç å­¦</h1><p>&#x2F;krÉªp&#39;tÉ‘grÉ™fi&#x2F;</p>
<ol>
<li>divisibility &#x2F;di,vizi&#39;bilÉ™ti&#x2F; å¯é™¤æ€§</li>
<li>hexadecimal &#x2F;,hÉ›ksÉ™&#39;dÉ›sÉªml&#x2F; åå…­è¿›åˆ¶ï¼ˆçš„ï¼‰</li>
<li>modular &#x2F;&#39;mÉ‘djÊŠlÉš&#x2F; æ¨¡çš„</li>
<li>congruence åŒä½™ &#x2F;&#39;kÉ‘Å‹grÊŠÉ™ns&#x2F;</li>
<li>a divides b  aé™¤bï¼Œ a is a factor or divisor of b, b is a multiple of a.</li>
<li>quotient &#x2F;&#39;kwoÊƒnt&#x2F;å•†; remainder &#x2F;rÉª&#39;mendÉš&#x2F;ä½™æ•°</li>
<li>-11 &#x2F; 3 &#x3D; -4 ... 1</li>
<li>The notation a  â‰¡  b (mod m)  says  that a is <strong>congruent</strong> to b modulo m.   a  â‰¡  b (mod m) is a congruence and that m is its modulus.</li>
<li>doing arithmatic modulo m: $a+_mb &#x3D; (a+b) \mod m; a*_mb &#x3D; (a*b) \mod m$</li>
</ol>
<h2 id="Zm-x3D-0-m-1"><a href="#Zm-x3D-0-m-1" class="headerlink" title="Zm &#x3D; {0...m-1}"></a>Zm &#x3D; {0...m-1}</h2><ol>
<li>Closure å°é—­æ€§</li>
<li>Associativity ç»“åˆå¾‹</li>
<li>Commutativity äº¤æ¢å¾‹</li>
<li>Identity element å•ä½å…ƒ ï¼ˆåŠ æ³•0ï¼Œä¹˜æ³•1ï¼‰</li>
<li>Additive inverse åŠ æ³•é€†å…ƒ</li>
<li>Distributivity åˆ†é…ç‡</li>
<li>åˆ¤å®šåŒä½™å¼ï¼Œå·¦è¾¹å‡å³è¾¹æ˜¯mçš„å€æ•°ã€‚</li>
</ol>
<h2 id="Prime"><a href="#Prime" class="headerlink" title="Prime"></a>Prime</h2><ol>
<li>composite &#x2F;kÉ‘m&#39;pÉ‘zÉªt&#x2F; åˆæ•°</li>
<li>divisible by 7 èƒ½è¢«7æ•´é™¤</li>
<li>Mersenne Primes æ¢…æ£®ç´ æ•°ï¼šæ»¡è¶³2çš„ç´ æ•°æ¬¡æ–¹å‡ä¸€çš„ç´ æ•°ã€‚æ£€éªŒ2çš„ç´ æ•°æ¬¡æ–¹å‡ä¸€æ˜¯å¦ç´ æ•°æ˜¯å®¹æ˜“çš„ï¼Œç”±æ­¤å¾—åˆ°å·²çŸ¥çš„æœ€å¤§ç´ æ•°ã€‚$2^{11}-1ä¸æ˜¯ç´ æ•°$</li>
<li>Prime Number Theorem: ä¸è¶…è¿‡xçš„ç´ æ•°ä¸ªæ•°å¤§çº¦æ˜¯(x &#x2F; ln x)ï¼Œä»»å–ä¸€ä¸ªä¸è¶…è¿‡nçš„æ•°ï¼Œåˆ™è¿™ä¸ªæ•°æ˜¯ç´ æ•°çš„æ¦‚ç‡æ˜¯1&#x2F;lnxã€‚</li>
<li>å¯¹ä¸¤ä¸ªäº’è´¨çš„æ•°a,b:ak+bå¯ä»¥ç”Ÿæˆæ— é™ä¸ªç´ æ•°ã€‚</li>
<li>å­˜åœ¨ç”±ä»»æ„ä¸ªç´ æ•°ç»„æˆçš„ç­‰å·®æ•°åˆ—ï¼ˆArithmetic Progressionï¼‰</li>
<li>ç°é˜¶æ®µæ²¡æœ‰å‘ç°é«˜æ•ˆç”Ÿæˆç´ æ•°çš„ç®—æ³•f(n)</li>
<li>ä¸å­˜åœ¨å¤šé¡¹å¼å‡½æ•°f(n)ä½¿å¾—å…¶å€¼ä¸€å®šæ˜¯ç´ æ•°</li>
<li>Goldbachâ€™s Conjecture å“¥å¾·å·´èµ«çŒœæƒ³ï¼šæ‰€æœ‰å¤§äº2çš„å¶æ•°éƒ½èƒ½è¡¨ç¤ºä¸ºä¸¤ä¸ªç´ æ•°çš„å’Œã€‚</li>
<li>Conjecture: There are infinitly many primes of the form $n^2+1$.</li>
<li>The Twin Prime Conjecture: ç›¸å·®2çš„ç´ æ•°æœ‰æ— é™å¤šç»„</li>
</ol>
<h2 id="Great-Commom-Divisor-x2F-dÉª-39-vaÉªzÉš-x2F"><a href="#Great-Commom-Divisor-x2F-dÉª-39-vaÉªzÉš-x2F" class="headerlink" title="Great Commom Divisor &#x2F;dÉª&#39;vaÉªzÉš&#x2F;"></a>Great Commom Divisor &#x2F;dÉª&#39;vaÉªzÉš&#x2F;</h2><ol>
<li>relatively prime äº’è´¨æ•°</li>
<li>pairwise relatively prime ä¸¤ä¸¤äº’è´¨</li>
<li>Prime Factorizations &#x2F;,fÃ¦ktÉ™rai&#39;zeiÊƒÉ™n&#x2F; è´¨å› æ•°åˆ†è§£</li>
<li>Least Common Multiple æœ€å°å…¬å€æ•° lcm(a,b)</li>
<li>Euclidean &#x2F;ju:&#39;klidiÉ™n&#x2F; æ¬§å‡ é‡Œå¾—çš„</li>
<li>BÃ©zoutâ€™s Theorem è´ç¥–å®šç† gcd(a,b) &#x3D; sa+tb. ï¼ˆæ±‚sã€tç”¨æ‰©å±•æ¬§å‡ é‡Œå¾—ï¼‰</li>
<li>if gcd(a,b)&#x3D;1 &amp;&amp; a|bc, then a|c; Therefore, a â‰¡ b (mod m) if ac â‰¡ bc (mod m) &amp;&amp; gcd(c,m)&#x3D;1.</li>
</ol>
<h2 id="Solving-Congruences"><a href="#Solving-Congruences" class="headerlink" title="Solving Congruences"></a>Solving Congruences</h2><ol>
<li>linear congruences çº¿æ€§åŒä½™æ–¹ç¨‹ axâ‰¡b ( mod m)</li>
<li>an inverse of A modulo m æ¨¡mä¸‹açš„ä¹˜æ³•é€†å…ƒ</li>
<li>é€†å…ƒå­˜åœ¨çš„å……è¦æ¡ä»¶ï¼šè‹¥gcd(a,m)&#x3D;1, åˆ™å­˜åœ¨aåœ¨æ¨¡mä¸‹çš„ä¹˜æ³•é€†å…ƒã€‚ Proof: Since gcd(a,m)&#x3D;1, there are integers s and t such that sa+tm&#x3D;1. Hence, sa+tm â‰¡ 1 ( mod m), and it follows that sa â‰¡ 1 ( mod m). ç”¨æ‰©å±•æ¬§å‡ é‡Œå¾—æ±‚å‡ºså³é€†å…ƒã€‚</li>
<li>coefficient &#x2F;koÊŠÉ™ËˆfÉªÊƒÉ™nt&#x2F; ç³»æ•°</li>
<li>Chinese Remainder Theorem: å¯¹äºæ¨¡æ•°ä¸¤ä¸¤äº’è´¨çš„åŒä½™æ–¹ç¨‹ç»„ï¼ˆä¸€æ¡æ–¹ç¨‹çš„å½¢å¼ä¸º$xâ‰¡a_i (\mod m_i), m&gt;1$ï¼‰,åœ¨$æ¨¡M&#x3D;\prod\limits_{i&#x3D;1}^n m_iç³»$ä¸­æœ‰ä¸”ä»…æœ‰å”¯ä¸€è§£ã€‚ä¸€ä¸ªè§£çš„æ„é€ ä¸º$x &#x3D; \sum\limits_{i&#x3D;1}^n a_i M_i y_i$, å…¶ä¸­$M_i &#x3D; M\div m_i, y_i*M_iâ‰¡1 (\mod m_i)$ã€‚å¦‚æ­¤æ„é€ åï¼Œå¯¹ä»»æ„çš„iï¼Œéƒ½æ»¡è¶³åŒä½™æ–¹ç¨‹$x â‰¡ a_i M_i y_i â‰¡ a_i (\mod m_i)$ã€‚æ¨¡ç³»ä¸‹çš„å”¯ä¸€æ€§<strong>å¾…è¯ ç»ƒä¹ 30</strong>ã€‚</li>
<li>Fermatâ€™s Little Theoremï¼š $æœ‰è´¨æ•°pï¼Œæœ‰æ•´æ•°aä¸æ˜¯pçš„å€æ•°ï¼Œåˆ™a^{p-1}â‰¡1(\mod p)$</li>
<li>åˆ©ç”¨è´¹é©¬å°å®šç†å¯ä»¥ç®€åŒ–$a^q \mod p$çš„è¿ç®—ï¼Œå…¶ä¸­qå¾ˆå¤§ã€‚å¯ä»¥å°†qæ›¿æ¢ä¸º$(q \mod (p-1))$</li>
<li>æ»¡è¶³$b^{n-1}â‰¡1(\mod n)$çš„éè´¨æ•°næˆä¸ºä»¥bä¸ºåŸºçš„ä¼ªè´¨æ•° Pseudoprimes to the base bã€‚ï¼ˆè‹è±†ï¼‰</li>
<li>å› ä¸ºåœ¨ä¸€å®šèŒƒå›´å†…çš„å¯¹äºæŸä¸ªåŸºçš„pseudoprimesæ€»æ˜¯å¾ˆå°‘ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œè´¨æ•°è¿‘ä¼¼åˆ¤å®šæµ‹è¯•ã€‚å¯æƒœï¼Œå¯¹äºæŸäº›æ•°nï¼Œå¯¹äºæ‰€æœ‰åŸºbæ»¡è¶³gcd(b,n)&#x3D;1ï¼Œæ€»æ˜¯èƒ½é€šè¿‡ä¼ªç´ æ•°æµ‹è¯•ï¼Œå³$b^{n-1}â‰¡1(\mod n)$ï¼Œè¿™äº›æ•°ç§°ä¸ºCarmichael Numbersï¼ˆå¡éº¦æŠ  å¡ç±³åˆ‡å°”ï¼‰ã€‚ Carmichael Numbersæœ‰æ— ç©·å¤šä¸ªã€‚</li>
<li>æ¬§æ‹‰å®šç†ï¼šè´¹é©¬å°å®šç†çš„æ¨å¹¿ã€‚$æœ‰äº’è´¨æ•´æ•°a,n.åˆ™a^{\phi(n)}â‰¡1 (\mod n)$ï¼Œè€Œaåœ¨æ¨¡næ„ä¹‰ä¸‹å­˜åœ¨é€†å…ƒçš„å……è¦æ¡ä»¶å°±æ˜¯a,näº’è´¨ï¼Œä»è€Œå¾—åˆ°æ¨è®ºï¼šè‹¥açš„é€†å…ƒå­˜åœ¨ï¼Œåˆ™ä¸º$a^{\Phi(n)-1}$ã€‚</li>
<li>Discrete Logarithms (æ¨¡pæ„ä¹‰ä¸‹çš„)ç¦»æ•£å¯¹æ•° å¯¹å·²çŸ¥è´¨æ•°pï¼Œåœ¨æ¨¡pæ„ä¹‰ä¸‹å­˜åœ¨å”¯ä¸€ä¸€ä¸ªprimitive root $r$ åŸå§‹æ ¹ï¼Œä½¿å¾—$r^n$å–éæ‰€æœ‰æ¨¡pæ„ä¹‰ä¸‹æ‰€æœ‰éé›¶æ•°ã€‚ å¯¹ä»»æ„$a\in [1,p-1]$ï¼Œè‹¥æœ‰$r^eâ‰¡a(\mod p), e \in [1, p-1]$ ï¼Œåˆ™å³$\log_r a&#x3D;e$</li>
<li>æ±‚discrete logarithms $\log_r a$(æ¨¡è´¨æ•°pæ„ä¹‰ä¸‹)æ²¡æœ‰æ‰¾åˆ°å¤šé¡¹å¼æ—¶é—´çš„ç®—æ³•ã€‚è¿™ä¸ªé—®é¢˜æ˜¯å¯†ç å­¦çš„ä¸€éƒ¨åˆ†ã€‚</li>
<li></li>
</ol>
]]></content>
      <tags>
        <tag>æ•°å­¦</tag>
      </tags>
  </entry>
  <entry>
    <title>ç½‘ç»œç¼–ç¨‹å®æˆ˜</title>
    <url>/2021/11/08/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/</url>
    <content><![CDATA[<h2 id="å‰æ–¹æ–½å·¥ä¸­"><a href="#å‰æ–¹æ–½å·¥ä¸­" class="headerlink" title="å‰æ–¹æ–½å·¥ä¸­"></a>å‰æ–¹æ–½å·¥ä¸­</h2><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="http://chenshuo.com/practical-network-programming/">chenshuo.com&#x2F;pnp</a></li>
<li><a href="https://www.bilibili.com/video/BV1TA411q75p">é™ˆç¡•-ç½‘ç»œç¼–ç¨‹å®æˆ˜(TCP&#x2F;UDP&#x2F;Socket)</a></li>
<li>åŸæ¥çš„ <a href="http://boolan.com/course/10093">Boolan åšè§ˆè¯¾</a>å·²ç» 404</li>
</ul>
<span id="more"></span>

<h2 id="å¦‚ä½•ä¿è¯å¯é çš„-TCP-è¿æ¥"><a href="#å¦‚ä½•ä¿è¯å¯é çš„-TCP-è¿æ¥" class="headerlink" title="å¦‚ä½•ä¿è¯å¯é çš„ TCP è¿æ¥"></a>å¦‚ä½•ä¿è¯å¯é çš„ TCP è¿æ¥</h2><h3 id="å‘é€æ¯”æ¥æ”¶æ›´éš¾"><a href="#å‘é€æ¯”æ¥æ”¶æ›´éš¾" class="headerlink" title="å‘é€æ¯”æ¥æ”¶æ›´éš¾"></a>å‘é€æ¯”æ¥æ”¶æ›´éš¾</h3><ul>
<li>æŒ‰éš¾åº¦æ’åºï¼š<ol>
<li>æœåŠ¡å™¨å»ºç«‹ TCP &lt; å®¢æˆ·ç«¯å»ºç«‹ TCP &lt; é”€æ¯ TCP</li>
<li>æ¥æ”¶ TCP æ•°æ® &lt; å‘é€ TCP æ•°æ® ï¼ˆå°¤å…¶åœ¨éé˜»å¡ IO ä¸­ï¼‰</li>
</ol>
</li>
<li>å¸¸è§é”™è¯¯ï¼š<code>send()</code>+<code>close()</code> å¯¼è‡´ä¸¢æ•°æ®<ul>
<li>å¦‚æœæ¥æ”¶ç¼“å†²åŒºé‡Œæœ‰æ•°æ®ï¼Œ<code>close()</code> ä¼šå¯¼è‡´ RST æ®µï¼ˆè€Œä¸æ˜¯ FIN æ®µï¼‰å¼ºè¡Œæ–­è¿ï¼Œä¸è®ºå‘é€ç¼“å†²åŒºæ˜¯å¦ä¸ºç©ºï¼Œå¯¼è‡´å¯¹æ–¹ä¸¢æ•°æ®ã€‚</li>
<li><code>SO_LINGER</code> ä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</li>
<li>æ­£ç¡®å‘é€ç«¯åšæ³•ï¼š<code>send()</code>+<code>shutdown_write()</code>+<code>read_until_eof()</code>+<code>close()</code></li>
<li>æ­£ç¡®æ¥æ”¶ç«¯åšæ³•ï¼š<code>read() -&gt; 0</code> + nothing to send + <code>close()</code></li>
<li>å†è€ƒè™‘æœåŠ¡å™¨é˜²å¾¡ï¼š<code>shutdown_write()</code> åè®¾ç½®è¶…æ—¶ï¼Œæ— è®ºå¦‚ä½•éƒ½å…³é—­è¿æ¥ã€‚</li>
<li>æ›´å¥½çš„åšæ³•æ˜¯åœ¨åè®®ä¸­åŒ…å«æ•°æ®é•¿åº¦ï¼Œä½¿ App èƒ½å¤Ÿåˆ¤æ–­æ•°æ®æ˜¯å¦å®Œæ•´ã€‚</li>
<li>è¿˜æœ‰ä¸€ç‚¹æ¼æ´ï¼šsender æ— æ³•ä¿è¯ receiver å·²ç»æ­£ç¡®å¤„ç†æ•°æ®ï¼Œä¾‹å¦‚ receiver å´©æºƒæ—¶ï¼Œsender ä¹Ÿä¼šè¯»åˆ° eofã€‚</li>
</ul>
</li>
</ul>
<h3 id="å¯ç”¨-SO-REUSEADDR"><a href="#å¯ç”¨-SO-REUSEADDR" class="headerlink" title="å¯ç”¨ SO_REUSEADDR"></a>å¯ç”¨ SO_REUSEADDR</h3><ul>
<li>å…è®¸é‡å¤ç›‘å¬åŒä¸€ä¸ªç«¯å£<ul>
<li>ä»¥ä¾¿ server å´©æºƒä¹‹åå¯ä»¥ç«‹å³é‡å¯</li>
<li>ä»¥ä¾¿å¤šè¿›ç¨‹ server ç›‘å¬åŒä¸€ä¸ªç«¯å£</li>
</ul>
</li>
</ul>
<h3 id="åœ¨-Server-ä¸­å¤„ç†-SIGPIPE-ä¿¡å·"><a href="#åœ¨-Server-ä¸­å¤„ç†-SIGPIPE-ä¿¡å·" class="headerlink" title="åœ¨ Server ä¸­å¤„ç† SIGPIPE ä¿¡å·"></a>åœ¨ Server ä¸­å¤„ç† SIGPIPE ä¿¡å·</h3><ul>
<li>åœ¨ Linux I&#x2F;O ä¸­ï¼Œè‹¥è¾“å‡ºç®¡é“å·²ç»å…³é—­ï¼Œåˆ™ writer ä¼šæ”¶åˆ° SIGPIPE ä¿¡å·ã€‚é»˜è®¤çš„ååº”è¡Œä¸ºæ˜¯ä¸­æ­¢è¿›ç¨‹ã€‚</li>
<li>é»˜è®¤è¡Œä¸ºåœ¨å¤šæ•°åœºæ™¯ä¸‹ååˆ†å¥½ç”¨ï¼Œå¯ä»¥æå‰ç»“æŸå·¥ä½œæµï¼Œå‡å°‘ CPU æµªè´¹ã€‚  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gunzip -c huge.log.gz | grep ERROR | <span class="built_in">head</span></span><br></pre></td></tr></table></figure>
ç„¶è€Œåœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œè‹¥ Client å·²ç»å…³é—­ï¼Œåˆ™ Server åŒæ ·ä¼šæ”¶åˆ° SIGPIPE ä¿¡å·ã€‚</li>
<li>Server åº”å½“å°å¿ƒå¤„ç† SIGPIPE ä¿¡å·ï¼Œä»¥é˜² Client å‡ºé”™æˆ–è€…æ¶æ„å“åº”ã€‚</li>
<li>è‹¥ç›´æ¥å¿½ç•¥ SIGPIPE ä¿¡å·ï¼Œåˆ™åº”å½“æ£€æŸ¥<code>printf()</code>çš„è¿”å›å€¼ï¼Œåœ¨å‡ºé”™æ—¶<code>exit()</code>ã€‚</li>
</ul>
<h3 id="Nagle-ç®—æ³•-TCP-NODELAY"><a href="#Nagle-ç®—æ³•-TCP-NODELAY" class="headerlink" title="Nagle ç®—æ³•, TCP_NODELAY"></a>Nagle ç®—æ³•, TCP_NODELAY</h3><ul>
<li>å½±å“ã€Œè¯·æ±‚-å“åº”ã€å‹åè®®ã€‚</li>
<li>å¦‚æœæœ‰æŠ¥æ–‡æ®µæœªæ”¶åˆ° ackï¼Œ<code>write()</code> å°±ä¸ä¼šå‘é€æ•°æ®ï¼Œé¿å…åº”ç”¨å±‚å¤ªæ‹‰å‘å¤ªå¤šå°æ•°æ®ã€‚</li>
<li>å¯¹äºã€Œå†™-å†™-è¯»ã€æ¨¡å¼ï¼Œç¬¬äºŒæ¬¡å†™ä¼šè¢«å»¶è¿Ÿä¸€ä¸ª RTT(Round-Trip Time, å¾€è¿”å»¶è¿Ÿ)ã€‚<ul>
<li>è§£å†³åŠæ³•ï¼šåº”ç”¨å±‚ç¼“å†²ï¼Œæ”¹æˆã€Œå†™-è¯»ã€æ¨¡å¼</li>
<li>ç„¶è€Œéš¾ä»¥è§£å†³å¹¶å‘è¯·æ±‚é—®é¢˜</li>
</ul>
</li>
<li>åº”å½“è€ƒè™‘å…³é—­ Nagle ç®—æ³•<ul>
<li>Go è¯­è¨€å°±æ˜¯è¿™ä¹ˆå¹²çš„</li>
</ul>
</li>
</ul>
<h2 id="èµ·çº¿ç¨‹è¿˜æ˜¯-IO-å¤ç”¨"><a href="#èµ·çº¿ç¨‹è¿˜æ˜¯-IO-å¤ç”¨" class="headerlink" title="èµ·çº¿ç¨‹è¿˜æ˜¯ IO å¤ç”¨"></a>èµ·çº¿ç¨‹è¿˜æ˜¯ IO å¤ç”¨</h2><p>æœåŠ¡å™¨åº”è¯¥é€‰ç”¨ã€Œthread-per-connectã€è¿˜æ˜¯ã€ŒIO-multiplexingã€æ¨¡å¼ï¼Ÿ</p>
<p>å¼€é”€çš„æ ¹æºåœ¨äºåˆ‡æ¢ã€‚èµ·çº¿ç¨‹ä¼šæœ‰åˆ‡æ¢å¼€é”€ï¼ŒIO å¤ç”¨ä¹Ÿæœ‰ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ã€‚</p>
<ul>
<li>è‹¥å®¢æˆ·ç«¯ä¸è¶…è¿‡ç¡¬ä»¶å¹¶å‘æ•°ï¼Œå°±ï¼ˆå‡ ä¹ï¼‰æ²¡æœ‰çº¿ç¨‹åˆ‡æ¢å¼€é”€ã€‚</li>
<li>è‹¥å®¢æˆ·ç«¯å¾ˆå¤šï¼Œåˆ™ IO å¤ç”¨çš„ç³»ç»Ÿè°ƒç”¨å¼€é”€å°äºçº¿ç¨‹åˆ‡æ¢å¼€é”€ã€‚</li>
</ul>
<h2 id="netcat-å®ç°"><a href="#netcat-å®ç°" class="headerlink" title="netcat å®ç°"></a>netcat å®ç°</h2><ol>
<li>é˜»å¡å¼ï¼Œ2 threads per connection</li>
<li>IO-multiplexing</li>
</ol>
]]></content>
      <tags>
        <tag>C++</tag>
        <tag>Concurrency</tag>
        <tag>è®¡ç®—æœºç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>è®¡ç®—æœºç½‘ç»œæçº²</title>
    <url>/2019/10/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/</url>
    <content><![CDATA[<p>[TOC]</p>
<span id="more"></span>

<ul>
<li><a href="#1-%E6%A6%82%E8%BF%B0">1 æ¦‚è¿°</a><ul>
<li><a href="#13-%E4%BA%92%E8%81%94%E7%BD%91%E7%9A%84%E7%BB%84%E6%88%90">1.3 äº’è”ç½‘çš„ç»„æˆ</a><ul>
<li><a href="#%E4%BA%A4%E6%8D%A2%E6%96%B9%E5%BC%8F">äº¤æ¢æ–¹å¼</a></li>
</ul>
</li>
<li><a href="#15-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%9A%84%E7%B1%BB%E5%88%AB">1.5 è®¡ç®—æœºç½‘ç»œçš„ç±»åˆ«</a><ul>
<li><a href="#%E6%8C%89%E7%85%A7%E7%BD%91%E7%BB%9C%E7%9A%84%E4%BD%9C%E7%94%A8%E8%8C%83%E5%9B%B4%E5%88%86%E7%B1%BB">æŒ‰ç…§ç½‘ç»œçš„ä½œç”¨èŒƒå›´åˆ†ç±»</a></li>
</ul>
</li>
<li><a href="#16-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%9A%84%E6%80%A7%E8%83%BD">1.6 è®¡ç®—æœºç½‘ç»œçš„æ€§èƒ½</a><ul>
<li><a href="#%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87">æ€§èƒ½æŒ‡æ ‡</a><ul>
<li><a href="#%E9%80%9F%E7%8E%87">é€Ÿç‡</a></li>
<li><a href="#%E5%B8%A6%E5%AE%BD">å¸¦å®½</a></li>
<li><a href="#%E5%90%9E%E5%90%90%E9%87%8F">ååé‡</a></li>
<li><a href="#%E6%97%B6%E5%BB%B6">æ—¶å»¶</a></li>
<li><a href="#%E6%97%B6%E5%BB%B6%E5%B8%A6%E5%AE%BD%E7%A7%AF">æ—¶å»¶å¸¦å®½ç§¯</a></li>
<li><a href="#%E5%BE%80%E8%BF%94%E6%97%B6%E9%97%B4">å¾€è¿”æ—¶é—´</a></li>
<li><a href="#%E5%88%A9%E7%94%A8%E7%8E%87">åˆ©ç”¨ç‡</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#17-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84">1.7 è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„</a><ul>
<li><a href="#%E5%8D%8F%E8%AE%AE">åè®®</a><ul>
<li><a href="#%E4%BA%94%E5%B1%82%E5%8D%8F%E8%AE%AE%E7%9A%84%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84">äº”å±‚åè®®çš„ä½“ç³»ç»“æ„</a></li>
<li><a href="#%E5%BA%94%E7%94%A8%E5%B1%82">åº”ç”¨å±‚</a></li>
<li><a href="#%E4%BC%A0%E8%BE%93%E5%B1%82">ä¼ è¾“å±‚</a></li>
<li><a href="#%E7%BD%91%E7%BB%9C%E5%B1%82">ç½‘ç»œå±‚</a></li>
<li><a href="#%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82">æ•°æ®é“¾è·¯å±‚</a></li>
<li><a href="#%E7%89%A9%E7%90%86%E5%B1%82">ç‰©ç†å±‚</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#%E4%B9%A0%E9%A2%98">ä¹ é¢˜</a></li>
</ul>
</li>
<li><a href="#2-%E7%89%A9%E7%90%86%E5%B1%82">2 ç‰©ç†å±‚</a><ul>
<li><a href="#21-%E7%89%A9%E7%90%86%E5%B1%82%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">2.1 ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ</a></li>
<li><a href="#22-%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86">2.2 æ•°æ®é€šä¿¡çš„åŸºç¡€çŸ¥è¯†</a><ul>
<li><a href="#%E6%95%B0%E6%8D%AE%E9%80%9A%E4%BF%A1%E7%B3%BB%E7%BB%9F%E7%9A%84%E6%A8%A1%E5%9E%8B">æ•°æ®é€šä¿¡ç³»ç»Ÿçš„æ¨¡å‹</a></li>
<li><a href="#%E6%9C%89%E5%85%B3%E4%BF%A1%E9%81%93%E7%9A%84%E5%87%A0%E4%B8%AA%E6%A6%82%E5%BF%B5">æœ‰å…³ä¿¡é“çš„å‡ ä¸ªæ¦‚å¿µ</a><ul>
<li><a href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E7%BC%96%E7%A0%81%E6%96%B9%E5%BC%8F">å¸¸ç”¨çš„ç¼–ç æ–¹å¼</a></li>
<li><a href="#%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%B8%A6%E9%80%9A%E8%B0%83%E5%88%B6%E6%96%B9%E6%B3%95">åŸºæœ¬çš„å¸¦é€šè°ƒåˆ¶æ–¹æ³•</a></li>
</ul>
</li>
<li><a href="#%E4%BF%A1%E9%81%93%E7%9A%84%E6%9E%81%E9%99%90%E5%AE%B9%E9%87%8F">ä¿¡é“çš„æé™å®¹é‡</a><ul>
<li><a href="#%E4%BF%A1%E9%81%93%E8%83%BD%E9%80%9A%E8%BF%87%E7%9A%84%E9%A2%91%E7%8E%87%E8%8C%83%E5%9B%B4">ä¿¡é“èƒ½é€šè¿‡çš„é¢‘ç‡èŒƒå›´</a></li>
<li><a href="#%E4%BF%A1%E5%99%AA%E6%AF%94">ä¿¡å™ªæ¯”</a></li>
<li><a href="#%E9%A6%99%E5%86%9C%E5%85%AC%E5%BC%8F">é¦™å†œå…¬å¼</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#23-%E7%89%A9%E7%90%86%E5%B1%82%E4%B8%8B%E9%9D%A2%E7%9A%84%E4%BC%A0%E8%BE%93%E5%AA%92%E4%BD%93">2.3 ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“</a><ul>
<li><a href="#%E5%BC%95%E5%AF%BC%E5%9E%8B%E4%BC%A0%E8%BE%93%E5%AA%92%E4%BD%93">å¼•å¯¼å‹ä¼ è¾“åª’ä½“</a></li>
<li><a href="#%E9%9D%9E%E5%BC%95%E5%AF%BC%E5%9E%8B%E4%BC%A0%E8%BE%93%E5%AA%92%E4%BD%93">éå¼•å¯¼å‹ä¼ è¾“åª’ä½“</a></li>
</ul>
</li>
<li><a href="#%E4%BF%A1%E9%81%93%E5%A4%8D%E7%94%A8%E6%8A%80%E6%9C%AF">ä¿¡é“å¤ç”¨æŠ€æœ¯</a></li>
<li><a href="#25-%E6%95%B0%E5%AD%97%E4%BC%A0%E8%BE%93%E7%B3%BB%E7%BB%9F">2.5 æ•°å­—ä¼ è¾“ç³»ç»Ÿ</a></li>
<li><a href="#26-%E5%AE%BD%E5%B8%A6%E6%8E%A5%E5%85%A5%E6%8A%80%E6%9C%AF">2.6 å®½å¸¦æ¥å…¥æŠ€æœ¯</a><ul>
<li><a href="#adsl%E6%8A%80%E6%9C%AF">ADSLæŠ€æœ¯</a></li>
</ul>
</li>
<li><a href="#%E4%B9%A0%E9%A2%98-1">ä¹ é¢˜</a></li>
</ul>
</li>
<li><a href="#3-%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82">3 æ•°æ®é“¾è·¯å±‚</a><ul>
<li><a href="#%E7%82%B9%E5%AF%B9%E7%82%B9%E4%BF%A1%E9%81%93%E7%9A%84%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82">ç‚¹å¯¹ç‚¹ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚</a><ul>
<li><a href="#%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%92%8C%E5%B8%A7">æ•°æ®é“¾è·¯å’Œå¸§</a></li>
<li><a href="#%E4%B8%89%E4%B8%AA%E5%9F%BA%E6%9C%AC%E9%97%AE%E9%A2%98">ä¸‰ä¸ªåŸºæœ¬é—®é¢˜</a></li>
</ul>
</li>
<li><a href="#%E7%82%B9%E5%AF%B9%E7%82%B9%E5%8D%8F%E8%AE%AEppp">ç‚¹å¯¹ç‚¹åè®®PPP</a><ul>
<li><a href="#ppp%E5%8D%8F%E8%AE%AE%E7%9A%84%E7%89%B9%E7%82%B9">PPPåè®®çš„ç‰¹ç‚¹</a></li>
<li><a href="#ppp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%B8%A7%E6%A0%BC%E5%BC%8F">PPPåè®®çš„å¸§æ ¼å¼</a></li>
<li><a href="#ppp%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%B7%A5%E4%BD%9C%E7%8A%B6%E6%80%81">PPPåè®®çš„å·¥ä½œçŠ¶æ€</a></li>
</ul>
</li>
<li><a href="#%E4%B9%A0%E9%A2%98-2">ä¹ é¢˜</a></li>
</ul>
</li>
</ul>
<h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1 æ¦‚è¿°"></a>1 æ¦‚è¿°</h1><h2 id="1-3-äº’è”ç½‘çš„ç»„æˆ"><a href="#1-3-äº’è”ç½‘çš„ç»„æˆ" class="headerlink" title="1.3 äº’è”ç½‘çš„ç»„æˆ"></a>1.3 äº’è”ç½‘çš„ç»„æˆ</h2><h3 id="äº¤æ¢æ–¹å¼"><a href="#äº¤æ¢æ–¹å¼" class="headerlink" title="äº¤æ¢æ–¹å¼"></a>äº¤æ¢æ–¹å¼</h3><ol>
<li>ç”µè·¯äº¤æ¢ï¼šæ•´ä¸ªæŠ¥æ–‡çš„æ¯”ç‰¹æµè¿ç»­åœ°ä»æºç‚¹ç›´è¾¾ç»ˆç‚¹ï¼Œå¥½åƒåœ¨ä¸€ä¸ªç®¡é“ä¸­ä¼ é€ã€‚</li>
<li>æŠ¥æ–‡äº¤æ¢ï¼šæ•´ä¸ªæŠ¥æ–‡ä¼ é€åˆ°ç›¸é‚»ç»“ç‚¹ï¼Œå…¨éƒ¨å‚¨å­˜ä¸‹æ¥åæŸ¥æ‰¾è½¬å‘è¡¨ï¼Œè½¬å‘åˆ°ä¸‹ä¸€ä¸ªç»“ç‚¹ã€‚</li>
<li>åˆ†ç»„äº¤æ¢ï¼šå•ä¸ªåˆ†ç»„ï¼ˆæ•´ä¸ªæŠ¥æ–‡çš„ä¸€éƒ¨åˆ†ï¼‰ä¼ é€åˆ°ç›¸é‚»ç»“ç‚¹ï¼Œå‚¨å­˜ä¸‹æ¥åæŸ¥æ‰¾è½¬å‘è¡¨ï¼Œè½¬å‘åˆ°ä¸‹ä¸€ä¸ªç»“ç‚¹ã€‚</li>
</ol>
<h2 id="1-5-è®¡ç®—æœºç½‘ç»œçš„ç±»åˆ«"><a href="#1-5-è®¡ç®—æœºç½‘ç»œçš„ç±»åˆ«" class="headerlink" title="1.5 è®¡ç®—æœºç½‘ç»œçš„ç±»åˆ«"></a>1.5 è®¡ç®—æœºç½‘ç»œçš„ç±»åˆ«</h2><h3 id="æŒ‰ç…§ç½‘ç»œçš„ä½œç”¨èŒƒå›´åˆ†ç±»"><a href="#æŒ‰ç…§ç½‘ç»œçš„ä½œç”¨èŒƒå›´åˆ†ç±»" class="headerlink" title="æŒ‰ç…§ç½‘ç»œçš„ä½œç”¨èŒƒå›´åˆ†ç±»"></a>æŒ‰ç…§ç½‘ç»œçš„ä½œç”¨èŒƒå›´åˆ†ç±»</h3><ol>
<li>å¹¿åŸŸç½‘ (Wide Area Network, WAN)ï¼Œè¿œç¨‹ç½‘ï¼Œé•¿è·ç¦»ï¼Œé«˜é€Ÿé“¾è·¯ï¼Œè¾ƒå¤§é€šä¿¡å®¹é‡ã€‚</li>
<li>åŸåŸŸç½‘ (Metropolitan Area Network, MAN)ï¼Œå¤šä¸ªå±€åŸŸç½‘ï¼Œä¸€ä¸ªåŸå¸‚ï¼Œå¸¸ç”¨ä»¥å¤ªç½‘æŠ€æœ¯ã€‚</li>
<li>å±€åŸŸç½‘ (Local Area Network, LAN)ï¼Œå¾®å‹è®¡ç®—æœºæˆ–å·¥ä½œç«™é€šè¿‡é«˜é€Ÿé€šä¿¡çº¿è·¯ç›¸è¿ã€‚</li>
<li>ä¸ªäººåŒºåŸŸç½‘ (Personal Area Networl, PAN)ï¼Œä¸ªäººä½¿ç”¨çš„ç”µå­è®¾å¤‡ã€‚</li>
</ol>
<h2 id="1-6-è®¡ç®—æœºç½‘ç»œçš„æ€§èƒ½"><a href="#1-6-è®¡ç®—æœºç½‘ç»œçš„æ€§èƒ½" class="headerlink" title="1.6 è®¡ç®—æœºç½‘ç»œçš„æ€§èƒ½"></a>1.6 è®¡ç®—æœºç½‘ç»œçš„æ€§èƒ½</h2><h3 id="æ€§èƒ½æŒ‡æ ‡"><a href="#æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="æ€§èƒ½æŒ‡æ ‡"></a>æ€§èƒ½æŒ‡æ ‡</h3><h4 id="é€Ÿç‡"><a href="#é€Ÿç‡" class="headerlink" title="é€Ÿç‡"></a>é€Ÿç‡</h4><ul>
<li>1Mbps &#x3D; $10^6$ bits &#x2F; second</li>
<li>1MB &#x3D; $2^{20}$ Bytes</li>
</ul>
<h4 id="å¸¦å®½"><a href="#å¸¦å®½" class="headerlink" title="å¸¦å®½"></a>å¸¦å®½</h4><ul>
<li>æŸä¸ªä¿¡å·å…·æœ‰çš„é¢‘å¸¦å®½åº¦ï¼ˆ300Hz &lt;-&gt; 3.4 kHz &#x3D;&#x3D;&gt; 3.1kHzï¼‰ï¼Œé¢‘åŸŸ</li>
<li>æŸé€šé“ä¼ è¾“æ•°æ®çš„èƒ½åŠ›ï¼Œæ—¶åŸŸ</li>
</ul>
<h4 id="ååé‡"><a href="#ååé‡" class="headerlink" title="ååé‡"></a>ååé‡</h4><ul>
<li>å•ä½æ—¶é—´å†…é€šè¿‡æŸä¸ªç½‘ç»œï¼ˆæˆ–ä¿¡é“ã€æ¥å£ï¼‰çš„å®é™…æ•°æ®é‡</li>
</ul>
<h4 id="æ—¶å»¶"><a href="#æ—¶å»¶" class="headerlink" title="æ—¶å»¶"></a>æ—¶å»¶</h4><ol>
<li>å‘é€æ—¶å»¶ï¼ˆä¼ è¾“æ—¶å»¶ï¼‰ï¼ˆtransmission delayï¼‰ï¼šå‘é€æ•°æ®å¸§æ‰€éœ€çš„æ—¶é—´ï¼Œä¸å‘é€å™¨ï¼ˆç½‘ç»œé€‚é…å™¨ï¼‰æœ‰å…³ã€‚$å‘é€æ—¶é—´ &#x3D; \frac{æ•°æ®é•¿åº¦}{å‘é€é€Ÿç‡}$</li>
<li>ä¼ æ’­æ—¶å»¶ï¼ˆpropagation delayï¼‰ï¼šç”µç£æ³¢ä¼ æ’­èŠ±è´¹çš„æ—¶é—´ï¼Œä¸çº¿è·¯æœ‰å…³</li>
<li>å¤„ç†æ—¶å»¶ï¼šæ”¶åˆ°åˆ†ç»„åçš„è®¡ç®—è€—æ—¶</li>
<li>æ’é˜Ÿæ—¶å»¶ï¼šè¾“å…¥é˜Ÿåˆ—ã€è¾“å‡ºé˜Ÿåˆ—è€—æ—¶</li>
</ol>
<h4 id="æ—¶å»¶å¸¦å®½ç§¯"><a href="#æ—¶å»¶å¸¦å®½ç§¯" class="headerlink" title="æ—¶å»¶å¸¦å®½ç§¯"></a>æ—¶å»¶å¸¦å®½ç§¯</h4><p>ä¼ æ’­æ—¶å»¶ * å¸¦å®½ã€‚è¡¨ç¤ºçº¿è·¯çš„â€œå®¹ç§¯â€</p>
<h4 id="å¾€è¿”æ—¶é—´"><a href="#å¾€è¿”æ—¶é—´" class="headerlink" title="å¾€è¿”æ—¶é—´"></a>å¾€è¿”æ—¶é—´</h4><p>ï¼ˆRound-Trip Time, RTTï¼‰æœ€åä¸€å¸§çš„ä¼ æ’­å»¶è¿Ÿ+ackçš„ä¼ æ’­å»¶è¿Ÿï¼ˆå‡è®¾å¿½ç•¥å‘é€æ—¶å»¶ï¼‰</p>
<p>$æœ‰æ•ˆæ•°æ®ç‡ &#x3D; \frac{æ•°æ®é•¿åº¦}{å‘é€æ—¶é—´+\text{RTT}}$</p>
<h4 id="åˆ©ç”¨ç‡"><a href="#åˆ©ç”¨ç‡" class="headerlink" title="åˆ©ç”¨ç‡"></a>åˆ©ç”¨ç‡</h4><ul>
<li>ä¿¡é“åˆ©ç”¨ç‡ï¼šä¿¡é“æœ‰æ•°æ®é€šè¿‡çš„æ—¶é—´çš„æ¯”ç‡</li>
<li>ç½‘ç»œåˆ©ç”¨ç‡ï¼šå…¨ç½‘ç»œçš„ä¿¡é“åˆ©ç”¨ç‡çš„åŠ æƒå¹³å‡å€¼</li>
</ul>
<p>è®¾$D_0$ä¸ºç½‘ç»œç©ºé—²æ—¶ï¼ˆåˆ©ç”¨ç‡0%ï¼‰çš„æ—¶å»¶ï¼Œ$D$è¡¨ç¤ºå½“å‰ç½‘ç»œæ—¶å»¶ï¼Œå½“å‰åˆ©ç”¨ç‡$U$ï¼Œåˆ™$D &#x3D; \frac{D_0}{1-U}$ã€‚</p>
<h2 id="1-7-è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„"><a href="#1-7-è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„" class="headerlink" title="1.7 è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„"></a>1.7 è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„</h2><ul>
<li>ç³»ç»Ÿç½‘ç»œä½“ç³»ç»“æ„ SNAï¼ˆSystem Network Architectureï¼‰ã€‚IBMå¼€å‘ã€‚</li>
<li><strong>å¼€æ”¾ç³»ç»Ÿäº’è¿åŸºæœ¬å‚è€ƒæ¨¡å‹ OSI&#x2F;RM</strong>ï¼ˆOpen Systems Interconnection Reference Modelï¼‰ISOåˆ¶å®šã€‚</li>
</ul>
<h3 id="åè®®"><a href="#åè®®" class="headerlink" title="åè®®"></a>åè®®</h3><ul>
<li><p>å®šä¹‰ï¼šä¸ºè¿›è¡Œç½‘ç»œä¸­çš„æ•°æ®äº¤æ¢è€Œå»ºç«‹çš„è§„åˆ™ã€æ ‡å‡†æˆ–çº¦å®š</p>
</li>
<li><p>ä¸‰è¦ç´ ï¼šè¯­æ³•ï¼Œè¯­ä¹‰ï¼ŒåŒæ­¥</p>
</li>
</ul>
<h4 id="äº”å±‚åè®®çš„ä½“ç³»ç»“æ„"><a href="#äº”å±‚åè®®çš„ä½“ç³»ç»“æ„" class="headerlink" title="äº”å±‚åè®®çš„ä½“ç³»ç»“æ„"></a>äº”å±‚åè®®çš„ä½“ç³»ç»“æ„</h4><p><img src="/2019/10/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.png"></p>
<p>æ— è®ºå“ªä¸€å±‚ä¼ é€çš„æ•°æ®å•å…ƒï¼Œéƒ½ç¬¼ç»Ÿåœ°ç”¨â€œ<strong>åˆ†ç»„</strong>â€æˆ–â€œ<strong>åè®®æ•°æ®å•å…ƒPDUï¼ˆProtocol Data Unitï¼‰</strong>â€æ¥è¡¨ç¤º</p>
<h4 id="åº”ç”¨å±‚"><a href="#åº”ç”¨å±‚" class="headerlink" title="åº”ç”¨å±‚"></a>åº”ç”¨å±‚</h4><p><strong>application layer</strong></p>
<p>è´Ÿè´£åº”ç”¨è¿›ç¨‹é—´äº¤äº’ã€‚  åè®®å®šä¹‰è¿›ç¨‹é—´é€šä¿¡å’Œäº¤äº’çš„è§„åˆ™ã€‚</p>
<p>å¦‚ï¼šåŸŸåç³»ç»ŸDNSï¼›HTTPåè®®ï¼›SMTPåè®®ï¼›</p>
<p>æ•°æ®å•å…ƒç§°ä¸º<strong>æŠ¥æ–‡ï¼ˆmessageï¼‰</strong>ã€‚</p>
<h4 id="ä¼ è¾“å±‚"><a href="#ä¼ è¾“å±‚" class="headerlink" title="ä¼ è¾“å±‚"></a>ä¼ è¾“å±‚</h4><p><strong>transport layer</strong></p>
<p>è´Ÿè´£ä¸ºè¿›ç¨‹é—´é€šä¿¡æä¾›<strong>é€šç”¨çš„</strong>æ•°æ®ä¼ è¾“æœåŠ¡ã€‚</p>
<p>ä¸€ä¸ªä¸»æœºï¼Œå¤šä¸ªè¿›ç¨‹ &#x3D;&gt; ä¼ è¾“å±‚æœ‰å¤ç”¨å’Œåˆ†ç”¨çš„åŠŸèƒ½</p>
<p>ä¸»è¦åè®®ï¼š  </p>
<ul>
<li>ä¼ è¾“æ§åˆ¶åè®® TCPï¼ˆTransmission Control Protocolï¼‰ï¼šé¢å‘è¿æ¥çš„ã€å¯é çš„æ•°æ®ä¼ è¾“æœåŠ¡ã€‚æ•°æ®ä¼ è¾“çš„å•ä½æ˜¯<strong>æŠ¥æ–‡æ®µï¼ˆsegmentï¼‰</strong></li>
<li>ç”¨æˆ·æ•°æ®æŠ¥åè®® UDPï¼ˆUser Datagram protocolï¼‰ï¼šæ— è¿æ¥çš„ã€å°½æœ€å¤§åŠªåŠ›çš„æ•°æ®ä¼ è¾“æœåŠ¡ï¼ˆä¸ä¿è¯æ•°æ®ä¼ è¾“çš„å¯é æ€§ï¼‰ã€‚æ•°æ®ä¼ è¾“çš„å•ä½æ˜¯<strong>ç”¨æˆ·æ•°æ®æŠ¥</strong></li>
</ul>
<h4 id="ç½‘ç»œå±‚"><a href="#ç½‘ç»œå±‚" class="headerlink" title="ç½‘ç»œå±‚"></a>ç½‘ç»œå±‚</h4><p><strong>network layer</strong></p>
<p>ä¹Ÿå«ç½‘é™…å±‚ã€IPå±‚ã€‚</p>
<p>è´Ÿè´£ä¸ºåˆ†ç»„äº¤æ¢ç½‘ä¸Šçš„ä¸åŒä¸»æœºæä¾›é€šä¿¡æœåŠ¡ã€‚ å‘é€æ•°æ®æ—¶ï¼Œå°†è¿è¾“å±‚çš„æŠ¥æ–‡æ®µæˆ–ç”¨æˆ·æ•°æ®æŠ¥å°è£…æˆ<strong>åˆ†ç»„</strong>æˆ–<strong>åŒ…</strong>è¿›è¡Œä¼ é€ã€‚</p>
<p>åœ¨TCP&#x2F;IPä¸­ï¼Œç½‘ç»œå±‚ä½¿ç”¨IPåè®®ï¼Œæ‰€ä»¥åˆ†ç»„ä¹Ÿå«<strong>IPæ•°æ®æŠ¥</strong>ï¼Œç®€ç§°æ•°æ®æŠ¥ã€‚</p>
<p>ç½‘ç»œå±‚è¦é€‰æ‹©åˆé€‚çš„è·¯ç”±ã€‚</p>
<h4 id="æ•°æ®é“¾è·¯å±‚"><a href="#æ•°æ®é“¾è·¯å±‚" class="headerlink" title="æ•°æ®é“¾è·¯å±‚"></a>æ•°æ®é“¾è·¯å±‚</h4><p><strong>data link layer</strong></p>
<p>å°†ç½‘ç»œå±‚çš„åŒ…<strong>ç»„è£…æˆå¸§ï¼ˆframingï¼‰</strong>ï¼Œåœ¨ä¸¤ä¸ªç›¸é‚»ç»“ç‚¹ä¹‹é—´ä¼ é€<strong>å¸§ï¼ˆframeï¼‰</strong>ã€‚æ¯ä¸€å¸§åŒ…æ‹¬æ•°æ®å’Œ<strong>æ§åˆ¶ä¿¡æ¯</strong>ï¼ˆå¦‚åŒæ­¥ä¿¡æ¯ã€åœ°å€ä¿¡æ¯ã€å·®é”™æ§åˆ¶ç­‰ï¼‰ã€‚</p>
<p>æ§åˆ¶ä¿¡æ¯æŒ‡å‡ºäº†æ•°æ®åœ¨å“ªã€æ ¡éªŒæˆ–çº é”™ä¿¡æ¯ã€‚å¦‚æœå‘ç°å·®é”™ï¼Œå¯ä»¥<strong>ä¸¢å¼ƒ</strong>è¿™ä¸€å¸§ã€‚</p>
<h4 id="ç‰©ç†å±‚"><a href="#ç‰©ç†å±‚" class="headerlink" title="ç‰©ç†å±‚"></a>ç‰©ç†å±‚</h4><p><strong>physical layer</strong></p>
<p>æ•°æ®å•ä½æ˜¯<strong>æ¯”ç‰¹</strong>ã€‚è´Ÿè´£å…³æ³¨ç”µå‹å’Œç”µç¼†çš„å¼•è„šã€‚</p>
<p>ç”µç¼†ã€æ— çº¿ä¿¡é“ç­‰ç‰©ç†åª’ä½“ä¸æ˜¯ç‰©ç†å±‚å…³æ³¨çš„ã€‚å¦‚ä½•è§£é‡Š0å’Œ1çš„æ„ä¹‰ä¹Ÿä¸æ˜¯ç‰©ç†å±‚è´Ÿè´£çš„ã€‚</p>
<hr>
<p>åŒå±‚æ¬¡ä¹‹é—´å¯ä»¥å±è”½ä¸‹å±‚çš„å·¥ä½œï¼Œçœ‹ä½œæŠŠåè®®æ•°æ®å•å…ƒç›´æ¥ä¼ é€ç»™â€œ<strong>å¯¹ç­‰å±‚ï¼ˆpeer layersï¼‰</strong>â€ã€‚</p>
<p>æ¯ä¸€å±‚åœ¨åè®®çš„æ§åˆ¶ä¸‹ä¸ºä¸Šä¸€å±‚æä¾›<strong>æœåŠ¡</strong>ã€‚è¦å®ç°æœ¬å±‚åè®®ï¼Œéœ€è¦ä¾èµ–ä¸‹ä¸€å±‚æä¾›çš„æœåŠ¡ã€‚</p>
<p>æ¯ä¸€å±‚åè®®åªèƒ½çœ‹è§ä¸‹ä¸€å±‚çš„æœåŠ¡ã€‚ ä¸‹é¢çš„åè®®å¯¹ä¸Šé¢çš„å®ä½“æ˜¯é€æ˜çš„ã€‚</p>
<p>OSIæŠŠå±‚ä¸å±‚ä¹‹é—´äº¤æ¢çš„æ•°æ®çš„å•ä½ç§°ä¸º*<em>æœåŠ¡æ•°æ®å•å…ƒSDUï¼ˆService Data Unitï¼‰</em></p>
<p>è®¡ç®—æœºç½‘ç»œçš„åè®®å¿…é¡»æŠŠ<strong>æ‰€æœ‰</strong>ä¸åˆ©çš„æ¡ä»¶éƒ½äº‹å…ˆä¼°è®¡åˆ°ï¼Œè€Œä¸èƒ½å‡å®šä¸€åˆ‡éƒ½æ˜¯æ­£å¸¸çš„å’Œç†æƒ³çš„ã€‚</p>
<h2 id="ä¹ é¢˜"><a href="#ä¹ é¢˜" class="headerlink" title="ä¹ é¢˜"></a>ä¹ é¢˜</h2><ol>
<li>OSIçš„ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µæ˜¯æœåŠ¡ã€æ¥å£ã€åè®®ã€‚</li>
<li>åŸæ•°æ®1000å­—èŠ‚ï¼Œä¸ƒå±‚ä½“ç³»ç»“æ„ï¼Œæ¯å±‚20å­—èŠ‚çš„å¤´ã€‚åˆ™å¤´å ç”¨äº†$140&#x2F;1140 &#x3D; 12%$çš„å¸¦å®½ã€‚</li>
<li>æœ€æ—©å®ç°åˆ†ç»„äº¤æ¢ï¼ˆ<strong>packet switched</strong>ï¼‰çš„ç½‘ç»œæ˜¯<strong>ARPAnet</strong>ã€‚</li>
<li>ç½‘ç»œå±‚æ§åˆ¶äº†å­ç½‘çš„æ“ä½œã€å†³å®šåˆ†ç»„çš„è·¯ç”±ã€‚</li>
<li>åº”ç”¨å±‚æœ‰ä¸€ç³»åˆ—ç”¨æˆ·å¸¸ç”¨çš„åè®®ã€‚</li>
<li>è¡¨ç¤ºå±‚ï¼ˆ<strong>presentation</strong>ï¼‰å…³å¿ƒæ•°æ®çš„è¯­æ³•å’Œè¯­ä¹‰ã€‚</li>
<li>æ•°æ®é“¾è·¯å±‚å°†åŸå§‹ä¼ è¾“è®¾å¤‡è½¬æ¢ä¸ºä¸€ä¸ªå·²æ£€é”™çš„çº¿è·¯ã€‚</li>
<li>èƒ½å°†ä¿¡æ¯å‘å¾€éƒ¨åˆ†æœºå™¨çš„å¹¿æ’­å½¢å¼å«å¤šæ’­ï¼ˆ<strong>multicasting</strong>ï¼‰ã€‚</li>
<li>åè®®æ˜¯å®ä½“å¦‚ä½•è¿›è¡Œäº¤æµçš„çº¦å®šã€‚</li>
<li>å„ç§åè®®çš„å®ç°ç»†èŠ‚ä¸å±äºç½‘ç»œä½“ç³»ç»“æ„çš„å†…å®¹ã€‚</li>
<li>ä¸€ä¸ªè®¡ç®—æœºç½‘ç»œå¯ä»¥çœ‹ä½œä¸€äº›è‡ªä¸»è®¡ç®—æœºç³»ç»Ÿçš„è¿æ¥ã€‚</li>
<li>å‘é€é€Ÿç‡æ˜¯10Mbpsï¼Œè€ƒè™‘åŒè½´çº¿ç¼†çš„ä¼ æ’­é€Ÿåº¦æ˜¯å…‰é€Ÿçš„$\frac{2}{3}$ï¼Œåˆ™1bitçš„é•¿åº¦æ˜¯20ç±³ã€‚</li>
<li>OSIçš„å¤±è´¥åœ¨äºæŠ€æœ¯ã€è€—æ—¶ã€å®ç°ã€æ”¿ç­–ã€‚</li>
<li>æ•°æ®åŒ…åœ¨å‘ä¸Šå±‚ä¼ é€’æ—¶ï¼Œå¤´éƒ¨å°†ä¼šè¢«åˆ é™¤ã€‚</li>
<li>å«æ˜Ÿç»„ç½‘ï¼Œå›åº”è¯·æ±‚çš„å»¶è¿ŸæŒ‰4å€çš„è·ç¦»ç®—ã€‚</li>
<li>å‚¨å­˜è½¬å‘ä¼ è¾“ï¼ˆ<strong>Store-and-forward transmission</strong>ï¼‰æ„å‘³ç€è·¯ç”±å™¨è¦å‚¨å­˜æ•´ä¸ªåŒ…çš„å†…å®¹ã€‚</li>
<li>æ•°æ®è½¬æ¢å’Œå‹ç¼©æ˜¯ç”±è¡¨ç¤ºå±‚å®Œæˆçš„ã€‚</li>
<li>æ¥å£å®šä¹‰äº†ä½å±‚å‘é«˜å±‚æä¾›çš„åŸå§‹æ“ä½œå’ŒæœåŠ¡ã€‚</li>
</ol>
<h1 id="2-ç‰©ç†å±‚"><a href="#2-ç‰©ç†å±‚" class="headerlink" title="2 ç‰©ç†å±‚"></a>2 ç‰©ç†å±‚</h1><h2 id="2-1-ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ"><a href="#2-1-ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="2.1 ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ"></a>2.1 ç‰©ç†å±‚çš„åŸºæœ¬æ¦‚å¿µ</h2><p>ç‰©ç†å±‚çš„ä¸»è¦ä»»åŠ¡æ˜¯ç¡®å®šä¸ä¼ è¾“åª’ä½“æ¥å£ç›¸å…³çš„ä¸€äº›ç‰¹æ€§ï¼Œå³ï¼š  </p>
<ol>
<li>æœºæ¢°ç‰¹æ€§</li>
<li>ç”µæ°”ç‰¹æ€§</li>
<li>åŠŸèƒ½ç‰¹æ€§</li>
<li>è¿‡ç¨‹ç‰¹æ€§</li>
</ol>
<h2 id="2-2-æ•°æ®é€šä¿¡çš„åŸºç¡€çŸ¥è¯†"><a href="#2-2-æ•°æ®é€šä¿¡çš„åŸºç¡€çŸ¥è¯†" class="headerlink" title="2.2 æ•°æ®é€šä¿¡çš„åŸºç¡€çŸ¥è¯†"></a>2.2 æ•°æ®é€šä¿¡çš„åŸºç¡€çŸ¥è¯†</h2><h3 id="æ•°æ®é€šä¿¡ç³»ç»Ÿçš„æ¨¡å‹"><a href="#æ•°æ®é€šä¿¡ç³»ç»Ÿçš„æ¨¡å‹" class="headerlink" title="æ•°æ®é€šä¿¡ç³»ç»Ÿçš„æ¨¡å‹"></a>æ•°æ®é€šä¿¡ç³»ç»Ÿçš„æ¨¡å‹</h3><p>ä¸‰å¤§éƒ¨åˆ†ï¼š  </p>
<ol>
<li>æºç³»ç»Ÿï¼ˆå‘é€ç«¯ã€å‘é€æ–¹ï¼‰</li>
<li>ä¼ è¾“ç³»ç»Ÿï¼ˆä¼ è¾“ç½‘ç»œï¼‰</li>
<li>ç›®çš„ç³»ç»Ÿï¼ˆæ¥æ”¶ç«¯ã€æ¥æ”¶æ–¹ï¼‰</li>
</ol>
<p>æºç³»ç»Ÿã€ç›®çš„ç³»ç»Ÿå¯ç»†åˆ†ä¸ºï¼š</p>
<ol>
<li>æºç‚¹ï¼ˆ<strong>source</strong>ï¼‰</li>
<li>å‘é€å™¨ï¼ˆæ•°å­—æ¯”ç‰¹æµ-&gt;æ¨¡æ‹Ÿä¿¡å·ï¼‰</li>
<li>æ¥æ”¶å™¨ï¼ˆæ¨¡æ‹Ÿä¿¡å·-&gt;æ•°å­—æ¯”ç‰¹æµï¼‰</li>
<li>ç»ˆç‚¹ï¼ˆdestinationï¼‰</li>
</ol>
<h3 id="æœ‰å…³ä¿¡é“çš„å‡ ä¸ªæ¦‚å¿µ"><a href="#æœ‰å…³ä¿¡é“çš„å‡ ä¸ªæ¦‚å¿µ" class="headerlink" title="æœ‰å…³ä¿¡é“çš„å‡ ä¸ªæ¦‚å¿µ"></a>æœ‰å…³ä¿¡é“çš„å‡ ä¸ªæ¦‚å¿µ</h3><p>ä»é€šä¿¡çš„åŒæ–¹ä¿¡æ¯äº¤äº’æ¥çœ‹ï¼Œä¸‰ç§åŸºæœ¬æ–¹å¼ï¼š  </p>
<ol>
<li>å•å‘é€šä¿¡ï¼ˆå•å·¥é€šä¿¡ï¼‰</li>
<li>åŒå‘äº¤æ›¿é€šä¿¡ï¼ˆåŠåŒå·¥é€šä¿¡ï¼‰</li>
<li>åŒå‘åŒæ—¶é€šä¿¡ï¼ˆå…¨åŒå·¥é€šä¿¡ï¼‰</li>
</ol>
<p>â€œå•å·¥â€æœ‰æ—¶ä¹Ÿè¡¨ç¤ºåŒå‘äº¤æ›¿é€šä¿¡ã€‚</p>
<p>æ¥è‡ªä¿¡æºçš„ä¿¡å·ç§°ä¸º<strong>åŸºå¸¦ä¿¡å·</strong>ï¼ˆåŸºæœ¬é¢‘å¸¦ä¿¡å·ï¼‰ã€‚ä¿¡é“ä¸èƒ½ä¼ è¾“ä½é¢‘åˆ†é‡æˆ–ç›´æµåˆ†é‡ï¼Œæ•…éœ€è¦å¯¹åŸºå¸¦ä¿¡å·è¿›è¡Œ<strong>è°ƒåˆ¶ï¼ˆmodulationï¼‰</strong>ã€‚</p>
<p>è°ƒåˆ¶çš„åˆ†ç±»ï¼š</p>
<ol>
<li><strong>åŸºå¸¦è°ƒåˆ¶</strong>ï¼ˆ<strong>ç¼–ç </strong>ï¼‰ï¼šå¯¹æ³¢å½¢å˜æ¢ï¼Œå˜æ¢åä»æ˜¯åŸºå¸¦ä¿¡å·ï¼Œä»æ˜¯æ•°å­—ä¿¡å·ã€‚</li>
<li><strong>å¸¦é€šè°ƒåˆ¶</strong>ï¼šä½¿ç”¨<strong>è½½æ³¢ï¼ˆcarrierï¼‰</strong>è¿›è¡Œè°ƒåˆ¶ï¼ŒæŠŠåŸºå¸¦ä¿¡å·çš„é¢‘ç‡èŒƒå›´æ¬ç§»åˆ°è¾ƒé«˜çš„é¢‘æ®µï¼Œå¹¶è½¬æ¢ä¸ºæ¨¡æ‹Ÿä¿¡å·ã€‚è½½æ³¢è°ƒåˆ¶åçš„ä¿¡å·æˆä¸º<strong>å¸¦é€šä¿¡å·</strong>ï¼ˆä»…åœ¨ä¸€æ®µé¢‘ç‡èŒƒå›´å†…èƒ½é€šè¿‡ä¿¡å·ï¼‰ã€‚</li>
</ol>
<h4 id="å¸¸ç”¨çš„ç¼–ç æ–¹å¼"><a href="#å¸¸ç”¨çš„ç¼–ç æ–¹å¼" class="headerlink" title="å¸¸ç”¨çš„ç¼–ç æ–¹å¼"></a>å¸¸ç”¨çš„ç¼–ç æ–¹å¼</h4><p><img src="/2019/10/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E6%95%B0%E5%AD%97%E4%BF%A1%E5%8F%B7%E5%B8%B8%E7%94%A8%E7%9A%84%E7%BC%96%E7%A0%81%E6%96%B9%E5%BC%8F.png" alt="æ•°å­—ä¿¡å·å¸¸ç”¨çš„ç¼–ç æ–¹å¼"></p>
<ol>
<li><strong>ä¸å½’é›¶åˆ¶</strong>ï¼šç”µå¹³ä»£è¡¨01</li>
<li><strong>å½’é›¶åˆ¶</strong>ï¼šè„‰å†²ä»£è¡¨01ï¼›ä½å¼€å§‹è¾¹ç•Œæ€»æ˜¯ä¸­é—´ç”µå¹³ã€‚</li>
<li><strong>æ›¼å½»æ–¯ç‰¹ç¼–ç </strong>ï¼šä½å‘¨æœŸä¸­å¿ƒè·³å˜ä»£è¡¨01.</li>
<li><strong>å·®åˆ†æ›¼å½»æ–¯ç‰¹ç¼–ç </strong>ï¼šä½ä¸­å¿ƒæ€»æ˜¯è·³å˜ï¼›ä½å¼€å§‹è¾¹ç•Œè·³å˜ä¸º0ï¼Œä¸è·³å˜ä¸º1ã€‚</li>
</ol>
<p>è‡ªåŒæ­¥ï¼šä»ä¿¡å·æ³¢å½¢æœ¬èº«æå–ä¿¡å·æ—¶é’Ÿé¢‘ç‡ã€‚</p>
<h4 id="åŸºæœ¬çš„å¸¦é€šè°ƒåˆ¶æ–¹æ³•"><a href="#åŸºæœ¬çš„å¸¦é€šè°ƒåˆ¶æ–¹æ³•" class="headerlink" title="åŸºæœ¬çš„å¸¦é€šè°ƒåˆ¶æ–¹æ³•"></a>åŸºæœ¬çš„å¸¦é€šè°ƒåˆ¶æ–¹æ³•</h4><p><img src="/2019/10/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%B8%A6%E9%80%9A%E8%B0%83%E5%88%B6%E6%96%B9%E6%B3%95.png" alt="åŸºæœ¬çš„å¸¦é€šè°ƒåˆ¶æ–¹æ³•"></p>
<ol>
<li><strong>è°ƒå¹…ï¼ˆAMï¼‰</strong>ï¼šæŒ¯å¹…éšæ•°å­—ä¿¡å·å˜åŒ–ã€‚<br>2.<strong>è°ƒé¢‘ï¼ˆFMï¼‰</strong>ï¼šé¢‘ç‡éšæ•°å­—ä¿¡å·å˜åŒ–ã€‚</li>
<li><strong>è°ƒç›¸ï¼ˆPMï¼‰</strong>ï¼šåˆç›¸ä½éšæ•°å­—ä¿¡å·å˜åŒ–ã€‚</li>
</ol>
<p>ä¸ºäº†æ›´é«˜çš„ä¿¡æ¯ä¼ è¾“é€Ÿç‡ï¼Œå¿…é¡»é‡‡ç”¨å¤šå…ƒåˆ¶çš„æŒ¯å¹…ç›¸ä½æ··åˆè°ƒåˆ¶æ–¹æ³•ã€‚ä¾‹å¦‚<strong>æ­£äº¤æŒ¯å¹…è°ƒåˆ¶QAMï¼ˆQuadrature Amplitude Modulationï¼‰</strong>ã€‚</p>
<h3 id="ä¿¡é“çš„æé™å®¹é‡"><a href="#ä¿¡é“çš„æé™å®¹é‡" class="headerlink" title="ä¿¡é“çš„æé™å®¹é‡"></a>ä¿¡é“çš„æé™å®¹é‡</h3><p>é™åˆ¶ç å…ƒåœ¨ä¿¡é“ä¸Šçš„ä¼ è¾“é€Ÿç‡çš„å› ç´ æœ‰ä¸¤ä¸ªï¼š  </p>
<ol>
<li>ä¿¡é“èƒ½é€šè¿‡çš„é¢‘ç‡èŒƒå›´</li>
<li>ä¿¡å™ªæ¯”</li>
</ol>
<h4 id="ä¿¡é“èƒ½é€šè¿‡çš„é¢‘ç‡èŒƒå›´"><a href="#ä¿¡é“èƒ½é€šè¿‡çš„é¢‘ç‡èŒƒå›´" class="headerlink" title="ä¿¡é“èƒ½é€šè¿‡çš„é¢‘ç‡èŒƒå›´"></a>ä¿¡é“èƒ½é€šè¿‡çš„é¢‘ç‡èŒƒå›´</h4><p><strong>ç é—´ä¸²æ‰°</strong>ï¼šæ¥æ”¶ç«¯æ”¶åˆ°çš„ä¿¡å·æ³¢å½¢å¤±å»äº†ç å…ƒä¹‹é—´çš„æ¸…æ™°ç•Œé™ã€‚</p>
<p><strong>å¥ˆæ°å‡†åˆ™</strong>ï¼šç®—å‡ºç†æƒ³æ¡ä»¶ä¸‹ã€é¿å…ç é—´ä¸²æ‰°ï¼Œç å…ƒçš„ä¼ è¾“é€Ÿç‡çš„ä¸Šé™å€¼ã€‚è¶…è¿‡æ­¤ä¸Šé™ï¼Œæ¥æ”¶ç«¯å¯¹ç å…ƒçš„è¯†åˆ«æˆä¸ºä¸å¯èƒ½ã€‚</p>
<p>ä¿¡é“çš„é¢‘å¸¦è¶Šå®½ï¼Œèƒ½é€šè¿‡çš„ä¿¡å·é«˜é¢‘åˆ†é‡è¶Šå¤šï¼Œå°±å¯ç”¨æ›´é«˜é€Ÿç‡ä¼ é€ç å…ƒè€Œä¸å‡ºç°ç é—´ä¸²æ‰°ã€‚</p>
<h4 id="ä¿¡å™ªæ¯”"><a href="#ä¿¡å™ªæ¯”" class="headerlink" title="ä¿¡å™ªæ¯”"></a>ä¿¡å™ªæ¯”</h4><p>ä¿¡å™ªæ¯”å°±æ˜¯ä¿¡å·çš„å¹³å‡åŠŸç‡å’Œå™ªå£°çš„å¹³å‡åŠŸç‡ä¹‹æ¯”ï¼Œè®°ä¸º$S&#x2F;N$ã€‚</p>
<p>$$<br>\text{ä¿¡å™ªæ¯”(dB)} &#x3D; 10 \log_{10}(S&#x2F;N) \text{(dB)}<br>$$</p>
<h4 id="é¦™å†œå…¬å¼"><a href="#é¦™å†œå…¬å¼" class="headerlink" title="é¦™å†œå…¬å¼"></a>é¦™å†œå…¬å¼</h4><p><strong>ä¿¡é“çš„æé™ä¿¡æ¯ä¼ è¾“é€Ÿç‡</strong>$C$ï¼š</p>
<p>$$<br>C &#x3D; W \log_2(1 + S&#x2F;N) \text{(bit&#x2F;s)}<br>$$</p>
<p>$W$æ˜¯ä¿¡é“çš„å¸¦å®½(Hz)ï¼ŒSæ˜¯ä¿¡é“å†…æ‰€ä¼ ä¿¡å·çš„å¹³å‡åŠŸç‡ï¼ŒNæ˜¯ä¿¡é“å†…é«˜æ–¯å™ªå£°åŠŸç‡ã€‚</p>
<p>åªè¦ä¿¡æ¯ä¼ è¾“é€Ÿç‡ä½äºä¿¡é“çš„æé™ä¿¡æ¯ä¼ è¾“é€Ÿç‡ï¼Œå°±ä¸€å®šå­˜åœ¨æŸç§åŠæ³•æ¥å®ç°æ— å·®é”™çš„ä¼ è¾“ã€‚</p>
<p>è¦æé«˜ä¿¡æ¯çš„ä¼ è¾“é€Ÿç‡ï¼Œè¿˜å¯ç”¨ç¼–ç çš„æ–¹æ³•è®©æ¯ä¸€ä¸ªç å…ƒæºå¸¦æ›´å¤šæ¯”ç‰¹çš„ä¿¡æ¯é‡ã€‚</p>
<h2 id="2-3-ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“"><a href="#2-3-ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“" class="headerlink" title="2.3 ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“"></a>2.3 ç‰©ç†å±‚ä¸‹é¢çš„ä¼ è¾“åª’ä½“</h2><p><strong>ä¼ è¾“åª’ä½“</strong>ï¼ˆä¼ è¾“ä»‹è´¨ï¼Œä¼ è¾“åª’ä»‹ï¼‰æ˜¯å‘é€å™¨å’Œæ¥æ”¶å™¨ä¹‹é—´çš„ç‰©ç†é€šè·¯ã€‚å¯åˆ†ä¸ºä¸¤å¤§ç±»ï¼š<strong>å¼•å¯¼å‹ï¼ˆguidedï¼‰</strong>ï¼Œ<strong>éå¼•å¯¼å‹</strong>ã€‚</p>
<p>å¼•å¯¼å‹æ²¿ç€å›ºä½“åª’ä½“ä¼ æ’­ï¼›éå¼•å¯¼å‹æŒ‡å‘è‡ªç”±ç©ºé—´ï¼Œæ— çº¿ä¼ è¾“ã€‚</p>
<h3 id="å¼•å¯¼å‹ä¼ è¾“åª’ä½“"><a href="#å¼•å¯¼å‹ä¼ è¾“åª’ä½“" class="headerlink" title="å¼•å¯¼å‹ä¼ è¾“åª’ä½“"></a>å¼•å¯¼å‹ä¼ è¾“åª’ä½“</h3><ol>
<li><strong>åŒç»çº¿ï¼ˆtwisted pairsï¼‰</strong>ï¼šæœ€å¸¸ç”¨ï¼Œä¾¿å®œï¼Œæ€§èƒ½ä¸é”™ã€‚è·ç¦»å¤ªé•¿æ—¶éœ€è¦æ”¾å¤§å™¨ï¼ˆæ¨¡æ‹Ÿä¼ è¾“ï¼‰æˆ–ä¸­ç»§å™¨ï¼ˆæ•°å­—ä¼ è¾“ï¼‰ï¼ŒåŠ ç²—å¯¼çº¿ã€‚<strong>å±è”½åŒç»çº¿ï¼ˆSTPï¼ŒShielded Twisted Pairï¼‰</strong>ï¼›<strong>æ— å±è”½åŒç»çº¿ï¼ˆUTPï¼ŒUnshielded Twisted Pairï¼‰</strong>ã€‚</li>
<li><strong>åŒè½´ç”µç¼†ï¼ˆcoaxial cableï¼‰</strong></li>
<li><strong>å…‰ç¼†ï¼ˆfiber cableï¼‰</strong></li>
</ol>
<h3 id="éå¼•å¯¼å‹ä¼ è¾“åª’ä½“"><a href="#éå¼•å¯¼å‹ä¼ è¾“åª’ä½“" class="headerlink" title="éå¼•å¯¼å‹ä¼ è¾“åª’ä½“"></a>éå¼•å¯¼å‹ä¼ è¾“åª’ä½“</h3><p>çŸ­æ³¢ï¼ˆé«˜é¢‘ï¼‰é€šä¿¡ï¼šé ç”µç¦»å±‚çš„åå°„ï¼›å¤šå¾„æ•ˆåº”ï¼Œè´¨é‡è¾ƒå·®ï¼Œä½é€Ÿä¼ è¾“ã€‚</p>
<p> å¾®æ³¢é€šä¿¡ï¼š  </p>
<ol>
<li>åœ°é¢å¾®æ³¢æ¥åŠ›é€šä¿¡</li>
<li>å«æ˜Ÿé€šä¿¡</li>
</ol>
<h2 id="ä¿¡é“å¤ç”¨æŠ€æœ¯"><a href="#ä¿¡é“å¤ç”¨æŠ€æœ¯" class="headerlink" title="ä¿¡é“å¤ç”¨æŠ€æœ¯"></a>ä¿¡é“å¤ç”¨æŠ€æœ¯</h2><ol>
<li><strong>é¢‘åˆ†å¤ç”¨ï¼ˆFDM, Frequency Division Multiplexingï¼‰</strong>ï¼šç”¨æˆ·å§‹ç»ˆå ç”¨ä¸åŒé¢‘å¸¦</li>
<li><strong>æ—¶åˆ†å¤ç”¨ï¼ˆTDMï¼‰</strong>ï¼šæ›´æœ‰åˆ©äºæ•°å­—ä¿¡å·çš„ä¼ è¾“ã€‚åˆ©ç”¨ç‡ä¸é«˜ï¼Œè‹¥ç”¨æˆ·å¤ªå¤šåˆ™æ—¶éš™å¤ªçŸ­ã€‚</li>
<li><strong>ç»Ÿè®¡æ—¶åˆ†å¤ç”¨ï¼ˆSTDM, Statisticï¼‰</strong>ï¼šä¿å­˜ç”¨æˆ·ä¿¡æ¯å¤´ï¼Œæœ‰é¢å¤–èŠ±é”€ã€‚</li>
<li><strong>æ³¢åˆ†å¤ç”¨ï¼ˆWDM, Wavelength Division Multiplexingï¼‰</strong>ï¼šå…‰çš„é¢‘åˆ†å¤ç”¨ã€‚å…‰è½½æ³¢é¢‘ç‡å¾ˆé«˜ï¼Œå› æ­¤å¸¸ç”¨æ³¢é•¿ã€‚</li>
<li><strong>å¯†é›†æ³¢åˆ†å¤ç”¨ï¼ˆDWDN, Denseï¼‰</strong>ï¼šä¸€æ ¹å…‰çº¤ä¸Šå¤ç”¨å‡ åæˆ–æ›´å¤šè·¯ã€‚</li>
<li><strong>ç åˆ†å¤ç”¨ï¼ˆCDM, Codeï¼‰ï¼Œç åˆ†å¤šå€CDMAï¼ˆCode Division Multple Accessï¼‰</strong>ï¼šé¢‘è°±ç±»ä¼¼äºç™½å™ªå£°ï¼Œä¸æ˜“è¢«å‘ç°ï¼›æŠ—å¹²æ‰°èƒ½åŠ›å¼ºã€‚</li>
</ol>
<h2 id="2-5-æ•°å­—ä¼ è¾“ç³»ç»Ÿ"><a href="#2-5-æ•°å­—ä¼ è¾“ç³»ç»Ÿ" class="headerlink" title="2.5 æ•°å­—ä¼ è¾“ç³»ç»Ÿ"></a>2.5 æ•°å­—ä¼ è¾“ç³»ç»Ÿ</h2><h2 id="2-6-å®½å¸¦æ¥å…¥æŠ€æœ¯"><a href="#2-6-å®½å¸¦æ¥å…¥æŠ€æœ¯" class="headerlink" title="2.6 å®½å¸¦æ¥å…¥æŠ€æœ¯"></a>2.6 å®½å¸¦æ¥å…¥æŠ€æœ¯</h2><h3 id="ADSLæŠ€æœ¯"><a href="#ADSLæŠ€æœ¯" class="headerlink" title="ADSLæŠ€æœ¯"></a>ADSLæŠ€æœ¯</h3><p><strong>éå¯¹ç§°æ•°å­—ç”¨æˆ·çº¿ADSLï¼ˆAsymmetric Digital Subscriber Lineï¼‰</strong>æŠ€æœ¯æ˜¯ç”¨æ•°å­—æŠ€æœ¯å¯¹çº¿æœ‰çš„æ¨¡æ‹Ÿç”µè¯ç”¨æˆ·çº¿è¿›è¡Œæ”¹é€ ï¼Œä½¿å…¶æ‰¿è½½å®½å¸¦æ•°å­—ä¸šåŠ¡ã€‚</p>
<p>ADSLä¼ è¾“è·ç¦»å–å†³äºæ•°æ®ç‡å’Œç”¨æˆ·çº¿çš„çº¿å¾„ã€‚å®é™…æœ€é«˜æ•°æ®ä¼ è¾“é€Ÿç‡è¿˜ä¸ç”¨æˆ·çº¿ä¸Šçš„ä¿¡å™ªæ¯”å¯†åˆ‡ç›¸å…³ã€‚</p>
<p><strong>ç¦»æ•£å¤šéŸ³è°ƒ DMTï¼ˆDiscrete Multi-Toneï¼‰</strong>è°ƒåˆ¶æŠ€æœ¯ï¼šé¢‘åˆ†å¤ç”¨ï¼ˆ24kHz - 1.1MHzï¼‰åˆ’åˆ†ä¸ºè®¸å¤šå­ä¿¡é“ã€‚ç›¸å½“äºè®¸å¤šçš„è°ƒåˆ¶è§£è°ƒå™¨å¹¶è¡Œåœ°ä¼ é€æ•°æ®ã€‚</p>
<p>ADSLè‡ªé€‚åº”åœ°è°ƒæ•´å¯ç”¨é¢‘ç‡ä»¥é¿å¼€å¹²æ‰°ï¼Œå¯è§ä¸èƒ½ä¿è¯å›ºå®šçš„æ•°æ®ç‡</p>
<h2 id="ä¹ é¢˜-1"><a href="#ä¹ é¢˜-1" class="headerlink" title="ä¹ é¢˜"></a>ä¹ é¢˜</h2><ol>
<li>ICMPå±äºç½‘ç»œå±‚</li>
<li>SDLC, PPP, HDLCå±äºæ•°æ®é“¾è·¯å±‚</li>
<li>çº¢å¤–çº¿åœ¨å…‰çº¤ä¸­è¡°å‡ã€‚ç°æœ‰æ³¢æ®µæ˜¯0.85ï¼Œ1.30ï¼Œ1.55ï¼ˆå¾®ç±³ï¼Œe-6ï¼‰</li>
<li>ç”µè·¯äº¤æ¢ä¸ä½¿ç”¨å‚¨å­˜è½¬å‘ä¼ è¾“æŠ€æœ¯ã€‚</li>
<li>10base5ï¼Œä¸€ç§ä»¥å¤ªç½‘æ ‡å‡†ï¼Œè¯¥æ ‡å‡†ç”¨äºä½¿ç”¨ç²—åŒè½´ç”µç¼†ï¼ˆThick coaxialcableï¼‰ã€é€Ÿåº¦ä¸º10Mbpsçš„åŸºå¸¦å±€åŸŸç½‘ç»œï¼ŒåŸºäºæ›¼å½»æ–¯ç‰¹ç¼–ç ã€‚åœ¨æ€»çº¿å‹ç½‘ç»œä¸­ï¼Œæœ€è¿œä¼ è¾“è·ç¦»ä¸º500ç±³ã€‚</li>
<li>æ³¢ç‰¹ç‡ï¼ˆbaud rateï¼‰ä¸º1000çš„ä¿¡é“ï¼Œè‹¥å…¶ç”µå¹³çº§æ•°ä¸º16ï¼ˆ2^4ï¼‰ï¼Œåˆ™æ•°æ®ç‡ï¼ˆdata rateï¼‰å¯è¾¾4Kbpsã€‚</li>
<li>å½±å“æ•°æ®ä¼ è¾“ç‡çš„å› ç´ æœ‰ä¿¡å™ªæ¯”ã€é¢‘ç‡å¸¦å®½ã€è°ƒåˆ¶æ•ˆç‡ï¼ˆModulation rateï¼‰ã€‚ä¸å—ä¼ æ’­é€Ÿç‡å½±å“ã€‚</li>
<li>é¢‘åˆ†å¤ç”¨æ—¶ï¼Œæœ€å·¦å³ä¸¤ä¾§å¯ä¸è®¾ç½®ä¿æŠ¤é¢‘æ®µã€‚</li>
<li><img src="/2019/10/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E7%94%B5%E8%AF%9D%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%BB%84%E6%88%90.png" alt="ç”µè¯ç³»ç»Ÿç»“æ„"></li>
<li>å…‰çº¤å…·æœ‰è¾ƒå¥½çš„æŠ—å¹²æ‰°æ€§</li>
<li>äºŒå…ƒä¿¡å·ï¼Œ3KHzä¿¡é“ï¼Œä¿¡å™ªæ¯”S&#x2F;N 31ï¼Œæœ€å¤§ä¼ è¾“æ•°æ®ç‡ä¸º6Kbpsã€‚ï¼ˆå½“åšæ— å™ªå£°ä¿¡é“è®¡ç®—ï¼‰</li>
<li>E1è½½æ³¢ï¼Œ2.048Mbpsé€Ÿç‡çš„PCMè½½æ³¢ï¼ŒåŒæ­¥æ—¶åˆ†å¤ç”¨ï¼Œ30ä¸ªè¯éŸ³ä¿¡é“ï¼ˆ64Kï¼‰å’Œä¸¤ä¸ªæ§åˆ¶ä¿¡é“ï¼ˆ16Kï¼‰ã€‚  å¼€å§‹å’Œä¸­é—´å„æœ‰8ä½åˆ†åˆ«åšåŒæ­¥å’Œä¿¡ä»¤ï¼›30è·¯8ä½æ•°æ®ï¼›ç»„æˆä¸€å¸§ï¼Œ256ä½ï¼Œæ¯ä¸€å¸§125usæ—¶é—´ï¼ˆæ¯ç§’8000å¸§ï¼‰ã€‚ å¼€é”€å æ¯”2&#x2F;32 &#x3D; 6.25%ï¼Œ æœ‰æ•ˆæ•°æ®ç‡1.92Mbpsã€‚</li>
<li>T1è½½æ³¢ï¼Œ24ä¸ªä¿¡é“ï¼ˆæ¯ä¸ª8bitï¼‰ï¼Œå¤–åŠ 1bitå¸§åŒæ­¥æ•°æ®ï¼Œå…±193bitæ¯å¸§ã€‚æ¯ä¸ª8bitä¸­æœ‰1bitæ˜¯æ§åˆ¶æ•°æ®ã€‚å¯¹ä¸€è·¯è¯­éŸ³é€šé“ï¼Œæ•°æ®æ¯”ç‰¹ç‡æ˜¯7b&#x2F;125us&#x3D;56kb&#x2F;sã€‚æ€»çš„æ¯”ç‰¹ç‡193b&#x2F;125us&#x3D;1.544Mb&#x2F;sã€‚å¼€é”€å æ¯”(1*24+1)&#x2F;193 &#x3D; 13%ã€‚</li>
<li><img src="/2019/10/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E4%BF%A1%E9%81%93%E6%9C%80%E5%A4%A7%E4%BC%A0%E8%BE%93%E9%80%9F%E7%8E%87.png" alt="ä¿¡é“æœ€å¤§ä¼ è¾“é€Ÿç‡"></li>
<li>ç‰©ç†å±‚å…³å¿ƒåœ¨ä¸€ä¸ªé€šä¿¡ä¿¡é“ä¸Šä¼ è¾“çº¯æ¯”ç‰¹ã€‚</li>
</ol>
<h1 id="3-æ•°æ®é“¾è·¯å±‚"><a href="#3-æ•°æ®é“¾è·¯å±‚" class="headerlink" title="3 æ•°æ®é“¾è·¯å±‚"></a>3 æ•°æ®é“¾è·¯å±‚</h1><p>ä¸»è¦ä¿¡é“ç±»å‹ï¼š  </p>
<ol>
<li>ç‚¹å¯¹ç‚¹ä¿¡é“</li>
<li>å¹¿æ’­ä¿¡é“</li>
</ol>
<h2 id="ç‚¹å¯¹ç‚¹ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚"><a href="#ç‚¹å¯¹ç‚¹ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚" class="headerlink" title="ç‚¹å¯¹ç‚¹ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚"></a>ç‚¹å¯¹ç‚¹ä¿¡é“çš„æ•°æ®é“¾è·¯å±‚</h2><h3 id="æ•°æ®é“¾è·¯å’Œå¸§"><a href="#æ•°æ®é“¾è·¯å’Œå¸§" class="headerlink" title="æ•°æ®é“¾è·¯å’Œå¸§"></a>æ•°æ®é“¾è·¯å’Œå¸§</h3><p>æ•°æ®é“¾è·¯ &#x3D; ç‰©ç†é“¾è·¯ + é€šä¿¡åè®®</p>
<p>å¸¸ç”¨<strong>ç½‘ç»œé€‚é…å™¨</strong>å®ç°è¿™äº›ç¡¬ä»¶å’Œè½¯ä»¶ï¼Œé€‚é…å™¨ä¹Ÿå«æœ‰ç‰©ç†å±‚çš„åŠŸèƒ½ã€‚</p>
<p>ç½‘ç»œå±‚äº¤ä¸‹æ¥çš„æ•°æ®æ„æˆ<strong>å¸§</strong>â€”â€”æ•°æ®é“¾è·¯å±‚çš„åè®®æ•°æ®å•å…ƒã€‚ å¸§ä¸Šäº¤åˆ°ç½‘ç»œå±‚ç»„æˆIPæ•°æ®åŒ…ï¼ˆæ•°æ®åŒ…ã€åˆ†ç»„ã€åŒ…ï¼‰ã€‚</p>
<p>ç‚¹å¯¹ç‚¹ä¿¡é“åœ¨æ•°æ®é“¾è·¯å±‚é€šä¿¡æ—¶çš„ä¸»è¦æ­¥éª¤ï¼š  </p>
<ol>
<li>ç½‘ç»œå±‚ï¼ˆIPæ•°æ®æŠ¥ï¼‰-&gt;æ•°æ®é“¾è·¯å±‚</li>
<li>æ•°æ®é“¾è·¯å±‚æ·»åŠ é¦–éƒ¨å°¾éƒ¨ï¼Œæˆå¸§</li>
<li>å¸§å‘é€åˆ°å¦ä¸€ç»“ç‚¹</li>
<li>æ¥å—è€…çš„æ•°æ®é“¾è·¯å±‚æ£€é”™ï¼ˆæœ‰é”™åˆ™ä¸¢å¼ƒå¸§ï¼‰ï¼Œæå–IPæ•°æ®æŠ¥-&gt;ç½‘ç»œå±‚</li>
</ol>
<h3 id="ä¸‰ä¸ªåŸºæœ¬é—®é¢˜"><a href="#ä¸‰ä¸ªåŸºæœ¬é—®é¢˜" class="headerlink" title="ä¸‰ä¸ªåŸºæœ¬é—®é¢˜"></a>ä¸‰ä¸ªåŸºæœ¬é—®é¢˜</h3><ol>
<li>å°è£…æˆå¸§</li>
<li>é€æ˜ä¼ è¾“</li>
<li>å·®é”™æ£€æµ‹</li>
</ol>
<p>å°è£…æˆå¸§ï¼š</p>
<p>é“¾è·¯å±‚åè®®è§„å®šäº†<strong>æœ€å¤§ä¼ è¾“å•å…ƒï¼ˆMTU, Maximum Transfer Unitï¼‰</strong>ï¼Œè¡¨ç¤ºå¸§èƒ½å®¹çº³çš„æœ€å¤§æ•°æ®ï¼ˆä¸è®¡é¦–éƒ¨å’Œå°¾éƒ¨ï¼‰ã€‚</p>
<p>å¦‚æœæ•°æ®æ˜¯ASCIIç¼–ç çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå¸§å¤´æ ‡è®°æ˜¯<strong>SOH(Start Of Header, 0x01)<strong>ï¼Œå¸§å°¾æ ‡è®°æ˜¯</strong>EOT(End Of Transmissionï¼Œ0x04)</strong> ã€‚</p>
<p>é€æ˜ä¼ è¾“ï¼š</p>
<p>è‹¥æ–‡æœ¬æ— éœ€å¤„ç†ï¼ˆä¸ä¼šå‡ºç°SOHå’ŒEOTï¼‰ï¼Œåˆ™ä¼ è¾“æ˜¯<strong>é€æ˜ä¼ è¾“</strong>ã€‚</p>
<p>è‹¥æ–‡æœ¬æ— æ³•é€æ˜ä¼ è¾“ï¼Œå¯ä»¥ç”¨<strong>å­—èŠ‚å¡«å……ï¼ˆbyte stuffingï¼‰</strong>æˆ–<strong>å­—ç¬¦å¡«å……ï¼ˆcharacter stuffingï¼‰</strong>ã€‚åœ¨ç‰¹æ®Šå­—ç¬¦å‰æ’å…¥<strong>è½¬ä¹‰å­—ç¬¦</strong>â€œ<strong>ESCï¼ˆ0x1Bï¼‰</strong>â€ã€‚ä¾‹å¦‚æ–‡æœ¬å«&quot;0x1B&quot;ï¼Œå°±ä¼ è¾“ &quot;0x1B 0x1B&quot;ã€‚</p>
<p>æ•°æ®é“¾è·¯å±‚è¿˜åŸIPæ•°æ®æŠ¥æ—¶éœ€è¦å»é™¤è½¬ä¹‰ä¿¡æ¯ã€‚</p>
<p>å·®é”™æ£€æµ‹ï¼š</p>
<p><strong>è¯¯ç ç‡ï¼ˆBER, Bit Error Rateï¼‰</strong>æŒ‡å•ä½æ—¶é—´å†…é”™è¯¯æ¯”ç‰¹çš„æ¯”ç‡ã€‚</p>
<p><strong>å¾ªç¯å†—ä½™æ£€éªŒï¼ˆCRC, Cyclic Redundancyï¼‰</strong></p>
<p>å‡è®¾ä¼ é€æ•°æ®$M$ï¼Œ<em>äº‹å…ˆçº¦å®š</em>é™¤æ•°$P\textï¼ˆn+1ä½äºŒè¿›åˆ¶ï¼‰$ï¼Œåšå¼‚æˆ–å–æ¨¡$R\text{(nä½äºŒè¿›åˆ¶)} &#x3D;  2^nM \mod P$ã€‚</p>
<p>$R$ä½œä¸º<strong>å¸§æ£€éªŒåºåˆ—ï¼ˆFCS, Frame Check Sequenceï¼‰</strong>ï¼Œä¹Ÿæ”¾åœ¨æ•°æ®æœ«å°¾ã€‚</p>
<p>æ¥æ”¶ç«¯ç›´æ¥åšå¼‚æˆ–å–æ¨¡ï¼Œè‹¥æ— å·®é”™ï¼Œä½™æ•°ä¸º0ã€‚</p>
<p>ç”¨å¤šé¡¹å¼è¡¨ç¤ºï¼Œé™¤æ•°$P&#x3D;1100&#x3D;X^3 + X^2 + 1$ã€‚</p>
<p>ç°åœ¨å¯ä»¥è¿‘ä¼¼è®¤ä¸ºâ€œå‡¡æ˜¯æ¥æ”¶ç«¯æ•°æ®é“¾è·¯å±‚æ¥æ”¶çš„å¸§å‡æ— å·®é”™â€ã€‚ä½†å°šæœªè€ƒè™‘<strong>å¸§ä¸¢å¤±ã€é‡å¤ã€å¤±åº</strong>ç­‰é—®é¢˜ï¼Œå³é<strong>å¯é ä¼ è¾“</strong>ã€‚</p>
<p>OSIè¦æ±‚å¯é ä¼ è¾“ï¼Œå› æ­¤æœ‰CRCï¼Œ<strong>å¸§ç¼–å·ã€ç¡®è®¤</strong>å’Œ<strong>é‡ä¼ æœºåˆ¶</strong>ã€‚ä½†ç°åœ¨çš„æ•°æ®é“¾è·¯å±‚ä¸ä½¿ç”¨ç¡®è®¤å’Œé‡ä¼ ï¼Œè€Œå°†å·®é”™äº¤ç»™ä¸Šå±‚åè®®ï¼ˆå¦‚è¿è¾“å±‚TCPï¼‰æ¥å¤„ç†ã€‚</p>
<h2 id="ç‚¹å¯¹ç‚¹åè®®PPP"><a href="#ç‚¹å¯¹ç‚¹åè®®PPP" class="headerlink" title="ç‚¹å¯¹ç‚¹åè®®PPP"></a>ç‚¹å¯¹ç‚¹åè®®PPP</h2><p>PPPåè®®æ˜¯ç”¨æˆ·å’ŒISPé€šä¿¡æ—¶ä½¿ç”¨çš„æ•°æ®é“¾è·¯å±‚åè®®ã€‚</p>
<h3 id="PPPåè®®çš„ç‰¹ç‚¹"><a href="#PPPåè®®çš„ç‰¹ç‚¹" class="headerlink" title="PPPåè®®çš„ç‰¹ç‚¹"></a>PPPåè®®çš„ç‰¹ç‚¹</h3><ol>
<li>ç®€å•ã€‚å°†ç¹æ‚ä»»åŠ¡ä¸¢ç»™TCP&#x2F;IPã€‚ä¸çº é”™ï¼Œæ— åºå·ï¼Œæ— æµé‡æ§åˆ¶ã€‚ä»…åšCRCæ£€éªŒã€‚</li>
<li>å°è£…æˆå¸§ã€‚ä½¿ç”¨å¸§å®šç•Œç¬¦ã€‚</li>
<li>é€æ˜æ€§ã€‚è§„é¿æ–‡æœ¬å‡ºç°çš„å¸§å®šç•Œç¬¦ã€‚</li>
<li>æ”¯æŒå¤šç§ç½‘ç»œå±‚åè®®ï¼Œåœ¨åŒä¸€ç‰©ç†é“¾è·¯ä¸Šã€‚</li>
<li>æ”¯æŒå¤šç§é“¾è·¯ã€‚</li>
<li>å·®é”™æ£€æµ‹ã€‚ç«‹å³ä¸¢å¼ƒé”™è¯¯å¸§ã€‚</li>
<li>æ£€æµ‹è¿æ¥çŠ¶æ€ã€‚åŠæ—¶å‘ç°é“¾è·¯æ•…éšœæˆ–æ¢å¤ã€‚</li>
<li>æœ€å¤§ä¼ é€å•å…ƒMTUçš„æ ‡å‡†é»˜è®¤å€¼ã€‚</li>
<li>ç½‘ç»œå±‚åœ°å€åå•†ã€‚ä½¿é€šä¿¡çš„ä¸¤ä¸ªç½‘ç»œå±‚çŸ¥é“æˆ–é…ç½®å½¼æ­¤çš„ç½‘ç»œå±‚åœ°å€ã€‚</li>
<li>æ•°æ®å‹ç¼©åå•†ã€‚</li>
</ol>
<p>PPPä¸éœ€è¦çš„åŠŸèƒ½ï¼š  </p>
<ol>
<li>çº é”™</li>
<li>æµé‡æ§åˆ¶</li>
<li>åºå·ï¼ˆPPPä¸æ˜¯å¯é ä¼ è¾“åè®®ï¼‰</li>
<li>å¤šç‚¹çº¿è·¯</li>
<li>åŠåŒå·¥æˆ–å•å·¥é“¾è·¯ï¼ˆPPPä»…æ”¯æŒå…¨åŒå·¥é“¾è·¯ï¼‰</li>
</ol>
<p>PPPåè®®çš„ç»„æˆï¼š  </p>
<ol>
<li>IPæ•°æ®åŒ…å°è£…åˆ°ä¸²è¡Œé“¾è·¯çš„æ–¹æ³•ã€‚PPPæ—¢æ”¯æŒå¼‚æ­¥é“¾è·¯ï¼ˆæ— å¥‡å¶æ ¡éªŒçš„8æ¯”ç‰¹æ•°æ®ï¼‰ï¼Œä¹Ÿæ”¯æŒé¢å‘æ¯”ç‰¹çš„åŒæ­¥é“¾è·¯ã€‚</li>
<li><strong>é“¾è·¯æ§åˆ¶åè®®LCPï¼ˆLink Control Protocolï¼‰</strong>ã€‚å»ºç«‹ã€é…ç½®å’Œæµ‹è¯•æ•°æ®é“¾è·¯è¿æ¥ã€‚</li>
<li><strong>ç½‘ç»œæ§åˆ¶åè®®NCPï¼ˆNetwork Control Protocolï¼‰</strong>ã€‚ç”¨æ¥æ”¯æŒä¸åŒçš„ç½‘ç»œå±‚åè®®ã€‚</li>
</ol>
<h3 id="PPPåè®®çš„å¸§æ ¼å¼"><a href="#PPPåè®®çš„å¸§æ ¼å¼" class="headerlink" title="PPPåè®®çš„å¸§æ ¼å¼"></a>PPPåè®®çš„å¸§æ ¼å¼</h3><p><img src="/2019/10/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/PPP%E5%B8%A7%E7%9A%84%E6%A0%BC%E5%BC%8F.png" alt="PPPåè®®çš„å¸§æ ¼å¼"></p>
<p>å½“â€œåè®®â€ä¸º0x0021å°±æ˜¯IPæ•°æ®åŒ…ï¼Œ<br>ä¸º0xC021å°±æ˜¯LCPæ•°æ®ï¼Œ<br>ä¸º0x8021å°±æ˜¯ç½‘ç»œå±‚çš„æ§åˆ¶æ•°æ®ã€‚</p>
<p>å­—èŠ‚å¡«å……ï¼š</p>
<p>å¼‚æ­¥ï¼š  </p>
<ol>
<li>0x7E -&gt; (0x7D, 0x5E)</li>
<li>0x7D -&gt; (0x7D, 0x5D)</li>
<li>ASCIIæ§åˆ¶å­—ç¬¦ï¼ˆå°äº0x20ï¼‰ -&gt; (0x7D 0x??)</li>
</ol>
<p>é›¶æ¯”ç‰¹å¡«å……ï¼š ç”¨äºSONET&#x2F;SDHé“¾è·¯ï¼ŒåŒæ­¥ä¼ è¾“<br>ä¿¡æ¯å­—æ®µä¸­5ä¸ªè¿ç»­çš„1åæ’å…¥ä¸€ä¸ª0ã€‚æœ‰æ•ˆé¿å¼€äº†0x7Eã€‚</p>
<h3 id="PPPåè®®çš„å·¥ä½œçŠ¶æ€"><a href="#PPPåè®®çš„å·¥ä½œçŠ¶æ€" class="headerlink" title="PPPåè®®çš„å·¥ä½œçŠ¶æ€"></a>PPPåè®®çš„å·¥ä½œçŠ¶æ€</h3><p><img src="/2019/10/04/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/PPP%E5%8D%8F%E8%AE%AE%E7%9A%84%E7%8A%B6%E6%80%81%E5%9B%BE.png" alt="PPPåè®®çš„çŠ¶æ€å›¾"></p>
<h2 id="ä¹ é¢˜-2"><a href="#ä¹ é¢˜-2" class="headerlink" title="ä¹ é¢˜"></a>ä¹ é¢˜</h2><ol>
<li>selective repeat protocol æœ€å¤§æ¥å—çª—å£ä¸º$2^M-1$</li>
<li>Go-Back-N æœ€å¤§æ¥æ”¶çª—å£æ˜¯$2^{M-1}$ï¼ˆé»˜è®¤æ¥æ”¶çª—å£å¤§å° &#x3D; å‘é€çª—å£å¤§å°ï¼‰</li>
<li>CRCå¼‚æˆ–å–æ¨¡ã€‚åˆ«å¿˜äº†å…ˆå·¦ç§»nä½</li>
<li>çº é”™éœ€è¦è·ç¦»ä¸º2d+1æ¯”ç‰¹çš„ç¼–ç </li>
<li>æ£€æµ‹éœ€è¦è·ç¦»ä¸ºd+1æ¯”ç‰¹çš„ç¼–ç </li>
<li>æ•°æ®é“¾è·¯å±‚çš„åŠŸèƒ½ï¼šä¸ºç½‘ç»œå±‚æä¾›æ˜ç¡®çš„æœåŠ¡æ¥å£ï¼›è°ƒèŠ‚æ•°æ®æµï¼Œä»¥å¸®åŠ©æ…¢é€Ÿæ¥æ”¶è€…ä¸è¢«æ·¹æ²¡ã€‚</li>
<li>å¤„ç†ä¼ è¾“é”™è¯¯</li>
<li>PPPæä¾›äº†NCPï¼ŒLCPå’Œå¸§çš„å°è£…æ–¹æ³•</li>
<li>ï¼Ÿï¼Ÿï¼ŸPPPæä¾›äº†åå•†ç½‘ç»œå±‚é€‰é¡¹çš„æ–¹æ³•ï¼ˆè€Œä¸æ˜¯SLIP, BOOTP, HDLCï¼‰</li>
<li>PPP, HDLC, SDLC(åŒæ­¥) å±äºæ•°æ®é“¾è·¯å±‚ã€‚ICMPå±äºç½‘ç»œå±‚ã€‚</li>
<li>PPPå¸§åŒ…æ‹¬flagsï¼Œaddressï¼Œcontrolï¼Œprotocolï¼Œpayloadï¼Œchecksumã€‚</li>
</ol>
]]></content>
      <tags>
        <tag>è®¡ç®—æœºç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>è¯†è¶£</title>
    <url>/2019/04/07/%E8%AF%86%E8%B6%A3/</url>
    <content><![CDATA[<span id="more"></span>

<h3 id="æ¢åº•å…¬å¼"><a href="#æ¢åº•å…¬å¼" class="headerlink" title="æ¢åº•å…¬å¼"></a>æ¢åº•å…¬å¼</h3><p>$\log_ab &#x3D; \frac{\ln b}{\ln a}$</p>
<blockquote>
<p>è¯æ˜ï¼š<br>$e^{\ln a * \log_an} &#x3D; b$ ä¸¤è¾¹å–å¯¹æ•°ï¼Œç§»é¡¹ã€‚</p>
</blockquote>
<p>$A^{\log_bC} &#x3D; C^{\log_bA}$</p>
<blockquote>
<p>è¯æ˜ï¼šä¸¤è¾¹å–å¯¹æ•°ï¼Œå¾—$\log_bC \ln A &#x3D; \frac{\ln C}{\ln b}*\ln A$</p>
</blockquote>
<h3 id="åˆ†æ²»çš„æ—¶é—´å¤æ‚åº¦"><a href="#åˆ†æ²»çš„æ—¶é—´å¤æ‚åº¦" class="headerlink" title="åˆ†æ²»çš„æ—¶é—´å¤æ‚åº¦"></a>åˆ†æ²»çš„æ—¶é—´å¤æ‚åº¦</h3><p>$T(N) &#x3D; aT(N&#x2F;b) + \Theta(N^k \log_p N)$</p>
<p>$$<br>T(N) &#x3D; \begin{cases}<br>O(N^{\log_b a})&amp; \text{if }a &gt; b^k \<br>O(N^k \log_{p+1} N)&amp; \text{if }a &#x3D; b^k \<br>O(N^k \log_{p} N)&amp; \text{if }a &lt; b^k \<br>\end{cases}<br>$$</p>
<h3 id="ä¸‰è§’å‡½æ•°"><a href="#ä¸‰è§’å‡½æ•°" class="headerlink" title="ä¸‰è§’å‡½æ•°"></a>ä¸‰è§’å‡½æ•°</h3><h4 id="sin-cos-tançŸ¥ä¸€æ±‚äºŒ"><a href="#sin-cos-tançŸ¥ä¸€æ±‚äºŒ" class="headerlink" title="sin,cos,tançŸ¥ä¸€æ±‚äºŒ"></a>sin,cos,tançŸ¥ä¸€æ±‚äºŒ</h4><p>è¯•è¯•$(\tan^2x)^{(-1)^k}+1 &#x3D; ?$</p>
]]></content>
      <tags>
        <tag>æ•°å­¦</tag>
      </tags>
  </entry>
</search>
